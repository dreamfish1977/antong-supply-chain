<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®‰é€šä¾›åº”é“¾ - ç®¡ç†åå°</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Vue.js -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Apache ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <!-- SheetJS for Excel import -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <style>
    body, html {
      font-family: "Microsoft YaHei", "æ€æºé»‘ä½“", "Source Han Sans SC", "Noto Sans SC", "PingFang SC", "Hiragino Sans GB", "Helvetica Neue", Helvetica, Arial, sans-serif;
      background-color: #f9fafb;
      color: #1f2937;
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
    }
    
    .sidebar {
      background: #ffffff;
      border-right: 1px solid #e5e7eb;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
    }
    
    .menu-item {
      transition: all 0.2s;
      color: #4b5563;
    }
    
    .menu-item:hover {
      background: #f3f4f6;
    }
    
    .menu-item.active {
      background: #eff6ff;
      border-left: 3px solid #2563eb;
      color: #2563eb;
      font-weight: 600;
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-pending {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    
    .status-ongoing {
      background: #eff6ff;
      color: #2563eb;
      border: 1px solid #bfdbfe;
    }
    
    .status-completed {
      background: #f0fdf4;
      color: #16a34a;
      border: 1px solid #bbf7d0;
    }
    
    .table-container {
      max-height: calc(100vh - 200px);
      overflow-y: auto;
      overflow-x: auto;
    }
    
    .table-container::-webkit-scrollbar {
      width: 8px;
    }
    
    .table-container::-webkit-scrollbar-track {
      background: #f3f4f6;
    }
    
    .table-container::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
    
    .table-container::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    
    /* A4 æ‰“å°æ ·å¼ */
    .a4-page {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    
    @media print {
      @page {
        size: A4;
        margin: 0;
      }
      
      body * {
        visibility: hidden;
      }
      
      .print-area,
      .print-area * {
        visibility: visible;
      }
      
      .print-area {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      
      .a4-page {
        width: 210mm;
        min-height: 297mm;
        margin: 0;
        padding: 15mm;
        box-shadow: none;
        page-break-after: always;
      }
      
      .print\\:hidden {
        display: none !important;
      }
      
      /* ç¡®ä¿æ‰“å°æ—¶æ–‡å­—ä¸ºé»‘è‰²ï¼Œä½†ä¿ç•™çº¢è‰²ECOæ ‡è®° */
      .a4-page,
      .a4-page * {
        color: #000 !important;
      }
      
      /* ECO çº¢è‰²æ ‡è®°åœ¨æ‰“å°æ—¶ä¿æŒå¯è§ï¼ˆåŠ ç²—é»‘è‰²ï¼‰ */
      .a4-page .text-red-600,
      .a4-page .text-red-700 {
        color: #000 !important;
        font-weight: bold !important;
      }
      
      /* ECO è­¦ç¤ºæ¡†åœ¨æ‰“å°æ—¶ä¿æŒè¾¹æ¡† */
      .a4-page .bg-red-50 {
        background-color: #fff !important;
        border: 2px solid #000 !important;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="flex h-screen">
      <!-- å·¦ä¾§ä¾§è¾¹æ  -->
      <aside class="sidebar w-64 flex flex-col">
        <!-- Logo åŒºåŸŸ -->
        <div class="p-6 border-b border-gray-200">
          <div class="text-xl font-bold text-orange-500">å®‰é€šä¾›åº”é“¾</div>
          <div class="text-sm text-gray-500 mt-1">ç®¡ç†åå°</div>
        </div>
        
        <!-- å¯¼èˆªèœå• -->
        <nav class="flex-1 py-4">
          <div 
            v-for="(item, index) in visibleMenuItems" 
            :key="index"
            :class="['menu-item px-6 py-3 cursor-pointer', { active: currentMenu === item.key }]"
            @click="switchMenu(item.key)"
          >
            <div class="flex items-center">
              <span class="text-sm">{{ item.name }}</span>
            </div>
          </div>
        </nav>
        <!-- å½“å‰è§’è‰²æ˜¾ç¤º -->
        <div class="p-4 border-t border-gray-200 text-sm text-gray-700">
          <div class="text-xs text-gray-500 mb-1">å½“å‰è§’è‰²</div>
          <div class="font-semibold text-gray-800">{{ roles[currentUser.role]?.name || currentUser.role }}</div>
        </div>
      </aside>
      
      <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
      <main class="flex-1 flex flex-col overflow-hidden bg-gray-50">
        <!-- é¡¶éƒ¨æ  -->
        <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between shadow-sm">
          <h1 class="text-xl font-semibold text-gray-800">{{ currentMenuName }}</h1>
          <div class="flex items-center gap-4" @click.self="showRoleDropdown = false">
            <div class="flex items-center gap-2 relative" @click.stop>
              <div class="w-8 h-8 rounded-full bg-orange-500 flex items-center justify-center text-white text-sm font-semibold">
                {{ currentUser.name.charAt(0) }}
              </div>
              <div class="flex items-center gap-1 cursor-pointer" @click="showRoleDropdown = !showRoleDropdown">
                <span class="text-sm text-gray-600">{{ currentUser.name }}</span>
                <span class="text-xs text-gray-400">â–¼</span>
              </div>
              <!-- è§’è‰²åˆ‡æ¢ä¸‹æ‹‰èœå• -->
              <div
                v-if="showRoleDropdown"
                class="absolute top-full right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50"
                @click.stop
              >
                <div class="py-1">
                  <div
                    @click="switchRole('boss')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šè€æ¿ (Boss)
                  </div>
                  <div
                    @click="switchRole('planner')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šè®¡åˆ’å‘˜ (Planner)
                  </div>
                  <div
                    @click="switchRole('logistics')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šç‰©æµå‘˜ (Logistics)
                  </div>
                  <div
                    @click="switchRole('admin')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šç®¡ç†å‘˜ (Admin)
                  </div>
                </div>
              </div>
            </div>
            <button 
              @click="logout"
              class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm transition text-gray-700"
            >
              é€€å‡ºç™»å½•
            </button>
          </div>
        </header>
        
        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="flex-1 overflow-auto p-6">
          <!-- ç”Ÿäº§è®¡åˆ’ -->
          <div v-if="currentMenu === 'production'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col gap-4 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div class="flex flex-col gap-1">
                    <h2 class="text-lg font-semibold text-gray-800">ç”Ÿäº§è®¡åˆ’åˆ—è¡¨</h2>
                    <div class="text-xs text-gray-500">
                      æœ€åæ›´æ–°æ—¶é—´ï¼š<span v-if="planUpdateTime">{{ planUpdateTime }}</span><span v-else>æš‚æ— æ›´æ–°</span>
                    </div>
                  </div>
                  <div class="flex flex-col md:flex-row gap-3 md:items-center">
                    <!-- æŸ¥è¯¢ç­›é€‰ -->
                    <div class="flex gap-2">
                      <input
                        type="date"
                        v-model="productionPlanSearchDate"
                        class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-3 py-2 text-sm text-gray-800 outline-none"
                        placeholder="é€‰æ‹©æ—¥æœŸ"
                      />
                      <input
                        type="text"
                        v-model="productionPlanSearchKeyword"
                        placeholder="æœå·¥å•å·/äº§å“/äº§çº¿"
                        class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-4 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-48"
                      />
                    </div>
                    <button 
                      @click="exportProductionPlanToExcel"
                      class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                    >
                      ğŸ“¤ å¯¼å‡º Excel
                    </button>
                    <button 
                      @click="refreshData"
                      class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white whitespace-nowrap"
                    >
                      åˆ·æ–°
                    </button>
                  </div>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä½¿ç”¨æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å‘è½¦æ—¶é—´</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è½¦æ¬¡</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥åºå·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§çº¿åç§°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åˆ°åœºæ—¶é—´</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§å“æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥å•å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åŠ å·¥åºåˆ—å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥åºæè¿°</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredProductionPlan.length === 0" class="border-b border-gray-200">
                      <td colspan="10" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredProductionPlan" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.ä½¿ç”¨æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å‘è½¦æ—¶é—´ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.è½¦æ¬¡ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å·¥åºå· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.äº§çº¿åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.åˆ°åœºæ—¶é—´ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.äº§å“æè¿° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å·¥å•å· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.åŠ å·¥åºåˆ—å· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å·¥åºæè¿° || '--' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredProductionPlan.length }} æ¡è®°å½•
                <span v-if="productionPlanSearchKeyword || productionPlanSearchDate" class="text-blue-600">
                  ï¼ˆå·²ç­›é€‰ï¼Œå…± {{ productionPlan.length }} æ¡åŸå§‹è®°å½•ï¼‰
                </span>
              </div>
            </div>
          </div>

          <!-- å·¥å•ç®¡ç† -->
          <div v-if="currentMenu === 'workorder'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col gap-4 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div class="flex flex-col gap-1">
                    <h2 class="text-lg font-semibold text-gray-800">å·¥å•ç®¡ç†åˆ—è¡¨</h2>
                    <div class="text-xs text-gray-500">
                      â„¹ï¸ æ•°æ®åŒæ­¥è‡ªé…æ–™æ¨¡å—ï¼Œä¸Šä¼ æ—¶é—´ï¼š<span v-if="planUpdateTime">{{ planUpdateTime }}</span><span v-else>æš‚æ— æ›´æ–°</span>
                    </div>
                  </div>
                  <div class="flex flex-col md:flex-row gap-3 md:items-center">
                    <div class="relative">
                      <input
                        type="text"
                        v-model="workOrderSearchKeyword"
                        placeholder="æœç´¢å·¥å•å·/äº§å“æè¿°"
                        class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                      />
                      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                    </div>
                    <button 
                      @click="exportWorkOrderToExcel"
                      class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                    >
                      ğŸ“¤ å¯¼å‡º Excel
                    </button>
                    <button 
                      @click="refreshData"
                      class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                    >
                      åˆ·æ–°
                    </button>
                  </div>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥å•å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§å“æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å°å¥—</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥åº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åŠ å·¥åºåˆ—å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§çº¿åç§°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä½¿ç”¨æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">çŠ¶æ€</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredWorkOrderList.length === 0" class="border-b border-gray-200">
                      <td colspan="8" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredWorkOrderList" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap font-semibold">{{ item.å·¥å•å· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.äº§å“æè¿° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å°å¥— || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å·¥åºå· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.åŠ å·¥åºåˆ—å· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.äº§çº¿åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.ä½¿ç”¨æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span class="status-badge status-ongoing">å¾…äº§</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredWorkOrderList.length }} æ¡è®°å½•
                <span v-if="workOrderSearchKeyword" class="text-blue-600">
                  ï¼ˆå·²ç­›é€‰ï¼Œå…± {{ workOrderList.length }} æ¡åŸå§‹è®°å½•ï¼‰
                </span>
              </div>
            </div>
          </div>

          <!-- åˆ°è´§å¼‚å¸¸ç®¡ç† -->
          <div v-if="currentMenu === 'discrepancy'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">åˆ°è´§å¼‚å¸¸ç®¡ç†</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeywordDiscrepancy"
                      placeholder="æœç´¢ä¾›åº”å•†/PO/ç‰©æ–™/åˆ†ç±»"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <button 
                    @click="openDiscrepancyModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition whitespace-nowrap"
                  >
                    + ç™»è®°å¼‚å¸¸
                  </button>
                  <button 
                    @click="exportDiscrepancyToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>

              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç¼–å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä¾›åº”å•†</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç‰©æ–™/æ•°é‡</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¼‚å¸¸åˆ†ç±»</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä¿ç¨</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">çŠ¶æ€</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¤„ç†æ—¶é•¿</th>
                      <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 whitespace-nowrap">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredDiscrepancyList.length === 0" class="border-b border-gray-200">
                      <td colspan="10" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredDiscrepancyList" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.report_id || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.date || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.supplier || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">
                        <div class="flex flex-col">
                          <span>{{ item.material || '--' }}</span>
                          <span class="text-xs text-gray-500">æ•°é‡ï¼š{{ item.qty || 0 }}</span>
                        </div>
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span :class="discrepancyCategoryClass(item.category)" class="status-badge">{{ item.category || '--' }}</span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">
                        <div class="max-w-xs truncate" :title="item.description || ''">
                          {{ item.description || '--' }}
                        </div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.is_bonded ? 'æ˜¯' : 'å¦' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span :class="discrepancyStatusClass(item.status)" class="status-badge">{{ item.status || '--' }}</span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap" :class="discrepancyDurationClass(item)">
                        {{ getDiscrepancyDuration(item) }} å¤©
                      </td>
                      <td class="px-4 py-3 text-center whitespace-nowrap">
                        <button 
                          @click="viewDiscrepancyDetail(item)"
                          class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition text-white whitespace-nowrap"
                        >
                          è¯¦æƒ…
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredDiscrepancyList.length }} / {{ discrepancyList.length }} æ¡è®°å½•
              </div>
            </div>
          </div>

          <!-- è½¦æ¬¡ç®¡ç† -->
          <div v-if="currentMenu === 'vehicle'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">è½¦æ¬¡ç®¡ç†åˆ—è¡¨</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeywordVehicle"
                      placeholder="æœç´¢å®¢æˆ·/å¸æœº/è½¦å‹"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <button 
                    @click="openVehicleLogModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition whitespace-nowrap"
                  >
                    + ç™»è®°è½¦æ¬¡
                  </button>
                  <button 
                    @click="exportVehicleLogToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ—¶é—´</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è½¦å‹</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¸æœºå§“å</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å®¢æˆ·åç§°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å®¢æˆ·ç­¾æ”¶äºº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å†…å®¹</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¤‡æ³¨</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredVehicleLog.length === 0" class="border-b border-gray-200">
                      <td colspan="8" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredVehicleLog" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.æ—¶é—´ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.è½¦å‹ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å¸æœºå§“å || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å®¢æˆ·åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å®¢æˆ·ç­¾æ”¶äºº || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å†…å®¹ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å¤‡æ³¨ || '--' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredVehicleLog.length }} / {{ vehicleLog.length }} æ¡è®°å½•
              </div>
            </div>
          </div>

          <!-- ECO å˜æ›´ç®¡ç† -->
          <div v-if="currentMenu === 'eco'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <!-- æ“ä½œæ  -->
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">ECO å˜æ›´åˆ—è¡¨</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <!-- æœç´¢æ¡† -->
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeyword"
                      placeholder="æœç´¢ ECOå· / ç‰©æ–™å· / äº§å“æè¿°"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <div class="flex gap-3">
                    <button
                      @click="openCreateModal"
                      class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition"
                    >
                      æ–°å¢ ECO
                    </button>
                    <button 
                      @click="exportEcoListToExcel"
                      class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                    >
                      ğŸ“¤ å¯¼å‡º Excel
                    </button>
                    <button 
                      @click="refreshData"
                      class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                    >
                      åˆ·æ–°
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- æ•°æ®è¡¨æ ¼ -->
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ECOå·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§å“æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥åº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">èµ·å§‹å°å¥—</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ¶‰åŠç‰©æ–™</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å˜æ›´çŠ¶æ€</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ›´æ–°æ—¶é—´</th>
                      <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 whitespace-nowrap">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredEcoList.length === 0" class="border-b border-gray-200">
                      <td colspan="8" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredEcoList" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.eco_no || item.ECOå· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.description || item.äº§å“æè¿° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.op || item.é€‚ç”¨å·¥åº || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">ç¬¬ {{ item.start_set || item.å°å¥— || '--' }} å°èµ·</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">
                        <span 
                          :title="getEcoMaterialsFullList(item)"
                          class="cursor-help"
                        >
                          {{ getEcoMaterialsSummary(item) }}
                        </span>
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span 
                          :class="[
                            'status-badge',
                            item.status === 'å·²è¿‡æœŸ' || item.å˜æ›´çŠ¶æ€ === 'å·²è¿‡æœŸ' ? 'status-pending' : 
                            (item.status === 'è¿›è¡Œä¸­' || item.status === 'æœªå®Œæˆ' || item.å˜æ›´çŠ¶æ€ === 'è¿›è¡Œä¸­' || item.å˜æ›´çŠ¶æ€ === 'æœªå®Œæˆ') ? 'status-ongoing' : 'status-completed'
                          ]"
                        >
                          {{ item.status || item.å˜æ›´çŠ¶æ€ || '--' }}
                        </span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.update_time || item.å˜æ›´æ—¶é—´ || '--' }}</td>
                      <td class="px-4 py-3 text-center whitespace-nowrap">
                        <div class="flex gap-2 justify-center">
                          <!-- å¦‚æœçŠ¶æ€æ˜¯"è¿›è¡Œä¸­"æˆ–"æœªå®Œæˆ"ï¼Œæ˜¾ç¤ºæ‰§è¡ŒæŒ‰é’® -->
                          <button 
                            v-if="(item.status === 'è¿›è¡Œä¸­' || item.status === 'æœªå®Œæˆ' || item.å˜æ›´çŠ¶æ€ === 'è¿›è¡Œä¸­' || item.å˜æ›´çŠ¶æ€ === 'æœªå®Œæˆ')"
                            @click="executeEco(item, index)"
                            class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition text-white whitespace-nowrap"
                          >
                            âœ… æ‰§è¡Œ
                          </button>
                          <!-- å¦‚æœçŠ¶æ€æ˜¯"å·²å®Œæˆ"æˆ–"å·²è¿‡æœŸ"ï¼Œåªæ˜¾ç¤ºè¯¦æƒ…æŒ‰é’® -->
                          <button 
                            v-else
                            @click="viewDetail(item)"
                            class="px-3 py-1 bg-gray-400 hover:bg-gray-500 rounded text-xs transition text-white whitespace-nowrap"
                          >
                            è¯¦æƒ…
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- ç»Ÿè®¡ä¿¡æ¯ -->
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredEcoList.length }} / {{ ecoList.length }} æ¡è®°å½•
              </div>
            </div>
          </div>
          
          <!-- å®¢æˆ·è´¹ç”¨ç»“ç®— -->
          <div v-if="currentMenu === 'billing'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">å®¢æˆ·è´¹ç”¨ç»“ç®—åˆ—è¡¨</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeywordBilling"
                      placeholder="æœç´¢å®¢æˆ·/è´¹ç”¨ç±»å‹"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <button 
                    @click="openBillingModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition whitespace-nowrap"
                  >
                    + ç™»è®°è´¹ç”¨
                  </button>
                  <button 
                    @click="exportBillingToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å®¢æˆ·åç§°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è´¹ç”¨ç±»å‹</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">é¢ç§¯ (ã¡)</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è´¹ç”¨è¯¦æƒ…</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å‘ç”Ÿæ—¥æœŸ</th>
                      <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700 whitespace-nowrap">é‡‘é¢</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç»“ç®—çŠ¶æ€</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä¸‹æ¬¡æé†’æ—¥æœŸ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredBillingRecord.length === 0" class="border-b border-gray-200">
                      <td colspan="8" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredBillingRecord" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å®¢æˆ·åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.è´¹ç”¨ç±»å‹ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.é¢ç§¯ !== undefined ? item.é¢ç§¯ : '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.è´¹ç”¨è¯¦æƒ… || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å‘ç”Ÿæ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-right text-gray-800 font-medium whitespace-nowrap">
                        {{ displayBillingAmount(item.é‡‘é¢) }}
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span 
                          :class="[
                            'status-badge',
                            item.ç»“ç®—çŠ¶æ€ === 'å¾…ç»“ç®—' ? 'status-pending' : 'status-completed'
                          ]"
                        >
                          {{ item.ç»“ç®—çŠ¶æ€ || '--' }}
                        </span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.ä¸‹æ¬¡æé†’æ—¥æœŸ || '--' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredBillingRecord.length }} / {{ billingRecord.length }} æ¡è®°å½•
              </div>
            </div>
          </div>

          <!-- ä¾›åº”å•†æ”¶è´§ç›‘æ§ -->
          <div v-if="currentMenu === 'supplier'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col gap-4 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div>
                    <h2 class="text-lg font-semibold text-gray-800">ä¾›åº”å•†æ”¶è´§ç›‘æ§</h2>
                    <p class="text-xs text-gray-500 mt-1">SLA 48 å°æ—¶ Â· é»˜è®¤ä»…å±•ç¤ºè¿›è¡Œä¸­/æœ‰ç§¯å‹ä»»åŠ¡ï¼Œå¦‚éœ€æŸ¥çœ‹å…¨éƒ¨è¯·åˆ‡æ¢åˆ°â€œå…¨éƒ¨å†å²â€ã€‚</p>
                  </div>
                  <div class="flex flex-col md:flex-row gap-3 md:items-center">
                    <!-- çŠ¶æ€æ ‡ç­¾é¡µ -->
                    <div class="inline-flex items-center rounded-full bg-gray-100 p-1 text-xs">
                      <button
                        class="px-3 py-1 rounded-full transition whitespace-nowrap"
                        :class="activeReceivingTab === 'ongoing' ? 'bg-white text-blue-600 shadow-sm border border-gray-200' : 'text-gray-500'"
                        @click="changeReceivingTab('ongoing')"
                      >
                        è¿›è¡Œä¸­ / æœ‰ç§¯å‹
                      </button>
                      <button
                        class="px-3 py-1 rounded-full transition whitespace-nowrap"
                        :class="activeReceivingTab === 'all' ? 'bg-white text-blue-600 shadow-sm border border-gray-200' : 'text-gray-500'"
                        @click="changeReceivingTab('all')"
                      >
                        å…¨éƒ¨å†å²
                      </button>
                    </div>
                    <!-- æœç´¢æ¡† -->
                    <div class="flex flex-col sm:flex-row gap-3 items-stretch sm:items-center">
                      <div class="relative">
                        <input
                          type="text"
                          v-model="receivingSearchKeyword"
                          @input="onReceivingSearchInput"
                          placeholder="æœç´¢ä¾›åº”å•†åç§°"
                          class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                        />
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                      </div>
                      <button
                        @click="openNewReceivingModal"
                        class="inline-flex items-center justify-center px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-xs md:text-sm font-semibold rounded-lg shadow-sm transition whitespace-nowrap"
                      >
                        + ç™»è®°æ–°åˆ°è´§
                      </button>
                      <button
                        @click="triggerGeReportUpload"
                        class="inline-flex items-center justify-center px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white text-xs md:text-sm font-semibold rounded-lg shadow-sm transition whitespace-nowrap"
                      >
                        ğŸ“¥ ä¸Šä¼  GE æ”¶è´§æŠ¥è¡¨
                      </button>
                      <input
                        type="file"
                        ref="geReportFileInput"
                        accept=".xlsx,.xls"
                        @change="handleGeReportUpload"
                        class="hidden"
                      />
                      <button
                        @click="exportSupplierReceivingToExcel"
                        class="inline-flex items-center justify-center px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 text-xs md:text-sm font-semibold rounded-lg shadow-sm transition whitespace-nowrap"
                      >
                        ğŸ“¤ å¯¼å‡º Excel
                      </button>
                    </div>
                  </div>
                </div>
                <div class="text-xs text-gray-500">å…± {{ filteredReceivingTasks.length }} ä¸ªåˆ°è´§æ‰¹æ¬¡ Â· ç¬¬ {{ receivingPage }} / {{ receivingTotalPages }} é¡µ</div>
              </div>

              <div class="table-container">
                <div class="min-w-[900px] space-y-4">
                  <div
                    v-if="receivingTasks.length === 0"
                    class="flex items-center justify-center py-12 text-gray-500 text-sm border border-dashed border-gray-300 rounded-lg bg-gray-50"
                  >
                    æš‚æ— ä¾›åº”å•†æ”¶è´§ä»»åŠ¡
                  </div>

                  <div
                    v-else
                    v-for="(task, index) in pagedReceivingTasks"
                    :key="index"
                    class="bg-white border border-gray-200 rounded-xl shadow-sm px-4 py-4 hover:shadow-md transition"
                  >
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                      <!-- åˆ— 1ï¼šä¾›åº”å•† & åˆ°è´§æ—¥æœŸ -->
                      <div class="text-left space-y-1">
                        <div class="flex items-center gap-2">
                          <span class="text-sm font-semibold text-gray-900 whitespace-nowrap">
                            {{ task.ä¾›åº”å•†åç§° || task.supplier_cn || '--' }}
                          </span>
                        </div>
                        <div v-if="task.physical_qty && task.unit" class="text-xs text-gray-500 whitespace-nowrap">
                          ğŸ“¦ å®ç‰©ï¼š{{ task.physical_qty }} {{ task.unit }}
                        </div>
                        <div class="text-xs text-gray-500 whitespace-nowrap">
                          åˆ°è´§æ—¥æœŸï¼š{{ task.åˆ°è´§æ—¥æœŸ || '--' }}
                        </div>
                        <div>
                          <span
                            class="inline-flex items-center text-[11px] px-2 py-0.5 rounded-full border"
                            :class="getReceivingStatusBadge(task)"
                          >
                            {{ task.å½“å‰çŠ¶æ€ || 'æ­£å¸¸' }}
                          </span>
                        </div>
                      </div>

                      <!-- åˆ— 2ï¼šæ”¶è´§è¿›åº¦æ¡ -->
                      <div class="space-y-2">
                        <div class="flex justify-between items-center text-xs text-gray-600">
                          <span class="whitespace-nowrap" v-if="task.data_source === 'synced' && task.æ€»è¡Œæ•° > 0">
                            {{ task.å·²å®Œæˆæ•°é‡ }} / {{ task.æ€»è¡Œæ•° }} æ¡
                            ({{ getReceivingProgressPercent(task) }}%)
                          </span>
                          <span class="whitespace-nowrap text-gray-400" v-else>
                            â³ ç­‰å¾…ç³»ç»Ÿæ•°æ®å¯¼å…¥...
                          </span>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden" v-if="task.data_source === 'synced' && task.æ€»è¡Œæ•° > 0">
                          <div
                            class="h-3 rounded-full bg-blue-500 transition-all duration-300"
                            :style="{ width: getReceivingProgressPercent(task) + '%' }"
                          ></div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden" v-else>
                          <div class="h-3 rounded-full bg-gray-300 flex items-center justify-center text-[10px] text-gray-500">
                            ç­‰å¾…æ•°æ®
                          </div>
                        </div>
                        <div class="flex gap-1 text-[11px] text-gray-400 flex-wrap">
                          <span v-for="(h, idx) in (task.æ¯æ—¥è¿›åº¦è®°å½• || []).slice(-3)" :key="idx" class="whitespace-nowrap">
                            {{ h.date }} +{{ h.count }}
                          </span>
                        </div>
                      </div>

                      <!-- åˆ— 3ï¼šæ—¶æ•ˆå€’è®¡æ—¶ -->
                      <div class="text-left">
                        <div
                          v-if="getSlaInfo(task).type === 'overdue'"
                          class="text-sm font-semibold text-red-600 whitespace-nowrap"
                        >
                          {{ getSlaInfo(task).text }}
                        </div>
                        <div
                          v-else-if="getSlaInfo(task).type === 'done'"
                          class="text-sm text-green-600 whitespace-nowrap"
                        >
                          å·²åœ¨ SLA å†…å®Œæˆ
                        </div>
                        <div
                          v-else
                          class="text-sm text-emerald-600 whitespace-nowrap"
                        >
                          {{ getSlaInfo(task).text }}
                        </div>
                        <div class="text-xs text-gray-400 mt-1 whitespace-nowrap">
                          SLA 48 å°æ—¶å†…å®Œæˆå…¨éƒ¨æ”¶è´§
                        </div>
                      </div>

                      <!-- åˆ— 4ï¼šæ“ä½œæŒ‰é’® -->
                      <div class="flex justify-start md:justify-end gap-2">
                        <button
                          @click="openReceivingDetail(task)"
                          class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs font-semibold rounded-lg border border-gray-300 transition whitespace-nowrap"
                        >
                          æŸ¥çœ‹è¯¦æƒ…
                        </button>
                        <button
                          @click="openReceivingModal(task)"
                          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded-lg shadow-sm transition whitespace-nowrap"
                        >
                          æ›´æ–°è¿›åº¦
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- åˆ†é¡µå™¨ -->
              <div class="mt-4 flex items-center justify-between text-xs text-gray-600">
                <div>
                  å½“å‰ç¬¬ {{ receivingPage }} / {{ receivingTotalPages }} é¡µï¼Œåˆè®¡ {{ filteredReceivingTasks.length }} æ¡è®°å½•
                </div>
                <div class="flex items-center gap-2">
                  <button
                    class="px-3 py-1 rounded border text-xs"
                    :class="receivingPage <= 1 ? 'bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'"
                    :disabled="receivingPage <= 1"
                    @click="goToReceivingPage(receivingPage - 1)"
                  >
                    ä¸Šä¸€é¡µ
                  </button>
                  <span>ç¬¬ {{ receivingPage }} é¡µ</span>
                  <button
                    class="px-3 py-1 rounded border text-xs"
                    :class="receivingPage >= receivingTotalPages ? 'bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'"
                    :disabled="receivingPage >= receivingTotalPages"
                    @click="goToReceivingPage(receivingPage + 1)"
                  >
                    ä¸‹ä¸€é¡µ
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- ç»è¥æŠ¥è¡¨ BI Dashboard -->
          <div v-if="currentMenu === 'bi'" class="h-full overflow-auto">
            <div class="p-6 space-y-6">
              <!-- ç¬¬ä¸€å±‚ï¼šKPI æ ¸å¿ƒæŒ‡æ ‡å¡ -->
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6 hover:shadow-lg transition">
                  <div class="text-sm text-gray-500 mb-2">å½“æœˆäº§é‡</div>
                  <div class="text-3xl font-bold text-gray-900">{{ formatNumber(biData.kpi.monthlyProduction) }}</div>
                  <div class="text-xs text-gray-400 mt-2">è¾ƒä¸Šæœˆ â†‘ 12.5%</div>
                </div>
                <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6 hover:shadow-lg transition">
                  <div class="text-sm text-gray-500 mb-2">å¹³å‡ DPMO</div>
                  <div class="text-3xl font-bold text-blue-600">{{ biData.kpi.avgDPMO }}</div>
                  <div class="text-xs text-gray-400 mt-2">ç›®æ ‡å€¼: 80</div>
                </div>
                <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6 hover:shadow-lg transition">
                  <div class="text-sm text-gray-500 mb-2">æ”¶è´§å‡†æ—¶ç‡</div>
                  <div class="text-3xl font-bold text-green-600">{{ biData.kpi.receivingOnTimeRate }}%</div>
                  <div class="text-xs text-gray-400 mt-2">è¾ƒä¸Šæœˆ â†‘ 0.3%</div>
                </div>
                <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6 hover:shadow-lg transition">
                  <div class="text-sm text-gray-500 mb-2">æœ¬æœˆä¾›åº”å•†å¼‚å¸¸æ•°</div>
                  <div class="text-3xl font-bold text-orange-600">{{ biData.kpi.supplierIssues }}</div>
                  <div class="text-xs text-gray-400 mt-2">è¾ƒä¸Šæœˆ â†“ 8</div>
                </div>
              </div>

              <!-- ç¬¬äºŒå±‚å’Œç¬¬ä¸‰å±‚ï¼šå›¾è¡¨åŒºåŸŸ -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- å·¦ä¾§ï¼šè´¨é‡æ§åˆ¶ -->
                <div class="space-y-6">
                  <!-- å›¾è¡¨1ï¼šäº§é‡ä¸ç¼ºé™·ç‡è¶‹åŠ¿å›¾ -->
                  <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">äº§é‡ä¸ç¼ºé™·ç‡è¶‹åŠ¿å›¾</h3>
                    <div ref="chart1" style="width: 100%; height: 350px;"></div>
                  </div>
                  
                  <!-- å›¾è¡¨2ï¼šæ”¶å‘è´§ç¼ºé™·åˆ†å¸ƒ -->
                  <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">æ”¶å‘è´§ç¼ºé™·åˆ†å¸ƒ</h3>
                    <div ref="chart2" style="width: 100%; height: 350px;"></div>
                  </div>
                </div>

                <!-- å³ä¾§ï¼šç‰©æµæ•ˆèƒ½ -->
                <div class="space-y-6">
                  <!-- å›¾è¡¨3ï¼šæ”¶å‘è´§åŠæ—¶æ€§å¯¹æ¯” -->
                  <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">æ”¶å‘è´§åŠæ—¶æ€§å¯¹æ¯”</h3>
                    <div ref="chart3" style="width: 100%; height: 350px;"></div>
                  </div>
                  
                  <!-- å›¾è¡¨4ï¼šä¾›åº”å•†é—®é¢˜åˆ†å¸ƒ -->
                  <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ä¾›åº”å•†é—®é¢˜åˆ†å¸ƒ</h3>
                    <div ref="chart4" style="width: 100%; height: 350px;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ç¼ºé™·ç®¡ç† -->
          <div v-if="currentMenu === 'defect'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">ç¼ºé™·ç®¡ç†åˆ—è¡¨</h2>
              <div class="flex flex-wrap gap-3 items-center">
                <!-- æŒ‰æœˆä»½ç­›é€‰ -->
                <div class="flex items-center gap-2">
                  <label class="text-xs text-gray-600 whitespace-nowrap">æœˆä»½ï¼š</label>
                  <input
                    type="month"
                    v-model="defectFilterMonth"
                    class="border border-gray-300 rounded-lg px-2 py-1 text-xs text-gray-800 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>
                <!-- æŒ‰ç±»å‹ç­›é€‰ -->
                <div class="flex items-center gap-2">
                  <label class="text-xs text-gray-600 whitespace-nowrap">ç±»å‹ï¼š</label>
                  <select
                    v-model="defectFilterType"
                    class="border border-gray-300 rounded-lg px-2 py-1 text-xs text-gray-800 bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option value="">å…¨éƒ¨</option>
                    <option value="Bç±»">Bç±»</option>
                    <option value="Cç±»">Cç±»</option>
                  </select>
                </div>
                  <button
                    @click="openDefectModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition"
                  >
                    + ç™»è®°ç¼ºé™·
                  </button>
                  <button
                    @click="triggerExcelImport"
                    class="px-4 py-2 bg-white hover:bg-gray-50 border border-gray-300 rounded-lg text-sm font-semibold text-gray-700 transition"
                  >
                    ğŸ“¥ å¯¼å…¥ Excel
                  </button>
                  <button
                    @click="exportDefectsToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <input
                    type="file"
                    ref="excelFileInput"
                    accept=".xlsx,.xls"
                    @change="handleExcelImport"
                    style="display: none;"
                  />
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>
              
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å‘ç°æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç±»å‹</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç§ç±»</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ˜¯å¦æŒ‰ç¯</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§å“</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">é—®é¢˜æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å‘ç°äºº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è´£ä»»äºº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åŸå› </th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è§£å†³æ–¹æ¡ˆ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">5WHYåˆ†æ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¤‡æ³¨</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredDefectList.length === 0" class="border-b border-gray-200">
                      <td colspan="12" class="px-4 py-8 text-center text-gray-500">æš‚æ— ç¼ºé™·è®°å½•</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredDefectList" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å‘ç°æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span 
                          :class="[
                            'status-badge',
                            item.ç±»å‹ === 'Bç±»' ? 'bg-yellow-50 text-yellow-700 border border-yellow-200' : 'bg-blue-50 text-blue-700 border border-blue-200'
                          ]"
                        >
                          {{ item.ç±»å‹ || '--' }}
                        </span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.ç§ç±» || '--' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span v-if="item.æ˜¯å¦æŒ‰ç¯" class="text-red-600 text-lg">âš ï¸</span>
                        <span v-else class="text-gray-400 text-lg">â—‹</span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.äº§å“ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800" :title="item.é—®é¢˜æè¿°">
                        <div class="max-w-xs truncate">{{ item.é—®é¢˜æè¿° || '--' }}</div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å‘ç°äºº || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.è´£ä»»äºº || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800" :title="item.åŸå› ">
                        <div class="max-w-xs truncate">{{ item.åŸå›  || '--' }}</div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800" :title="item.è§£å†³æ–¹æ¡ˆ">
                        <div class="max-w-xs truncate">{{ item.è§£å†³æ–¹æ¡ˆ || '--' }}</div>
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <a 
                          v-if="get5WhyFile(item)" 
                          href="#" 
                          @click.prevent="view5WhyReport(get5WhyFile(item))"
                          class="text-blue-600 hover:text-blue-800 text-sm underline"
                        >
                          ğŸ“æŸ¥çœ‹æŠ¥å‘Š
                        </a>
                        <span v-else class="text-gray-400">--</span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800" :title="item.å¤‡æ³¨">
                        <div class="max-w-xs truncate">{{ item.å¤‡æ³¨ || '--' }}</div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <div class="mt-4 text-sm text-gray-500">
                <span>æ€»è®¡ï¼š{{ defectList.length }} æ¡</span>
                <span v-if="filteredDefectList.length !== defectList.length" class="ml-3 text-blue-600">
                  å½“å‰ç­›é€‰ï¼š{{ filteredDefectList.length }} æ¡
                </span>
              </div>
            </div>
          </div>

          <!-- å·¥å•é…æ–™ç®¡ç† -->
          <div v-if="currentMenu === 'picking'" class="h-full overflow-auto">
            <div class="p-6 space-y-6">
              <!-- é¡¶éƒ¨æ“ä½œåŒº -->
              <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                <div class="flex flex-col md:flex-row gap-4 items-center">
                  <!-- ä¸Šä¼ ç”Ÿäº§è®¡åˆ’è¡¨ -->
                  <div class="flex-1 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-orange-500 transition cursor-pointer bg-gray-50">
                    <input
                      type="file"
                      ref="planFileInput"
                      accept=".xlsx,.xls"
                      @change="handlePlanFileUpload"
                      class="hidden"
                    />
                    <div @click="triggerPlanFileUpload" class="cursor-pointer">
                      <div class="text-2xl mb-2">ğŸ“¤</div>
                      <div class="text-sm font-semibold text-gray-700 mb-1">ä¸Šä¼ ç”Ÿäº§è®¡åˆ’è¡¨</div>
                      <div class="text-xs text-gray-500">å·¥å•å·, OP, äº§å“æè¿°, å°å¥—</div>
                      <div v-if="planData.length > 0" class="text-xs text-green-600 mt-2">
                        âœ… å·²åŠ è½½ {{ planData.length }} æ¡è®°å½•
                      </div>
                    </div>
                  </div>
                  
                  <!-- ä¸Šä¼  GE BOMæºè¡¨ -->
                  <div class="flex-1 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition cursor-pointer bg-gray-50">
                    <input
                      type="file"
                      ref="bomFileInput"
                      accept=".xlsx,.xls"
                      @change="handleBomFileUpload"
                      class="hidden"
                    />
                    <div @click="triggerBomFileUpload" class="cursor-pointer">
                      <div class="text-2xl mb-2">ğŸ“¤</div>
                      <div class="text-sm font-semibold text-gray-700 mb-1">ä¸Šä¼  GE BOMæºè¡¨</div>
                      <div class="text-xs text-gray-500">Job, OP, Component, PENDING_LOCATOR, Required</div>
                      <div v-if="bomData.length > 0" class="text-xs text-green-600 mt-2">
                        âœ… å·²åŠ è½½ {{ bomData.length }} æ¡è®°å½•
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- çŠ¶æ€æç¤º -->
                <div class="mt-4 text-center">
                  <div v-if="planData.length === 0 && bomData.length === 0" class="text-sm text-gray-500">
                    ç­‰å¾…ä¸Šä¼ ...
                  </div>
                  <div v-else-if="matchedWorkOrders.length > 0" class="text-sm text-green-600 font-semibold">
                    âœ… å·²åŒ¹é… {{ matchedWorkOrders.length }} ä¸ªå·¥å•
                  </div>
                  <div v-else class="text-sm text-orange-600">
                    âš ï¸ è¯·ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶ä»¥è¿›è¡ŒåŒ¹é…
                  </div>
                </div>
              </div>

              <!-- æ ¸å¿ƒäº¤äº’åŒº -->
              <div v-if="matchedWorkOrders.length > 0" class="flex gap-6">
                <!-- å·¦ä¾§ï¼šå·¥å•åˆ—è¡¨ (30%) -->
                <div class="w-[30%] bg-white rounded-lg border border-gray-200 shadow-sm">
                  <div class="p-4 border-b border-gray-200">
                    <div class="space-y-3">
                      <div class="flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-800">å·¥å•åˆ—è¡¨</h3>
                        <div class="flex flex-col items-end leading-tight">
                          <span class="text-xs text-gray-500">
                            æ€»è®¡ï¼š{{ matchedWorkOrders.length }} æ¡
                          </span>
                          <span class="text-[11px] text-blue-600" v-if="pickingFilteredAndSortedWorkOrders.length !== matchedWorkOrders.length">
                            å·²æŒ‰æ¡ä»¶ç­›é€‰ï¼š{{ pickingFilteredAndSortedWorkOrders.length }} æ¡
                          </span>
                          <span class="text-[11px] text-gray-400" v-else>
                            å½“å‰æ˜¾ç¤ºå…¨éƒ¨å·¥å•
                          </span>
                        </div>
                      </div>
                      <!-- æŒ‰æ—¥æœŸç­›é€‰ï¼ˆä½¿ç”¨æ—¥æœŸï¼‰ -->
                      <div class="flex items-center gap-2">
                        <label class="text-xs text-gray-600 whitespace-nowrap">ä½¿ç”¨æ—¥æœŸï¼š</label>
                        <input
                          type="date"
                          v-model="pickingSearchDate"
                          class="flex-1 border border-gray-300 rounded-md px-2 py-1 text-xs text-gray-800 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                        />
                        <button
                          type="button"
                          class="px-2 py-1 text-[11px] border border-gray-300 rounded-md text-gray-600 hover:bg-gray-50"
                          @click="pickingSearchDate = ''"
                        >
                          æ¸…ç©º
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="max-h-[calc(100vh-300px)] overflow-y-auto">
                    <div
                      v-for="(workOrder, index) in pickingFilteredAndSortedWorkOrders"
                      :key="index"
                      @click="selectWorkOrder(index)"
                      :class="[
                        'p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition',
                        selectedWorkOrderIndex === index ? 'bg-blue-50 border-l-4 border-l-blue-500' : ''
                      ]"
                    >
                      <div class="text-sm font-semibold text-gray-900">
                        {{ workOrder['å·¥å•å·'] || workOrder.å·¥å•å· }}
                      </div>
                      <div class="text-xs text-gray-600 mt-1">
                        {{ workOrder['äº§å“æè¿°'] || workOrder.äº§å“æè¿° }}
                      </div>
                      <div class="text-xs text-gray-500 mt-1">
                        OP{{ workOrder['OP'] || workOrder.OP }} Â· å°å¥—: {{ workOrder['å°å¥—'] || workOrder.å°å¥— }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- å³ä¾§ï¼šè¯¦æƒ…/æ‰“å°åŒº (70%) -->
                <div class="flex-1 bg-white rounded-lg border border-gray-200 shadow-sm p-6">
                  <div v-if="selectedWorkOrder" class="print-area">
                    <!-- æ‰“å°æŒ‰é’® -->
                    <div class="flex justify-end mb-4 print:hidden">
                      <button
                        @click="printWorkOrder"
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition"
                      >
                        ğŸ–¨ï¸ æ‰“å°å½“å‰å•æ®
                      </button>
                    </div>
                    
                    <!-- A4 å•æ®æ ·å¼ -->
                    <div class="a4-page bg-white shadow-lg p-8">
                      <!-- å•æ®å¤´éƒ¨ -->
                      <div class="mb-6">
                        <div class="flex justify-between items-start mb-4">
                          <div>
                            <h2 class="text-xl font-bold text-gray-900 mb-2">å·¥å•é…æ–™å•</h2>
                            <div class="space-y-1 text-sm text-gray-700">
                              <div><span class="font-semibold">å·¥å•å·ï¼š</span>{{ selectedWorkOrder['å·¥å•å·'] || selectedWorkOrder.å·¥å•å· }}</div>
                              <div><span class="font-semibold">ä½¿ç”¨æ—¶é—´ï¼š</span>{{ selectedWorkOrder['ä½¿ç”¨æ—¥æœŸ'] || selectedWorkOrder.ä½¿ç”¨æ—¥æœŸ || '--' }}</div>
                              <div><span class="font-semibold">æ‰“å°æ—¶é—´ï¼š</span>{{ printTime || '--' }}</div>
                              <!-- ECO è­¦ç¤ºè¯­ï¼ˆæ‰“å°æ—¶æ˜¾ç¤ºï¼‰ -->
                              <div v-if="selectedWorkOrder.hasEco" class="mt-2 p-2 bg-red-50 border border-red-300 rounded print:bg-white print:border-red-900">
                                <span class="font-bold text-red-600 print:text-red-900 print:font-bold">âš ï¸ æ³¨æ„ï¼šæœ¬å•åŒ…å« ECO å˜æ›´ï¼Œè¯·æ ¸å¯¹ç‰©æ–™ï¼</span>
                              </div>
                              <div><span class="font-semibold">äº§å“ï¼š</span>{{ selectedWorkOrder['äº§å“æè¿°'] || selectedWorkOrder.äº§å“æè¿° }}</div>
                              <div><span class="font-semibold">å°å¥—ï¼š</span>{{ selectedWorkOrder['å°å¥—'] || selectedWorkOrder.å°å¥— }}</div>
                              <div><span class="font-semibold">OPï¼š</span>{{ selectedWorkOrder['OP'] || selectedWorkOrder.OP }}</div>
                              <div><span class="font-semibold">ä»“åº“ï¼š</span>SUN</div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- ECO è­¦ç¤ºè¯­ï¼ˆå¦‚æœæœ‰ECOå˜æ›´ï¼‰ -->
                      <div v-if="selectedWorkOrder.hasEco" class="mb-4 p-3 bg-red-50 border-l-4 border-red-500 rounded print:bg-white print:border-red-900 print:border-2">
                        <div class="flex items-center text-red-700 font-semibold print:text-black print:font-bold">
                          <span class="text-lg mr-2">âš ï¸</span>
                          <span>æ³¨æ„ï¼šæœ¬å•åŒ…å« ECO å˜æ›´ï¼Œè¯·æ ¸å¯¹ç‰©æ–™ï¼</span>
                        </div>
                      </div>

                      <!-- ç‰©æ–™æ˜ç»†è¡¨æ ¼ -->
                      <table class="w-full border-collapse border border-gray-300 text-sm">
                        <thead>
                          <tr class="bg-gray-100">
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">åºå·</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">ç‰©æ–™å·</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">åº“ä½</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">æ•°é‡</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">ECOå˜æ›´</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">å¤‡æ³¨</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-if="!selectedWorkOrder.materials || selectedWorkOrder.materials.length === 0">
                            <td colspan="6" class="border border-gray-300 px-3 py-4 text-center text-gray-500">
                              æš‚æ— ç‰©æ–™æ˜ç»†
                            </td>
                          </tr>
                          <tr
                            v-else
                            v-for="(material, idx) in sortedMaterials"
                            :key="idx"
                            :class="[
                              'hover:bg-gray-50',
                              material.ecoInfo && material.ecoInfo.ecoNo ? 'bg-red-50 print:bg-white' : ''
                            ]"
                          >
                            <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ idx + 1 }}</td>
                            <td class="border border-gray-300 px-3 py-2 text-gray-900 font-semibold">{{ material['Component'] || material.Component || '--' }}</td>
                            <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['PENDING_LOCATOR'] || material.PENDING_LOCATOR || '--' }}</td>
                            <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['Required'] || material.Required || '--' }}</td>
                            <td class="border border-gray-300 px-3 py-2">
                              <div v-if="material.ecoInfo && material.ecoInfo.ecoNo" class="text-red-600 print:text-black">
                                <div class="font-bold">
                                  ECO-{{ material.ecoInfo.ecoNo }}
                                </div>
                                <div v-if="material.ecoInfo.changeDetails" class="text-xs mt-1 font-normal">
                                  {{ material.ecoInfo.changeDetails }}
                                </div>
                              </div>
                              <span v-else class="text-gray-400">--</span>
                            </td>
                            <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['å¤‡æ³¨'] || material.å¤‡æ³¨ || '--' }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div v-else class="text-center text-gray-500 py-12">
                    è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªå·¥å•æŸ¥çœ‹è¯¦æƒ…
                  </div>
                </div>
              </div>

              <!-- ç©ºçŠ¶æ€ -->
              <div v-else class="bg-white rounded-lg border border-gray-200 p-12 text-center">
                <div class="text-gray-400 text-lg mb-2">ğŸ“‹</div>
                <div class="text-gray-600">è¯·ä¸Šä¼ ç”Ÿäº§è®¡åˆ’è¡¨å’Œ GE BOMæºè¡¨ä»¥å¼€å§‹åŒ¹é…</div>
              </div>
            </div>
          </div>

          <!-- å…¶ä»–èœå•å ä½ -->
          <div v-else-if="!['production', 'vehicle', 'eco', 'billing', 'supplier', 'bi', 'defect', 'picking'].includes(currentMenu)" class="h-full flex items-center justify-center">
            <div class="text-center text-gray-500">
              <p class="text-lg mb-2">{{ currentMenuName }}</p>
              <p class="text-sm">åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- æ–°å¢ ECO æ¨¡æ€æ¡†ï¼ˆä¸»ä»è¡¨ç»“æ„ï¼‰ -->
    <div
      v-if="showCreateModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-2xl shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">æ–°å¢ ECO</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeCreateModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[80vh] overflow-y-auto">
          <div class="space-y-6">
            <!-- å…¬å…±åŒº -->
            <div class="space-y-4">
              <h4 class="text-sm font-semibold text-gray-700 border-b pb-2">åŸºæœ¬ä¿¡æ¯</h4>
              <div>
                <label class="block text-sm text-gray-700 mb-1">ECOå· <span class="text-red-500">*</span></label>
                <input
                  v-model="newEco.eco_no"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š401"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">äº§å“æè¿° <span class="text-red-500">*</span></label>
                <input
                  v-model="newEco.description"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼šHAL-X NC1"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">å·¥åº <span class="text-red-500">*</span></label>
                <input
                  v-model="newEco.op"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼šOP220"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">èµ·å§‹å°å¥— <span class="text-red-500">*</span></label>
                <input
                  v-model="newEco.start_set"
                  type="number"
                  min="1"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š25ï¼ˆä»ç¬¬25å°å¼€å§‹ç”Ÿæ•ˆï¼‰"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">å˜æ›´è¯¦æƒ… <span class="text-red-500">*</span></label>
                <textarea
                  v-model="newEco.change_details"
                  rows="3"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                  placeholder="å¦‚ï¼šæ›´æ¢ä¸ºV2ç‰ˆæœ¬ï¼Œæ³¨æ„å®‰è£…å­”ä½"
                ></textarea>
              </div>
            </div>
            
            <!-- æ˜ç»†åŒºï¼šæ¶‰åŠç‰©æ–™æ¸…å• -->
            <div class="space-y-4">
              <div class="flex items-center justify-between border-b pb-2">
                <h4 class="text-sm font-semibold text-gray-700">æ¶‰åŠç‰©æ–™æ¸…å•</h4>
                <button
                  @click="addEcoMaterial"
                  class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-lg transition"
                >
                  + æ·»åŠ ç‰©æ–™
                </button>
              </div>
              <div v-if="newEco.materials.length === 0" class="text-sm text-gray-500 text-center py-4">
                æš‚æ— ç‰©æ–™ï¼Œè¯·ç‚¹å‡»"æ·»åŠ ç‰©æ–™"æŒ‰é’®
              </div>
              <div v-else class="space-y-2">
                <div
                  v-for="(material, matIndex) in newEco.materials"
                  :key="matIndex"
                  class="flex gap-2 items-center"
                >
                  <input
                    v-model="newEco.materials[matIndex]"
                    type="text"
                    class="flex-1 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                    :placeholder="`ç‰©æ–™å· ${matIndex + 1}`"
                  />
                  <button
                    @click="removeEcoMaterial(matIndex)"
                    class="px-3 py-2 bg-red-100 hover:bg-red-200 text-red-700 text-xs rounded-lg transition"
                  >
                    åˆ é™¤
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeCreateModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveNewEco"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- åˆ°è´§å¼‚å¸¸ ç™»è®°æ¨¡æ€æ¡† -->
    <div
      v-if="showDiscrepancyModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-2xl shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°åˆ°è´§å¼‚å¸¸</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeDiscrepancyModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[80vh] overflow-y-auto">
          <div class="space-y-6 text-sm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-gray-700 mb-1">ä¾›åº”å•† <span class="text-red-500">*</span></label>
                <input
                  v-model="newDiscrepancy.supplier"
                  type="text"
                  list="supplier-list"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼šè²å°¼å…‹æ–¯"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">åˆ°è´§æ—¥æœŸ <span class="text-red-500">*</span></label>
                <input
                  v-model="newDiscrepancy.date"
                  type="date"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">POå· <span class="text-red-500">*</span></label>
                <input
                  v-model="newDiscrepancy.po"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼šPO-20250101"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">ç‰©æ–™å· <span class="text-red-500">*</span></label>
                <input
                  v-model="newDiscrepancy.material"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">æ•°é‡ <span class="text-red-500">*</span></label>
                <input
                  v-model.number="newDiscrepancy.qty"
                  type="number"
                  min="0"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š100"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">æ˜¯å¦ä¿ç¨</label>
                <div class="flex items-center gap-4">
                  <label class="flex items-center gap-1 text-gray-700 text-sm">
                    <input type="radio" v-model="newDiscrepancy.is_bonded" :value="true" />
                    æ˜¯
                  </label>
                  <label class="flex items-center gap-1 text-gray-700 text-sm">
                    <input type="radio" v-model="newDiscrepancy.is_bonded" :value="false" />
                    å¦
                  </label>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <div>
                <label class="block text-gray-700 mb-1">å¼‚å¸¸åˆ†ç±» <span class="text-red-500">*</span></label>
                <select
                  v-model="newDiscrepancy.category"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                >
                  <option value="ç³»ç»Ÿé—®é¢˜">ç³»ç»Ÿé—®é¢˜</option>
                  <option value="å•æ®é—®é¢˜">å•æ®é—®é¢˜</option>
                  <option value="å®ç‰©ç ´æŸ">å®ç‰©ç ´æŸ</option>
                  <option value="æ•°é‡å·®å¼‚">æ•°é‡å·®å¼‚</option>
                  <option value="æ ‡ç­¾é”™è¯¯">æ ‡ç­¾é”™è¯¯</option>
                </select>
              </div>
              <div>
                <label class="block text-gray-700 mb-1">è¯¦ç»†æè¿° <span class="text-red-500">*</span></label>
                <textarea
                  v-model="newDiscrepancy.description"
                  rows="3"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                  placeholder="è¯·æè¿°å…·ä½“å¼‚å¸¸ï¼Œå¦‚ç ´æŸä½ç½®ã€æ•°é‡å·®å¼‚ç­‰"
                ></textarea>
              </div>
              <div>
                <label class="block text-gray-700 mb-1">ç°åœºç…§ç‰‡</label>
                <input
                  ref="discrepancyPhotoInput"
                  type="file"
                  multiple
                  @change="handleDiscrepancyPhotos"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                />
                <div v-if="newDiscrepancy.photos && newDiscrepancy.photos.length" class="text-xs text-gray-600 mt-2">
                  å·²é€‰æ‹©ï¼š{{ newDiscrepancy.photos.join(', ') }}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeDiscrepancyModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveDiscrepancy"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- ç™»è®°è´¹ç”¨ æ¨¡æ€æ¡† -->
    <div
      v-if="showBillingModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-xl shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°è´¹ç”¨</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeBillingModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[75vh] overflow-y-auto">
          <div class="space-y-4 text-sm">
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®¢æˆ·åç§° <span class="text-red-500">*</span></label>
              <select
                v-model="newBilling.å®¢æˆ·åç§°"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="">è¯·é€‰æ‹©å®¢æˆ·</option>
                <option v-for="c in uniqueBillingCustomers" :key="c" :value="c">{{ c }}</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è´¹ç”¨ç±»å‹ <span class="text-red-500">*</span></label>
              <select
                v-model="newBilling.è´¹ç”¨ç±»å‹"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="ä»“å‚¨è´¹">ä»“å‚¨è´¹</option>
                <option value="è¿è¾“è´¹">è¿è¾“è´¹</option>
              </select>
            </div>
            <div v-if="newBilling.è´¹ç”¨ç±»å‹ === 'ä»“å‚¨è´¹'">
              <label class="block text-sm text-gray-700 mb-1">é¢ç§¯ (ã¡) <span class="text-red-500">*</span></label>
              <input
                type="number"
                min="0"
                v-model="newBilling.é¢ç§¯"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="å¦‚ï¼š100"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è´¹ç”¨è¯¦æƒ… <span class="text-red-500">*</span></label>
              <input
                type="text"
                v-model="newBilling.è´¹ç”¨è¯¦æƒ…"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="å¦‚ï¼šå­£åº¦å‰ç»“ç®—"
              />
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-gray-700 mb-1">å‘ç”Ÿæ—¥æœŸ <span class="text-red-500">*</span></label>
                <input
                  type="date"
                  v-model="newBilling.å‘ç”Ÿæ—¥æœŸ"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">é‡‘é¢ (Â¥) <span class="text-red-500">*</span></label>
                <input
                  type="number"
                  min="0"
                  v-model="newBilling.é‡‘é¢"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š12000"
                />
              </div>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ç»“ç®—çŠ¶æ€</label>
              <select
                v-model="newBilling.ç»“ç®—çŠ¶æ€"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="å¾…ç»“ç®—">å¾…ç»“ç®—</option>
                <option value="å·²å›æ¬¾">å·²å›æ¬¾</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ä¸‹æ¬¡æé†’æ—¥æœŸ</label>
              <input
                type="date"
                v-model="newBilling.ä¸‹æ¬¡æé†’æ—¥æœŸ"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeBillingModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveNewBilling"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- æ–°å»ºä¾›åº”å•†æ”¶è´§ä»»åŠ¡ æ¨¡æ€æ¡† -->
    <div
      v-if="showNewReceivingModal"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-md shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°æ–°åˆ°è´§</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeNewReceivingModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[70vh] overflow-y-auto">
          <div class="space-y-4 text-sm">
            <div>
              <label class="block text-sm text-gray-700 mb-1">ä¾›åº”å•†åç§° <span class="text-red-500">*</span></label>
              <div class="relative">
                <input
                  v-model="supplierSearchInput"
                  @input="onSupplierSearchInput"
                  @focus="showSupplierDropdown = true"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="è¾“å…¥è‹±æ–‡åç§°ï¼Œå¦‚ï¼šJABIL"
                />
                <div
                  v-if="showSupplierDropdown && filteredSupplierOptions.length > 0"
                  class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto"
                >
                  <div
                    v-for="(option, idx) in filteredSupplierOptions"
                    :key="idx"
                    @click="selectSupplier(option)"
                    class="px-3 py-2 hover:bg-blue-50 cursor-pointer text-sm"
                  >
                    <div class="font-semibold text-gray-900">{{ option.en }}</div>
                    <div class="text-xs text-gray-500">{{ option.cn }}</div>
                  </div>
                </div>
              </div>
              <div v-if="selectedSupplier" class="mt-2 text-xs text-green-600">
                âœ“ å·²é€‰æ‹©ï¼š{{ selectedSupplier.en }} - {{ selectedSupplier.cn }}
              </div>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">åˆ°è´§æ—¶é—´</label>
              <input
                v-model="newReceivingTask.åˆ°è´§æ—¥æœŸ"
                type="datetime-local"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®ç‰©æ•°é‡ <span class="text-red-500">*</span></label>
              <div class="flex gap-2">
                <input
                  v-model="newReceivingTask.physical_qty"
                  type="number"
                  min="1"
                  class="flex-1 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="ä¾‹å¦‚ï¼š5"
                />
                <select
                  v-model="newReceivingTask.unit"
                  class="w-24 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                >
                  <option value="æ‰˜">æ‰˜</option>
                  <option value="ç®±">ç®±</option>
                  <option value="ä»¶">ä»¶</option>
                </select>
              </div>
            </div>
            <div class="text-xs text-gray-500 bg-gray-50 p-2 rounded">
              ğŸ’¡ æç¤ºï¼šç³»ç»Ÿæ€»è¡Œæ•°å°†åœ¨ä¸Šä¼  GE æŠ¥è¡¨åè‡ªåŠ¨å›å¡«
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰</label>
              <textarea
                v-model="newReceivingTask.å¤‡æ³¨"
                rows="3"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                placeholder="å¯å¡«å†™ç‰¹æ®Šè¦æ±‚ã€åˆ°è´§è¯´æ˜ç­‰"
              ></textarea>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeNewReceivingModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveNewReceivingTask"
          >
            ç¡®è®¤ç™»è®°
          </button>
        </div>
      </div>
    </div>

    <!-- ç™»è®°è½¦æ¬¡ æ¨¡æ€æ¡† -->
    <div
      v-if="showVehicleLogModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-md shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°è½¦æ¬¡</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeVehicleLogModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[70vh] overflow-y-auto">
          <div class="space-y-4">
            <div>
              <label class="block text-sm text-gray-700 mb-1">æ—¥æœŸ <span class="text-red-500">*</span></label>
              <input
                v-model="newVehicleLog.æ—¥æœŸ"
                type="date"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">æ—¶é—´ <span class="text-red-500">*</span></label>
              <input
                v-model="newVehicleLog.æ—¶é—´"
                type="time"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è½¦å‹ <span class="text-red-500">*</span></label>
              <select
                v-model="newVehicleLog.è½¦å‹"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              >
                <option value="">è¯·é€‰æ‹©è½¦å‹</option>
                <option value="9.6ç±³æ¿è½¦">9.6ç±³æ¿è½¦</option>
                <option value="4.2ç±³ç®±è´§">4.2ç±³ç®±è´§</option>
                <option value="12ç±³åŠæŒ‚">12ç±³åŠæŒ‚</option>
                <option value="7.2ç±³å¢å¼è½¦">7.2ç±³å¢å¼è½¦</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å¸æœºå§“å <span class="text-red-500">*</span></label>
              <input
                v-model="newVehicleLog.å¸æœºå§“å"
                type="text"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¯·è¾“å…¥å¸æœºå§“å"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®¢æˆ·åç§° <span class="text-red-500">*</span></label>
              <input
                v-model="newVehicleLog.å®¢æˆ·åç§°"
                type="text"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¯·è¾“å…¥å®¢æˆ·åç§°"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®¢æˆ·ç­¾æ”¶äºº</label>
              <input
                v-model="newVehicleLog.å®¢æˆ·ç­¾æ”¶äºº"
                type="text"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¯·è¾“å…¥å®¢æˆ·ç­¾æ”¶äºº"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å†…å®¹ <span class="text-red-500">*</span></label>
              <select
                v-model="newVehicleLog.å†…å®¹"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              >
                <option value="">è¯·é€‰æ‹©å†…å®¹</option>
                <option value="é€è´§">é€è´§</option>
                <option value="æè´§">æè´§</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å¤‡æ³¨</label>
              <textarea
                v-model="newVehicleLog.å¤‡æ³¨"
                rows="3"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                placeholder="å¯å¡«å†™ç‰¹æ®Šè¯´æ˜ã€è´§ç‰©ä¿¡æ¯ç­‰"
              ></textarea>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeVehicleLogModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveNewVehicleLog"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- æ›´æ–°ä¾›åº”å•†æ”¶è´§è¿›åº¦ æ¨¡æ€æ¡†ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰ -->
    <div
      v-if="showReceivingModal"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-md shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">æ›´æ–°æ”¶è´§è¿›åº¦</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeReceivingModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body">
          <div class="space-y-4">
            <p class="text-sm text-gray-600">
              è¾“å…¥ä»Šæ—¥æ”¶è´§æ¡æ•°ï¼Œç”¨äºæ¨¡æ‹Ÿè¿›åº¦å˜æ›´ï¼ˆä»…å‰ç«¯æ¼”ç¤ºï¼Œä¸ä¼šä¿å­˜åˆ°çœŸå®ç³»ç»Ÿï¼‰ã€‚
            </p>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ä»Šæ—¥æ”¶è´§æ•°é‡</label>
              <input
                v-model="updateQuantityInput"
                type="number"
                min="1"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¯·è¾“å…¥ä»Šæ—¥æ”¶è´§æ¡æ•°ï¼Œä¾‹å¦‚ 20"
              />
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeReceivingModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm text-white"
            @click="saveReceivingProgress"
          >
            ç¡®è®¤æ›´æ–°
          </button>
        </div>
      </div>
    </div>

    <!-- æ–°å¢ç¼ºé™· æ¨¡æ€æ¡† -->
    <div
      v-if="showDefectModal"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-2xl shadow-xl max-h-[90vh] overflow-hidden flex flex-col">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°ç¼ºé™·</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeDefectModal">Ã—</button>
        </div>
        <div class="px-5 py-4 space-y-4 overflow-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <label class="block text-sm text-gray-700 mb-1">å‘ç°æ—¥æœŸ <span class="text-red-500">*</span></label>
              <input
                v-model="newDefect.å‘ç°æ—¥æœŸ"
                type="date"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ç±»å‹ <span class="text-red-500">*</span></label>
              <select
                v-model="newDefect.ç±»å‹"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="">è¯·é€‰æ‹©</option>
                <option value="Bç±»">Bç±»</option>
                <option value="Cç±»">Cç±»</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ç§ç±» <span class="text-red-500">*</span></label>
              <select
                v-model="newDefect.ç§ç±»"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="">è¯·é€‰æ‹©</option>
                <option value="æ¼é…">æ¼é…</option>
                <option value="é”™é…">é”™é…</option>
                <option value="ç‰©æ–™æ‘†å">ç‰©æ–™æ‘†å</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">äº§å“ <span class="text-red-500">*</span></label>
              <input
                v-model="newDefect.äº§å“"
                type="text"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="å¦‚ï¼šTB, 19DTA"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å‘ç°äºº <span class="text-red-500">*</span></label>
              <input
                v-model="newDefect.å‘ç°äºº"
                type="text"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è´£ä»»äºº <span class="text-red-500">*</span></label>
              <input
                v-model="newDefect.è´£ä»»äºº"
                type="text"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
          </div>
          
          <div>
            <label class="block text-sm text-gray-700 mb-1">é—®é¢˜æè¿° <span class="text-red-500">*</span></label>
            <textarea
              v-model="newDefect.é—®é¢˜æè¿°"
              rows="3"
              required
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
              placeholder="è¯·è¯¦ç»†æè¿°å‘ç°çš„é—®é¢˜"
            ></textarea>
          </div>

          <div>
            <label class="block text-sm text-gray-700 mb-1">åŸå› </label>
            <textarea
              v-model="newDefect.åŸå› "
              rows="2"
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
              placeholder="åˆ†æé—®é¢˜äº§ç”Ÿçš„åŸå› "
            ></textarea>
          </div>

          <div>
            <label class="block text-sm text-gray-700 mb-1">è§£å†³æ–¹æ¡ˆ</label>
            <textarea
              v-model="newDefect.è§£å†³æ–¹æ¡ˆ"
              rows="2"
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
              placeholder="æè¿°é‡‡å–çš„è§£å†³æ–¹æ¡ˆ"
            ></textarea>
          </div>

          <!-- å…³é”®ï¼šæ˜¯å¦æŒ‰ç¯è§¦å‘çš„å•é€‰æ¡† -->
          <div>
            <label class="block text-sm text-gray-700 mb-2">æ˜¯å¦æŒ‰ç¯è§¦å‘ï¼Ÿ <span class="text-red-500">*</span></label>
            <div class="flex gap-4">
              <label class="flex items-center">
                <input
                  type="radio"
                  v-model="newDefect.æ˜¯å¦æŒ‰ç¯"
                  :value="true"
                  @change="onAndonChange"
                  class="mr-2"
                />
                <span class="text-sm text-gray-700">æ˜¯</span>
              </label>
              <label class="flex items-center">
                <input
                  type="radio"
                  v-model="newDefect.æ˜¯å¦æŒ‰ç¯"
                  :value="false"
                  @change="onAndonChange"
                  class="mr-2"
                />
                <span class="text-sm text-gray-700">å¦</span>
              </label>
            </div>
          </div>

          <!-- åŠ¨æ€æ˜¾ç¤ºçš„æ–‡ä»¶ä¸Šä¼ æ¡†ï¼ˆä»…å½“é€‰æ‹©"æ˜¯"æ—¶æ˜¾ç¤ºï¼‰ -->
          <div v-if="newDefect.æ˜¯å¦æŒ‰ç¯ === true" class="border border-orange-200 bg-orange-50 rounded-lg p-4">
            <label class="block text-sm text-gray-700 mb-2">
              ä¸Šä¼  5WHY åˆ†ææŠ¥å‘Š <span class="text-red-500">*</span>
            </label>
            <input
              type="file"
              ref="fileInput"
              accept=".pdf,.doc,.docx"
              @change="onFileChange"
              required
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
            />
            <p class="text-xs text-gray-500 mt-1">æ”¯æŒ PDFã€Word æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 10MB</p>
          </div>

          <div>
            <label class="block text-sm text-gray-700 mb-1">å¤‡æ³¨</label>
            <textarea
              v-model="newDefect.å¤‡æ³¨"
              rows="2"
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
              placeholder="å…¶ä»–è¡¥å……è¯´æ˜"
            ></textarea>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeDefectModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveDefect"
          >
            ç¡®è®¤ç™»è®°
          </button>
        </div>
      </div>
    </div>

    <!-- ä¾›åº”å•†æ”¶è´§è¯¦æƒ… æ¨¡æ€æ¡† -->
    <div
      v-if="showReceivingDetailModal && currentReceivingDetailTask"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-2xl shadow-xl max-h-[80vh] overflow-hidden flex flex-col">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">æ”¶è´§è¯¦æƒ… - {{ currentReceivingDetailTask.ä¾›åº”å•†åç§° }}</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeReceivingDetailModal">Ã—</button>
        </div>
        <div class="px-5 py-4 space-y-4 overflow-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
            <div>
              <div class="text-gray-500 text-xs mb-1">ä¾›åº”å•†åç§°</div>
              <div class="font-medium">{{ currentReceivingDetailTask.ä¾›åº”å•†åç§° || '--' }}</div>
            </div>
            <div>
              <div class="text-gray-500 text-xs mb-1">åˆ°è´§æ—¶é—´</div>
              <div class="font-medium">{{ currentReceivingDetailTask.åˆ°è´§æ—¥æœŸ || '--' }}</div>
            </div>
            <div>
              <div class="text-gray-500 text-xs mb-1">æ€»è¡Œæ•°</div>
              <div class="font-medium">{{ currentReceivingDetailTask.æ€»è¡Œæ•° || 0 }} æ¡</div>
            </div>
            <div>
              <div class="text-gray-500 text-xs mb-1">å·²å®Œæˆæ•°é‡</div>
              <div class="font-medium">{{ currentReceivingDetailTask.å·²å®Œæˆæ•°é‡ || 0 }} æ¡ ({{ getReceivingProgressPercent(currentReceivingDetailTask) }}%)</div>
            </div>
          </div>

          <div class="mt-2">
            <h4 class="text-sm font-semibold text-gray-800 mb-2">æ”¶è´§è®°å½•</h4>
            <div class="border border-gray-200 rounded-lg overflow-hidden">
              <table class="min-w-full text-xs">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="px-4 py-2 text-left font-semibold text-gray-700 whitespace-nowrap">æ—¥æœŸ</th>
                    <th class="px-4 py-2 text-left font-semibold text-gray-700 whitespace-nowrap">å½“æ—¥æ”¶è´§é‡</th>
                    <th class="px-4 py-2 text-left font-semibold text-gray-700 whitespace-nowrap">æ“ä½œäºº</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    v-if="!(currentReceivingDetailTask.æ¯æ—¥è¿›åº¦è®°å½• && currentReceivingDetailTask.æ¯æ—¥è¿›åº¦è®°å½•.length)"
                    class="border-t border-gray-200"
                  >
                    <td colspan="3" class="px-4 py-6 text-center text-gray-500">æš‚æ— æ”¶è´§è®°å½•</td>
                  </tr>
                  <tr
                    v-else
                    v-for="(item, idx) in currentReceivingDetailTask.æ¯æ—¥è¿›åº¦è®°å½•"
                    :key="idx"
                    class="border-t border-gray-200"
                  >
                    <td class="px-4 py-2 text-gray-700 whitespace-nowrap">{{ item.date || '--' }}</td>
                    <td class="px-4 py-2 text-gray-700 whitespace-nowrap">{{ item.count || 0 }}</td>
                    <td class="px-4 py-2 text-gray-700 whitespace-nowrap">{{ item.operator || 'ç³»ç»Ÿ' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="px-5 py-3 border-t border-gray-200 flex justify-end">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeReceivingDetailModal"
          >
            å…³é—­
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    // Mock æ•°æ® - ç›´æ¥å†…åµŒåœ¨ HTML ä¸­
    const mockData = {
      // 1. ç”Ÿäº§è®¡åˆ’ (Production Plan)
      productionPlan: [
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-15",
          å‘è½¦æ—¶é—´: "08:30",
          è½¦æ¬¡: "VH-2024-0015",
          å·¥åºå·: "OP70",
          äº§çº¿åç§°: "äº§çº¿A-è£…é…çº¿",
          åˆ°åœºæ—¶é—´: "09:15",
          äº§å“æè¿°: "GEç‡ƒæ°”è½®æœºå¶ç‰‡ç»„ä»¶-TB-4502",
          å·¥å•å·: "WO-2024-0123",
          åŠ å·¥åºåˆ—å·: "SEQ-001",
          å·¥åºæè¿°: "CDFé—¨è£…é…"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-15",
          å‘è½¦æ—¶é—´: "10:00",
          è½¦æ¬¡: "VH-2024-0016",
          å·¥åºå·: "OP50",
          äº§çº¿åç§°: "äº§çº¿B-æœºåŠ å·¥çº¿",
          åˆ°åœºæ—¶é—´: "10:45",
          äº§å“æè¿°: "è¥¿é—¨å­ç”µæœºå®šå­ç»„ä»¶-SI-7821",
          å·¥å•å·: "WO-2024-0124",
          åŠ å·¥åºåˆ—å·: "SEQ-002",
          å·¥åºæè¿°: "ç²¾å¯†é“£å‰ŠåŠ å·¥"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-16",
          å‘è½¦æ—¶é—´: "07:45",
          è½¦æ¬¡: "VH-2024-0017",
          å·¥åºå·: "OP80",
          äº§çº¿åç§°: "äº§çº¿C-ç„Šæ¥çº¿",
          åˆ°åœºæ—¶é—´: "08:30",
          äº§å“æè¿°: "ABBå˜é¢‘å™¨å¤–å£³ç»„ä»¶-ABB-3350",
          å·¥å•å·: "WO-2024-0125",
          åŠ å·¥åºåˆ—å·: "SEQ-003",
          å·¥åºæè¿°: "æ°©å¼§ç„Šç„Šæ¥"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-16",
          å‘è½¦æ—¶é—´: "13:20",
          è½¦æ¬¡: "VH-2024-0018",
          å·¥åºå·: "OP60",
          äº§çº¿åç§°: "äº§çº¿A-è£…é…çº¿",
          åˆ°åœºæ—¶é—´: "14:05",
          äº§å“æè¿°: "GEå‹ç¼©æœºè½¬å­ç»„ä»¶-CP-2891",
          å·¥å•å·: "WO-2024-0126",
          åŠ å·¥åºåˆ—å·: "SEQ-004",
          å·¥åºæè¿°: "åŠ¨å¹³è¡¡æ£€æµ‹"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-17",
          å‘è½¦æ—¶é—´: "09:00",
          è½¦æ¬¡: "VH-2024-0019",
          å·¥åºå·: "OP90",
          äº§çº¿åç§°: "äº§çº¿D-å–·æ¶‚çº¿",
          åˆ°åœºæ—¶é—´: "09:50",
          äº§å“æè¿°: "è¥¿é—¨å­æ§åˆ¶æŸœé¢æ¿-SI-9012",
          å·¥å•å·: "WO-2024-0127",
          åŠ å·¥åºåˆ—å·: "SEQ-005",
          å·¥åºæè¿°: "é™ç”µå–·æ¶‚"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-17",
          å‘è½¦æ—¶é—´: "11:30",
          è½¦æ¬¡: "VH-2024-0020",
          å·¥åºå·: "OP70",
          äº§çº¿åç§°: "äº§çº¿B-æœºåŠ å·¥çº¿",
          åˆ°åœºæ—¶é—´: "12:15",
          äº§å“æè¿°: "ABBä¼ºæœç”µæœºè½´-ABB-4456",
          å·¥å•å·: "WO-2024-0128",
          åŠ å·¥åºåˆ—å·: "SEQ-006",
          å·¥åºæè¿°: "CDFé—¨è£…é…"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-18",
          å‘è½¦æ—¶é—´: "08:15",
          è½¦æ¬¡: "VH-2024-0021",
          å·¥åºå·: "OP55",
          äº§çº¿åç§°: "äº§çº¿C-ç„Šæ¥çº¿",
          åˆ°åœºæ—¶é—´: "09:00",
          äº§å“æè¿°: "GEå‘ç”µæœºç«¯ç›–ç»„ä»¶-GE-5678",
          å·¥å•å·: "WO-2024-0129",
          åŠ å·¥åºåˆ—å·: "SEQ-007",
          å·¥åºæè¿°: "æ¿€å…‰ç„Šæ¥"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-18",
          å‘è½¦æ—¶é—´: "14:00",
          è½¦æ¬¡: "VH-2024-0022",
          å·¥åºå·: "OP75",
          äº§çº¿åç§°: "äº§çº¿A-è£…é…çº¿",
          åˆ°åœºæ—¶é—´: "14:45",
          äº§å“æè¿°: "è¥¿é—¨å­å˜é¢‘å™¨æ•£çƒ­å™¨-SI-6789",
          å·¥å•å·: "WO-2024-0130",
          åŠ å·¥åºåˆ—å·: "SEQ-008",
          å·¥åºæè¿°: "çƒ­å‹è£…é…"
        }
      ],

      // 2. è½¦æ¬¡ç®¡ç† (Vehicle Log)
      vehicleLog: [
        {
          æ—¥æœŸ: "2024-01-15",
          æ—¶é—´: "08:30",
          è½¦å‹: "9.6ç±³æ¿è½¦",
          å¸æœºå§“å: "å¼ å¸ˆå‚…",
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          å®¢æˆ·ç­¾æ”¶äºº: "æç»ç†",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "GEç‡ƒæ°”è½®æœºå¶ç‰‡ç»„ä»¶ï¼Œå…±3ç®±ï¼Œå·²ç­¾æ”¶"
        },
        {
          æ—¥æœŸ: "2024-01-15",
          æ—¶é—´: "10:00",
          è½¦å‹: "7.2ç±³å¢å¼è½¦",
          å¸æœºå§“å: "ç‹å¸ˆå‚…",
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          å®¢æˆ·ç­¾æ”¶äºº: "é™ˆä¸»ç®¡",
          å†…å®¹: "æè´§",
          å¤‡æ³¨: "æå–è¥¿é—¨å­ç”µæœºå®šå­ç»„ä»¶ï¼Œå¾…åŠ å·¥"
        },
        {
          æ—¥æœŸ: "2024-01-16",
          æ—¶é—´: "07:45",
          è½¦å‹: "9.6ç±³æ¿è½¦",
          å¸æœºå§“å: "åˆ˜å¸ˆå‚…",
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          å®¢æˆ·ç­¾æ”¶äºº: "å‘¨ä¸»ä»»",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "ABBå˜é¢‘å™¨å¤–å£³ç»„ä»¶ï¼Œå…±5ç®±ï¼Œå·²é€è¾¾"
        },
        {
          æ—¥æœŸ: "2024-01-16",
          æ—¶é—´: "13:20",
          è½¦å‹: "12ç±³åŠæŒ‚è½¦",
          å¸æœºå§“å: "èµµå¸ˆå‚…",
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          å®¢æˆ·ç­¾æ”¶äºº: "å´ç»ç†",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "GEå‹ç¼©æœºè½¬å­ç»„ä»¶ï¼Œå¤§å‹è®¾å¤‡ï¼Œéœ€å‰è½¦å¸è´§"
        },
        {
          æ—¥æœŸ: "2024-01-17",
          æ—¶é—´: "09:00",
          è½¦å‹: "7.2ç±³å¢å¼è½¦",
          å¸æœºå§“å: "å­™å¸ˆå‚…",
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          å®¢æˆ·ç­¾æ”¶äºº: "éƒ‘ä¸»ç®¡",
          å†…å®¹: "æè´§",
          å¤‡æ³¨: "æå–è¥¿é—¨å­æ§åˆ¶æŸœé¢æ¿ï¼Œè¿”å›å·¥å‚"
        },
        {
          æ—¥æœŸ: "2024-01-17",
          æ—¶é—´: "11:30",
          è½¦å‹: "9.6ç±³æ¿è½¦",
          å¸æœºå§“å: "é’±å¸ˆå‚…",
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          å®¢æˆ·ç­¾æ”¶äºº: "å†¯ä¸»ä»»",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "ABBä¼ºæœç”µæœºè½´ï¼Œå…±2ç®±ï¼Œå·²ç­¾æ”¶"
        },
        {
          æ—¥æœŸ: "2024-01-18",
          æ—¶é—´: "08:15",
          è½¦å‹: "12ç±³åŠæŒ‚è½¦",
          å¸æœºå§“å: "å‘¨å¸ˆå‚…",
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          å®¢æˆ·ç­¾æ”¶äºº: "æç»ç†",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "GEå‘ç”µæœºç«¯ç›–ç»„ä»¶ï¼Œå…±8ç®±ï¼Œå·²å…¨éƒ¨é€è¾¾"
        },
        {
          æ—¥æœŸ: "2024-01-18",
          æ—¶é—´: "14:00",
          è½¦å‹: "7.2ç±³å¢å¼è½¦",
          å¸æœºå§“å: "å´å¸ˆå‚…",
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          å®¢æˆ·ç­¾æ”¶äºº: "é™ˆä¸»ç®¡",
          å†…å®¹: "æè´§",
          å¤‡æ³¨: "æå–è¥¿é—¨å­å˜é¢‘å™¨æ•£çƒ­å™¨ï¼Œè¿”å›åŠ å·¥"
        }
      ],

      // 3. ECO å˜æ›´ç®¡ç† (ECO List) - é‡æ„ä¸ºæ”¯æŒå¤šç‰©æ–™ç»“æ„
      ecoList: [
        {
          eco_no: "401",
          description: "HAL-X NC1",
          op: "OP220",
          start_set: 1,
          change_details: "æ›´æ¢ä¸ºV2ç‰ˆæœ¬ï¼Œæ³¨æ„å®‰è£…å­”ä½",
          materials: ["151X1249KA08NP17", "151X1249KA08NP18", "151X1249KA08NP19"],
          status: "è¿›è¡Œä¸­",
          update_time: "2024-01-20 10:00",
          é…æ–™å‘˜: "ç‹é…æ–™"
        },
        {
          eco_no: "323",
          description: "GEç‡ƒæ°”è½®æœºå¶ç‰‡ç»„ä»¶-TB-4502",
          op: "OP70",
          start_set: 25,
          change_details: "æ›´æ¢ä¸ºV2ç‰ˆæœ¬ï¼Œæ³¨æ„å®‰è£…å­”ä½",
          materials: ["MAT-GE-TB4502-V2", "MAT-GE-TB4502-V2-BOLT"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-10 14:30",
          é…æ–™å‘˜: "å¼ é…æ–™"
        },
        {
          eco_no: "324",
          description: "è¥¿é—¨å­ç”µæœºå®šå­ç»„ä»¶-SI-7821",
          op: "OP50",
          start_set: 20,
          change_details: "å‡çº§åˆ°V3ç‰ˆæœ¬ï¼Œå¢åŠ æ•£çƒ­ç‰‡",
          materials: ["MAT-SI-7821-V3", "MAT-SI-7821-HEATSINK"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-11 09:15",
          é…æ–™å‘˜: "æé…æ–™"
        },
        {
          eco_no: "325",
          description: "ABBå˜é¢‘å™¨å¤–å£³ç»„ä»¶-ABB-3350",
          op: "OP80",
          start_set: 12,
          change_details: "æ›´æ¢å¤–å£³æè´¨ï¼Œæé«˜è€çƒ­æ€§",
          materials: ["MAT-ABB-3350-V1", "MAT-ABB-3350-SEAL"],
          status: "å·²è¿‡æœŸ",
          update_time: "2023-12-20 16:45",
          é…æ–™å‘˜: "ç‹é…æ–™"
        },
        {
          eco_no: "326",
          description: "GEå‹ç¼©æœºè½¬å­ç»„ä»¶-CP-2891",
          op: "OP60",
          start_set: 6,
          change_details: "ä¼˜åŒ–è½¬å­å¹³è¡¡ï¼Œè°ƒæ•´é…é‡",
          materials: ["MAT-GE-CP2891-V2"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-12 11:20",
          é…æ–™å‘˜: "åˆ˜é…æ–™"
        },
        {
          eco_no: "327",
          description: "è¥¿é—¨å­æ§åˆ¶æŸœé¢æ¿-SI-9012",
          op: "OP90",
          start_set: 30,
          change_details: "æ›´æ–°é¢æ¿å¸ƒå±€ï¼Œå¢åŠ æ¥å£",
          materials: ["MAT-SI-9012-V4", "MAT-SI-9012-CONNECTOR"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-13 15:00",
          é…æ–™å‘˜: "èµµé…æ–™"
        },
        {
          eco_no: "328",
          description: "ABBä¼ºæœç”µæœºè½´-ABB-4456",
          op: "OP70",
          start_set: 15,
          change_details: "æ›´æ¢è½´ææ–™ï¼Œæé«˜å¼ºåº¦",
          materials: ["MAT-ABB-4456-V2"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-14 10:30",
          é…æ–™å‘˜: "å­™é…æ–™"
        },
        {
          eco_no: "329",
          description: "GEå‘ç”µæœºç«¯ç›–ç»„ä»¶-GE-5678",
          op: "OP55",
          start_set: 8,
          change_details: "ä¼˜åŒ–å¯†å°ç»“æ„",
          materials: ["MAT-GE-5678-V1", "MAT-GE-5678-GASKET"],
          status: "å·²è¿‡æœŸ",
          update_time: "2023-12-15 13:10",
          é…æ–™å‘˜: "é’±é…æ–™"
        },
        {
          eco_no: "330",
          description: "è¥¿é—¨å­å˜é¢‘å™¨æ•£çƒ­å™¨-SI-6789",
          op: "OP75",
          start_set: 25,
          change_details: "å¢åŠ æ•£çƒ­é¢ç§¯ï¼Œä¼˜åŒ–é£é“",
          materials: ["MAT-SI-6789-V3", "MAT-SI-6789-FAN"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-15 08:45",
          é…æ–™å‘˜: "å‘¨é…æ–™"
        }
      ],
      // 4. åˆ°è´§å¼‚å¸¸ç®¡ç† (Inbound Discrepancy)
      discrepancyList: [
        {
          report_id: "W-2025-0102",
          date: "2025-01-15",
          supplier: "è²å°¼å…‹æ–¯",
          po: "PO-889912",
          material: "PHX-TERM-1102",
          qty: 120,
          is_bonded: false,
          category: "å®ç‰©ç ´æŸ",
          description: "å¤–ç®±ç ´æŸï¼Œå†…éƒ¨ç«¯å­æœ‰ç£•ç¢°ï¼Œéœ€äºŒæ¬¡æ£€éªŒ",
          photos: ["damage-box.jpg", "terminal-scratch.jpg"],
          status: "å¾…å¤„ç†",
          result: "",
          duration: 0
        },
        {
          report_id: "W-2025-0103",
          date: "2025-01-14",
          supplier: "ABB",
          po: "PO-776601",
          material: "ABB-MOTOR-4421",
          qty: 50,
          is_bonded: true,
          category: "æ•°é‡å·®å¼‚",
          description: "é€è´§å• 50 ä»¶ï¼Œå®æ”¶ 48 ä»¶ï¼Œå·®å¼‚ 2 ä»¶",
          photos: ["short-qty.jpg"],
          status: "å¤„ç†ä¸­",
          result: "ä¾›åº”å•†æ ¸å¯¹ä¸­",
          duration: 1
        },
        {
          report_id: "W-2025-0104",
          date: "2025-01-12",
          supplier: "åŒ—äº¬ç¦æ¶¦è¾¾",
          po: "PO-770021",
          material: "BRD-FILTER-9001",
          qty: 200,
          is_bonded: false,
          category: "æ ‡ç­¾é”™è¯¯",
          description: "å¤–åŒ…è£…æ ‡ç­¾ä¸å†…ä»¶ç‰©æ–™å·ä¸ä¸€è‡´ï¼Œéœ€é‡æ–°è´´æ ‡",
          photos: ["label-mismatch.jpg"],
          status: "å·²é—­ç¯",
          result: "å·²é‡æ–°è´´æ ‡å¹¶å¤æ ¸",
          duration: 2
        },
        {
          report_id: "W-2025-0105",
          date: "2025-01-11",
          supplier: "è¥¿é—¨å­",
          po: "PO-665512",
          material: "SI-PLC-1200",
          qty: 30,
          is_bonded: false,
          category: "ç³»ç»Ÿé—®é¢˜",
          description: "åˆ°è´§é€šçŸ¥æœªåŒæ­¥ï¼Œç³»ç»Ÿæ—  ASNï¼Œéœ€æ‰‹å·¥å»ºå•",
          photos: [],
          status: "å¾…å¤„ç†",
          result: "",
          duration: 0
        },
        {
          report_id: "W-2025-0106",
          date: "2025-01-10",
          supplier: "ä¼å°”ç‰¹",
          po: "PO-551120",
          material: "WUR-SCREW-9901",
          qty: 1000,
          is_bonded: false,
          category: "å•æ®é—®é¢˜",
          description: "å‘ç¥¨ä¸é€è´§å•æ•°é‡ä¸ä¸€è‡´ï¼Œéœ€ä¾›åº”å•†é‡å¼€å‘ç¥¨",
          photos: ["invoice-issue.jpg"],
          status: "å¤„ç†ä¸­",
          result: "ä¾›åº”å•†è¡¥å¼€ç¥¨",
          duration: 4
        }
      ],

      // 4. å®¢æˆ·è´¹ç”¨ç»“ç®— (Billing Record)
      billingRecord: [
        {
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          è´¹ç”¨ç±»å‹: "ä»“å‚¨è´¹",
          è´¹ç”¨è¯¦æƒ…: "å­£åº¦å‰ç»“ç®—",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-15",
          é¢ç§¯: 100,
          é‡‘é¢: 125000,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-01-25"
        },
        {
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          è´¹ç”¨ç±»å‹: "è¿è¾“è´¹",
          è´¹ç”¨è¯¦æƒ…: "è´§è½¦é€æŸœ",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-15",
          é¢ç§¯: 0,
          é‡‘é¢: 8500,
          ç»“ç®—çŠ¶æ€: "å·²å›æ¬¾",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: ""
        },
        {
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          è´¹ç”¨ç±»å‹: "è¿è¾“è´¹",
          è´¹ç”¨è¯¦æƒ…: "è´§è½¦é€æŸœ",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-16",
          é¢ç§¯: 0,
          é‡‘é¢: 12000,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-01-26"
        },
        {
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          è´¹ç”¨ç±»å‹: "ä»“å‚¨è´¹",
          è´¹ç”¨è¯¦æƒ…: "å­£åº¦å‰ç»“ç®—",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-16",
          é¢ç§¯: 120,
          é‡‘é¢: 98000,
          ç»“ç®—çŠ¶æ€: "å·²å›æ¬¾",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: ""
        },
        {
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          è´¹ç”¨ç±»å‹: "ä»“å‚¨è´¹",
          è´¹ç”¨è¯¦æƒ…: "æœˆåº¦ä»“å‚¨è´¹",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-17",
          é¢ç§¯: 70,
          é‡‘é¢: 45000,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-01-27"
        },
        {
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          è´¹ç”¨ç±»å‹: "è¿è¾“è´¹",
          è´¹ç”¨è¯¦æƒ…: "è´§è½¦é€æŸœ",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-17",
          é¢ç§¯: 0,
          é‡‘é¢: 6500,
          ç»“ç®—çŠ¶æ€: "å·²å›æ¬¾",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: ""
        },
        {
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          è´¹ç”¨ç±»å‹: "è¿è¾“è´¹",
          è´¹ç”¨è¯¦æƒ…: "å¤§å‹è®¾å¤‡è¿è¾“",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-18",
          é¢ç§¯: 0,
          é‡‘é¢: 18500,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-01-28"
        },
        {
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          è´¹ç”¨ç±»å‹: "ä»“å‚¨è´¹",
          è´¹ç”¨è¯¦æƒ…: "æœˆåº¦ä»“å‚¨è´¹",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-18",
          é¢ç§¯: 95,
          é‡‘é¢: 32000,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-01-28"
        }
      ],

      // ä¾›åº”å•†å­—å…¸ (Supplier Dictionary - ä¸­è‹±æ–‡å¯¹ç…§)
      supplierDict: [
        { en: 'JABIL CIRCUITS INC', cn: 'æ·æ™®ç”µå­' },
        { en: 'Semikron Hong Kong Co Ltd', cn: 'èµ›ç±³æ§' },
        { en: 'Eaton Corporation', cn: 'ä¼Šé¡¿' },
        { en: 'GE DRIVES & CONTROLS, INC.', cn: 'GE é©±åŠ¨æ§åˆ¶' },
        { en: 'Bossard', cn: 'åšè¨å¾·ç´§å›ºä»¶' },
        { en: 'Siemens', cn: 'è¥¿é—¨å­' },
        { en: 'ABB', cn: 'ABB' }
      ],

      // 5. ä¾›åº”å•†æ”¶è´§ç›‘æ§ (Receiving Tasks)
      receivingTasks: [
        {
          ä¾›åº”å•†åç§°: "Bossard åšè¨å¾·ç´§å›ºä»¶",
          supplier_en: "Bossard",
          supplier_cn: "åšè¨å¾·ç´§å›ºä»¶",
          åˆ°è´§æ—¥æœŸ: "2024-01-18 10:00",
          æ€»è¡Œæ•°: 120,
          physical_qty: 5,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 65,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-18", count: 45, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-19", count: 20, operator: "ä»“åº“æ”¶è´§å‘˜-å¼ å¼º" }
          ],
          å½“å‰çŠ¶æ€: "âš ï¸æœ‰ç§¯å‹"
        },
        {
          ä¾›åº”å•†åç§°: "GE èƒ½æºé›¶éƒ¨ä»¶ä¸­å¿ƒ",
          supplier_en: "GE DRIVES & CONTROLS, INC.",
          supplier_cn: "GE é©±åŠ¨æ§åˆ¶",
          åˆ°è´§æ—¥æœŸ: "2024-01-17 15:30",
          æ€»è¡Œæ•°: 80,
          physical_qty: 3,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 80,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-17", count: 50, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-18", count: 30, operator: "ä»“åº“æ”¶è´§å‘˜-ææ•" }
          ],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "Siemens - è¥¿é—¨å­",
          supplier_en: "Siemens",
          supplier_cn: "è¥¿é—¨å­",
          åˆ°è´§æ—¥æœŸ: "2024-01-16 09:00",
          æ€»è¡Œæ•°: 150,
          physical_qty: 8,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 92,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-16", count: 40, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-17", count: 30, operator: "ä»“åº“æ”¶è´§å‘˜-ç‹å»º" },
            { date: "2024-01-18", count: 22, operator: "ä»“åº“æ”¶è´§å‘˜-ç‹å»º" }
          ],
          å½“å‰çŠ¶æ€: "âš ï¸æœ‰ç§¯å‹"
        },
        {
          ä¾›åº”å•†åç§°: "ABB - ABB",
          supplier_en: "ABB",
          supplier_cn: "ABB",
          åˆ°è´§æ—¥æœŸ: "2024-01-15 14:20",
          æ€»è¡Œæ•°: 200,
          physical_qty: 12,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 150,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-15", count: 60, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-16", count: 55, operator: "ä»“åº“æ”¶è´§å‘˜-åˆ˜ä¼Ÿ" },
            { date: "2024-01-17", count: 35, operator: "ä»“åº“æ”¶è´§å‘˜-åˆ˜ä¼Ÿ" }
          ],
          å½“å‰çŠ¶æ€: "ğŸ”´å·²è¶…æ—¶"
        },
        {
          ä¾›åº”å•†åç§°: "å…ˆå¯¼ç²¾å¯†åŒ…è£…ææ–™",
          supplier_en: "",
          supplier_cn: "å…ˆå¯¼ç²¾å¯†åŒ…è£…ææ–™",
          åˆ°è´§æ—¥æœŸ: "2024-01-18 08:30",
          æ€»è¡Œæ•°: 60,
          physical_qty: 2,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 18,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-18", count: 18, operator: "ç³»ç»Ÿå¯¼å…¥" }
          ],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "å¯Œåˆ›ç²¾å¯†æœºåŠ ä»¶",
          supplier_en: "",
          supplier_cn: "å¯Œåˆ›ç²¾å¯†æœºåŠ ä»¶",
          åˆ°è´§æ—¥æœŸ: "2024-01-17 11:10",
          æ€»è¡Œæ•°: 90,
          physical_qty: 4,
          unit: "ç®±",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 40,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-17", count: 25, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-18", count: 15, operator: "ä»“åº“æ”¶è´§å‘˜-å‘¨é’" }
          ],
          å½“å‰çŠ¶æ€: "âš ï¸æœ‰ç§¯å‹"
        },
        // æ–°å¢ï¼šç­‰å¾… GE æŠ¥è¡¨å¯¼å…¥çš„ç¤ºä¾‹æ•°æ®ï¼ˆpending çŠ¶æ€ï¼‰
        {
          ä¾›åº”å•†åç§°: "JABIL CIRCUITS INC - æ·æ™®ç”µå­",
          supplier_en: "JABIL CIRCUITS INC",
          supplier_cn: "æ·æ™®ç”µå­",
          åˆ°è´§æ—¥æœŸ: "2024-01-19 09:00",
          æ€»è¡Œæ•°: 0,
          physical_qty: 6,
          unit: "æ‰˜",
          data_source: "pending",
          å·²å®Œæˆæ•°é‡: 0,
          æ¯æ—¥è¿›åº¦è®°å½•: [],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "Semikron Hong Kong Co Ltd - èµ›ç±³æ§",
          supplier_en: "Semikron Hong Kong Co Ltd",
          supplier_cn: "èµ›ç±³æ§",
          åˆ°è´§æ—¥æœŸ: "2024-01-19 14:30",
          æ€»è¡Œæ•°: 0,
          physical_qty: 3,
          unit: "ç®±",
          data_source: "pending",
          å·²å®Œæˆæ•°é‡: 0,
          æ¯æ—¥è¿›åº¦è®°å½•: [],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "Eaton Corporation - ä¼Šé¡¿",
          supplier_en: "Eaton Corporation",
          supplier_cn: "ä¼Šé¡¿",
          åˆ°è´§æ—¥æœŸ: "2024-01-18 16:00",
          æ€»è¡Œæ•°: 0,
          physical_qty: 10,
          unit: "ä»¶",
          data_source: "pending",
          å·²å®Œæˆæ•°é‡: 0,
          æ¯æ—¥è¿›åº¦è®°å½•: [],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "GE DRIVES & CONTROLS, INC. - GE é©±åŠ¨æ§åˆ¶",
          supplier_en: "GE DRIVES & CONTROLS, INC.",
          supplier_cn: "GE é©±åŠ¨æ§åˆ¶",
          åˆ°è´§æ—¥æœŸ: "2024-01-20 08:00",
          æ€»è¡Œæ•°: 0,
          physical_qty: 7,
          unit: "æ‰˜",
          data_source: "pending",
          å·²å®Œæˆæ•°é‡: 0,
          æ¯æ—¥è¿›åº¦è®°å½•: [],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "JABIL CIRCUITS INC - æ·æ™®ç”µå­",
          supplier_en: "JABIL CIRCUITS INC",
          supplier_cn: "æ·æ™®ç”µå­",
          åˆ°è´§æ—¥æœŸ: "2024-01-17 13:20",
          æ€»è¡Œæ•°: 180,
          physical_qty: 9,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 120,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-17", count: 80, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-18", count: 40, operator: "ä»“åº“æ”¶è´§å‘˜-èµµæ˜" }
          ],
          å½“å‰çŠ¶æ€: "âš ï¸æœ‰ç§¯å‹"
        },
        {
          ä¾›åº”å•†åç§°: "Eaton Corporation - ä¼Šé¡¿",
          supplier_en: "Eaton Corporation",
          supplier_cn: "ä¼Šé¡¿",
          åˆ°è´§æ—¥æœŸ: "2024-01-16 11:00",
          æ€»è¡Œæ•°: 95,
          physical_qty: 5,
          unit: "ç®±",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 95,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-16", count: 50, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-17", count: 45, operator: "ä»“åº“æ”¶è´§å‘˜-é™ˆä¸½" }
          ],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        }
      ],

      // 6. ç¼ºé™·ç®¡ç† (Defect Management)
      defectList: [
        {
          å‘ç°æ—¥æœŸ: "2024-01-18",
          ç±»å‹: "Bç±»",
          ç§ç±»: "æ¼é…",
          æ˜¯å¦æŒ‰ç¯: true,
          äº§å“: "TB",
          é—®é¢˜æè¿°: "å·¥å•TB-2024-0123ç¼ºå°‘2ä¸ªM6èºæ “",
          å‘ç°äºº: "å¼ è´¨æ£€",
          è´£ä»»äºº: "æé…æ–™",
          åŸå› : "é…æ–™æ¸…å•æœªå®Œæ•´æ ¸å¯¹",
          è§£å†³æ–¹æ¡ˆ: "è¡¥å……ç¼ºå¤±ç‰©æ–™ï¼ŒåŠ å¼ºæ¸…å•å¤æ ¸",
          '5WHYæ–‡ä»¶': "5why-tb-2024-0123.pdf",
          å¤‡æ³¨: "å·²è¡¥å‘ï¼Œåç»­åŠ å¼ºæ£€æŸ¥"
        },
        {
          å‘ç°æ—¥æœŸ: "2024-01-17",
          ç±»å‹: "Cç±»",
          ç§ç±»: "é”™é…",
          æ˜¯å¦æŒ‰ç¯: false,
          äº§å“: "19DTA",
          é—®é¢˜æè¿°: "ä½¿ç”¨äº†é”™è¯¯è§„æ ¼çš„å¯†å°åœˆ",
          å‘ç°äºº: "ç‹æ£€éªŒ",
          è´£ä»»äºº: "å‘¨è£…é…",
          åŸå› : "ç‰©æ–™æ ‡è¯†ä¸æ¸…ï¼Œæœªä»”ç»†æ ¸å¯¹",
          è§£å†³æ–¹æ¡ˆ: "é‡æ–°æ ‡è¯†ç‰©æ–™ï¼ŒåŸ¹è®­æ“ä½œè§„èŒƒ",
          '5WHYæ–‡ä»¶': "",
          å¤‡æ³¨: "å·²æ›´æ¢æ­£ç¡®ç‰©æ–™"
        },
        {
          å‘ç°æ—¥æœŸ: "2024-01-16",
          ç±»å‹: "Bç±»",
          ç§ç±»: "ç‰©æ–™æ‘†å",
          æ˜¯å¦æŒ‰ç¯: true,
          äº§å“: "TB",
          é—®é¢˜æè¿°: "ç”µæœºå®šå­å®‰è£…æ–¹å‘é”™è¯¯",
          å‘ç°äºº: "èµµè´¨æ£€",
          è´£ä»»äºº: "å´è£…é…",
          åŸå› : "è£…é…å›¾çº¸ç†è§£æœ‰è¯¯",
          è§£å†³æ–¹æ¡ˆ: "é‡æ–°åŸ¹è®­è£…é…æµç¨‹ï¼Œæ˜ç¡®æ–¹å‘æ ‡è¯†",
          '5WHYæ–‡ä»¶': "5why-tb-motor-2024-0116.pdf",
          å¤‡æ³¨: "å·²è¿”å·¥ï¼Œæ›´æ–°ä½œä¸šæŒ‡å¯¼ä¹¦"
        },
        {
          å‘ç°æ—¥æœŸ: "2024-01-15",
          ç±»å‹: "Cç±»",
          ç§ç±»: "æ¼é…",
          æ˜¯å¦æŒ‰ç¯: false,
          äº§å“: "19DTA",
          é—®é¢˜æè¿°: "ç¼ºå°‘åŒ…è£…æ ‡ç­¾",
          å‘ç°äºº: "å­™åŒ…è£…",
          è´£ä»»äºº: "éƒ‘åŒ…è£…",
          åŸå› : "åŒ…è£…æµç¨‹é—æ¼æ ‡ç­¾ç¯èŠ‚",
          è§£å†³æ–¹æ¡ˆ: "å®Œå–„åŒ…è£…æ£€æŸ¥æ¸…å•",
          '5WHYæ–‡ä»¶': "",
          å¤‡æ³¨: "å·²è¡¥æ‰“æ ‡ç­¾"
        },
        {
          å‘ç°æ—¥æœŸ: "2024-01-14",
          ç±»å‹: "Bç±»",
          ç§ç±»: "é”™é…",
          æ˜¯å¦æŒ‰ç¯: true,
          äº§å“: "TB",
          é—®é¢˜æè¿°: "ä½¿ç”¨äº†éæ ‡å‡†ä»¶æ›¿ä»£æ ‡å‡†ä»¶",
          å‘ç°äºº: "é’±è´¨æ£€",
          è´£ä»»äºº: "å†¯é‡‡è´­",
          åŸå› : "ç´§æ€¥é‡‡è´­æ—¶æœªä¸¥æ ¼æŒ‰è§„æ ¼æ‰§è¡Œ",
          è§£å†³æ–¹æ¡ˆ: "å»ºç«‹ç´§æ€¥é‡‡è´­å®¡æ‰¹æµç¨‹ï¼Œç¦æ­¢éšæ„æ›¿ä»£",
          '5WHYæ–‡ä»¶': "5why-tb-nonstandard-2024-0114.pdf",
          å¤‡æ³¨: "å·²æ›´æ¢æ ‡å‡†ä»¶ï¼Œæµç¨‹å·²æ›´æ–°"
        }
      ]
    };

    // BI Dashboard Mock æ•°æ®
    const biMockData = {
      kpi: {
        monthlyProduction: 25320,
        avgDPMO: 76.3,
        receivingOnTimeRate: 99.8,
        supplierIssues: 45
      },
      // äº§é‡ä¸ç¼ºé™·ç‡è¶‹åŠ¿ï¼ˆ1-12æœˆï¼‰
      productionDefectTrend: {
        months: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
        production: [18500, 21200, 19800, 22800, 24500, 23800, 25200, 26800, 25320, 24100, 23500, 24800],
        dmpo: [82.5, 78.2, 85.1, 75.8, 72.3, 79.5, 74.2, 71.6, 76.3, 78.9, 80.1, 77.5]
      },
      // æ”¶å‘è´§ç¼ºé™·åˆ†å¸ƒ
      defectDistribution: {
        categories: ['åˆ°è´§ç¼ºé™·', 'å‘è´§ç¼ºé™·'],
        series: [
          { name: 'æ¸…ç‚¹é—®é¢˜', data: [45, 28] },
          { name: 'ä¸Šæ¶é—®é¢˜', data: [32, 15] },
          { name: 'å‘è½¦é—®é¢˜', data: [0, 42] },
          { name: 'åŒ…è£…é—®é¢˜', data: [18, 12] },
          { name: 'å…¶ä»–', data: [8, 5] }
        ]
      },
      // æ”¶å‘è´§åŠæ—¶æ€§å¯¹æ¯”ï¼ˆ9æœˆä»½æ¯å¤©ï¼‰
      receivingShippingTimeliness: {
        dates: Array.from({ length: 30 }, (_, i) => `${i + 1}æ—¥`),
        receiving: [120, 135, 128, 142, 138, 145, 132, 150, 148, 140, 155, 142, 138, 145, 132, 148, 152, 145, 140, 135, 142, 148, 150, 145, 138, 142, 148, 152, 145, 140],
        shipping: [115, 130, 125, 140, 135, 142, 128, 145, 143, 135, 150, 138, 132, 140, 125, 142, 145, 138, 132, 128, 135, 142, 145, 140, 132, 138, 142, 148, 140, 135]
      },
      // ä¾›åº”å•†é—®é¢˜åˆ†å¸ƒ
      supplierIssueDistribution: [
        { name: 'ç³»ç»Ÿé—®é¢˜', value: 70 },
        { name: 'å•æ®é—®é¢˜', value: 27 },
        { name: 'å®ç‰©é—®é¢˜', value: 3 }
      ]
    };

    createApp({
      data() {
        return {
          currentMenu: 'eco', // é»˜è®¤é€‰ä¸­ ECO å˜æ›´ç®¡ç†
          // è§’è‰²æƒé™é…ç½®
          roles: {
            admin: {
              name: 'è¶…çº§ç®¡ç†å‘˜',
              menus: ['bi', 'production', 'supplier', 'discrepancy', 'vehicle', 'picking', 'eco', 'workorder', 'defect', 'billing'],
              canViewAmount: true
            },
            boss: {
              name: 'è€æ¿/ç®¡ç†å±‚',
              menus: ['bi', 'production', 'supplier', 'discrepancy', 'vehicle', 'picking', 'eco', 'workorder', 'defect', 'billing'],
              canViewAmount: true
            },
            planner: {
              name: 'è®¡åˆ’å‘˜',
              menus: ['production', 'eco', 'picking', 'workorder', 'defect'],
              canViewAmount: false
            },
            logistics: {
              name: 'ç‰©æµ/åº“æˆ¿',
              menus: ['supplier', 'discrepancy', 'vehicle', 'defect'],
              canViewAmount: false
            }
          },
          // å…¨å±€ç”¨æˆ·çŠ¶æ€
          currentUser: {
            name: 'ç®¡ç†å‘˜',
            role: 'admin'
          },
          showRoleDropdown: false,
          menuItems: [
            // ğŸ“Š å†³ç­–å±‚
            { id: 'bi', key: 'bi', name: 'ğŸ“Š ç»è¥æŠ¥è¡¨', icon: 'chart-bar' },
            { id: 'production', key: 'production', name: 'ğŸ“… ç”Ÿäº§è®¡åˆ’', icon: 'calendar' },
            // -- ç‰©æµç®¡ç† --
            { id: 'supplier', key: 'supplier', name: 'ğŸšš ä¾›åº”å•†æ”¶è´§ç›‘æ§', icon: 'truck' },
            { id: 'discrepancy', key: 'discrepancy', name: 'âš ï¸ åˆ°è´§å¼‚å¸¸ç®¡ç†', icon: 'exclamation-circle' },
            { id: 'vehicle', key: 'vehicle', name: 'ğŸš› è½¦æ¬¡ç®¡ç†', icon: 'shipping-fast' },
            // -- ç”Ÿäº§æ‰§è¡Œ --
            { id: 'picking', key: 'picking', name: 'ğŸ­ å·¥å•é…æ–™', icon: 'boxes' },
            { id: 'eco', key: 'eco', name: 'ğŸ”„ ECO å˜æ›´ç®¡ç†', icon: 'sync' },
            { id: 'workorder', key: 'workorder', name: 'ğŸ“‹ å·¥å•ç®¡ç†', icon: 'list-alt' },
            // -- è´¨é‡ä¸ç»“ç®— --
            { id: 'defect', key: 'defect', name: 'ğŸ› ï¸ ç¼ºé™·ç®¡ç†', icon: 'tools' },
            { id: 'billing', key: 'billing', name: 'ğŸ’° å®¢æˆ·è´¹ç”¨ç»“ç®—', icon: 'file-invoice-dollar' }
          ],
          // ä¼˜å…ˆä» localStorage è¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ mockData
          productionPlan: (() => {
            try {
              const saved = localStorage.getItem('productionPlanData');
              if (saved) {
                return JSON.parse(saved);
              }
            } catch (e) {
              console.error('è¯»å– localStorage å¤±è´¥:', e);
            }
            return mockData.productionPlan || [];
          })(),
          planUpdateTime: localStorage.getItem('planUpdateTime') || null,
          // ç”Ÿäº§è®¡åˆ’æŸ¥è¯¢ç­›é€‰
          productionPlanSearchKeyword: '',
          productionPlanSearchDate: '',
          // å·¥å•ç®¡ç†ï¼šæ•°æ®æ¥æºä¸ç”Ÿäº§è®¡åˆ’ä¸€è‡´
          workOrderList: [],
          workOrderSearchKeyword: '',
          // è½¦æ¬¡ç®¡ç†ï¼šä¼˜å…ˆä» localStorage è¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ mockData
          vehicleLog: (() => {
            try {
              const saved = localStorage.getItem('vehicleLogData');
              if (saved) {
                return JSON.parse(saved);
              }
            } catch (e) {
              console.error('è¯»å– vehicleLog localStorage å¤±è´¥:', e);
            }
            return mockData.vehicleLog || [];
          })(),
          ecoList: mockData.ecoList || [],
          billingRecord: mockData.billingRecord || [],
          discrepancyList: mockData.discrepancyList || [],
          receivingTasks: mockData.receivingTasks || [],
          defectList: mockData.defectList || [],
          userRole: 'staff', // ä¿ç•™å…¼å®¹æ€§ï¼Œä½†ç»Ÿä¸€ä½¿ç”¨ currentUser.role
          isBossMode: false, // ä¿ç•™å…¼å®¹æ€§
          searchKeywordDiscrepancy: '',
          // ç¼ºé™·ç®¡ç†ç­›é€‰
          defectFilterMonth: '',
          defectFilterType: '',
          showDiscrepancyModal: false,
          newDiscrepancy: {
            supplier: '',
            date: '',
            po: '',
            material: '',
            qty: '',
            is_bonded: false,
            category: 'ç³»ç»Ÿé—®é¢˜',
            description: '',
            photos: [],
            status: 'å¾…å¤„ç†',
            result: ''
          },
          // BI Dashboard æ•°æ®
          biData: biMockData,
          chartInstances: {
            chart1: null,
            chart2: null,
            chart3: null,
            chart4: null
          },
          searchKeyword: '',
          searchKeywordVehicle: '',
          searchKeywordBilling: '',
          receivingSearchKeyword: '',
          activeReceivingTab: 'ongoing',
          receivingPage: 1,
          receivingPageSize: 10,
          showCreateModal: false,
          showNewReceivingModal: false,
          showReceivingModal: false,
          showReceivingDetailModal: false,
          showVehicleLogModal: false,
          currentReceivingDetailTask: null,
          currentReceivingTaskIndex: null,
          currentReceivingTask: null,
          updateQuantityInput: '',
          newReceivingTask: {
            ä¾›åº”å•†åç§°: '',
            supplier_en: '',
            supplier_cn: '',
            åˆ°è´§æ—¥æœŸ: '',
            æ€»è¡Œæ•°: 0,
            physical_qty: '',
            unit: 'æ‰˜',
            data_source: 'pending',
            å¤‡æ³¨: ''
          },
          supplierSearchInput: '',
          selectedSupplier: null,
          showSupplierDropdown: false,
          filteredSupplierOptions: [],
          showBillingModal: false,
          newBilling: {
            å®¢æˆ·åç§°: '',
            è´¹ç”¨ç±»å‹: '',
            é¢ç§¯: '',
            è´¹ç”¨è¯¦æƒ…: '',
            å‘ç”Ÿæ—¥æœŸ: '',
            é‡‘é¢: '',
            ç»“ç®—çŠ¶æ€: 'å¾…ç»“ç®—'
          },
          newEco: {
            eco_no: '',
            description: '',
            op: '',
            start_set: '',
            change_details: '',
            materials: [],
            status: 'è¿›è¡Œä¸­'
          },
          newVehicleLog: {
            æ—¥æœŸ: '',
            æ—¶é—´: '',
            è½¦å‹: '',
            å¸æœºå§“å: '',
            å®¢æˆ·åç§°: '',
            å®¢æˆ·ç­¾æ”¶äºº: '',
            å†…å®¹: '',
            å¤‡æ³¨: ''
          },
          showDefectModal: false,
          newDefect: {
            å‘ç°æ—¥æœŸ: '',
            ç±»å‹: '',
            ç§ç±»: '',
            æ˜¯å¦æŒ‰ç¯: false,
            äº§å“: '',
            é—®é¢˜æè¿°: '',
            å‘ç°äºº: '',
            è´£ä»»äºº: '',
            åŸå› : '',
            è§£å†³æ–¹æ¡ˆ: '',
            '5WHYæ–‡ä»¶': '',
            å¤‡æ³¨: ''
          },
          defectFile: null,
          excelFileInput: null,
          // å·¥å•é…æ–™ç®¡ç†æ•°æ®
          planData: [],
          bomData: [],
          matchedWorkOrders: [],
          selectedWorkOrderIndex: -1,
          // å·¥å•é…æ–™ï¼šæ—¥æœŸç­›é€‰
          pickingSearchDate: '',
          // å·¥å•é…æ–™ï¼šæ‰“å°æ—¶é—´
          printTime: ''
        };
      },
      computed: {
        currentMenuName() {
          const menu = this.menuItems.find(m => m.key === this.currentMenu);
          return menu ? menu.name : '';
        },
        // æ ¹æ®å½“å‰è§’è‰²è¿‡æ»¤å¯è§èœå•
        visibleMenuItems() {
          const roleConfig = this.roles[this.currentUser.role];
          if (!roleConfig) return [];
          return this.menuItems.filter(item => roleConfig.menus.includes(item.id));
        },
        // è®¡ç®—å±æ€§ï¼šæ ¹æ®æœç´¢å…³é”®å­—è¿‡æ»¤æœ¬åœ° ecoListï¼ˆæ”¯æŒæ–°æ—§æ•°æ®ç»“æ„ï¼‰
        filteredEcoList() {
          const kw = (this.searchKeyword || '').trim().toLowerCase();
          if (!kw) return this.ecoList;
          return this.ecoList.filter(item => {
            const ecoNo = String(item.eco_no || item.ECOå· || '').toLowerCase();
            const desc = String(item.description || item.äº§å“æè¿° || '').toLowerCase();
            // æ”¯æŒæœç´¢ç‰©æ–™å·ï¼ˆæ–°ç»“æ„ä¸­çš„ materials æ•°ç»„ï¼‰
            const materials = item.materials || [];
            const materialMatch = materials.some(mat => String(mat || '').toLowerCase().includes(kw));
            // å…¼å®¹æ—§ç»“æ„çš„å•ç‰©æ–™å·
            const oldMaterial = String(item.ç‰©æ–™å· || '').toLowerCase();
            return ecoNo.includes(kw) || desc.includes(kw) || materialMatch || oldMaterial.includes(kw);
          });
        },
        // è¿‡æ»¤è½¦æ¬¡ç®¡ç†æ•°æ®
        filteredVehicleLog() {
          const kw = (this.searchKeywordVehicle || '').trim().toLowerCase();
          if (!kw) return this.vehicleLog;
          return this.vehicleLog.filter(item => {
            const customer = String(item.å®¢æˆ·åç§° || '').toLowerCase();
            const driver = String(item.å¸æœºå§“å || '').toLowerCase();
            const vehicle = String(item.è½¦å‹ || '').toLowerCase();
            return customer.includes(kw) || driver.includes(kw) || vehicle.includes(kw);
          });
        },
        // è¿‡æ»¤å®¢æˆ·è´¹ç”¨ç»“ç®—æ•°æ®
        filteredBillingRecord() {
          const kw = (this.searchKeywordBilling || '').trim().toLowerCase();
          if (!kw) return this.billingRecord;
          return this.billingRecord.filter(item => {
            const customer = String(item.å®¢æˆ·åç§° || '').toLowerCase();
            const type = String(item.è´¹ç”¨ç±»å‹ || '').toLowerCase();
            return customer.includes(kw) || type.includes(kw);
          });
        },
        // è¿‡æ»¤åˆ°è´§å¼‚å¸¸æ•°æ®
        filteredDiscrepancyList() {
          const kw = (this.searchKeywordDiscrepancy || '').trim().toLowerCase();
          if (!kw) return this.discrepancyList || [];
          return (this.discrepancyList || []).filter(item => {
            const supplier = String(item.supplier || '').toLowerCase();
            const po = String(item.po || '').toLowerCase();
            const material = String(item.material || '').toLowerCase();
            const category = String(item.category || '').toLowerCase();
            const status = String(item.status || '').toLowerCase();
            const desc = String(item.description || '').toLowerCase();
            return (
              supplier.includes(kw) ||
              po.includes(kw) ||
              material.includes(kw) ||
              category.includes(kw) ||
              status.includes(kw) ||
              desc.includes(kw)
            );
          });
        },
        // ç¼ºé™·ç®¡ç†ï¼šæŒ‰æœˆä»½ã€ç±»å‹ç­›é€‰
        filteredDefectList() {
          let list = this.defectList || [];

          // æŒ‰æœˆä»½ç­›é€‰ï¼ˆå‘ç°æ—¥æœŸå‰7ä½å¦‚ 2024-01ï¼‰
          if (this.defectFilterMonth) {
            const month = this.defectFilterMonth; // æ ¼å¼ï¼šYYYY-MM
            list = list.filter(item => {
              const dateStr = String(item.å‘ç°æ—¥æœŸ || '').trim().replace(/\//g, '-');
              return dateStr.startsWith(month);
            });
          }

          // æŒ‰ç±»å‹ç­›é€‰ï¼ˆBç±»/Cç±»ç­‰ï¼‰
          if (this.defectFilterType) {
            const type = this.defectFilterType;
            list = list.filter(item => String(item.ç±»å‹ || '').trim() === type);
          }

          return list;
        },
        uniqueBillingCustomers() {
          const set = new Set();
          (this.billingRecord || []).forEach(item => {
            if (item.å®¢æˆ·åç§°) set.add(item.å®¢æˆ·åç§°);
          });
          return Array.from(set);
        },
        // ä¾›åº”å•†æ”¶è´§ç›‘æ§ï¼šæ ¹æ®æ ‡ç­¾å’Œæœç´¢è¿‡æ»¤
        filteredReceivingTasks() {
          const kw = (this.receivingSearchKeyword || '').trim().toLowerCase();
          return (this.receivingTasks || []).filter(task => {
            // çŠ¶æ€æ ‡ç­¾è¿‡æ»¤
            const progress = this.getReceivingProgressPercent(task);
            if (this.activeReceivingTab === 'ongoing') {
              const isBacklog = String(task.å½“å‰çŠ¶æ€ || '').includes('æœ‰ç§¯å‹') || String(task.å½“å‰çŠ¶æ€ || '').includes('âš ï¸');
              const isNormalOngoing = String(task.å½“å‰çŠ¶æ€ || '').includes('æ­£å¸¸') && progress < 100;
              if (!isBacklog && !isNormalOngoing) return false;
            }
            // æœç´¢è¿‡æ»¤
            if (!kw) return true;
            const name = String(task.ä¾›åº”å•†åç§° || '').toLowerCase();
            return name.includes(kw);
          });
        },
        // ä¾›åº”å•†æ”¶è´§ç›‘æ§ï¼šåˆ†é¡µåçš„åˆ—è¡¨
        pagedReceivingTasks() {
          const list = this.filteredReceivingTasks;
          const size = this.receivingPageSize || 10;
          const page = Math.max(1, this.receivingPage || 1);
          const start = (page - 1) * size;
          return list.slice(start, start + size);
        },
        receivingTotalPages() {
          const size = this.receivingPageSize || 10;
          if (!size) return 1;
          const total = this.filteredReceivingTasks.length;
          return total === 0 ? 1 : Math.ceil(total / size);
        },
        // ä» mockData ä¸­æå–æ‰€æœ‰å”¯ä¸€çš„ä¾›åº”å•†åç§°
        uniqueSuppliers() {
          const suppliers = new Set();
          // ä» receivingTasks ä¸­æå–ä¾›åº”å•†åç§°
          (this.receivingTasks || []).forEach(task => {
            if (task.ä¾›åº”å•†åç§°) {
              suppliers.add(task.ä¾›åº”å•†åç§°);
            }
          });
          // è¿”å›æ’åºåçš„æ•°ç»„ï¼Œä¾¿äºç”¨æˆ·æŸ¥æ‰¾
          return Array.from(suppliers).sort();
        },
        // å·¥å•é…æ–™ï¼šè·å–ç»è¿‡ç­›é€‰ä¸æ’åºåçš„å·¥å•åˆ—è¡¨
        pickingFilteredAndSortedWorkOrders() {
          let list = this.matchedWorkOrders ? [...this.matchedWorkOrders] : [];

          // 1ï¼‰æŒ‰ä½¿ç”¨æ—¥æœŸç­›é€‰ï¼ˆä¸ç”Ÿäº§è®¡åˆ’çš„æ—¥æœŸç­›é€‰è§„åˆ™ä¿æŒä¸€è‡´ï¼‰
          if (this.pickingSearchDate) {
            const searchDate = this.pickingSearchDate; // YYYY-MM-DD
            list = list.filter(item => {
              const itemDate = String(item['ä½¿ç”¨æ—¥æœŸ'] || item.ä½¿ç”¨æ—¥æœŸ || '').trim();
              if (!itemDate) return false;
              const normalizedItemDate = itemDate.replace(/\//g, '-').substring(0, 10);
              return normalizedItemDate === searchDate || normalizedItemDate.includes(searchDate);
            });
          }

          // 2ï¼‰å…¨å±€æ’åºï¼šå…ˆæŒ‰äº§å“æè¿°ï¼Œå†æŒ‰ OP è‡ªç„¶æ’åºï¼ˆæ•°å­—ä»å°åˆ°å¤§ï¼‰
          list.sort((a, b) => {
            const descA = String(a['äº§å“æè¿°'] || a.äº§å“æè¿° || '').trim();
            const descB = String(b['äº§å“æè¿°'] || b.äº§å“æè¿° || '').trim();
            const cmpDesc = descA.localeCompare(descB, 'zh-CN');
            if (cmpDesc !== 0) return cmpDesc;

            const opA = String(a['OP'] || a.OP || '').trim();
            const opB = String(b['OP'] || b.OP || '').trim();

            // å»æ‰ OP å‰ç¼€åšæ•°å­—æ¯”è¾ƒï¼Œé¿å… "OP100" < "OP20" çš„é—®é¢˜
            const numA = parseInt(opA.replace(/^OP/i, ''), 10);
            const numB = parseInt(opB.replace(/^OP/i, ''), 10);

            const finalNumA = isNaN(numA) ? Number.MAX_SAFE_INTEGER : numA;
            const finalNumB = isNaN(numB) ? Number.MAX_SAFE_INTEGER : numB;

            if (finalNumA !== finalNumB) return finalNumA - finalNumB;

            // å†æŒ‰å·¥å•å·ç¨³å®šæ’åºï¼Œé¿å…å®Œå…¨ç›¸åŒæ—¶é¡ºåºä¸ç¨³å®š
            const jobA = String(a['å·¥å•å·'] || a.å·¥å•å· || '').trim();
            const jobB = String(b['å·¥å•å·'] || b.å·¥å•å· || '').trim();
            return jobA.localeCompare(jobB, 'zh-CN');
          });

          return list;
        },
        // å·¥å•é…æ–™ï¼šè·å–é€‰ä¸­çš„å·¥å•
        selectedWorkOrder() {
          const list = this.pickingFilteredAndSortedWorkOrders || [];
          if (this.selectedWorkOrderIndex >= 0 && this.selectedWorkOrderIndex < list.length) {
            const workOrder = list[this.selectedWorkOrderIndex];
            // ç¡®ä¿ materials å±æ€§å­˜åœ¨
            if (workOrder && !workOrder.materials) {
              workOrder.materials = [];
            }
            return workOrder;
          }
          return null;
        },
        // å·¥å•é…æ–™ï¼šå½“å‰é€‰ä¸­å·¥å•çš„ç‰©æ–™æŒ‰åº“ä½æ’åºï¼ˆå‡åºï¼‰
        sortedMaterials() {
          const workOrder = this.selectedWorkOrder;
          if (!workOrder || !Array.isArray(workOrder.materials)) {
            return [];
          }
          const list = [...workOrder.materials];
          list.sort((a, b) => {
            const locA = String(a['PENDING_LOCATOR'] || a.PENDING_LOCATOR || '').trim();
            const locB = String(b['PENDING_LOCATOR'] || b.PENDING_LOCATOR || '').trim();
            return locA.localeCompare(locB, 'zh-CN');
          });
          return list;
        },
        // ç”Ÿäº§è®¡åˆ’ï¼šæ ¹æ®å…³é”®è¯å’Œæ—¥æœŸç­›é€‰
        filteredProductionPlan() {
          let result = this.productionPlan || [];
          
          // æ—¥æœŸç­›é€‰ï¼ˆæ”¯æŒ YYYY-MM-DD æ ¼å¼åŒ¹é…ï¼‰
          if (this.productionPlanSearchDate) {
            const searchDate = this.productionPlanSearchDate; // æ ¼å¼ï¼šYYYY-MM-DD
            result = result.filter(item => {
              const itemDate = String(item.ä½¿ç”¨æ—¥æœŸ || '').trim();
              // æ ‡å‡†åŒ–æ—¥æœŸæ ¼å¼è¿›è¡Œæ¯”è¾ƒï¼ˆæ”¯æŒå¤šç§æ—¥æœŸæ ¼å¼ï¼‰
              const normalizedItemDate = itemDate.replace(/\//g, '-').substring(0, 10);
              return normalizedItemDate === searchDate || normalizedItemDate.includes(searchDate);
            });
          }
          
          // å…³é”®è¯æœç´¢ï¼ˆå·¥å•å·/äº§å“/äº§çº¿ï¼‰
          const keyword = (this.productionPlanSearchKeyword || '').trim().toLowerCase();
          if (keyword) {
            result = result.filter(item => {
              const workOrder = String(item.å·¥å•å· || '').toLowerCase();
              const product = String(item.äº§å“æè¿° || '').toLowerCase();
              const line = String(item.äº§çº¿åç§° || '').toLowerCase();
              return workOrder.includes(keyword) || product.includes(keyword) || line.includes(keyword);
            });
          }
          
          return result;
        },
        // å·¥å•ç®¡ç†ï¼šæ ¹æ®å…³é”®è¯è¿‡æ»¤ï¼ˆå·¥å•å·/äº§å“æè¿°ï¼‰
        filteredWorkOrderList() {
          const keyword = (this.workOrderSearchKeyword || '').trim().toLowerCase();
          if (!keyword) return this.workOrderList || [];
          return (this.workOrderList || []).filter(item => {
            const workOrder = String(item.å·¥å•å· || '').toLowerCase();
            const product = String(item.äº§å“æè¿° || '').toLowerCase();
            return workOrder.includes(keyword) || product.includes(keyword);
          });
        }
      },
      mounted() {
        console.log('Dashboard ä»¥ Mock æ¨¡å¼è¿è¡Œï¼ˆæœ¬åœ°å‡æ•°æ®ï¼‰');
        // åˆå§‹åŒ–æ—¶åŠ è½½ç”Ÿäº§è®¡åˆ’æ•°æ®ï¼ˆä» localStorage æˆ–ä½¿ç”¨ mockDataï¼‰
        this.loadProductionPlanFromStorage();
        // åˆå§‹åŒ–æ—¶åŠ è½½è½¦æ¬¡ç®¡ç†æ•°æ®ï¼ˆä» localStorage æˆ–ä½¿ç”¨ mockDataï¼‰
        this.loadVehicleLogFromStorage();
        // åˆå§‹åŒ–æ—¶åŠ è½½å·¥å•ç®¡ç†æ•°æ®ï¼ˆä» localStorage æˆ–ä½¿ç”¨ mockDataï¼‰
        this.loadWorkOrderFromStorage();
        console.log('Mock æ•°æ®å·²åŠ è½½:', {
          productionPlan: this.productionPlan.length,
          vehicleLog: this.vehicleLog.length,
          ecoList: this.ecoList.length,
          billingRecord: this.billingRecord.length,
          receivingTasks: this.receivingTasks.length,
          defectList: this.defectList.length
        });
        // åˆå§‹åŒ–BIå›¾è¡¨
        this.$nextTick(() => {
          if (this.currentMenu === 'bi') {
            this.initBICharts();
          }
          // å·¥å•é…æ–™ï¼šåŠ è½½æ¨¡æ‹Ÿæ•°æ®
          if (this.currentMenu === 'picking') {
            this.loadMockData();
          }
        });
      },
      watch: {
        currentMenu(newVal) {
          if (newVal === 'bi') {
            this.$nextTick(() => {
              this.initBICharts();
            });
          } else if (newVal === 'picking') {
            this.$nextTick(() => {
              // å¦‚æœè¿˜æ²¡æœ‰æ•°æ®ï¼ŒåŠ è½½æ¨¡æ‹Ÿæ•°æ®
              if (this.planData.length === 0 && this.bomData.length === 0) {
                this.loadMockData();
              }
            });
          } else if (newVal === 'production') {
            // åˆ‡æ¢åˆ°ç”Ÿäº§è®¡åˆ’æ—¶ï¼Œä» localStorage è¯»å–æœ€æ–°æ•°æ®
            this.loadProductionPlanFromStorage();
          } else if (newVal === 'vehicle') {
            // åˆ‡æ¢åˆ°è½¦æ¬¡ç®¡ç†æ—¶ï¼Œä» localStorage è¯»å–æœ€æ–°æ•°æ®
            this.loadVehicleLogFromStorage();
          } else if (newVal === 'workorder') {
            // åˆ‡æ¢åˆ°å·¥å•ç®¡ç†æ—¶ï¼Œä» localStorage è¯»å–æœ€æ–°æ•°æ®ï¼ˆä¸ç”Ÿäº§è®¡åˆ’æ•°æ®æºä¸€è‡´ï¼‰
            this.loadWorkOrderFromStorage();
          } else {
            // é”€æ¯å›¾è¡¨å®ä¾‹ä»¥é‡Šæ”¾èµ„æº
            Object.values(this.chartInstances).forEach(chart => {
              if (chart) {
                chart.dispose();
              }
            });
            this.chartInstances = {
              chart1: null,
              chart2: null,
              chart3: null,
              chart4: null
            };
          }
        }
      },
      methods: {
        // åˆ‡æ¢èœå•
        switchMenu(key) {
          this.currentMenu = key;
        },
        // ä» localStorage åŠ è½½ç”Ÿäº§è®¡åˆ’æ•°æ®
        loadProductionPlanFromStorage() {
          try {
            const saved = localStorage.getItem('productionPlanData');
            if (saved) {
              this.productionPlan = JSON.parse(saved);
              this.planUpdateTime = localStorage.getItem('planUpdateTime') || null;
            } else {
              // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨ mockData
              this.productionPlan = mockData.productionPlan || [];
              this.planUpdateTime = null;
            }
          } catch (e) {
            console.error('è¯»å– localStorage å¤±è´¥:', e);
            this.productionPlan = mockData.productionPlan || [];
            this.planUpdateTime = null;
          }
        },
        // ä» localStorage åŠ è½½è½¦æ¬¡ç®¡ç†æ•°æ®
        loadVehicleLogFromStorage() {
          try {
            const saved = localStorage.getItem('vehicleLogData');
            if (saved) {
              this.vehicleLog = JSON.parse(saved);
            } else {
              // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨ mockData
              this.vehicleLog = mockData.vehicleLog || [];
            }
          } catch (e) {
            console.error('è¯»å– vehicleLog localStorage å¤±è´¥:', e);
            this.vehicleLog = mockData.vehicleLog || [];
          }
        },
        // ä» localStorage åŠ è½½å·¥å•ç®¡ç†æ•°æ®ï¼ˆä¸ç”Ÿäº§è®¡åˆ’æ•°æ®æºä¸€è‡´ï¼‰
        loadWorkOrderFromStorage() {
          try {
            const saved = localStorage.getItem('productionPlanData');
            if (saved) {
              this.workOrderList = JSON.parse(saved);
            } else {
              // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨ mockData
              this.workOrderList = mockData.productionPlan || [];
            }
          } catch (e) {
            console.error('è¯»å–å·¥å•ç®¡ç† localStorage å¤±è´¥:', e);
            this.workOrderList = mockData.productionPlan || [];
          }
        },
        // åˆ·æ–°æ•°æ®ï¼ˆä» localStorage é‡æ–°åŠ è½½ï¼‰
        refreshData() {
          if (this.currentMenu === 'production') {
            this.loadProductionPlanFromStorage();
          } else if (this.currentMenu === 'vehicle') {
            this.loadVehicleLogFromStorage();
          } else if (this.currentMenu === 'workorder') {
            this.loadWorkOrderFromStorage();
          } else {
            // å…¶ä»–æ¨¡å—çš„åˆ·æ–°é€»è¾‘
            alert('å½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ï¼ˆMock æ•°æ®ï¼‰ï¼Œåˆ·æ–°ä¸ä¼šè®¿é—®çœŸå®æ•°æ®åº“ã€‚');
            return;
          }
          alert('æ•°æ®å·²åˆ·æ–°');
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šæ‰“å¼€ç™»è®°å¼¹çª—
        openBillingModal() {
          this.newBilling = {
            å®¢æˆ·åç§°: this.uniqueBillingCustomers[0] || '',
            è´¹ç”¨ç±»å‹: 'ä»“å‚¨è´¹',
            é¢ç§¯: '',
            è´¹ç”¨è¯¦æƒ…: '',
            å‘ç”Ÿæ—¥æœŸ: '',
            é‡‘é¢: '',
            ç»“ç®—çŠ¶æ€: 'å¾…ç»“ç®—'
          };
          this.showBillingModal = true;
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šå…³é—­å¼¹çª—
        closeBillingModal() {
          this.showBillingModal = false;
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šä¿å­˜ç™»è®°
        saveNewBilling() {
          const item = this.newBilling || {};
          if (!item.å®¢æˆ·åç§° || !item.è´¹ç”¨ç±»å‹ || !item.è´¹ç”¨è¯¦æƒ… || !item.å‘ç”Ÿæ—¥æœŸ || !item.é‡‘é¢) {
            alert('è¯·å¡«å†™å®¢æˆ·åç§°ã€è´¹ç”¨ç±»å‹ã€è´¹ç”¨è¯¦æƒ…ã€å‘ç”Ÿæ—¥æœŸå’Œé‡‘é¢');
            return;
          }
          if (item.è´¹ç”¨ç±»å‹ === 'ä»“å‚¨è´¹' && (!item.é¢ç§¯ && item.é¢ç§¯ !== 0)) {
            alert('ä»“å‚¨è´¹éœ€å¡«å†™é¢ç§¯');
            return;
          }
          const newItem = {
            å®¢æˆ·åç§°: item.å®¢æˆ·åç§°,
            è´¹ç”¨ç±»å‹: item.è´¹ç”¨ç±»å‹,
            è´¹ç”¨è¯¦æƒ…: item.è´¹ç”¨è¯¦æƒ…,
            å‘ç”Ÿæ—¥æœŸ: item.å‘ç”Ÿæ—¥æœŸ,
            é¢ç§¯: item.é¢ç§¯ ? Number(item.é¢ç§¯) : 0,
            é‡‘é¢: Number(item.é‡‘é¢),
            ç»“ç®—çŠ¶æ€: item.ç»“ç®—çŠ¶æ€ || 'å¾…ç»“ç®—',
            ä¸‹æ¬¡æé†’æ—¥æœŸ: item.ä¸‹æ¬¡æé†’æ—¥æœŸ || ''
          };
          this.billingRecord.unshift(newItem);
          this.showBillingModal = false;
          alert('è´¹ç”¨ç™»è®°æˆåŠŸï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼Œä»…å‰ç«¯ï¼‰');
        },
        // æ‰“å¼€æ–°å¢å¼¹çª—
        openCreateModal() {
          this.newEco = {
            eco_no: '',
            description: '',
            op: '',
            start_set: '',
            change_details: '',
            materials: [],
            status: 'è¿›è¡Œä¸­'
          };
          this.showCreateModal = true;
        },
        closeCreateModal() {
          this.showCreateModal = false;
        },
        // æ·»åŠ ç‰©æ–™
        addEcoMaterial() {
          this.newEco.materials.push('');
        },
        // åˆ é™¤ç‰©æ–™
        removeEcoMaterial(index) {
          this.newEco.materials.splice(index, 1);
        },
        // ä¿å­˜æ–°å¢ ECOï¼špush åˆ°æœ¬åœ°æ•°ç»„
        saveNewEco() {
          if (!this.newEco.eco_no || !this.newEco.description || !this.newEco.op || !this.newEco.start_set || !this.newEco.change_details) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼ˆECOå·ã€äº§å“æè¿°ã€å·¥åºã€èµ·å§‹å°å¥—ã€å˜æ›´è¯¦æƒ…ï¼‰');
            return;
          }
          if (!this.newEco.materials || this.newEco.materials.length === 0) {
            alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªç‰©æ–™');
            return;
          }
          
          // è¿‡æ»¤ç©ºç‰©æ–™å·
          const validMaterials = this.newEco.materials.filter(mat => mat && mat.trim());
          if (validMaterials.length === 0) {
            alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæœ‰æ•ˆçš„ç‰©æ–™å·');
            return;
          }
          
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const hour = String(now.getHours()).padStart(2, '0');
          const minute = String(now.getMinutes()).padStart(2, '0');
          const second = String(now.getSeconds()).padStart(2, '0');
          const timeStr = `${year}-${month}-${day} ${hour}:${minute}:${second}`;
          
          const newItem = {
            eco_no: this.newEco.eco_no.trim(),
            description: this.newEco.description.trim(),
            op: this.newEco.op.trim(),
            start_set: Number(this.newEco.start_set),
            change_details: this.newEco.change_details.trim(),
            materials: validMaterials.map(mat => mat.trim()),
            status: this.newEco.status || 'è¿›è¡Œä¸­',
            update_time: timeStr,
            é…æ–™å‘˜: 'ç³»ç»Ÿ'
          };
          this.ecoList.unshift(newItem);
          this.showCreateModal = false;
          alert('å·²åœ¨æœ¬åœ°åˆ—è¡¨ä¸­æ–°å¢ä¸€æ¡ ECOï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰');
        },
        // è½¦æ¬¡ç®¡ç†ï¼šæ‰“å¼€ç™»è®°è½¦æ¬¡æ¨¡æ€æ¡†
        openVehicleLogModal() {
          // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
          const today = new Date();
          const dateStr = today.toISOString().split('T')[0];
          const timeStr = today.toTimeString().slice(0, 5); // HH:mm
          
          this.newVehicleLog = {
            æ—¥æœŸ: dateStr,
            æ—¶é—´: timeStr,
            è½¦å‹: '',
            å¸æœºå§“å: '',
            å®¢æˆ·åç§°: '',
            å®¢æˆ·ç­¾æ”¶äºº: '',
            å†…å®¹: '',
            å¤‡æ³¨: ''
          };
          this.showVehicleLogModal = true;
        },
        // è½¦æ¬¡ç®¡ç†ï¼šå…³é—­ç™»è®°è½¦æ¬¡æ¨¡æ€æ¡†
        closeVehicleLogModal() {
          this.showVehicleLogModal = false;
        },
        // è½¦æ¬¡ç®¡ç†ï¼šä¿å­˜æ–°ç™»è®°çš„è½¦æ¬¡
        saveNewVehicleLog() {
          // éªŒè¯å¿…å¡«é¡¹
          if (!this.newVehicleLog.æ—¥æœŸ || !this.newVehicleLog.æ—¶é—´ || !this.newVehicleLog.è½¦å‹ || 
              !this.newVehicleLog.å¸æœºå§“å || !this.newVehicleLog.å®¢æˆ·åç§° || !this.newVehicleLog.å†…å®¹) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼ˆæ—¥æœŸã€æ—¶é—´ã€è½¦å‹ã€å¸æœºå§“åã€å®¢æˆ·åç§°ã€å†…å®¹ï¼‰');
            return;
          }
          
          // åˆ›å»ºæ–°è®°å½•
          const newItem = {
            æ—¥æœŸ: this.newVehicleLog.æ—¥æœŸ,
            æ—¶é—´: this.newVehicleLog.æ—¶é—´,
            è½¦å‹: this.newVehicleLog.è½¦å‹,
            å¸æœºå§“å: this.newVehicleLog.å¸æœºå§“å,
            å®¢æˆ·åç§°: this.newVehicleLog.å®¢æˆ·åç§°,
            å®¢æˆ·ç­¾æ”¶äºº: this.newVehicleLog.å®¢æˆ·ç­¾æ”¶äºº || '',
            å†…å®¹: this.newVehicleLog.å†…å®¹,
            å¤‡æ³¨: this.newVehicleLog.å¤‡æ³¨ || ''
          };
          
          // æ·»åŠ åˆ°æ•°ç»„æœ€å‰é¢
          this.vehicleLog.unshift(newItem);
          
          // ä¿å­˜åˆ° localStorage
          try {
            localStorage.setItem('vehicleLogData', JSON.stringify(this.vehicleLog));
          } catch (e) {
            console.error('ä¿å­˜åˆ° localStorage å¤±è´¥:', e);
          }
          
          // å…³é—­æ¨¡æ€æ¡†å¹¶æç¤º
          this.showVehicleLogModal = false;
          alert('ç™»è®°æˆåŠŸ');
        },
        // è½¦æ¬¡ç®¡ç†ï¼šå¯¼å‡º Excelï¼ˆæ‰€è§å³æ‰€å¾—ï¼šå¯¼å‡ºå½“å‰è¡¨æ ¼æ˜¾ç¤ºçš„æ•°æ®ï¼‰
        exportVehicleLogToExcel() {
          // ä½¿ç”¨ filteredVehicleLogï¼ˆè®¡ç®—å±æ€§ï¼‰ï¼Œå®ç°"æ‰€è§å³æ‰€å¾—"å¯¼å‡º
          // å¦‚æœç”¨æˆ·è¿›è¡Œäº†ç­›é€‰ï¼Œå¯¼å‡ºç­›é€‰åçš„æ•°æ®ï¼›å¦‚æœæœªç­›é€‰ï¼Œå¯¼å‡ºå…¨éƒ¨æ•°æ®
          const dataToExport = this.filteredVehicleLog;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            // å‡†å¤‡å¯¼å‡ºæ•°æ®ï¼Œç¡®ä¿è¡¨å¤´æ˜¯ä¸­æ–‡
            const exportData = dataToExport.map(item => ({
              'æ—¥æœŸ': item.æ—¥æœŸ || '',
              'æ—¶é—´': item.æ—¶é—´ || '',
              'è½¦å‹': item.è½¦å‹ || '',
              'å¸æœºå§“å': item.å¸æœºå§“å || '',
              'å®¢æˆ·åç§°': item.å®¢æˆ·åç§° || '',
              'å®¢æˆ·ç­¾æ”¶äºº': item.å®¢æˆ·ç­¾æ”¶äºº || '',
              'å†…å®¹': item.å†…å®¹ || '',
              'å¤‡æ³¨': item.å¤‡æ³¨ || ''
            }));
            
            // åˆ›å»ºå·¥ä½œè¡¨
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'è½¦æ¬¡ç®¡ç†è¡¨');
            
            // ç”Ÿæˆæ–‡ä»¶åï¼ˆå¸¦å½“å‰æ—¥æœŸï¼‰
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `è½¦æ¬¡ç®¡ç†è¡¨_${dateStr}.xlsx`;
            
            // å¯¼å‡ºæ–‡ä»¶
            XLSX.writeFile(wb, fileName);
            
            // æç¤ºä¿¡æ¯ï¼šå¦‚æœè¿›è¡Œäº†ç­›é€‰ï¼Œæ˜¾ç¤ºç­›é€‰åçš„è®°å½•æ•°
            const totalCount = this.vehicleLog.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ç”Ÿäº§è®¡åˆ’ï¼šå¯¼å‡º Excel
        exportProductionPlanToExcel() {
          const dataToExport = this.filteredProductionPlan;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'ä½¿ç”¨æ—¥æœŸ': item.ä½¿ç”¨æ—¥æœŸ || '',
              'å‘è½¦æ—¶é—´': item.å‘è½¦æ—¶é—´ || '',
              'è½¦æ¬¡': item.è½¦æ¬¡ || '',
              'å·¥åºå·': item.å·¥åºå· || '',
              'äº§çº¿åç§°': item.äº§çº¿åç§° || '',
              'åˆ°åœºæ—¶é—´': item.åˆ°åœºæ—¶é—´ || '',
              'äº§å“æè¿°': item.äº§å“æè¿° || '',
              'å·¥å•å·': item.å·¥å•å· || '',
              'åŠ å·¥åºåˆ—å·': item.åŠ å·¥åºåˆ—å· || '',
              'å·¥åºæè¿°': item.å·¥åºæè¿° || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ç”Ÿäº§è®¡åˆ’è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `ç”Ÿäº§è®¡åˆ’_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.productionPlan.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // å·¥å•ç®¡ç†ï¼šå¯¼å‡º Excel
        exportWorkOrderToExcel() {
          const dataToExport = this.filteredWorkOrderList;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'å·¥å•å·': item.å·¥å•å· || '',
              'äº§å“æè¿°': item.äº§å“æè¿° || '',
              'å°å¥—': item.å°å¥— || '',
              'å·¥åº': item.å·¥åºå· || '',
              'åŠ å·¥åºåˆ—å·': item.åŠ å·¥åºåˆ—å· || '',
              'äº§çº¿åç§°': item.äº§çº¿åç§° || '',
              'ä½¿ç”¨æ—¥æœŸ': item.ä½¿ç”¨æ—¥æœŸ || '',
              'çŠ¶æ€': 'å¾…äº§'
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'å·¥å•ç®¡ç†è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `å·¥å•ç®¡ç†_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.workOrderList.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ECO å˜æ›´ç®¡ç†ï¼šå¯¼å‡º Excelï¼ˆç‰¹æ®Šå¤„ç† materials æ•°ç»„ï¼‰
        exportEcoListToExcel() {
          const dataToExport = this.filteredEcoList;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => {
              // å¤„ç† materials æ•°ç»„ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²
              const materials = item.materials || [];
              let materialsStr = '';
              if (materials.length > 0) {
                materialsStr = materials.join(', ');
              } else {
                // å…¼å®¹æ—§ç»“æ„çš„å•ç‰©æ–™å·
                materialsStr = item.ç‰©æ–™å· || '';
              }
              
              return {
                'ECOå·': item.eco_no || item.ECOå· || '',
                'äº§å“æè¿°': item.description || item.äº§å“æè¿° || '',
                'å·¥åº': item.op || item.é€‚ç”¨å·¥åº || '',
                'èµ·å§‹å°å¥—': item.start_set || item.å°å¥— || '',
                'å˜æ›´è¯¦æƒ…': item.change_details || '',
                'æ¶‰åŠç‰©æ–™': materialsStr,
                'å˜æ›´çŠ¶æ€': item.status || item.å˜æ›´çŠ¶æ€ || '',
                'æ›´æ–°æ—¶é—´': item.update_time || item.å˜æ›´æ—¶é—´ || '',
                'é…æ–™å‘˜': item.é…æ–™å‘˜ || ''
              };
            });
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ECOå˜æ›´è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `ECOå˜æ›´ç®¡ç†_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.ecoList.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šå¯¼å‡º Excel
        exportBillingToExcel() {
          const dataToExport = this.filteredBillingRecord;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'å®¢æˆ·åç§°': item.å®¢æˆ·åç§° || '',
              'è´¹ç”¨ç±»å‹': item.è´¹ç”¨ç±»å‹ || '',
              'é¢ç§¯(ã¡)': item.é¢ç§¯ !== undefined ? item.é¢ç§¯ : '',
              'è´¹ç”¨è¯¦æƒ…': item.è´¹ç”¨è¯¦æƒ… || '',
              'å‘ç”Ÿæ—¥æœŸ': item.å‘ç”Ÿæ—¥æœŸ || '',
              'é‡‘é¢': item.é‡‘é¢ || '',
              'ç»“ç®—çŠ¶æ€': item.ç»“ç®—çŠ¶æ€ || '',
              'ä¸‹æ¬¡æé†’æ—¥æœŸ': item.ä¸‹æ¬¡æé†’æ—¥æœŸ || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'å®¢æˆ·è´¹ç”¨ç»“ç®—è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `å®¢æˆ·è´¹ç”¨ç»“ç®—_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.billingRecord.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ç¼ºé™·ç®¡ç†ï¼šå¯¼å‡º Excel
        exportDefectsToExcel() {
          const dataToExport = this.defectList || [];
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'å‘ç°æ—¥æœŸ': item.å‘ç°æ—¥æœŸ || '',
              'ç±»å‹': item.ç±»å‹ || '',
              'ç§ç±»': item.ç§ç±» || '',
              'æŒ‰ç¯çŠ¶æ€': item.æ˜¯å¦æŒ‰ç¯ ? 'æ˜¯' : 'å¦',
              'äº§å“': item.äº§å“ || '',
              'é—®é¢˜æè¿°': item.é—®é¢˜æè¿° || '',
              'å‘ç°äºº': item.å‘ç°äºº || '',
              'è´£ä»»äºº': item.è´£ä»»äºº || '',
              'åŸå› ': item.åŸå›  || '',
              'è§£å†³æ–¹æ¡ˆ': item.è§£å†³æ–¹æ¡ˆ || '',
              '5WHYæŠ¥å‘Š': item['5WHYæ–‡ä»¶'] || '',
              'å¤‡æ³¨': item.å¤‡æ³¨ || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ç¼ºé™·ç®¡ç†è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `ç¼ºé™·ç®¡ç†_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${dataToExport.length} æ¡è®°å½•`);
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ä¾›åº”å•†æ”¶è´§ç›‘æ§ï¼šå¯¼å‡º Excel
        exportSupplierReceivingToExcel() {
          const dataToExport = this.filteredReceivingTasks;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => {
              const progress = this.getReceivingProgressPercent(item);
              const status = item.å½“å‰çŠ¶æ€ || (progress === 100 ? 'å·²å®Œæˆ' : progress < 100 ? 'æ­£å¸¸' : 'è¶…æ—¶');
              
              return {
                'ä¾›åº”å•†åç§°': item.ä¾›åº”å•†åç§° || '',
                'åˆ°è´§æ—¶é—´': item.åˆ°è´§æ—¥æœŸ || '',
                'æ€»è¡Œæ•°': item.æ€»è¡Œæ•° || 0,
                'å·²å®Œæˆæ•°é‡': item.å·²å®Œæˆæ•°é‡ || 0,
                'è¿›åº¦ç™¾åˆ†æ¯”': `${progress}%`,
                'çŠ¶æ€': status
              };
            });
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ä¾›åº”å•†æ”¶è´§ç›‘æ§è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `ä¾›åº”å•†æ”¶è´§ç›‘æ§_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.receivingTasks.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // è·å– ECO ç‰©æ–™æ‘˜è¦ï¼ˆç”¨äºåˆ—è¡¨æ˜¾ç¤ºï¼‰
        getEcoMaterialsSummary(item) {
          const materials = item.materials || [];
          if (materials.length === 0) {
            // å…¼å®¹æ—§ç»“æ„
            return item.ç‰©æ–™å· || '--';
          }
          if (materials.length <= 2) {
            return materials.join(', ');
          }
          return `${materials[0]}, ${materials[1]} ç­‰ ${materials.length} é¡¹`;
        },
        // è·å– ECO ç‰©æ–™å®Œæ•´åˆ—è¡¨ï¼ˆç”¨äºæ‚¬åœæç¤ºï¼‰
        getEcoMaterialsFullList(item) {
          const materials = item.materials || [];
          if (materials.length === 0) {
            return item.ç‰©æ–™å· || '--';
          }
          return materials.join(', ');
        },
        // æŸ¥çœ‹è¯¦æƒ…ï¼ˆç®€å•å¼¹çª—ï¼‰
        viewDetail(item) {
          if (this.currentMenu === 'eco') {
            const ecoNo = item.eco_no || item.ECOå· || '--';
            const desc = item.description || item.äº§å“æè¿° || '--';
            const op = item.op || item.é€‚ç”¨å·¥åº || '--';
            const startSet = item.start_set || item.å°å¥— || '--';
            const changeDetails = item.change_details || '--';
            const materials = item.materials || [];
            const materialsStr = materials.length > 0 ? materials.join(', ') : (item.ç‰©æ–™å· || '--');
            const status = item.status || item.å˜æ›´çŠ¶æ€ || '--';
            const updateTime = item.update_time || item.å˜æ›´æ—¶é—´ || '--';
            const operator = item.é…æ–™å‘˜ || '--';
            
            alert(
              `ECOå·: ${ecoNo}\n` +
              `äº§å“æè¿°: ${desc}\n` +
              `å·¥åº: ${op}\n` +
              `èµ·å§‹å°å¥—: ç¬¬ ${startSet} å°èµ·\n` +
              `å˜æ›´è¯¦æƒ…: ${changeDetails}\n` +
              `æ¶‰åŠç‰©æ–™: ${materialsStr}\n` +
              `å˜æ›´çŠ¶æ€: ${status}\n` +
              `æ›´æ–°æ—¶é—´: ${updateTime}\n` +
              `é…æ–™å‘˜: ${operator}`
            );
          }
        },
        // æ‰§è¡Œ ECO å˜æ›´
        executeEco(item, index) {
          // å¼¹å‡ºç¡®è®¤æ¡†
          if (!confirm('ç¡®è®¤è¯¥ ECO å˜æ›´å·²æ‰§è¡Œå®Œæ¯•ï¼Ÿ')) {
            return;
          }
          
          // æ›´æ–°çŠ¶æ€ä¸º"å·²å®Œæˆ"ï¼ˆæ”¯æŒæ–°æ—§æ•°æ®ç»“æ„ï¼‰
          if (item.status !== undefined) {
            item.status = 'å·²å®Œæˆ';
          } else {
            item.å˜æ›´çŠ¶æ€ = 'å·²å®Œæˆ';
          }
          
          // æ›´æ–°å˜æ›´æ—¶é—´ä¸ºå½“å‰ç³»ç»Ÿæ—¶é—´
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const hour = String(now.getHours()).padStart(2, '0');
          const minute = String(now.getMinutes()).padStart(2, '0');
          const second = String(now.getSeconds()).padStart(2, '0');
          const timeStr = `${year}-${month}-${day} ${hour}:${minute}:${second}`;
          
          if (item.update_time !== undefined) {
            item.update_time = timeStr;
          } else {
            item.å˜æ›´æ—¶é—´ = timeStr;
          }
          
          // Vue ä¼šè‡ªåŠ¨å“åº”å¼æ›´æ–°ç•Œé¢ï¼ŒæŒ‰é’®ä¼šè‡ªåŠ¨å˜ä¸º"è¯¦æƒ…"
          alert('ECO å˜æ›´å·²æ ‡è®°ä¸ºå·²å®Œæˆ');
        },
        // æ ¼å¼åŒ–é‡‘é¢
        formatCurrency(amount) {
          if (amount === null || amount === undefined) return '0.00';
          return Number(amount).toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        },
        displayBillingAmount(amount) {
          const roleConfig = this.roles[this.currentUser.role];
          if (roleConfig && roleConfig.canViewAmount) {
            return `Â¥${this.formatCurrency(amount)}`;
          }
          return '****';
        },
        toggleBossRole() {
          this.userRole = this.isBossMode ? 'boss' : 'staff';
          // å…¼å®¹æ—§é€»è¾‘ï¼Œä½†ç»Ÿä¸€ä½¿ç”¨ currentUser.role
          if (this.isBossMode) {
            this.currentUser.role = 'boss';
            this.currentUser.name = this.roles['boss'].name;
          }
        },
        // åˆ‡æ¢è§’è‰²
        switchRole(role) {
          if (!this.roles[role]) {
            alert('æ— æ•ˆçš„è§’è‰²');
            return;
          }
          this.currentUser.role = role;
          this.currentUser.name = this.roles[role].name;
          this.showRoleDropdown = false;
          
          // å¦‚æœå½“å‰èœå•ä¸åœ¨æ–°è§’è‰²çš„æƒé™èŒƒå›´å†…ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨èœå•
          const roleConfig = this.roles[role];
          if (roleConfig && roleConfig.menus.length > 0) {
            if (!roleConfig.menus.includes(this.currentMenu)) {
              this.currentMenu = roleConfig.menus[0];
            }
          }
          
          // åŒæ­¥æ›´æ–°å…¼å®¹å­—æ®µ
          this.userRole = (role === 'boss' || role === 'admin') ? 'boss' : 'staff';
          this.isBossMode = (role === 'boss');
          
          alert(`å½“å‰èº«ä»½å·²åˆ‡æ¢ä¸ºï¼š${this.roles[role].name}`);
        },
        // åˆ°è´§å¼‚å¸¸ï¼šåˆ†ç±»æ ·å¼
        discrepancyCategoryClass(category) {
          const base = 'status-badge';
          switch (category) {
            case 'å®ç‰©ç ´æŸ':
              return `${base} status-pending`;
            case 'ç³»ç»Ÿé—®é¢˜':
              return `${base} status-ongoing`;
            case 'æ•°é‡å·®å¼‚':
            case 'å•æ®é—®é¢˜':
              return `${base} bg-yellow-50 text-yellow-700 border border-yellow-200`;
            case 'æ ‡ç­¾é”™è¯¯':
              return `${base} bg-indigo-50 text-indigo-700 border border-indigo-200`;
            default:
              return `${base} bg-gray-100 text-gray-700 border border-gray-200`;
          }
        },
        // åˆ°è´§å¼‚å¸¸ï¼šçŠ¶æ€æ ·å¼
        discrepancyStatusClass(status) {
          const base = 'status-badge';
          if (status === 'å¾…å¤„ç†') return `${base} status-pending`;
          if (status === 'å¤„ç†ä¸­') return `${base} status-ongoing`;
          return `${base} status-completed`;
        },
        // åˆ°è´§å¼‚å¸¸ï¼šå¤„ç†æ—¶é•¿
        getDiscrepancyDuration(item) {
          const startDate = new Date(item.date || item.åˆ°è´§æ—¥æœŸ);
          if (isNaN(startDate)) return item.duration || 0;
          const now = new Date();
          const diffDays = Math.max(0, Math.floor((now - startDate) / (1000 * 60 * 60 * 24)));
          if (item.status === 'å·²é—­ç¯') {
            return item.duration || diffDays;
          }
          return diffDays;
        },
        discrepancyDurationClass(item) {
          const days = this.getDiscrepancyDuration(item);
          if (item.status !== 'å·²é—­ç¯' && days > 3) {
            return 'text-red-600 font-semibold';
          }
          return '';
        },
        // åˆ°è´§å¼‚å¸¸ï¼šæ‰“å¼€/å…³é—­
        openDiscrepancyModal() {
          const today = new Date().toISOString().split('T')[0];
          this.newDiscrepancy = {
            supplier: '',
            date: today,
            po: '',
            material: '',
            qty: '',
            is_bonded: false,
            category: 'ç³»ç»Ÿé—®é¢˜',
            description: '',
            photos: [],
            status: 'å¾…å¤„ç†',
            result: ''
          };
          this.showDiscrepancyModal = true;
        },
        closeDiscrepancyModal() {
          this.showDiscrepancyModal = false;
        },
        handleDiscrepancyPhotos(event) {
          const files = event.target.files || [];
          this.newDiscrepancy.photos = Array.from(files).map(f => f.name);
        },
        // åˆ°è´§å¼‚å¸¸ï¼šä¿å­˜
        saveDiscrepancy() {
          const d = this.newDiscrepancy;
          if (!d.supplier || !d.date || !d.po || !d.material || !d.qty || !d.category || !d.description) {
            alert('è¯·å¡«å†™å¿…å¡«é¡¹ï¼šä¾›åº”å•†ã€æ—¥æœŸã€POã€ç‰©æ–™ã€æ•°é‡ã€åˆ†ç±»ã€æè¿°');
            return;
          }
          const todayStr = (d.date || '').replace(/-/g, '');
          const sameDayCount = (this.discrepancyList || []).filter(item => (item.date || '').replace(/-/g, '') === todayStr).length + 1;
          const reportId = `W-${todayStr}-${String(sameDayCount).padStart(2, '0')}`;
          const newItem = {
            report_id: reportId,
            date: d.date,
            supplier: d.supplier,
            po: d.po,
            material: d.material,
            qty: Number(d.qty) || 0,
            is_bonded: !!d.is_bonded,
            category: d.category,
            description: d.description,
            photos: d.photos || [],
            status: d.status || 'å¾…å¤„ç†',
            result: d.result || '',
            duration: 0
          };
          this.discrepancyList.unshift(newItem);
          this.closeDiscrepancyModal();
          alert('åˆ°è´§å¼‚å¸¸å·²ç™»è®°');
        },
        viewDiscrepancyDetail(item) {
          alert(
            `ç¼–å·: ${item.report_id || '--'}\n` +
            `æ—¥æœŸ: ${item.date || '--'}\n` +
            `ä¾›åº”å•†: ${item.supplier || '--'}\n` +
            `POå·: ${item.po || '--'}\n` +
            `ç‰©æ–™: ${item.material || '--'} æ•°é‡: ${item.qty || 0}\n` +
            `åˆ†ç±»: ${item.category || '--'}\n` +
            `æè¿°: ${item.description || '--'}\n` +
            `ä¿ç¨: ${item.is_bonded ? 'æ˜¯' : 'å¦'}\n` +
            `çŠ¶æ€: ${item.status || '--'}\n` +
            `å¤„ç†ç»“æœ: ${item.result || '--'}\n` +
            `ç…§ç‰‡: ${(item.photos || []).join(', ') || '--'}`
          );
        },
        // åˆ°è´§å¼‚å¸¸ï¼šå¯¼å‡º
        exportDiscrepancyToExcel() {
          const dataToExport = this.filteredDiscrepancyList;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'æŠ¥å‘Šç¼–å·': item.report_id || '',
              'åˆ°è´§æ—¥æœŸ': item.date || '',
              'ä¾›åº”å•†': item.supplier || '',
              'POå·': item.po || '',
              'ç‰©æ–™å·': item.material || '',
              'æ•°é‡': item.qty || 0,
              'æ˜¯å¦ä¿ç¨': item.is_bonded ? 'æ˜¯' : 'å¦',
              'é—®é¢˜åˆ†ç±»': item.category || '',
              'æè¿°': item.description || '',
              'ç…§ç‰‡': (item.photos || []).join(', '),
              'çŠ¶æ€': item.status || '',
              'å¤„ç†ç»“æœ': item.result || '',
              'å¤„ç†æ—¶é•¿(å¤©)': this.getDiscrepancyDuration(item)
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'åˆ°è´§å¼‚å¸¸ç®¡ç†');
            
            const today = new Date();
            const dateStr = today.getFullYear() + String(today.getMonth() + 1).padStart(2, '0') + String(today.getDate()).padStart(2, '0');
            const fileName = `åˆ°è´§å¼‚å¸¸ç®¡ç†_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.discrepancyList.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ä¾›åº”å•†æ”¶è´§ï¼šè®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
        getReceivingProgressPercent(task) {
          if (!task || !task.æ€»è¡Œæ•° || task.æ€»è¡Œæ•° === 0 || task.data_source === 'pending') return 0;
          const percent = Math.round((task.å·²å®Œæˆæ•°é‡ / task.æ€»è¡Œæ•°) * 100);
          return Math.max(0, Math.min(100, percent));
        },
        // ä¾›åº”å•†æ”¶è´§ï¼šè®¡ç®— SLA å€’è®¡æ—¶ä¿¡æ¯
        getSlaInfo(task) {
          if (!task || !task.åˆ°è´§æ—¥æœŸ) return { text: '--', type: 'normal' };
          const arrival = new Date(task.åˆ°è´§æ—¥æœŸ.replace(' ', 'T'));
          const now = new Date();
          const diffMs = now.getTime() - arrival.getTime();
          const diffHours = diffMs / (1000 * 60 * 60);
          const deadlineHours = 48;
          const progress = this.getReceivingProgressPercent(task);

          if (diffHours <= deadlineHours || progress >= 100) {
            // æœªè¶…è¿‡ 48 å°æ—¶ æˆ– å·²å®Œæˆ
            const remaining = Math.max(0, deadlineHours - diffHours);
            const remainingHours = Math.round(remaining);
            return {
              text: `å‰©ä½™ ${remainingHours} å°æ—¶`,
              type: progress >= 100 ? 'done' : 'ok'
            };
          } else {
            const overtimeHours = Math.round(diffHours - deadlineHours);
            const days = Math.floor(overtimeHours / 24);
            const hours = overtimeHours % 24;
            const detail = days > 0 ? `${days} å¤©` : `${hours} å°æ—¶`;
            return {
              text: `å·²è¶…æ—¶ ${detail}`,
              type: 'overdue'
            };
          }
        },
        // ä¾›åº”å•†æ”¶è´§ï¼šçŠ¶æ€æ ·å¼
        getReceivingStatusBadge(task) {
          if (!task || !task.å½“å‰çŠ¶æ€) return 'bg-gray-100 text-gray-600 border border-gray-200';
          if (task.å½“å‰çŠ¶æ€.includes('æ­£å¸¸')) {
            return 'bg-green-50 text-green-700 border border-green-200';
          }
          if (task.å½“å‰çŠ¶æ€.includes('è¶…æ—¶') || task.å½“å‰çŠ¶æ€.includes('ğŸ”´')) {
            return 'bg-red-50 text-red-700 border border-red-200';
          }
          return 'bg-yellow-50 text-yellow-700 border border-yellow-200';
        },
        // æ‰“å¼€ä¾›åº”å•†æ”¶è´§è¿›åº¦æ›´æ–°æ¡†
        openReceivingModal(task) {
          this.currentReceivingTask = task;
          this.updateQuantityInput = '';
          this.showReceivingModal = true;
        },
        closeReceivingModal() {
          this.showReceivingModal = false;
          this.currentReceivingTask = null;
          this.updateQuantityInput = '';
        },
        // ä¿å­˜è¿›åº¦æ›´æ–°ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼šä»…å‰ç«¯è®¡ç®—ï¼‰
        saveReceivingProgress() {
          const task = this.currentReceivingTask;
          if (!task) {
            this.closeReceivingModal();
            return;
          }
          const qty = Number(this.updateQuantityInput);
          if (Number.isNaN(qty) || qty <= 0) {
            alert('è¯·è¾“å…¥å¤§äº 0 çš„ä»Šæ—¥æ”¶è´§æ•°é‡');
            return;
          }

          // å¦‚æœæ€»è¡Œæ•°ä¸º 0ï¼ˆpending çŠ¶æ€ï¼‰ï¼Œæç¤ºéœ€è¦å…ˆä¸Šä¼  GE æŠ¥è¡¨
          if (!task.æ€»è¡Œæ•° || task.æ€»è¡Œæ•° === 0 || task.data_source === 'pending') {
            alert('è¯¥ä»»åŠ¡å°šæœªå¯¼å…¥ç³»ç»Ÿæ•°æ®ï¼Œè¯·å…ˆä¸Šä¼  GE æ”¶è´§æŠ¥è¡¨');
            this.closeReceivingModal();
            return;
          }

          const newCompleted = Math.min(task.æ€»è¡Œæ•°, task.å·²å®Œæˆæ•°é‡ + qty);
          task.å·²å®Œæˆæ•°é‡ = newCompleted;

          // è®°å½•åˆ°æ¯æ—¥è¿›åº¦
          const today = new Date().toISOString().slice(0, 10);
          task.æ¯æ—¥è¿›åº¦è®°å½• = task.æ¯æ—¥è¿›åº¦è®°å½• || [];
          task.æ¯æ—¥è¿›åº¦è®°å½•.push({ date: today, count: qty, operator: 'ç³»ç»Ÿæ¨¡æ‹Ÿæ›´æ–°' });

          const progress = this.getReceivingProgressPercent(task);
          const slaInfo = this.getSlaInfo(task);

          if (progress >= 100 && slaInfo.type !== 'overdue') {
            task.å½“å‰çŠ¶æ€ = 'æ­£å¸¸';
          } else if (slaInfo.type === 'overdue' && progress < 100) {
            task.å½“å‰çŠ¶æ€ = 'ğŸ”´å·²è¶…æ—¶';
          } else {
            task.å½“å‰çŠ¶æ€ = 'âš ï¸æœ‰ç§¯å‹';
          }

          this.closeReceivingModal();
          alert('å·²æ›´æ–°æ”¶è´§è¿›åº¦ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼Œä»…å‰ç«¯è®¡ç®—ï¼‰');
        },
        // æ‰“å¼€æ–°å»ºæ”¶è´§ä»»åŠ¡å¼¹çª—
        openNewReceivingModal() {
          const now = new Date();
          const pad = (n) => n.toString().padStart(2, '0');
          const value = `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
          this.newReceivingTask = {
            ä¾›åº”å•†åç§°: '',
            supplier_en: '',
            supplier_cn: '',
            åˆ°è´§æ—¥æœŸ: value,
            æ€»è¡Œæ•°: 0,
            physical_qty: '',
            unit: 'æ‰˜',
            data_source: 'pending',
            å¤‡æ³¨: ''
          };
          this.supplierSearchInput = '';
          this.selectedSupplier = null;
          this.showSupplierDropdown = false;
          this.showNewReceivingModal = true;
        },
        closeNewReceivingModal() {
          this.showNewReceivingModal = false;
        },
        // ä¾›åº”å•†è”æƒ³è¾“å…¥ï¼šæœç´¢
        onSupplierSearchInput() {
          const kw = (this.supplierSearchInput || '').trim().toLowerCase();
          if (!kw) {
            this.filteredSupplierOptions = [];
            return;
          }
          this.filteredSupplierOptions = (mockData.supplierDict || []).filter(item => {
            const en = String(item.en || '').toLowerCase();
            const cn = String(item.cn || '').toLowerCase();
            return en.includes(kw) || cn.includes(kw);
          });
        },
        // ä¾›åº”å•†è”æƒ³è¾“å…¥ï¼šé€‰æ‹©
        selectSupplier(option) {
          this.selectedSupplier = option;
          this.supplierSearchInput = option.en;
          this.newReceivingTask.supplier_en = option.en;
          this.newReceivingTask.supplier_cn = option.cn;
          this.newReceivingTask.ä¾›åº”å•†åç§° = `${option.en} - ${option.cn}`;
          this.showSupplierDropdown = false;
        },
        saveNewReceivingTask() {
          if (!this.selectedSupplier || !this.newReceivingTask.physical_qty) {
            alert('è¯·é€‰æ‹©ä¾›åº”å•†å¹¶å¡«å†™å®ç‰©æ•°é‡');
            return;
          }
          const physicalQty = Number(this.newReceivingTask.physical_qty);
          if (Number.isNaN(physicalQty) || physicalQty <= 0) {
            alert('å®ç‰©æ•°é‡å¿…é¡»ä¸ºå¤§äº 0 çš„æ•°å­—');
            return;
          }
          const arrivalRaw = this.newReceivingTask.åˆ°è´§æ—¥æœŸ || '';
          const arrival = arrivalRaw.replace('T', ' ');
          const newTask = {
            ä¾›åº”å•†åç§°: this.newReceivingTask.ä¾›åº”å•†åç§°,
            supplier_en: this.newReceivingTask.supplier_en,
            supplier_cn: this.newReceivingTask.supplier_cn,
            åˆ°è´§æ—¥æœŸ: arrival,
            æ€»è¡Œæ•°: 0,
            physical_qty: physicalQty,
            unit: this.newReceivingTask.unit || 'æ‰˜',
            data_source: 'pending',
            å·²å®Œæˆæ•°é‡: 0,
            æ¯æ—¥è¿›åº¦è®°å½•: [],
            å½“å‰çŠ¶æ€: 'æ­£å¸¸',
            å¤‡æ³¨: this.newReceivingTask.å¤‡æ³¨ || ''
          };
          this.receivingTasks.unshift(newTask);
          this.showNewReceivingModal = false;
          this.receivingPage = 1;
          alert('å·²ç™»è®°æ–°çš„ä¾›åº”å•†åˆ°è´§ä»»åŠ¡ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼Œä»…å‰ç«¯ä¿å­˜äºå†…å­˜ï¼‰');
        },
        // æ‰“å¼€æ”¶è´§è¯¦æƒ…
        openReceivingDetail(task) {
          this.currentReceivingDetailTask = task;
          this.showReceivingDetailModal = true;
        },
        closeReceivingDetailModal() {
          this.showReceivingDetailModal = false;
          this.currentReceivingDetailTask = null;
        },
        // åˆ‡æ¢æ ‡ç­¾
        changeReceivingTab(tab) {
          if (this.activeReceivingTab === tab) return;
          this.activeReceivingTab = tab;
          this.receivingPage = 1;
        },
        // æœç´¢é‡ç½®é¡µç 
        onReceivingSearchInput() {
          this.receivingPage = 1;
        },
        // GE æŠ¥è¡¨ä¸Šä¼ ï¼šè§¦å‘æ–‡ä»¶é€‰æ‹©
        triggerGeReportUpload() {
          if (this.$refs.geReportFileInput) {
            this.$refs.geReportFileInput.click();
          }
        },
        // GE æŠ¥è¡¨ä¸Šä¼ ï¼šå¤„ç†æ–‡ä»¶
        handleGeReportUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              // è§£æ Excelï¼šæŒ‰ Supplier å’Œ Transaction Date åˆ†ç»„èšåˆ
              const supplierDateMap = {};
              jsonData.forEach(row => {
                const supplier = String(row['Supplier'] || row['ä¾›åº”å•†'] || row['ä¾›åº”å•†åç§°'] || '').trim();
                const dateRaw = row['Transaction Date'] || row['äº¤æ˜“æ—¥æœŸ'] || row['æ—¥æœŸ'] || row['Date'] || '';
                const date = this.normalizeExcelDate(dateRaw);
                
                if (!supplier || !date) return;
                
                const key = `${supplier}|${date}`;
                if (!supplierDateMap[key]) {
                  supplierDateMap[key] = {
                    supplier: supplier,
                    date: date,
                    count: 0
                  };
                }
                supplierDateMap[key].count++;
              });

              // åŒ¹é…å›å¡«ï¼šæŸ¥æ‰¾å¯¹åº”çš„ receivingTasks
              let matchedCount = 0;
              Object.values(supplierDateMap).forEach(stat => {
                const matchedTasks = this.receivingTasks.filter(task => {
                  const taskSupplierEn = String(task.supplier_en || '').trim();
                  const taskDate = String(task.åˆ°è´§æ—¥æœŸ || '').substring(0, 10);
                  return taskSupplierEn === stat.supplier && taskDate === stat.date;
                });

                matchedTasks.forEach(task => {
                  task.æ€»è¡Œæ•° = stat.count;
                  task.data_source = 'synced';
                  matchedCount++;
                });
              });

              event.target.value = '';
              if (matchedCount > 0) {
                alert(`æˆåŠŸåŒ¹é…å¹¶æ›´æ–° ${matchedCount} æ¡æ”¶è´§ä»»åŠ¡`);
              } else {
                alert('æœªæ‰¾åˆ°åŒ¹é…çš„æ”¶è´§ä»»åŠ¡ï¼Œè¯·ç¡®è®¤ä¾›åº”å•†åç§°å’Œæ—¥æœŸæ˜¯å¦ä¸€è‡´');
              }
            } catch (error) {
              console.error('è§£æ GE æŠ¥è¡¨é”™è¯¯:', error);
              alert('è§£æå¤±è´¥ï¼š' + error.message);
              event.target.value = '';
            }
          };
          reader.readAsArrayBuffer(file);
        },
        // ç¿»é¡µ
        goToReceivingPage(page) {
          const total = this.receivingTotalPages;
          if (page < 1 || page > total) return;
          this.receivingPage = page;
        },
        // é€€å‡ºç™»å½•
        logout() {
          if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
            window.location.href = 'index.html';
          }
        },
        // æ‰“å¼€æ–°å¢ç¼ºé™·æ¨¡æ€æ¡†
        openDefectModal() {
          const today = new Date().toISOString().split('T')[0];
          this.newDefect = {
            å‘ç°æ—¥æœŸ: today,
            ç±»å‹: '',
            ç§ç±»: '',
            æ˜¯å¦æŒ‰ç¯: false,
            äº§å“: '',
            é—®é¢˜æè¿°: '',
            å‘ç°äºº: '',
            è´£ä»»äºº: '',
            åŸå› : '',
            è§£å†³æ–¹æ¡ˆ: '',
            '5WHYæ–‡ä»¶': '',
            å¤‡æ³¨: ''
          };
          this.defectFile = null;
          this.showDefectModal = true;
        },
        // å…³é—­æ–°å¢ç¼ºé™·æ¨¡æ€æ¡†
        closeDefectModal() {
          this.showDefectModal = false;
          this.newDefect = {
            å‘ç°æ—¥æœŸ: '',
            ç±»å‹: '',
            ç§ç±»: '',
            æ˜¯å¦æŒ‰ç¯: false,
            äº§å“: '',
            é—®é¢˜æè¿°: '',
            å‘ç°äºº: '',
            è´£ä»»äºº: '',
            åŸå› : '',
            è§£å†³æ–¹æ¡ˆ: '',
            '5WHYæ–‡ä»¶': '',
            å¤‡æ³¨: ''
          };
          this.defectFile = null;
        },
        // æŒ‰ç¯é€‰æ‹©å˜åŒ–æ—¶çš„å¤„ç†
        onAndonChange() {
          // å¦‚æœé€‰æ‹©"å¦"ï¼Œæ¸…ç©ºæ–‡ä»¶
          if (this.newDefect.æ˜¯å¦æŒ‰ç¯ === false) {
            this.defectFile = null;
            this.newDefect['5WHYæ–‡ä»¶'] = '';
            if (this.$refs.fileInput) {
              this.$refs.fileInput.value = '';
            }
          }
        },
        // æ–‡ä»¶é€‰æ‹©å˜åŒ–æ—¶çš„å¤„ç†
        onFileChange(event) {
          const file = event.target.files[0];
          if (file) {
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ10MBï¼‰
            if (file.size > 10 * 1024 * 1024) {
              alert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 10MB');
              event.target.value = '';
              this.defectFile = null;
              return;
            }
            this.defectFile = file;
            // æ¨¡æ‹Ÿç”Ÿæˆæ–‡ä»¶å
            const timestamp = new Date().getTime();
            const ext = file.name.split('.').pop();
            this.newDefect['5WHYæ–‡ä»¶'] = `5why-${this.newDefect.äº§å“}-${timestamp}.${ext}`;
          } else {
            this.defectFile = null;
            this.newDefect['5WHYæ–‡ä»¶'] = '';
          }
        },
        // ä¿å­˜ç¼ºé™·
        saveDefect() {
          // éªŒè¯å¿…å¡«é¡¹
          if (!this.newDefect.å‘ç°æ—¥æœŸ || !this.newDefect.ç±»å‹ || !this.newDefect.ç§ç±» || 
              !this.newDefect.äº§å“ || !this.newDefect.é—®é¢˜æè¿° || !this.newDefect.å‘ç°äºº || !this.newDefect.è´£ä»»äºº) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹');
            return;
          }
          
          // å¦‚æœé€‰æ‹©äº†"æŒ‰ç¯è§¦å‘"ï¼Œå¿…é¡»ä¸Šä¼ æ–‡ä»¶
          if (this.newDefect.æ˜¯å¦æŒ‰ç¯ === true) {
            if (!this.defectFile || !this.newDefect['5WHYæ–‡ä»¶']) {
              alert('æŒ‰ç¯è§¦å‘çš„ç¼ºé™·å¿…é¡»ä¸Šä¼  5WHY åˆ†ææŠ¥å‘Š');
              return;
            }
          }
          
          // åˆ›å»ºæ–°ç¼ºé™·è®°å½•
          const newItem = {
            å‘ç°æ—¥æœŸ: this.newDefect.å‘ç°æ—¥æœŸ,
            ç±»å‹: this.newDefect.ç±»å‹,
            ç§ç±»: this.newDefect.ç§ç±»,
            æ˜¯å¦æŒ‰ç¯: this.newDefect.æ˜¯å¦æŒ‰ç¯,
            äº§å“: this.newDefect.äº§å“,
            é—®é¢˜æè¿°: this.newDefect.é—®é¢˜æè¿°,
            å‘ç°äºº: this.newDefect.å‘ç°äºº,
            è´£ä»»äºº: this.newDefect.è´£ä»»äºº,
            åŸå› : this.newDefect.åŸå›  || '',
            è§£å†³æ–¹æ¡ˆ: this.newDefect.è§£å†³æ–¹æ¡ˆ || '',
            '5WHYæ–‡ä»¶': this.newDefect['5WHYæ–‡ä»¶'] || '',
            å¤‡æ³¨: this.newDefect.å¤‡æ³¨ || ''
          };
          
          // æ·»åŠ åˆ°åˆ—è¡¨é¡¶éƒ¨
          this.defectList.unshift(newItem);
          this.closeDefectModal();
          alert('ç¼ºé™·ç™»è®°æˆåŠŸï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼Œä»…å‰ç«¯ä¿å­˜äºå†…å­˜ï¼‰');
        },
        // è·å–5WHYæ–‡ä»¶ï¼ˆå®‰å…¨è®¿é—®å±æ€§ï¼‰
        get5WhyFile(item) {
          return item && item['5WHYæ–‡ä»¶'] ? item['5WHYæ–‡ä»¶'] : '';
        },
        // æŸ¥çœ‹5WHYæŠ¥å‘Š
        view5WhyReport(filename) {
          alert(`æŸ¥çœ‹ 5WHY åˆ†ææŠ¥å‘Šï¼š${filename}\n\nï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼šå®é™…ç¯å¢ƒä¸­è¿™é‡Œä¼šæ‰“å¼€æ–‡ä»¶é¢„è§ˆæˆ–ä¸‹è½½ï¼‰`);
        },
        // è§¦å‘Excelå¯¼å…¥
        triggerExcelImport() {
          if (this.$refs.excelFileInput) {
            this.$refs.excelFileInput.click();
          }
        },
        // å¤„ç†Excelå¯¼å…¥
        handleExcelImport(event) {
          const file = event.target.files[0];
          if (!file) return;

          // æ£€æŸ¥æ–‡ä»¶ç±»å‹
          const fileName = file.name.toLowerCase();
          if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
            alert('è¯·é€‰æ‹© Excel æ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsï¼‰');
            event.target.value = '';
            return;
          }

          // æ£€æŸ¥ XLSX åº“æ˜¯å¦åŠ è½½
          if (typeof XLSX === 'undefined') {
            alert('Excel è§£æåº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            event.target.value = '';
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              // è§£æExcelæ–‡ä»¶
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });

              // è·å–ç¬¬ä¸€ä¸ªSheet
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];

              // è½¬æ¢ä¸ºJSONï¼ˆä¿ç•™è¡¨å¤´ï¼‰
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                header: 1, // ä½¿ç”¨æ•°ç»„æ ¼å¼ï¼Œç¬¬ä¸€è¡Œæ˜¯è¡¨å¤´
                defval: '' // ç©ºå•å…ƒæ ¼é»˜è®¤å€¼
              });

              if (jsonData.length < 2) {
                alert('Excelæ–‡ä»¶è‡³å°‘éœ€è¦åŒ…å«è¡¨å¤´å’Œæ•°æ®è¡Œ');
                event.target.value = '';
                return;
              }

              // è·å–è¡¨å¤´ï¼ˆç¬¬ä¸€è¡Œï¼‰ï¼Œå»é™¤ç©ºæ ¼å’Œæ¢è¡Œ
              const headers = jsonData[0].map(h => h ? String(h).trim().replace(/\s+/g, '') : '');
              
              // è°ƒè¯•ï¼šæ˜¾ç¤ºè¯†åˆ«åˆ°çš„è¡¨å¤´
              console.log('è¯†åˆ«åˆ°çš„è¡¨å¤´:', headers);
              
              // å­—æ®µæ˜ å°„ï¼šä¸­æ–‡è¡¨å¤´ -> å†…éƒ¨å˜é‡åï¼ˆå»é™¤ç©ºæ ¼åçš„åŒ¹é…ï¼‰
              const headerMapping = {
                'å‘ç°æ—¥æœŸ': 'date',
                'ç±»å‹': 'type',
                'ç§ç±»': 'category',
                'æŒ‰ç¯': 'andon',
                'äº§å“': 'product',
                'é—®é¢˜æè¿°': 'description',
                'å‘ç°äºº': 'finder',
                'è´£ä»»äºº': 'owner',
                'åŸå› ': 'cause',
                'è§£å†³æ–¹æ¡ˆ': 'solution',
                '5WHYåˆ†æ': 'fiveWhyFile',
                '5whyåˆ†æ': 'fiveWhyFile', // å…¼å®¹å°å†™
                '5WHY': 'fiveWhyFile' // ç®€åŒ–ç‰ˆæœ¬
              };

              // æ‰¾åˆ°è¡¨å¤´å¯¹åº”çš„ç´¢å¼•ï¼ˆæ”¯æŒå»é™¤ç©ºæ ¼åçš„åŒ¹é…ï¼‰
              const columnIndexes = {};
              headers.forEach((header, index) => {
                if (header) {
                  // å…ˆå°è¯•ç²¾ç¡®åŒ¹é…
                  if (headerMapping[header]) {
                    columnIndexes[headerMapping[header]] = index;
                  } else {
                    // å°è¯•å»é™¤ç©ºæ ¼ååŒ¹é…
                    const cleanHeader = header.replace(/\s+/g, '');
                    if (headerMapping[cleanHeader]) {
                      columnIndexes[headerMapping[cleanHeader]] = index;
                    }
                  }
                }
              });

              // æ£€æŸ¥æ˜¯å¦è¯†åˆ«åˆ°å¿…è¦çš„å­—æ®µ
              const requiredFields = ['date', 'type', 'category', 'product', 'description', 'finder', 'owner'];
              const missingFields = requiredFields.filter(field => columnIndexes[field] === undefined);
              
              if (missingFields.length > 0) {
                const missingHeaders = missingFields.map(f => {
                  const map = {
                    'date': 'å‘ç°æ—¥æœŸ',
                    'type': 'ç±»å‹',
                    'category': 'ç§ç±»',
                    'product': 'äº§å“',
                    'description': 'é—®é¢˜æè¿°',
                    'finder': 'å‘ç°äºº',
                    'owner': 'è´£ä»»äºº'
                  };
                  return map[f] || f;
                }).join('ã€');
                
                alert(`è¡¨å¤´è¯†åˆ«å¤±è´¥ï¼\n\nç¼ºå°‘ä»¥ä¸‹å¿…éœ€å­—æ®µï¼š${missingHeaders}\n\nè¯†åˆ«åˆ°çš„è¡¨å¤´ï¼š${headers.filter(h => h).join('ã€')}\n\nè¯·ç¡®ä¿Excelç¬¬ä¸€è¡ŒåŒ…å«å®Œæ•´çš„ä¸­æ–‡è¡¨å¤´ã€‚`);
                console.error('ç¼ºå°‘çš„å­—æ®µ:', missingFields);
                console.error('è¯†åˆ«åˆ°çš„è¡¨å¤´:', headers);
                event.target.value = '';
                return;
              }

              // è½¬æ¢æ•°æ®è¡Œï¼ˆä»ç¬¬äºŒè¡Œå¼€å§‹ï¼‰
              const importedData = [];
              for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                
                // è·³è¿‡ç©ºè¡Œ
                if (!row || row.every(cell => !cell || cell.toString().trim() === '')) {
                  continue;
                }

                // æ„å»ºæ•°æ®å¯¹è±¡
                const item = {};

                // å¤„ç†å‘ç°æ—¥æœŸï¼ˆExcelæ—¥æœŸæ ¼å¼è½¬æ¢ï¼‰
                if (columnIndexes.date !== undefined) {
                  const dateValue = row[columnIndexes.date];
                  if (dateValue) {
                    if (typeof dateValue === 'number') {
                      // Excelæ—¥æœŸåºåˆ—å·ï¼Œéœ€è¦è½¬æ¢
                      const excelEpoch = new Date(1899, 11, 30);
                      const date = new Date(excelEpoch.getTime() + dateValue * 24 * 60 * 60 * 1000);
                      item.å‘ç°æ—¥æœŸ = date.toISOString().split('T')[0];
                    } else if (typeof dateValue === 'string') {
                      // å­—ç¬¦ä¸²æ ¼å¼çš„æ—¥æœŸ
                      let dateStr = dateValue.trim();
                      if (dateStr) {
                        // å¤„ç† "2025.11.7" è¿™ç§æ ¼å¼ï¼Œè½¬æ¢ä¸º "2025-11-07"
                        dateStr = dateStr.replace(/\./g, '-');
                        // å¤„ç†å•æ•°æ—¥æœŸï¼Œå¦‚ "2025-11-7" -> "2025-11-07"
                        const parts = dateStr.split('-');
                        if (parts.length === 3) {
                          const year = parts[0];
                          const month = parts[1].padStart(2, '0');
                          const day = parts[2].padStart(2, '0');
                          dateStr = `${year}-${month}-${day}`;
                        }
                        // å°è¯•è§£æå„ç§æ—¥æœŸæ ¼å¼
                        const parsedDate = new Date(dateStr);
                        if (!isNaN(parsedDate.getTime())) {
                          item.å‘ç°æ—¥æœŸ = parsedDate.toISOString().split('T')[0];
                        } else {
                          // å¦‚æœè¿˜æ˜¯æ— æ³•è§£æï¼Œå°è¯•å…¶ä»–æ ¼å¼
                          item.å‘ç°æ—¥æœŸ = dateStr; // ä¿æŒåŸæ ·
                        }
                      }
                    } else if (dateValue instanceof Date) {
                      item.å‘ç°æ—¥æœŸ = dateValue.toISOString().split('T')[0];
                    }
                  }
                }

                // å¤„ç†ç±»å‹
                if (columnIndexes.type !== undefined && row[columnIndexes.type]) {
                  item.ç±»å‹ = String(row[columnIndexes.type]).trim();
                }

                // å¤„ç†ç§ç±»
                if (columnIndexes.category !== undefined && row[columnIndexes.category]) {
                  item.ç§ç±» = String(row[columnIndexes.category]).trim();
                }

                // å¤„ç†æŒ‰ç¯ï¼ˆé€»è¾‘ï¼šåŒ…å«"æ˜¯"åˆ™ä¸ºtrueï¼‰
                if (columnIndexes.andon !== undefined) {
                  const andonValue = row[columnIndexes.andon];
                  if (andonValue !== undefined && andonValue !== null && andonValue !== '') {
                    const andonStr = String(andonValue).trim();
                    item.æ˜¯å¦æŒ‰ç¯ = andonStr.includes('æ˜¯') || andonStr.toLowerCase().includes('yes') || andonStr === '1';
                  } else {
                    item.æ˜¯å¦æŒ‰ç¯ = false;
                  }
                }

                // å¤„ç†äº§å“
                if (columnIndexes.product !== undefined && row[columnIndexes.product]) {
                  item.äº§å“ = String(row[columnIndexes.product]).trim();
                }

                // å¤„ç†é—®é¢˜æè¿°
                if (columnIndexes.description !== undefined && row[columnIndexes.description]) {
                  item.é—®é¢˜æè¿° = String(row[columnIndexes.description]).trim();
                }

                // å¤„ç†å‘ç°äºº
                if (columnIndexes.finder !== undefined && row[columnIndexes.finder]) {
                  item.å‘ç°äºº = String(row[columnIndexes.finder]).trim();
                }

                // å¤„ç†è´£ä»»äºº
                if (columnIndexes.owner !== undefined && row[columnIndexes.owner]) {
                  item.è´£ä»»äºº = String(row[columnIndexes.owner]).trim();
                }

                // å¤„ç†åŸå› 
                if (columnIndexes.cause !== undefined && row[columnIndexes.cause]) {
                  item.åŸå›  = String(row[columnIndexes.cause]).trim();
                }

                // å¤„ç†è§£å†³æ–¹æ¡ˆ
                if (columnIndexes.solution !== undefined && row[columnIndexes.solution]) {
                  item.è§£å†³æ–¹æ¡ˆ = String(row[columnIndexes.solution]).trim();
                }

                // å¤„ç†5WHYåˆ†æï¼ˆä½œä¸ºæ–‡ä»¶åå ä½ç¬¦ï¼‰
                if (columnIndexes.fiveWhyFile !== undefined && row[columnIndexes.fiveWhyFile]) {
                  item['5WHYæ–‡ä»¶'] = String(row[columnIndexes.fiveWhyFile]).trim();
                } else {
                  item['5WHYæ–‡ä»¶'] = '';
                }

                // é»˜è®¤å¤‡æ³¨ä¸ºç©º
                item.å¤‡æ³¨ = '';

                // éªŒè¯å¿…å¡«é¡¹ï¼ˆè´£ä»»äººæ”¹ä¸ºå¯é€‰ï¼‰
                const missingFields = [];
                if (!item.å‘ç°æ—¥æœŸ) missingFields.push('å‘ç°æ—¥æœŸ');
                if (!item.ç±»å‹) missingFields.push('ç±»å‹');
                if (!item.ç§ç±») missingFields.push('ç§ç±»');
                if (!item.äº§å“) missingFields.push('äº§å“');
                if (!item.é—®é¢˜æè¿°) missingFields.push('é—®é¢˜æè¿°');
                if (!item.å‘ç°äºº) missingFields.push('å‘ç°äºº');
                // è´£ä»»äººæ”¹ä¸ºå¯é€‰ï¼Œä¸å†éªŒè¯
                
                if (missingFields.length > 0) {
                  console.warn(`ç¬¬ ${i + 1} è¡Œæ•°æ®ç¼ºå°‘å¿…å¡«é¡¹ï¼š${missingFields.join('ã€')}ï¼Œå·²è·³è¿‡`);
                  console.warn('è¯¥è¡Œæ•°æ®:', row);
                  continue;
                }
                
                // å¦‚æœè´£ä»»äººä¸å­˜åœ¨ï¼Œè®¾ä¸ºç©ºå­—ç¬¦ä¸²
                if (!item.è´£ä»»äºº) {
                  item.è´£ä»»äºº = '';
                }

                importedData.push(item);
              }

              if (importedData.length === 0) {
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ–‡ä»¶æ ¼å¼\n\nå¯èƒ½åŸå› ï¼š\n1. æ•°æ®è¡Œç¼ºå°‘å¿…å¡«é¡¹\n2. æ•°æ®è¡Œä¸ºç©º\n3. è¡¨å¤´æ ¼å¼ä¸æ­£ç¡®');
                event.target.value = '';
                return;
              }

              // åˆå¹¶æ•°æ®åˆ°defectList
              this.defectList = [...importedData, ...this.defectList];
              
              // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
              event.target.value = '';
              
              // æ˜¾ç¤ºæˆåŠŸæç¤º
              alert(`æˆåŠŸå¯¼å…¥ ${importedData.length} æ¡æ•°æ®`);
              console.log('å¯¼å…¥çš„æ•°æ®:', importedData);

            } catch (error) {
              console.error('Excelå¯¼å…¥é”™è¯¯:', error);
              console.error('é”™è¯¯å †æ ˆ:', error.stack);
              alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message + '\n\nè¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯');
              event.target.value = '';
            }
          };

          reader.onerror = () => {
            alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
            event.target.value = '';
          };

          reader.readAsArrayBuffer(file);
        },
        // æ ¼å¼åŒ–æ•°å­—ï¼ˆæ·»åŠ åƒåˆ†ä½ï¼‰
        // å·¥å…·ï¼šæ ¼å¼åŒ–æ•°å­—
        formatNumber(num) {
          return Number(num).toLocaleString('zh-CN');
        },
        // å·¥å…·ï¼šå°† Excel æ—¥æœŸ/å­—ç¬¦ä¸²æ ‡å‡†åŒ–ä¸º YYYY-MM-DD
        normalizeExcelDate(raw) {
          if (raw === null || raw === undefined || raw === '') return '';

          // å¦‚æœæ˜¯ Date å¯¹è±¡ï¼Œç›´æ¥æ ¼å¼åŒ–
          if (raw instanceof Date) {
            const year = raw.getFullYear();
            const month = String(raw.getMonth() + 1).padStart(2, '0');
            const day = String(raw.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
          }

          // å¦‚æœæ˜¯æ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼ˆExcel åºåˆ—å·ï¼Œå¦‚ 45989ï¼‰
          const num = Number(raw);
          if (!isNaN(num) && isFinite(num) && String(raw).trim() !== '') {
            // Excel 1900 æ—¥æœŸç³»ç»Ÿï¼šä»¥ 1899-12-30 ä¸ºåŸºå‡†ï¼ˆè€ƒè™‘ Excel çš„é—°å¹´åå·®ï¼‰
            const excelEpoch = new Date(Date.UTC(1899, 11, 30)); // 1899-12-30
            const ms = num * 24 * 60 * 60 * 1000;
            const date = new Date(excelEpoch.getTime() + ms);
            const year = date.getUTCFullYear();
            const month = String(date.getUTCMonth() + 1).padStart(2, '0');
            const day = String(date.getUTCDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
          }

          // å¦åˆ™è®¤ä¸ºå·²ç»æ˜¯å­—ç¬¦ä¸²æ—¥æœŸï¼Œåšç®€å•è§„èŒƒåŒ–ï¼ˆæ”¯æŒ 2025/11/14 æˆ– 2025-11-14 ç­‰ï¼‰
          const str = String(raw).trim().replace(/\//g, '-');
          return str.substring(0, 10);
        },
        // å·¥å•é…æ–™ï¼šè§¦å‘ç”Ÿäº§è®¡åˆ’è¡¨ä¸Šä¼ 
        triggerPlanFileUpload() {
          if (this.$refs.planFileInput) {
            this.$refs.planFileInput.click();
          }
        },
        // å·¥å•é…æ–™ï¼šå¤„ç†ç”Ÿäº§è®¡åˆ’è¡¨ä¸Šä¼ 
        handlePlanFileUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              // å­—æ®µæ˜ å°„ - ä¿å­˜å®Œæ•´æ•°æ®ç”¨äºç”Ÿäº§è®¡åˆ’æ¨¡å—
              const fullPlanData = jsonData.map(row => ({
                'ä½¿ç”¨æ—¥æœŸ': this.normalizeExcelDate(row['ä½¿ç”¨æ—¥æœŸ'] || row['æ—¥æœŸ'] || ''),
                'å‘è½¦æ—¶é—´': String(row['å‘è½¦æ—¶é—´'] || '').trim(),
                'è½¦æ¬¡': String(row['è½¦æ¬¡'] || '').trim(),
                'å·¥åºå·': String(row['å·¥åºå·'] || row['OP'] || '').trim(),
                'äº§çº¿åç§°': String(row['äº§çº¿åç§°'] || row['äº§çº¿'] || '').trim(),
                'åˆ°åœºæ—¶é—´': String(row['åˆ°åœºæ—¶é—´'] || '').trim(),
                'äº§å“æè¿°': String(row['äº§å“æè¿°'] || row['äº§å“'] || '').trim(),
                'å·¥å•å·': String(row['å·¥å•å·'] || row['Job'] || '').trim(),
                'åŠ å·¥åºåˆ—å·': String(row['åŠ å·¥åºåˆ—å·'] || row['åºåˆ—å·'] || '').trim(),
                'å·¥åºæè¿°': String(row['å·¥åºæè¿°'] || '').trim(),
                'å°å¥—': String(row['å°å¥—'] || row['Station'] || '').trim()
              }));

              // å·¥å•é…æ–™æ¨¡å—ä½¿ç”¨çš„ç®€åŒ–æ•°æ®ï¼ˆç¡®ä¿å°å¥—è½¬ä¸ºå­—ç¬¦ä¸²ç”¨äºåŒ¹é…ï¼ŒåŒæ—¶ä¿ç•™å·²æ ‡å‡†åŒ–çš„ä½¿ç”¨æ—¥æœŸæ–¹ä¾¿ç­›é€‰/æ‰“å°ï¼‰
              this.planData = fullPlanData.map(row => ({
                'ä½¿ç”¨æ—¥æœŸ': row['ä½¿ç”¨æ—¥æœŸ'],
                'å·¥å•å·': row['å·¥å•å·'],
                'OP': row['å·¥åºå·'],
                'äº§å“æè¿°': row['äº§å“æè¿°'],
                'å°å¥—': row['å°å¥—'] ? String(row['å°å¥—']).trim() : ''
              })).filter(item => item['å·¥å•å·'] && item['OP']);

              // ä¿å­˜å®Œæ•´æ•°æ®åˆ° localStorage
              const updateTime = new Date();
              const timeString = updateTime.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
              }).replace(/\//g, '-');

              localStorage.setItem('productionPlanData', JSON.stringify(fullPlanData));
              localStorage.setItem('planUpdateTime', timeString);

              this.performMatching();
              alert(`æˆåŠŸåŠ è½½ ${this.planData.length} æ¡ç”Ÿäº§è®¡åˆ’è®°å½•\nè®¡åˆ’å·²æ›´æ–°ï¼Œå¯å‰å¾€ç”Ÿäº§è®¡åˆ’æ¨¡å—æŸ¥çœ‹`);
            } catch (error) {
              console.error('è§£æç”Ÿäº§è®¡åˆ’è¡¨é”™è¯¯:', error);
              alert('è§£æå¤±è´¥ï¼š' + error.message);
            }
            event.target.value = '';
          };
          reader.readAsArrayBuffer(file);
        },
        // å·¥å•é…æ–™ï¼šè§¦å‘BOMè¡¨ä¸Šä¼ 
        triggerBomFileUpload() {
          if (this.$refs.bomFileInput) {
            this.$refs.bomFileInput.click();
          }
        },
        // å·¥å•é…æ–™ï¼šå¤„ç†BOMè¡¨ä¸Šä¼ 
        handleBomFileUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              // å­—æ®µæ˜ å°„
              this.bomData = jsonData.map(row => ({
                'Job': String(row['Job'] || row['å·¥å•å·'] || '').trim(),
                'OP': String(row['OP'] || '').trim(),
                'Component': String(row['Component'] || row['ç‰©æ–™å·'] || '').trim(),
                'PENDING_LOCATOR': String(row['PENDING_LOCATOR'] || row['åº“ä½'] || '').trim(),
                'Required': String(row['Required'] || row['æ•°é‡'] || '').trim(),
                'å¤‡æ³¨': String(row['å¤‡æ³¨'] || '').trim()
              })).filter(item => item['Job'] && item['OP']);

              this.performMatching();
              alert(`æˆåŠŸåŠ è½½ ${this.bomData.length} æ¡BOMè®°å½•`);
            } catch (error) {
              console.error('è§£æBOMè¡¨é”™è¯¯:', error);
              alert('è§£æå¤±è´¥ï¼š' + error.message);
            }
            event.target.value = '';
          };
          reader.readAsArrayBuffer(file);
        },
        // å·¥å•é…æ–™ï¼šæ‰§è¡ŒåŒ¹é…é€»è¾‘
        performMatching() {
          if (this.planData.length === 0 || this.bomData.length === 0) {
            this.matchedWorkOrders = [];
            return;
          }

          this.matchedWorkOrders = this.planData.map(plan => {
            // è·å–è®¡åˆ’ä¸­çš„å°å¥—å·ï¼ˆè½¬ä¸ºæ•°å­—ï¼‰
            const planSetNumber = Number(plan['å°å¥—'] || plan.å°å¥— || 0);
            
            // åŒ¹é…BOMæ•°æ®ï¼šå·¥å•å· + OP åŒ¹é…
            const matchedMaterials = this.bomData.filter(bom => {
              const planJob = String(plan['å·¥å•å·'] || plan.å·¥å•å· || '').trim();
              const bomJob = String(bom['Job'] || bom.Job || '').trim();
              const planOP = String(plan['OP'] || plan.OP || '').trim();
              const bomOP = String(bom['OP'] || bom.OP || '').trim();
              
              return planJob === bomJob && planOP === bomOP;
            }).map(bom => {
              // ä¸ºæ¯ä¸ªç‰©æ–™åŒ¹é… ECOï¼ˆä¸‰é‡åŒ¹é…ï¼šç‰©æ–™ã€å·¥åºã€å°å¥—ï¼‰
              const component = String(bom['Component'] || bom.Component || '').trim();
              const op = String(bom['OP'] || bom.OP || '').trim();
              
              // åŒ¹é… ECOï¼šç‰©æ–™å‘½ä¸­ + å·¥åºå‘½ä¸­ + å°å¥—å‘½ä¸­
              const matchedEco = (this.ecoList || []).find(eco => {
                // æ¡ä»¶1ï¼šç‰©æ–™å‘½ä¸­ - æ£€æŸ¥ç‰©æ–™å·æ˜¯å¦åœ¨ ECO çš„ materials æ•°ç»„ä¸­
                const ecoMaterials = eco.materials || [];
                const materialMatch = ecoMaterials.some(ecoMat => {
                  const ecoMatStr = String(ecoMat || '').trim();
                  return component && ecoMatStr && component === ecoMatStr;
                });
                
                // å…¼å®¹æ—§ç»“æ„ï¼šå•ç‰©æ–™å·
                const oldMaterialMatch = !materialMatch && ecoMaterials.length === 0 && 
                  component === String(eco['ç‰©æ–™å·'] || eco.ç‰©æ–™å· || '').trim();
                
                if (!materialMatch && !oldMaterialMatch) return false;
                
                // æ¡ä»¶2ï¼šå·¥åºå‘½ä¸­
                const ecoOp = String(eco.op || eco.é€‚ç”¨å·¥åº || '').trim();
                const normalizedOp = op.replace(/^OP/i, ''); // ç§»é™¤ OP å‰ç¼€
                const normalizedEcoOp = ecoOp.replace(/^OP/i, ''); // ç§»é™¤ OP å‰ç¼€
                const processMatch = normalizedOp && normalizedEcoOp && normalizedOp === normalizedEcoOp;
                
                if (!processMatch) return false;
                
                // æ¡ä»¶3ï¼šå°å¥—å‘½ä¸­ - è®¡åˆ’å°å¥— >= ECOèµ·å§‹å°å¥—
                const ecoStartSet = Number(eco.start_set || eco.å°å¥— || 0);
                const setMatch = planSetNumber >= ecoStartSet;
                
                if (!setMatch) return false;
                
                // ä»…åŒ¹é…æœªå®Œæˆæˆ–è¿›è¡Œä¸­çš„ ECOï¼ˆæ’é™¤"å·²å®Œæˆ"å’Œ"å·²è¿‡æœŸ"ï¼‰
                const status = String(eco.status || eco.å˜æ›´çŠ¶æ€ || '').trim();
                const isActive = status && (
                  status === 'æœªå®Œæˆ' || 
                  status === 'è¿›è¡Œä¸­' || 
                  status.includes('æœªå®Œæˆ') || 
                  status.includes('è¿›è¡Œä¸­')
                ) && !status.includes('å·²å®Œæˆ') && !status.includes('å·²è¿‡æœŸ');
                
                return isActive;
              });
              
              // æ·»åŠ  ECO ä¿¡æ¯åˆ°ç‰©æ–™å¯¹è±¡
              return {
                ...bom,
                ecoInfo: matchedEco ? {
                  ecoNo: matchedEco.eco_no || matchedEco.ECOå· || '',
                  status: matchedEco.status || matchedEco.å˜æ›´çŠ¶æ€ || '',
                  changeDetails: matchedEco.change_details || ''
                } : null
              };
            });

            // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç‰©æ–™åŒ…å« ECO
            const hasEco = matchedMaterials.some(m => m.ecoInfo !== null);

            return {
              ...plan,
              materials: matchedMaterials,
              hasEco: hasEco
            };
          }).filter(wo => wo.materials.length > 0);

          // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå·¥å•
          if (this.matchedWorkOrders.length > 0) {
            // é‡ç½®é€‰ä¸­ç´¢å¼•ä¸ºç¬¬ä¸€ä¸ªï¼ˆåç»­ç”±è®¡ç®—å±æ€§ç»Ÿä¸€æ’åº/ç­›é€‰ï¼‰
            this.selectedWorkOrderIndex = 0;
          } else {
            this.selectedWorkOrderIndex = -1;
          }
        },
        // å·¥å•é…æ–™ï¼šé€‰æ‹©å·¥å•
        selectWorkOrder(index) {
          if (index >= 0 && index < this.matchedWorkOrders.length) {
            this.selectedWorkOrderIndex = index;
            // ç¡®ä¿ materials å±æ€§å­˜åœ¨
            const workOrder = this.matchedWorkOrders[index];
            if (workOrder && !workOrder.materials) {
              workOrder.materials = [];
            }
          }
        },
        // å·¥å•é…æ–™ï¼šæ‰“å°
        printWorkOrder() {
          const now = new Date();
          this.printTime = now
            .toLocaleString('zh-CN', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit',
              hour12: false
            })
            .replace(/\//g, '-');

          // ç¡®ä¿æ‰“å°æ—¶é—´å·²ç»æ¸²æŸ“åå†è§¦å‘æ‰“å°
          this.$nextTick(() => {
            window.print();
          });
        },
        // å·¥å•é…æ–™ï¼šåŠ è½½æ¨¡æ‹Ÿæ•°æ®
        loadMockData() {
          // æ¨¡æ‹Ÿç”Ÿäº§è®¡åˆ’æ•°æ®
          this.planData = [
            {
              'ä½¿ç”¨æ—¥æœŸ': '2024-01-15',
              'å·¥å•å·': 'G463922442',
              'OP': '220',
              'äº§å“æè¿°': 'HAL-X NC1',
              'å°å¥—': '1'
            }
          ];

          // æ¨¡æ‹ŸBOMæ•°æ®
          this.bomData = [
            { 'Job': 'G463922442', 'OP': '220', 'Component': '151X1249KA08NP17', 'PENDING_LOCATOR': 'W6.4.2', 'Required': '1', 'å¤‡æ³¨': '' },
            { 'Job': 'G463922442', 'OP': '220', 'Component': '151X1249KA08NP18', 'PENDING_LOCATOR': 'W6.4.3', 'Required': '2', 'å¤‡æ³¨': '' },
            { 'Job': 'G463922442', 'OP': '220', 'Component': '151X1249KA08NP19', 'PENDING_LOCATOR': 'W7.4.1', 'Required': '1', 'å¤‡æ³¨': '' }
          ];

          this.performMatching();
          if (this.matchedWorkOrders.length > 0) {
            this.selectedWorkOrderIndex = 0;
          }
        },
        // åˆå§‹åŒ–BIå›¾è¡¨
        initBICharts() {
          if (typeof echarts === 'undefined') {
            console.error('ECharts æœªåŠ è½½');
            return;
          }
          
          // å›¾è¡¨1ï¼šäº§é‡ä¸ç¼ºé™·ç‡è¶‹åŠ¿å›¾ï¼ˆåŒè½´å›¾ï¼‰
          const chart1El = this.$refs.chart1;
          if (chart1El && !this.chartInstances.chart1) {
            this.chartInstances.chart1 = echarts.init(chart1El);
            const option1 = {
              tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'cross' }
              },
              legend: {
                data: ['äº§é‡', 'DPMO'],
                top: 10
              },
              grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
              },
              xAxis: {
                type: 'category',
                data: this.biData.productionDefectTrend.months,
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              yAxis: [
                {
                  type: 'value',
                  name: 'äº§é‡',
                  position: 'left',
                  axisLine: { lineStyle: { color: '#2563eb' } },
                  axisLabel: { formatter: '{value}' }
                },
                {
                  type: 'value',
                  name: 'DPMO',
                  position: 'right',
                  axisLine: { lineStyle: { color: '#f97316' } },
                  axisLabel: { formatter: '{value}' }
                }
              ],
              series: [
                {
                  name: 'äº§é‡',
                  type: 'bar',
                  data: this.biData.productionDefectTrend.production,
                  itemStyle: { color: '#2563eb', borderRadius: [4, 4, 0, 0] },
                  barWidth: '50%'
                },
                {
                  name: 'DPMO',
                  type: 'line',
                  yAxisIndex: 1,
                  data: this.biData.productionDefectTrend.dmpo,
                  lineStyle: { color: '#f97316', width: 3 },
                  itemStyle: { color: '#f97316' },
                  smooth: true
                }
              ]
            };
            this.chartInstances.chart1.setOption(option1);
          }

          // å›¾è¡¨2ï¼šæ”¶å‘è´§ç¼ºé™·åˆ†å¸ƒï¼ˆå †å æŸ±çŠ¶å›¾ï¼‰
          const chart2El = this.$refs.chart2;
          if (chart2El && !this.chartInstances.chart2) {
            this.chartInstances.chart2 = echarts.init(chart2El);
            const option2 = {
              tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'shadow' }
              },
              legend: {
                data: this.biData.defectDistribution.series.map(s => s.name),
                top: 10
              },
              grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
              },
              xAxis: {
                type: 'category',
                data: this.biData.defectDistribution.categories,
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              yAxis: {
                type: 'value',
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              series: this.biData.defectDistribution.series.map((s, idx) => {
                const colors = ['#2563eb', '#f97316', '#06b6d4', '#10b981', '#8b5cf6'];
                return {
                  name: s.name,
                  type: 'bar',
                  stack: 'defect',
                  data: s.data,
                  itemStyle: { color: colors[idx % colors.length], borderRadius: [0, 0, 0, 0] }
                };
              })
            };
            this.chartInstances.chart2.setOption(option2);
          }

          // å›¾è¡¨3ï¼šæ”¶å‘è´§åŠæ—¶æ€§å¯¹æ¯”ï¼ˆæŠ˜çº¿å›¾ï¼‰
          const chart3El = this.$refs.chart3;
          if (chart3El && !this.chartInstances.chart3) {
            this.chartInstances.chart3 = echarts.init(chart3El);
            const option3 = {
              tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'cross' }
              },
              legend: {
                data: ['åˆ°è´§é‡', 'æ”¶è´§é‡'],
                top: 10
              },
              grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
              },
              xAxis: {
                type: 'category',
                data: this.biData.receivingShippingTimeliness.dates,
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              yAxis: {
                type: 'value',
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              series: [
                {
                  name: 'åˆ°è´§é‡',
                  type: 'line',
                  data: this.biData.receivingShippingTimeliness.receiving,
                  lineStyle: { color: '#2563eb', width: 3 },
                  itemStyle: { color: '#2563eb' },
                  smooth: true,
                  areaStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: 'rgba(37, 99, 235, 0.3)' }, { offset: 1, color: 'rgba(37, 99, 235, 0.05)' }] } }
                },
                {
                  name: 'æ”¶è´§é‡',
                  type: 'line',
                  data: this.biData.receivingShippingTimeliness.shipping,
                  lineStyle: { color: '#f97316', width: 3 },
                  itemStyle: { color: '#f97316' },
                  smooth: true,
                  areaStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: 'rgba(249, 115, 22, 0.3)' }, { offset: 1, color: 'rgba(249, 115, 22, 0.05)' }] } }
                }
              ]
            };
            this.chartInstances.chart3.setOption(option3);
          }

          // å›¾è¡¨4ï¼šä¾›åº”å•†é—®é¢˜åˆ†å¸ƒï¼ˆé¥¼å›¾ï¼‰
          const chart4El = this.$refs.chart4;
          if (chart4El && !this.chartInstances.chart4) {
            this.chartInstances.chart4 = echarts.init(chart4El);
            const option4 = {
              tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b}: {c}% ({d}%)'
              },
              legend: {
                orient: 'vertical',
                left: 'left',
                top: 'middle',
                data: this.biData.supplierIssueDistribution.map(item => item.name)
              },
              series: [
                {
                  name: 'ä¾›åº”å•†é—®é¢˜',
                  type: 'pie',
                  radius: ['40%', '70%'],
                  center: ['60%', '50%'],
                  avoidLabelOverlap: false,
                  itemStyle: {
                    borderRadius: 8,
                    borderColor: '#fff',
                    borderWidth: 2
                  },
                  label: {
                    show: true,
                    formatter: '{b}: {c}%'
                  },
                  emphasis: {
                    label: {
                      show: true,
                      fontSize: 16,
                      fontWeight: 'bold'
                    }
                  },
                  data: this.biData.supplierIssueDistribution.map(item => ({
                    value: item.value,
                    name: item.name,
                    itemStyle: {
                      color: item.name === 'ç³»ç»Ÿé—®é¢˜' ? '#2563eb' : item.name === 'å•æ®é—®é¢˜' ? '#f97316' : '#06b6d4'
                    }
                  }))
                }
              ]
            };
            this.chartInstances.chart4.setOption(option4);
          }

          // å“åº”å¼è°ƒæ•´
          window.addEventListener('resize', () => {
            Object.values(this.chartInstances).forEach(chart => {
              if (chart) {
                chart.resize();
              }
            });
          });
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
