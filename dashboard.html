<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®‰é€šä¾›åº”é“¾ - ç®¡ç†åå°</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Vue.js -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Apache ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <!-- SheetJS for Excel import -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <style>
    body, html {
      font-family: "Microsoft YaHei", "æ€æºé»‘ä½“", "Source Han Sans SC", "Noto Sans SC", "PingFang SC", "Hiragino Sans GB", "Helvetica Neue", Helvetica, Arial, sans-serif;
      background-color: #f9fafb;
      color: #1f2937;
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
    }
    
    .sidebar {
      background: #ffffff;
      border-right: 1px solid #e5e7eb;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
    }
    
    .menu-item {
      transition: all 0.2s;
      color: #4b5563;
    }
    
    .menu-item:hover {
      background: #f3f4f6;
    }
    
    .menu-item.active {
      background: #eff6ff;
      border-left: 3px solid #2563eb;
      color: #2563eb;
      font-weight: 600;
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-pending {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    
    .status-ongoing {
      background: #eff6ff;
      color: #2563eb;
      border: 1px solid #bfdbfe;
    }
    
    .status-completed {
      background: #f0fdf4;
      color: #16a34a;
      border: 1px solid #bbf7d0;
    }
    
    .table-container {
      max-height: calc(100vh - 200px);
      overflow-y: auto;
      overflow-x: auto;
    }
    
    .table-container::-webkit-scrollbar {
      width: 8px;
    }
    
    .table-container::-webkit-scrollbar-track {
      background: #f3f4f6;
    }
    
    .table-container::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
    
    .table-container::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    
    /* A4 æ‰“å°æ ·å¼ */
    .a4-page {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    
    @media print {
      @page {
        size: A4;
        margin: 0;
      }
      
      body * {
        visibility: hidden;
      }
      
      .print-area,
      .print-area * {
        visibility: visible;
      }
      
      .print-area {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      
      .a4-page {
        width: 210mm;
        min-height: 297mm;
        margin: 0;
        padding: 15mm;
        box-shadow: none;
        page-break-after: always;
      }
      
      .print\\:hidden {
        display: none !important;
      }
      
      /* ç¡®ä¿æ‰“å°æ—¶æ–‡å­—ä¸ºé»‘è‰²ï¼Œä½†ä¿ç•™çº¢è‰²ECOæ ‡è®° */
      .a4-page,
      .a4-page * {
        color: #000 !important;
      }
      
      /* ECO çº¢è‰²æ ‡è®°åœ¨æ‰“å°æ—¶ä¿æŒå¯è§ï¼ˆåŠ ç²—é»‘è‰²ï¼‰ */
      .a4-page .text-red-600,
      .a4-page .text-red-700 {
        color: #000 !important;
        font-weight: bold !important;
      }
      
      /* ECO è­¦ç¤ºæ¡†åœ¨æ‰“å°æ—¶ä¿æŒè¾¹æ¡† */
      .a4-page .bg-red-50 {
        background-color: #fff !important;
        border: 2px solid #000 !important;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="flex h-screen">
      <!-- å·¦ä¾§ä¾§è¾¹æ  -->
      <aside class="sidebar w-64 flex flex-col">
        <!-- Logo åŒºåŸŸ -->
        <div class="p-6 border-b border-gray-200">
          <div class="text-xl font-bold text-orange-500">å®‰é€šä¾›åº”é“¾</div>
          <div class="text-sm text-gray-500 mt-1">ç®¡ç†åå°</div>
        </div>
        
        <!-- å¯¼èˆªèœå• -->
        <nav class="flex-1 py-4">
          <div 
            v-for="(item, index) in visibleMenuItems" 
            :key="index"
            :class="['menu-item px-6 py-3 cursor-pointer', { active: currentMenu === item.key }]"
            @click="switchMenu(item.key)"
          >
            <div class="flex items-center">
              <span class="text-sm">{{ item.name }}</span>
            </div>
          </div>
        </nav>
        <!-- å½“å‰è§’è‰²æ˜¾ç¤º -->
        <div class="p-4 border-t border-gray-200 text-sm text-gray-700">
          <div class="text-xs text-gray-500 mb-1">å½“å‰è§’è‰²</div>
          <div class="font-semibold text-gray-800">{{ roles[currentUser.role]?.name || currentUser.role }}</div>
        </div>
        <!-- ç³»ç»Ÿé‡ç½®æŒ‰é’®ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰ -->
        <div v-if="currentUser.role === 'admin'" class="p-4 border-t border-gray-200">
          <button
            @click="resetSystemData"
            class="w-full px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg text-sm font-semibold text-white transition"
          >
            âš ï¸ é‡ç½®ç³»ç»Ÿæ•°æ®
          </button>
        </div>
      </aside>
      
      <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
      <main class="flex-1 flex flex-col overflow-hidden bg-gray-50">
        <!-- é¡¶éƒ¨æ  -->
        <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between shadow-sm">
          <h1 class="text-xl font-semibold text-gray-800">{{ currentMenuName }}</h1>
          <div class="flex items-center gap-4" @click.self="showRoleDropdown = false">
            <div class="flex items-center gap-2 relative" @click.stop>
              <div class="w-8 h-8 rounded-full bg-orange-500 flex items-center justify-center text-white text-sm font-semibold">
                {{ currentUser.name.charAt(0) }}
              </div>
              <div class="flex items-center gap-1 cursor-pointer" @click="showRoleDropdown = !showRoleDropdown">
                <span class="text-sm text-gray-600">{{ currentUser.name }}</span>
                <span class="text-xs text-gray-400">â–¼</span>
              </div>
              <!-- è§’è‰²åˆ‡æ¢ä¸‹æ‹‰èœå• -->
              <div
                v-if="showRoleDropdown"
                class="absolute top-full right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50"
                @click.stop
              >
                <div class="py-1">
                  <div
                    @click="switchRole('admin')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šç®¡ç†å‘˜
                  </div>
                  <div
                    @click="switchRole('role_a')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šç”Ÿäº§ä¸“å‘˜ (A)
                  </div>
                  <div
                    @click="switchRole('role_b')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šGEç‰©æµ (B)
                  </div>
                  <div
                    @click="switchRole('role_c')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šç»¼åˆè´¢åŠ¡ (C)
                  </div>
                  <div
                    @click="switchRole('receiver')"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-700"
                  >
                    åˆ‡æ¢ä¸ºï¼šæ”¶è´§å‘˜
                  </div>
                  <div
                    v-if="currentUser.role === 'admin'"
                    class="border-t border-gray-200 mt-1 pt-1"
                  >
                    <div
                      @click="resetSystemData"
                      class="px-4 py-2 hover:bg-red-50 cursor-pointer text-sm text-red-600 font-semibold"
                    >
                      âš ï¸ é‡ç½®ç³»ç»Ÿæ•°æ®
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <button 
              @click="logout"
              class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm transition text-gray-700"
            >
              é€€å‡ºç™»å½•
            </button>
          </div>
        </header>
        
        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="flex-1 overflow-auto p-6">
          <!-- ç”Ÿäº§è®¡åˆ’ -->
          <div v-if="currentMenu === 'production'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col gap-4 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div class="flex flex-col gap-1">
                    <h2 class="text-lg font-semibold text-gray-800">ç”Ÿäº§è®¡åˆ’åˆ—è¡¨</h2>
                    <div class="text-xs text-gray-500">
                      æœ€åæ›´æ–°æ—¶é—´ï¼š<span v-if="planUpdateTime">{{ planUpdateTime }}</span><span v-else>æš‚æ— æ›´æ–°</span>
                    </div>
                  </div>
                  <div class="flex flex-col md:flex-row gap-3 md:items-center">
                    <!-- æŸ¥è¯¢ç­›é€‰ -->
                    <div class="flex gap-2">
                      <input
                        type="date"
                        v-model="productionPlanSearchDate"
                        class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-3 py-2 text-sm text-gray-800 outline-none"
                        placeholder="é€‰æ‹©æ—¥æœŸ"
                      />
                      <input
                        type="text"
                        v-model="productionPlanSearchKeyword"
                        placeholder="æœå·¥å•å·/äº§å“/äº§çº¿"
                        class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-4 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-48"
                      />
                    </div>
                    <button 
                      @click="exportProductionPlanToExcel"
                      class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                    >
                      ğŸ“¤ å¯¼å‡º Excel
                    </button>
                    <button 
                      @click="refreshData"
                      class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white whitespace-nowrap"
                    >
                      åˆ·æ–°
                    </button>
                  </div>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åˆ°è¾¾æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åˆ°è¾¾æ—¶é—´</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è½¦æ¬¡</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥å•å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥åº/OP</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§çº¿</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§å“æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åŠ å·¥åºåˆ—å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">AGVå‘è½¦æ—¶é—´</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredProductionPlan.length === 0" class="border-b border-gray-200">
                      <td colspan="9" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredProductionPlan" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.arrival_date || item.åˆ°è¾¾æ—¥æœŸ || item.ä½¿ç”¨æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.arrival_time || item.åˆ°è¾¾æ—¶é—´ || item.åˆ°åœºæ—¶é—´ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.trip_no || item.è½¦æ¬¡ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.work_order || item.å·¥å•å· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.op || item.å·¥åº || item.å·¥åºå· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.line || item.äº§çº¿ || item.äº§çº¿åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.description || item.äº§å“æè¿° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.seq_no || item.åŠ å·¥åºåˆ—å· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.agv_time || item.AGVå‘è½¦æ—¶é—´ || item.å‘è½¦æ—¶é—´ || '--' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredProductionPlan.length }} æ¡è®°å½•
                <span v-if="productionPlanSearchKeyword || productionPlanSearchDate" class="text-blue-600">
                  ï¼ˆå·²ç­›é€‰ï¼Œå…± {{ productionPlan.length }} æ¡åŸå§‹è®°å½•ï¼‰
                </span>
              </div>
            </div>
          </div>

          <!-- å·¥å•ç®¡ç† -->
          <div v-if="currentMenu === 'workorder'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col gap-4 mb-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div class="flex flex-col gap-1">
                    <h2 class="text-lg font-semibold text-gray-800">å·¥å•ç®¡ç†åˆ—è¡¨</h2>
                    <div class="text-xs text-gray-500">
                      â„¹ï¸ æ•°æ®åŒæ­¥è‡ªé…æ–™æ¨¡å—ï¼Œä¸Šä¼ æ—¶é—´ï¼š<span v-if="planUpdateTime">{{ planUpdateTime }}</span><span v-else>æš‚æ— æ›´æ–°</span>
                    </div>
                  </div>
                  <div class="flex flex-col md:flex-row gap-3 md:items-center">
                    <div class="relative">
                      <input
                        type="text"
                        v-model="workOrderSearchKeyword"
                        placeholder="æœç´¢å·¥å•å·/äº§å“æè¿°"
                        class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                      />
                      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                    </div>
                    <button 
                      @click="exportWorkOrderToExcel"
                      class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                    >
                      ğŸ“¤ å¯¼å‡º Excel
                    </button>
                    <button 
                      @click="refreshData"
                      class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                    >
                      åˆ·æ–°
                    </button>
                  </div>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥å•å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§å“æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥åº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åŠ å·¥åºåˆ—å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§çº¿åç§°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä½¿ç”¨æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">çŠ¶æ€</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredWorkOrderList.length === 0" class="border-b border-gray-200">
                      <td colspan="7" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredWorkOrderList" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap font-semibold">{{ item.å·¥å•å· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.äº§å“æè¿° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å·¥åºå· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.åŠ å·¥åºåˆ—å· || item.seq_no || item.åŠ å·¥åºåˆ—å· || item.å°å¥— || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.äº§çº¿åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.ä½¿ç”¨æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span class="status-badge status-ongoing">å¾…äº§</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredWorkOrderList.length }} æ¡è®°å½•
                <span v-if="workOrderSearchKeyword" class="text-blue-600">
                  ï¼ˆå·²ç­›é€‰ï¼Œå…± {{ workOrderList.length }} æ¡åŸå§‹è®°å½•ï¼‰
                </span>
              </div>
            </div>
          </div>

          <!-- åˆ°è´§å¼‚å¸¸ç®¡ç† -->
          <div v-if="currentMenu === 'discrepancy'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">åˆ°è´§å¼‚å¸¸ç®¡ç†</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeywordDiscrepancy"
                      placeholder="æœç´¢ä¾›åº”å•†/PO/ç‰©æ–™/åˆ†ç±»"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <button 
                    @click="openDiscrepancyModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition whitespace-nowrap"
                  >
                    + ç™»è®°å¼‚å¸¸
                  </button>
                  <button 
                    @click="triggerDiscrepancyImport"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¥ å¯¼å…¥ Excel
                  </button>
                  <button 
                    @click="exportDiscrepancyToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <input
                    type="file"
                    ref="discrepancyFileInput"
                    accept=".xlsx,.xls"
                    @change="handleDiscrepancyImport"
                    style="display: none;"
                  />
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>

              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç¼–å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä¾›åº”å•†</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç‰©æ–™/æ•°é‡</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è¡Œå·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¼‚å¸¸åˆ†ç±»</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä¿ç¨</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">çŠ¶æ€</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¤„ç†æ—¶é•¿</th>
                      <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 whitespace-nowrap">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredDiscrepancyList.length === 0" class="border-b border-gray-200">
                      <td colspan="11" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredDiscrepancyList" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td 
                        class="px-4 py-3 text-sm text-gray-800 max-w-[120px]"
                        :title="item.report_id || '--'"
                      >
                        <div class="truncate">{{ item.report_id || '--' }}</div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.date || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.supplier || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">
                        <div class="flex flex-col">
                          <span>{{ item.material || '--' }}</span>
                          <span class="text-xs text-gray-500">æ•°é‡ï¼š{{ item.qty || 0 }}</span>
                        </div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.line_no || '--' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span :class="discrepancyCategoryClass(item.category)" class="status-badge">{{ item.category || '--' }}</span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">
                        <div class="max-w-xs truncate" :title="item.description || ''">
                          {{ item.description || '--' }}
                        </div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.is_bonded ? 'æ˜¯' : 'å¦' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span :class="discrepancyStatusClass(item.status)" class="status-badge">{{ item.status || '--' }}</span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap" :class="discrepancyDurationClass(item)">
                        {{ getDiscrepancyDuration(item) }} å¤©
                      </td>
                      <td class="px-4 py-3 text-center whitespace-nowrap">
                        <button 
                          v-if="item.status === 'å·²é—­ç¯'"
                          @click="viewDiscrepancyDetail(item)"
                          class="px-3 py-1 bg-gray-500 hover:bg-gray-600 rounded text-xs transition text-white whitespace-nowrap"
                        >
                          ğŸ“„ è¯¦æƒ…
                        </button>
                        <button 
                          v-else
                          @click="handleDiscrepancy(item)"
                          class="px-3 py-1 bg-blue-700 hover:bg-blue-800 rounded text-xs transition text-white whitespace-nowrap"
                        >
                          âš¡ å¤„ç†
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredDiscrepancyList.length }} / {{ discrepancyList.length }} æ¡è®°å½•
              </div>
            </div>
          </div>

          <!-- è½¦æ¬¡ç®¡ç† -->
          <div v-if="currentMenu === 'vehicle'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">è½¦æ¬¡ç®¡ç†åˆ—è¡¨</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeywordVehicle"
                      placeholder="æœç´¢å®¢æˆ·/å¸æœº/è½¦å‹"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <button 
                    @click="openVehicleLogModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition whitespace-nowrap"
                  >
                    + ç™»è®°è½¦æ¬¡
                  </button>
                  <button 
                    @click="triggerVehicleLogImport"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¥ å¯¼å…¥ Excel
                  </button>
                  <button 
                    @click="exportVehicleLogToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <input
                    type="file"
                    ref="vehicleLogFileInput"
                    accept=".xlsx,.xls"
                    @change="handleVehicleLogImport"
                    style="display: none;"
                  />
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ—¶é—´</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è½¦å‹</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¸æœºå§“å</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å®¢æˆ·åç§°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å®¢æˆ·ç­¾æ”¶äºº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å†…å®¹</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¤‡æ³¨</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredVehicleLog.length === 0" class="border-b border-gray-200">
                      <td colspan="8" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredVehicleLog" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.æ—¶é—´ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.è½¦å‹ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å¸æœºå§“å || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å®¢æˆ·åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å®¢æˆ·ç­¾æ”¶äºº || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å†…å®¹ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å¤‡æ³¨ || '--' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredVehicleLog.length }} / {{ vehicleLog.length }} æ¡è®°å½•
              </div>
            </div>
          </div>

          <!-- ECO å˜æ›´ç®¡ç† -->
          <div v-if="currentMenu === 'eco'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <!-- æ“ä½œæ  -->
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">ECO å˜æ›´åˆ—è¡¨</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <!-- æœç´¢æ¡† -->
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeyword"
                      placeholder="æœç´¢ ECOå· / ç‰©æ–™å· / äº§å“æè¿°"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <div class="flex gap-3">
                    <button
                      @click="openCreateModal"
                      class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition"
                    >
                      æ–°å¢ ECO
                    </button>
                    <button 
                      @click="triggerEcoImport"
                      class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                    >
                      ğŸ“¥ å¯¼å…¥ Excel
                    </button>
                    <button 
                      @click="exportEcoListToExcel"
                      class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                    >
                      ğŸ“¤ å¯¼å‡º Excel
                    </button>
                    <input
                      type="file"
                      ref="ecoFileInput"
                      accept=".xlsx,.xls"
                      @change="handleEcoImport"
                      style="display: none;"
                    />
                    <button 
                      @click="refreshData"
                      class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                    >
                      åˆ·æ–°
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- æ•°æ®è¡¨æ ¼ -->
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ECOå·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§å“æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å·¥åº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">èµ·å§‹å°å¥—</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ¶‰åŠç‰©æ–™</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å˜æ›´çŠ¶æ€</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ›´æ–°æ—¶é—´</th>
                      <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 whitespace-nowrap">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredEcoList.length === 0" class="border-b border-gray-200">
                      <td colspan="8" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredEcoList" 
                      :key="item.id || item._id || `eco_${index}_${item.eco_no || ''}`"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.eco_no || item.ECOå· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.description || item.äº§å“æè¿° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.op || item.é€‚ç”¨å·¥åº || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">ç¬¬ {{ item.start_set || item.å°å¥— || '--' }} å°èµ·</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">
                        <span 
                          :title="getEcoMaterialsFullList(item)"
                          class="cursor-help"
                        >
                          {{ getEcoMaterialsSummary(item) }}
                        </span>
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span 
                          :class="[
                            'status-badge',
                            item.status === 'å·²è¿‡æœŸ' || item.å˜æ›´çŠ¶æ€ === 'å·²è¿‡æœŸ' ? 'status-pending' : 
                            (item.status === 'è¿›è¡Œä¸­' || item.status === 'æœªå®Œæˆ' || item.å˜æ›´çŠ¶æ€ === 'è¿›è¡Œä¸­' || item.å˜æ›´çŠ¶æ€ === 'æœªå®Œæˆ') ? 'status-ongoing' : 'status-completed'
                          ]"
                        >
                          {{ item.status || item.å˜æ›´çŠ¶æ€ || '--' }}
                        </span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.update_time || item.å˜æ›´æ—¶é—´ || '--' }}</td>
                      <td class="px-4 py-3 text-center whitespace-nowrap">
                        <div class="flex gap-2 justify-center">
                          <!-- å¦‚æœçŠ¶æ€æ˜¯"è¿›è¡Œä¸­"æˆ–"æœªå®Œæˆ"ï¼Œæ˜¾ç¤ºæ‰§è¡ŒæŒ‰é’® -->
                          <button 
                            v-if="(item.status === 'è¿›è¡Œä¸­' || item.status === 'æœªå®Œæˆ' || item.å˜æ›´çŠ¶æ€ === 'è¿›è¡Œä¸­' || item.å˜æ›´çŠ¶æ€ === 'æœªå®Œæˆ')"
                            @click="executeEco(item, index)"
                            class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition text-white whitespace-nowrap"
                          >
                            âœ… æ‰§è¡Œ
                          </button>
                          <!-- å¦‚æœçŠ¶æ€æ˜¯"å·²å®Œæˆ"æˆ–"å·²è¿‡æœŸ"ï¼Œåªæ˜¾ç¤ºè¯¦æƒ…æŒ‰é’® -->
                          <button 
                            v-else
                            @click="viewDetail(item)"
                            class="px-3 py-1 bg-gray-400 hover:bg-gray-500 rounded text-xs transition text-white whitespace-nowrap"
                          >
                            è¯¦æƒ…
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- ç»Ÿè®¡ä¿¡æ¯ -->
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredEcoList.length }} / {{ ecoList.length }} æ¡è®°å½•
              </div>
            </div>
          </div>
          
          <!-- å®¢æˆ·è´¹ç”¨ç»“ç®— -->
          <div v-if="currentMenu === 'billing'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">å®¢æˆ·è´¹ç”¨ç»“ç®—åˆ—è¡¨</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeywordBilling"
                      placeholder="æœç´¢å®¢æˆ·/è´¹ç”¨ç±»å‹"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <button 
                    @click="openBillingModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition whitespace-nowrap"
                  >
                    + ç™»è®°è´¹ç”¨
                  </button>
                  <button 
                    @click="triggerBillingImport"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¥ å¯¼å…¥ Excel
                  </button>
                  <button 
                    @click="exportBillingToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <input
                    type="file"
                    ref="billingFileInput"
                    accept=".xlsx,.xls"
                    @change="handleBillingImport"
                    style="display: none;"
                  />
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å®¢æˆ·åç§°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è´¹ç”¨ç±»å‹</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">é¢ç§¯ (ã¡)</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç»“ç®—å‘¨æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å‘ç”Ÿæ—¥æœŸ</th>
                      <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700 whitespace-nowrap">é‡‘é¢</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç»“ç®—çŠ¶æ€</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä¸‹æ¬¡æé†’æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 whitespace-nowrap">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredBillingRecord.length === 0" class="border-b border-gray-200">
                      <td colspan="9" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredBillingRecord" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å®¢æˆ·åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.è´¹ç”¨ç±»å‹ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.é¢ç§¯ !== undefined ? item.é¢ç§¯ : '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap" :title="item.è´¹ç”¨è¯´æ˜ || ''">
                        <div class="flex flex-col">
                          <span class="font-medium">{{ item.ç»“ç®—å‘¨æœŸ || '--' }}</span>
                          <span v-if="item.è´¹ç”¨è¯´æ˜" class="text-xs text-gray-500 mt-0.5">{{ item.è´¹ç”¨è¯´æ˜ }}</span>
                        </div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å‘ç”Ÿæ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-right text-gray-800 font-medium whitespace-nowrap">
                        {{ displayBillingAmount(item.é‡‘é¢) }}
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span 
                          :class="[
                            'status-badge',
                            item.ç»“ç®—çŠ¶æ€ === 'å¾…ç»“ç®—' ? 'status-pending' : 'status-completed'
                          ]"
                        >
                          {{ item.ç»“ç®—çŠ¶æ€ || '--' }}
                        </span>
                      </td>
                      <td 
                        class="px-4 py-3 text-sm whitespace-nowrap"
                        :class="{
                          'text-red-600 font-bold': item.ç»“ç®—çŠ¶æ€ === 'å¾…ç»“ç®—' && item.ä¸‹æ¬¡æé†’æ—¥æœŸ && isReminderDateOverdue(item.ä¸‹æ¬¡æé†’æ—¥æœŸ)
                        }"
                      >
                        {{ item.ä¸‹æ¬¡æé†’æ—¥æœŸ || '--' }}
                      </td>
                      <td class="px-4 py-3 text-center whitespace-nowrap">
                        <button 
                          v-if="item.ç»“ç®—çŠ¶æ€ === 'å¾…ç»“ç®—'"
                          @click="confirmBillingPayment(item)"
                          class="px-3 py-1 bg-yellow-500 hover:bg-yellow-600 rounded text-xs transition text-white whitespace-nowrap"
                        >
                          ğŸ’° ç¡®è®¤å›æ¬¾
                        </button>
                        <span v-else class="text-xs text-gray-400">å·²å®Œæˆ</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredBillingRecord.length }} / {{ billingRecord.length }} æ¡è®°å½•
              </div>
            </div>
          </div>

          <!-- åˆ°è´§ç™»è®° -->
          <div v-if="currentMenu === 'arrival'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">åˆ°è´§ç™»è®°</h2>
                <div class="flex flex-col md:flex-row gap-3 md:items-center">
                  <div class="relative">
                    <input
                      type="text"
                      v-model="searchKeywordArrival"
                      placeholder="æœç´¢ä¾›åº”å•†/æ—¥æœŸ"
                      class="bg-white border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-lg px-10 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none w-64"
                    />
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">ğŸ”</span>
                  </div>
                  <button 
                    @click="openArrivalModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition whitespace-nowrap"
                  >
                    + ç™»è®°åˆ°è´§
                  </button>
                  <button 
                    @click="exportArrivalToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ—¶é—´</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ä¾›åº”å•†åç§°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å®ç‰©æ•°é‡</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å®é™…æ”¶è´§</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">çŠ¶æ€</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å•ä½</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">é€è´§å•å·</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¤‡æ³¨</th>
                      <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 whitespace-nowrap">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredArrivalLog.length === 0" class="border-b border-gray-200">
                      <td colspan="10" class="px-4 py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredArrivalLog" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.æ—¶é—´ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.ä¾›åº”å•†åç§° || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å®ç‰©æ•°é‡ || '--' }}</td>
                      <td class="px-4 py-3 text-sm whitespace-nowrap">
                        <span 
                          v-if="item.actual_qty !== null && item.actual_qty !== undefined"
                          :class="{
                            'font-bold text-red-600': (() => {
                              const physicalQty = Number(item.å®ç‰©æ•°é‡);
                              const actualQty = Number(item.actual_qty);
                              return !isNaN(physicalQty) && !isNaN(actualQty) && physicalQty !== actualQty;
                            })(),
                            'text-gray-800': (() => {
                              const physicalQty = Number(item.å®ç‰©æ•°é‡);
                              const actualQty = Number(item.actual_qty);
                              return isNaN(physicalQty) || isNaN(actualQty) || physicalQty === actualQty;
                            })()
                          }"
                        >
                          {{ item.actual_qty }}
                        </span>
                        <span v-else class="text-gray-800">--</span>
                      </td>
                      <td class="px-4 py-3 text-sm whitespace-nowrap">
                        <span 
                          v-if="item.status === 'å¾…æ”¶è´§'"
                          class="px-2 py-1 bg-gray-200 text-gray-700 rounded text-xs"
                        >
                          å¾…æ”¶è´§
                        </span>
                        <span 
                          v-else-if="item.status === 'å·²å®Œæˆ'"
                          :class="{
                            'px-2 py-1 rounded text-xs': true,
                            'bg-yellow-200 text-yellow-700': (() => {
                              if (item.actual_qty === null || item.actual_qty === undefined) return false;
                              const physicalQty = Number(item.å®ç‰©æ•°é‡);
                              const actualQty = Number(item.actual_qty);
                              return !isNaN(physicalQty) && !isNaN(actualQty) && physicalQty !== actualQty;
                            })(),
                            'bg-green-200 text-green-700': (() => {
                              if (item.actual_qty === null || item.actual_qty === undefined) return true;
                              const physicalQty = Number(item.å®ç‰©æ•°é‡);
                              const actualQty = Number(item.actual_qty);
                              return isNaN(physicalQty) || isNaN(actualQty) || physicalQty === actualQty;
                            })()
                          }"
                        >
                          {{ (() => {
                            if (item.actual_qty === null || item.actual_qty === undefined) return 'å·²å®Œæˆ';
                            const physicalQty = Number(item.å®ç‰©æ•°é‡);
                            const actualQty = Number(item.actual_qty);
                            return (!isNaN(physicalQty) && !isNaN(actualQty) && physicalQty !== actualQty) ? 'æœ‰å·®å¼‚' : 'å·²å®Œæˆ';
                          })() }}
                        </span>
                        <span 
                          v-else
                          class="px-2 py-1 bg-gray-200 text-gray-700 rounded text-xs"
                        >
                          {{ item.status || 'å¾…æ”¶è´§' }}
                        </span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å•ä½ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.é€è´§å•å· || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å¤‡æ³¨ || '--' }}</td>
                      <td class="px-4 py-3 text-center whitespace-nowrap">
                        <div class="flex gap-2 justify-center">
                          <button 
                            v-if="!item.status || item.status === 'å¾…æ”¶è´§'"
                            @click="openArrivalFeedbackModal(index)"
                            class="px-3 py-1 bg-blue-500 hover:bg-blue-600 rounded text-xs transition text-white"
                          >
                            âœ… æ”¶è´§åé¦ˆ
                          </button>
                          <button 
                            v-else-if="item.status === 'å·²å®Œæˆ'"
                            @click="openArrivalFeedbackModal(index)"
                            class="px-3 py-1 bg-white border border-orange-500 text-orange-600 hover:bg-orange-50 rounded text-xs transition"
                          >
                            âœ ä¿®æ”¹åé¦ˆ
                          </button>
                          <button 
                            @click="deleteArrivalRecord(index)"
                            class="px-3 py-1 bg-red-500 hover:bg-red-600 rounded text-xs transition text-white"
                          >
                            åˆ é™¤
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4 text-sm text-gray-500">
                å…± {{ filteredArrivalLog.length }} / {{ arrivalLog.length }} æ¡è®°å½•
              </div>
            </div>
          </div>

          <!-- ä¾›åº”å•†æ”¶è´§ç›‘æ§ -->
         <!-- ä¾›åº”å•†æ”¶è´§ç›‘æ§ (ä¿®å¤å¸ƒå±€ç‰ˆ) -->
<div v-if="currentMenu === 'supplier'" id="supplier-monitoring-view" class="flex flex-col h-full w-full bg-gray-50 overflow-hidden">
  
  <!-- 1. é¡¶éƒ¨æ ‡é¢˜å’Œå·¥å…·æ å®¹å™¨ -->
  <div class="flex-none p-6 space-y-4 bg-white border-b border-gray-200">
    
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <div class="w-full">
      <h2 class="text-2xl font-bold text-gray-800">ä¾›åº”å•†æ”¶è´§ç›‘æ§</h2>
      <p class="text-sm text-gray-500 mt-1">SLA 48 å°æ—¶ Â· å®æ—¶ç›‘æ§æ”¶è´§æ—¶æ•ˆä¸ç§¯å‹æƒ…å†µ</p>
    </div>

    <!-- æ“ä½œå·¥å…·æ  -->
    <div class="flex flex-wrap items-center gap-3">
      <!-- çŠ¶æ€ Tabs -->
      <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg">
        <button
          class="px-3 py-1.5 rounded-md text-sm font-medium transition-all"
          :class="activeReceivingTab === 'ongoing' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'"
          @click="changeReceivingTab('ongoing')"
        >
          è¿›è¡Œä¸­ / æœ‰ç§¯å‹
        </button>
        <button
          class="px-3 py-1.5 rounded-md text-sm font-medium transition-all"
          :class="activeReceivingTab === 'all' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'"
          @click="changeReceivingTab('all')"
        >
          å…¨éƒ¨å†å²
        </button>
      </div>

      <!-- æœç´¢æ¡† -->
      <div class="flex-1 min-w-[200px] relative">
        <input
          type="text"
          v-model="receivingSearchKeyword"
          @input="onReceivingSearchInput"
          placeholder="ğŸ” æœç´¢ä¾›åº”å•†åç§°..."
          class="w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
        />
        <span class="absolute left-3 top-2.5 text-gray-400 text-sm">ğŸ”</span>
      </div>

      <!-- æŒ‰é’®ç»„ -->
      <div class="flex items-center space-x-2">
        <button
          @click="openNewReceivingModal"
          class="flex items-center gap-1 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm"
        >
          <span>+ ç™»è®°å®ç‰©</span>
        </button>
        <button
          @click="exportSupplierReceivingToExcel"
          class="flex items-center gap-1 bg-white border border-green-600 text-green-600 hover:bg-green-50 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
        >
          <span>ğŸ“¤ å¯¼å‡º</span>
        </button>
      </div>
    </div>

    <!-- åŒè¡¨ä¸Šä¼ æ§åˆ¶åŒº (ä¿ç•™äº†ä½ çš„é€»è¾‘) -->
    <div class="w-full flex flex-wrap items-center gap-3 bg-blue-50 p-4 rounded-lg border border-blue-100">
      <div class="text-sm font-bold text-blue-800">ç³»ç»Ÿæ•°æ®å¯¹è´¦ï¼š</div>
      
      <button
        @click="triggerTransactionLogUpload"
        class="flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm"
        :class="transactionLogFile ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'"
      >
        <span v-if="transactionLogFile">âœ… å·²é€‰: æµæ°´è¡¨</span>
        <span v-else>ğŸ“„ 1. ä¸Šä¼ æ”¶è´§æµæ°´è¡¨</span>
      </button>

      <button
        @click="triggerMappingTableUpload"
        class="flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm"
        :class="mappingTableFile ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'"
      >
        <span v-if="mappingTableFile">âœ… å·²é€‰: å…³ç³»è¡¨</span>
        <span v-else>ğŸ”— 2. ä¸Šä¼ ç‰©æ–™å…³ç³»è¡¨</span>
      </button>

      <button
        @click="startMatching"
        class="flex items-center px-6 py-2 rounded-lg text-sm font-bold text-white transition-all shadow-md"
        :disabled="!transactionLogFile || !mappingTableFile"
        :class="(!transactionLogFile || !mappingTableFile) ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 hover:scale-105'"
      >
        ğŸš€ å¼€å§‹åŒ¹é…è®¡ç®—
      </button>
      
      <!-- éšè—çš„æ–‡ä»¶è¾“å…¥æ¡† -->
      <input type="file" ref="transactionLogFileInput" accept=".xlsx,.xls" @change="handleTransactionLogUpload" class="hidden" />
      <input type="file" ref="mappingTableFileInput" accept=".xlsx,.xls" @change="handleMappingTableUpload" class="hidden" />
    </div>
  </div>

  <!-- 2. ç»Ÿè®¡ä¿¡æ¯ -->
  <div class="flex-none px-6 py-2 text-sm text-gray-500 flex justify-between">
    <span>å…± {{ filteredReceivingTasks.length }} ä¸ªåˆ°è´§æ‰¹æ¬¡</span>
    <span>ç¬¬ {{ receivingPage }} / {{ receivingTotalPages || 1 }} é¡µ</span>
  </div>

  <!-- 3. å¡ç‰‡åˆ—è¡¨åŒºåŸŸ (å¯æ»šåŠ¨) -->
  <div class="flex-1 overflow-y-auto p-6 pt-0 space-y-4">
    
    <!-- ç©ºçŠ¶æ€ -->
    <div v-if="filteredReceivingTasks.length === 0" class="flex flex-col items-center justify-center py-20 text-gray-400 border-2 border-dashed border-gray-200 rounded-xl bg-gray-50">
      <p class="text-lg">æš‚æ— æ•°æ®</p>
      <p class="text-sm">è¯·ç‚¹å‡»ä¸Šæ–¹â€œç™»è®°å®ç‰©â€å¼€å§‹</p>
    </div>

    <!-- å¡ç‰‡å¾ªç¯ -->
    <div
      v-for="(task, index) in pagedReceivingTasks"
      :key="index"
      class="bg-white border border-gray-200 rounded-xl shadow-sm p-5 hover:shadow-md transition-shadow duration-200"
    >
      <div class="flex flex-col md:flex-row gap-6 items-center">
        
        <!-- å·¦ä¾§ï¼šå®ç‰©ä¿¡æ¯ -->
        <div class="flex-1 w-full">
          <div class="flex items-center gap-3">
            <h3 class="text-lg font-bold text-gray-900">{{ task.supplier_cn || 'æœªçŸ¥ä¾›åº”å•†' }}</h3>
            <span v-if="task.supplier_en" class="px-2 py-0.5 bg-gray-100 text-gray-500 text-xs rounded">{{ task.supplier_en }}</span>
          </div>
          <div class="mt-2 flex items-center gap-4 text-sm text-gray-600">
            <span class="flex items-center gap-1 bg-orange-50 text-orange-700 px-2 py-1 rounded border border-orange-100">
              ğŸ“¦ å®ç‰©: <strong>{{ task.physical_qty || 0 }}</strong> {{ task.unit || 'ä»¶' }}
            </span>
            <span class="text-gray-300">|</span>
            <span>ğŸ“… {{ task.date }}</span>
          </div>
        </div>

        <!-- ä¸­é—´ï¼šç³»ç»Ÿæ•°æ® (å·²ç§»é™¤è¾“å…¥æ¡†ï¼Œæ”¹ä¸ºçº¯å±•ç¤º) -->
        <div class="flex-1 w-full">
          <div class="flex justify-between items-end mb-2">
            <span class="text-sm font-medium text-gray-500">ç³»ç»Ÿæ•°æ®æ ¸å¯¹</span>
            <span v-if="task.system_lines > 0" class="text-sm font-bold text-blue-600">
              å·²åŒ¹é…: {{ task.system_lines }} æ¡
            </span>
            <span v-else class="text-xs text-red-400 bg-red-50 px-2 py-1 rounded">
              â³ ç­‰å¾…æŠ¥è¡¨ä¸Šä¼ ...
            </span>
          </div>
          <!-- è¿›åº¦æ¡ï¼šåªæœ‰å½“ç³»ç»Ÿæœ‰æ•°æ®æ—¶æ‰æ˜¾ç¤ºæœ‰æ•ˆè¿›åº¦ -->
          <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden">
            <div 
              class="h-full rounded-full transition-all duration-1000"
              :class="task.system_lines > 0 ? 'bg-blue-500' : 'bg-gray-300'"
              :style="{ width: task.system_lines > 0 ? '100%' : '0%' }"
            ></div>
          </div>
        </div>

        <!-- å³ä¾§ï¼šçŠ¶æ€ä¸æ“ä½œ (ç§»é™¤äº†æ›´æ–°æŒ‰é’®) -->
        <div class="flex flex-row md:flex-col items-center md:items-end justify-between w-full md:w-auto gap-2">
          <!-- çŠ¶æ€æ˜¾ç¤º -->
          <div v-if="task.status === 'è¶…æ—¶' || (task.is_overdue)" class="text-right">
            <div class="text-red-600 font-bold">å·²è¶…æ—¶</div>
            <div class="text-xs text-red-400">SLA 48h</div>
          </div>
          <div v-else-if="task.system_lines > 0" class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-bold">
            æ­£å¸¸è¿›è¡Œä¸­
          </div>
          <div v-else class="px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-xs">
            å¾…å¯¹è´¦
          </div>

          <!-- ä»…ä¿ç•™è¯¦æƒ…æŒ‰é’® -->
          <button class="text-sm text-gray-500 hover:text-blue-600 hover:underline transition-colors">
            æŸ¥çœ‹è¯¦æƒ…
          </button>
        </div>

      </div>
    </div>
  </div>
</div>

          <!-- ç»è¥æŠ¥è¡¨ BI Dashboard -->
          <div v-if="currentMenu === 'bi'" class="h-full overflow-auto">
            <div class="p-6 space-y-6">
              <!-- ç¬¬ä¸€å±‚ï¼šKPI æ ¸å¿ƒæŒ‡æ ‡å¡ -->
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6 hover:shadow-lg transition">
                  <div class="text-sm text-gray-500 mb-2">å½“æœˆäº§é‡</div>
                  <div class="text-3xl font-bold text-gray-900">{{ formatNumber(biData.kpi.monthlyProduction) }}</div>
                  <div class="text-xs text-gray-400 mt-2">è¾ƒä¸Šæœˆ â†‘ 12.5%</div>
                </div>
                <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6 hover:shadow-lg transition">
                  <div class="text-sm text-gray-500 mb-2">å¹³å‡ DPMO</div>
                  <div class="text-3xl font-bold text-blue-600">{{ biData.kpi.avgDPMO }}</div>
                  <div class="text-xs text-gray-400 mt-2">ç›®æ ‡å€¼: 80</div>
                </div>
                <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6 hover:shadow-lg transition">
                  <div class="text-sm text-gray-500 mb-2">æ”¶è´§å‡†æ—¶ç‡</div>
                  <div class="text-3xl font-bold text-green-600">{{ biData.kpi.receivingOnTimeRate }}%</div>
                  <div class="text-xs text-gray-400 mt-2">è¾ƒä¸Šæœˆ â†‘ 0.3%</div>
                </div>
                <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6 hover:shadow-lg transition">
                  <div class="text-sm text-gray-500 mb-2">æœ¬æœˆä¾›åº”å•†å¼‚å¸¸æ•°</div>
                  <div class="text-3xl font-bold text-orange-600">{{ biData.kpi.supplierIssues }}</div>
                  <div class="text-xs text-gray-400 mt-2">è¾ƒä¸Šæœˆ â†“ 8</div>
                </div>
              </div>

              <!-- ç¬¬äºŒå±‚å’Œç¬¬ä¸‰å±‚ï¼šå›¾è¡¨åŒºåŸŸ -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- å·¦ä¾§ï¼šè´¨é‡æ§åˆ¶ -->
                <div class="space-y-6">
                  <!-- å›¾è¡¨1ï¼šäº§é‡ä¸ç¼ºé™·ç‡è¶‹åŠ¿å›¾ -->
                  <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">äº§é‡ä¸ç¼ºé™·ç‡è¶‹åŠ¿å›¾</h3>
                    <div ref="chart1" style="width: 100%; height: 350px;"></div>
                  </div>
                  
                  <!-- å›¾è¡¨2ï¼šæ”¶å‘è´§ç¼ºé™·åˆ†å¸ƒ -->
                  <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">æ”¶å‘è´§ç¼ºé™·åˆ†å¸ƒ</h3>
                    <div ref="chart2" style="width: 100%; height: 350px;"></div>
                  </div>
                </div>

                <!-- å³ä¾§ï¼šç‰©æµæ•ˆèƒ½ -->
                <div class="space-y-6">
                  <!-- å›¾è¡¨3ï¼šæ”¶å‘è´§åŠæ—¶æ€§å¯¹æ¯” -->
                  <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">æ”¶å‘è´§åŠæ—¶æ€§å¯¹æ¯”</h3>
                    <div ref="chart3" style="width: 100%; height: 350px;"></div>
                  </div>
                  
                  <!-- å›¾è¡¨4ï¼šä¾›åº”å•†é—®é¢˜åˆ†å¸ƒ -->
                  <div class="bg-white rounded-xl border border-gray-200 shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ä¾›åº”å•†é—®é¢˜åˆ†å¸ƒ</h3>
                    <div ref="chart4" style="width: 100%; height: 350px;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ç¼ºé™·ç®¡ç† -->
          <div v-if="currentMenu === 'defect'" class="h-full">
            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                <h2 class="text-lg font-semibold text-gray-800">ç¼ºé™·ç®¡ç†åˆ—è¡¨</h2>
              <div class="flex flex-wrap gap-3 items-center">
                <!-- æŒ‰æœˆä»½ç­›é€‰ -->
                <div class="flex items-center gap-2">
                  <label class="text-xs text-gray-600 whitespace-nowrap">æœˆä»½ï¼š</label>
                  <input
                    type="month"
                    v-model="defectFilterMonth"
                    class="border border-gray-300 rounded-lg px-2 py-1 text-xs text-gray-800 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>
                <!-- æŒ‰ç±»å‹ç­›é€‰ -->
                <div class="flex items-center gap-2">
                  <label class="text-xs text-gray-600 whitespace-nowrap">ç±»å‹ï¼š</label>
                  <select
                    v-model="defectFilterType"
                    class="border border-gray-300 rounded-lg px-2 py-1 text-xs text-gray-800 bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option value="">å…¨éƒ¨</option>
                    <option value="Bç±»">Bç±»</option>
                    <option value="Cç±»">Cç±»</option>
                  </select>
                </div>
                  <button
                    @click="openDefectModal"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm font-semibold text-white transition"
                  >
                    + ç™»è®°ç¼ºé™·
                  </button>
                  <button
                    @click="triggerExcelImport"
                    class="px-4 py-2 bg-white hover:bg-gray-50 border border-gray-300 rounded-lg text-sm font-semibold text-gray-700 transition"
                  >
                    ğŸ“¥ å¯¼å…¥ Excel
                  </button>
                  <button
                    @click="exportDefectsToExcel"
                    class="px-4 py-2 bg-white border border-green-500 text-green-600 hover:bg-green-50 rounded-lg text-sm font-semibold transition whitespace-nowrap"
                  >
                    ğŸ“¤ å¯¼å‡º Excel
                  </button>
                  <input
                    type="file"
                    ref="excelFileInput"
                    accept=".xlsx,.xls"
                    @change="handleExcelImport"
                    style="display: none;"
                  />
                  <button 
                    @click="refreshData"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition text-white"
                  >
                    åˆ·æ–°
                  </button>
                </div>
              </div>
              
              <div class="table-container">
                <table class="w-full">
                  <thead class="bg-gray-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å‘ç°æ—¥æœŸ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç±»å‹</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">ç§ç±»</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">æ˜¯å¦æŒ‰ç¯</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">äº§å“</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">é—®é¢˜æè¿°</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å‘ç°äºº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è´£ä»»äºº</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">åŸå› </th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">è§£å†³æ–¹æ¡ˆ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">5WHYåˆ†æ</th>
                      <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">å¤‡æ³¨</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-if="filteredDefectList.length === 0" class="border-b border-gray-200">
                      <td colspan="12" class="px-4 py-8 text-center text-gray-500">æš‚æ— ç¼ºé™·è®°å½•</td>
                    </tr>
                    <tr 
                      v-else
                      v-for="(item, index) in filteredDefectList" 
                      :key="index"
                      class="border-b border-gray-200 hover:bg-gray-50 transition"
                    >
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å‘ç°æ—¥æœŸ || '--' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span 
                          :class="[
                            'status-badge',
                            item.ç±»å‹ === 'Bç±»' ? 'bg-yellow-50 text-yellow-700 border border-yellow-200' : 'bg-blue-50 text-blue-700 border border-blue-200'
                          ]"
                        >
                          {{ item.ç±»å‹ || '--' }}
                        </span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.ç§ç±» || '--' }}</td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <span v-if="item.æ˜¯å¦æŒ‰ç¯" class="text-red-600 text-lg">âš ï¸</span>
                        <span v-else class="text-gray-400 text-lg">â—‹</span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.äº§å“ || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800" :title="item.é—®é¢˜æè¿°">
                        <div class="max-w-xs truncate">{{ item.é—®é¢˜æè¿° || '--' }}</div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.å‘ç°äºº || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800 whitespace-nowrap">{{ item.è´£ä»»äºº || '--' }}</td>
                      <td class="px-4 py-3 text-sm text-gray-800" :title="item.åŸå› ">
                        <div class="max-w-xs truncate">{{ item.åŸå›  || '--' }}</div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800" :title="item.è§£å†³æ–¹æ¡ˆ">
                        <div class="max-w-xs truncate">{{ item.è§£å†³æ–¹æ¡ˆ || '--' }}</div>
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap">
                        <a 
                          v-if="get5WhyFile(item)" 
                          href="#" 
                          @click.prevent="view5WhyReport(get5WhyFile(item))"
                          class="text-blue-600 hover:text-blue-800 text-sm underline"
                        >
                          ğŸ“æŸ¥çœ‹æŠ¥å‘Š
                        </a>
                        <span v-else class="text-gray-400">--</span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-800" :title="item.å¤‡æ³¨">
                        <div class="max-w-xs truncate">{{ item.å¤‡æ³¨ || '--' }}</div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <div class="mt-4 text-sm text-gray-500">
                <span>æ€»è®¡ï¼š{{ defectList.length }} æ¡</span>
                <span v-if="filteredDefectList.length !== defectList.length" class="ml-3 text-blue-600">
                  å½“å‰ç­›é€‰ï¼š{{ filteredDefectList.length }} æ¡
                </span>
              </div>
            </div>
          </div>

          <!-- å·¥å•é…æ–™ç®¡ç† -->
          <div v-if="currentMenu === 'picking'" class="h-full overflow-auto">
            <div class="p-6 space-y-6">
              <!-- é¡¶éƒ¨æ“ä½œåŒº -->
              <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                <div class="flex flex-col md:flex-row gap-4 items-center">
                  <!-- ä¸Šä¼ ç”Ÿäº§è®¡åˆ’è¡¨ -->
                  <div class="flex-1 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-orange-500 transition cursor-pointer bg-gray-50">
                    <input
                      type="file"
                      ref="planFileInput"
                      accept=".xlsx,.xls"
                      @change="handlePlanFileUpload"
                      class="hidden"
                    />
                    <div @click="triggerPlanFileUpload" class="cursor-pointer">
                      <div class="text-2xl mb-2">ğŸ“¤</div>
                      <div class="text-sm font-semibold text-gray-700 mb-1">ä¸Šä¼ ç”Ÿäº§è®¡åˆ’è¡¨</div>
                      <div class="text-xs text-gray-500">å·¥å•å·, OP, äº§å“æè¿°, å°å¥—</div>
                      <div v-if="planData.length > 0" class="text-xs text-green-600 mt-2">
                        âœ… å·²åŠ è½½ {{ planData.length }} æ¡è®°å½•
                      </div>
                    </div>
                  </div>
                  
                  <!-- ä¸Šä¼  GE BOMæºè¡¨ -->
                  <div class="flex-1 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition cursor-pointer bg-gray-50">
                    <input
                      type="file"
                      ref="bomFileInput"
                      accept=".xlsx,.xls"
                      @change="handleBomFileUpload"
                      class="hidden"
                    />
                    <div @click="triggerBomFileUpload" class="cursor-pointer">
                      <div class="text-2xl mb-2">ğŸ“¤</div>
                      <div class="text-sm font-semibold text-gray-700 mb-1">ä¸Šä¼  GE BOMæºè¡¨</div>
                      <div class="text-xs text-gray-500">Job, OP, Component, PENDING_LOCATOR, Required</div>
                      <div v-if="bomData.length > 0" class="text-xs text-green-600 mt-2">
                        âœ… å·²åŠ è½½ {{ bomData.length }} æ¡è®°å½•
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- çŠ¶æ€æç¤º -->
                <div class="mt-4 text-center">
                  <div v-if="planData.length === 0 && bomData.length === 0" class="text-sm text-gray-500">
                    ç­‰å¾…ä¸Šä¼ ...
                  </div>
                  <div v-else-if="matchedWorkOrders.length > 0" class="text-sm text-green-600 font-semibold">
                    âœ… å·²åŒ¹é… {{ matchedWorkOrders.length }} ä¸ªå·¥å•
                  </div>
                  <div v-else class="text-sm text-orange-600">
                    âš ï¸ è¯·ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶ä»¥è¿›è¡ŒåŒ¹é…
                  </div>
                </div>
              </div>

              <!-- æ ¸å¿ƒäº¤äº’åŒº -->
              <div v-if="matchedWorkOrders.length > 0" class="flex gap-6">
                <!-- å·¦ä¾§ï¼šå·¥å•åˆ—è¡¨ (30%) -->
                <div class="w-[30%] bg-white rounded-lg border border-gray-200 shadow-sm">
                  <div class="p-4 border-b border-gray-200">
                    <div class="space-y-3">
                      <div class="flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-800">å·¥å•åˆ—è¡¨</h3>
                        <div class="flex flex-col items-end leading-tight">
                          <span class="text-xs text-gray-500">
                            æ€»è®¡ï¼š{{ matchedWorkOrders.length }} æ¡
                          </span>
                          <span class="text-[11px] text-blue-600" v-if="pickingFilteredAndSortedWorkOrders.length !== matchedWorkOrders.length">
                            å·²æŒ‰æ¡ä»¶ç­›é€‰ï¼š{{ pickingFilteredAndSortedWorkOrders.length }} æ¡
                          </span>
                          <span class="text-[11px] text-gray-400" v-else>
                            å½“å‰æ˜¾ç¤ºå…¨éƒ¨å·¥å•
                          </span>
                        </div>
                      </div>
                      <!-- æŒ‰æ—¥æœŸç­›é€‰ï¼ˆä½¿ç”¨æ—¥æœŸï¼‰ -->
                      <div class="flex items-center gap-2">
                        <label class="text-xs text-gray-600 whitespace-nowrap">ä½¿ç”¨æ—¥æœŸï¼š</label>
                        <input
                          type="date"
                          v-model="pickingSearchDate"
                          class="flex-1 border border-gray-300 rounded-md px-2 py-1 text-xs text-gray-800 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                        />
                        <button
                          type="button"
                          class="px-2 py-1 text-[11px] border border-gray-300 rounded-md text-gray-600 hover:bg-gray-50"
                          @click="pickingSearchDate = ''"
                        >
                          æ¸…ç©º
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="max-h-[calc(100vh-300px)] overflow-y-auto">
                    <div
                      v-for="(workOrder, index) in pickingFilteredAndSortedWorkOrders"
                      :key="index"
                      @click="selectWorkOrder(index)"
                      :class="[
                        'p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition',
                        selectedWorkOrderIndex === index ? 'bg-blue-50 border-l-4 border-l-blue-500' : ''
                      ]"
                    >
                      <div class="text-sm font-semibold text-gray-900">
                        {{ workOrder['å·¥å•å·'] || workOrder.work_order || workOrder.å·¥å•å· }}
                      </div>
                      <div class="text-xs text-gray-600 mt-1">
                        {{ workOrder['äº§å“æè¿°'] || workOrder.description || workOrder.äº§å“æè¿° }}
                      </div>
                      <div class="text-xs text-gray-500 mt-1">
                        OP{{ workOrder['OP'] || workOrder.op || workOrder.OP }} Â· åŠ å·¥åºåˆ—å·: {{ workOrder['åŠ å·¥åºåˆ—å·'] || workOrder.seq_no || workOrder.åŠ å·¥åºåˆ—å· || workOrder['å°å¥—'] || workOrder.å°å¥— || '--' }}
                      </div>
                      <div v-if="(workOrder['äº§å“æè¿°'] || workOrder.description || workOrder.äº§å“æè¿° || '').toLowerCase().includes('pitch')" class="text-xs text-blue-600 mt-1 flex items-center gap-1">
                        ğŸ•’ åˆ°è¾¾æ—¶é—´: {{ workOrder.arrival_time || workOrder['åˆ°è¾¾æ—¶é—´'] || workOrder['arrival_time'] || '--' }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- å³ä¾§ï¼šè¯¦æƒ…/æ‰“å°åŒº (70%) -->
                <div class="flex-1 bg-white rounded-lg border border-gray-200 shadow-sm p-6">
                  <div v-if="selectedWorkOrder" class="print-area">
                    <!-- æ‰“å°æŒ‰é’® -->
                    <div class="flex justify-end mb-4 print:hidden">
                      <button
                        @click="printWorkOrder"
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition"
                      >
                        ğŸ–¨ï¸ æ‰“å°å½“å‰å•æ®
                      </button>
                    </div>
                    
                    <!-- A4 å•æ®æ ·å¼ -->
                    <div class="a4-page bg-white shadow-lg p-8">
                      <!-- Pitch äº§å“ï¼šç‰¹æ®Šæ¨¡æ¿ï¼ˆä¸æ˜¾ç¤ºå¤§æ ‡é¢˜ï¼ŒæŒ‰å™¨å…·åˆ†ç»„ï¼‰ -->
                      <template v-if="isPitchProduct">
                        <div class="mb-6">
                          <div class="space-y-1 text-sm text-gray-700 mb-4">
                            <div><span class="font-semibold">å·¥å•å·ï¼š</span>{{ selectedWorkOrder['å·¥å•å·'] || selectedWorkOrder.work_order || selectedWorkOrder.å·¥å•å· }}</div>
                            <div><span class="font-semibold">åˆ°è¾¾æ—¶é—´ï¼š</span>{{ selectedWorkOrder.arrival_time || selectedWorkOrder['åˆ°è¾¾æ—¶é—´'] || selectedWorkOrder['arrival_time'] || '--' }}</div>
                            <div><span class="font-semibold">æ‰“å°æ—¶é—´ï¼š</span>{{ printTime || '--' }}</div>
                            <div><span class="font-semibold">äº§å“ï¼š</span>{{ selectedWorkOrder['äº§å“æè¿°'] || selectedWorkOrder.description || selectedWorkOrder.äº§å“æè¿° }}</div>
                            <div><span class="font-semibold">OPï¼š</span>{{ selectedWorkOrder['OP'] || selectedWorkOrder.op || selectedWorkOrder.OP }}</div>
                          </div>
                        </div>

                        <!-- ECO è­¦ç¤ºè¯­ï¼ˆå¦‚æœæœ‰ECOå˜æ›´ï¼‰ -->
                        <div v-if="selectedWorkOrder.hasEco" class="mb-4 p-3 bg-red-50 border-l-4 border-red-500 rounded print:bg-white print:border-red-900 print:border-2">
                          <div class="flex items-center text-red-700 font-semibold print:text-black print:font-bold">
                            <span class="text-lg mr-2">âš ï¸</span>
                            <span>æ³¨æ„ï¼šæœ¬å•åŒ…å« ECO å˜æ›´ï¼Œè¯·æ ¸å¯¹ç‰©æ–™ï¼</span>
                          </div>
                        </div>

                        <!-- Pitch äº§å“ï¼šæŒ‰ tool_type åˆ†ç»„æ˜¾ç¤ºå¤šä¸ªè¡¨æ ¼ -->
                        <template v-if="groupedMaterialsByToolType.length > 0">
                          <div
                            v-for="(group, groupIdx) in groupedMaterialsByToolType"
                            :key="groupIdx"
                            class="mb-8 print:page-break-before-always print:break-before-page"
                            :style="groupIdx > 0 ? 'page-break-before: always;' : ''"
                          >
                            <div class="mb-3 text-lg font-bold text-gray-900 print:text-black">
                              å™¨å…·: {{ group.toolType || 'æœªåˆ†ç±»' }}
                            </div>
                            <table class="w-full border-collapse border border-gray-300 text-sm">
                              <thead>
                                <tr class="bg-gray-100">
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">åºå·</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">ç‰©æ–™å·</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">åº“ä½</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">æ•°é‡</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">ECOå˜æ›´</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">å¤‡æ³¨</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr
                                  v-for="(material, idx) in group.materials"
                                  :key="idx"
                                  :class="[
                                    'hover:bg-gray-50',
                                    material.ecoInfo && material.ecoInfo.ecoNo ? 'bg-red-50 print:bg-white' : ''
                                  ]"
                                >
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ idx + 1 }}</td>
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900 font-semibold">{{ material['Component'] || material.Component || '--' }}</td>
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['PENDING_LOCATOR'] || material.PENDING_LOCATOR || '--' }}</td>
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['Required'] || material.Required || '--' }}</td>
                                  <td class="border border-gray-300 px-3 py-2">
                                    <div v-if="material.ecoInfo && material.ecoInfo.ecoNo" class="text-red-600 print:text-black">
                                      <div class="font-bold">
                                        <span v-if="material.ecoInfo.matchedCount > 1" class="text-xs text-orange-600 mr-1">[{{ material.ecoInfo.matchedCount }}æ¡]</span>
                                        <template v-if="material.ecoInfo.ecoNos && material.ecoInfo.ecoNos.length > 1">
                                          <span v-for="(ecoNo, idx) in material.ecoInfo.ecoNos" :key="idx">
                                            ECO-{{ ecoNo }}<span v-if="idx < material.ecoInfo.ecoNos.length - 1">, </span>
                                          </span>
                                        </template>
                                        <span v-else>ECO-{{ material.ecoInfo.ecoNo }}</span>
                                      </div>
                                      <div v-if="material.ecoInfo.changeDetails" class="text-xs mt-1 font-normal">
                                        {{ material.ecoInfo.changeDetails }}
                                      </div>
                                    </div>
                                    <span v-else class="text-gray-400">--</span>
                                  </td>
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['å¤‡æ³¨'] || material.å¤‡æ³¨ || '--' }}</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </template>
                        <div v-else class="text-center text-gray-500 py-8">
                          æš‚æ— ç‰©æ–™æ˜ç»†
                        </div>
                      </template>

                      <!-- SA14 äº§å“ï¼šç‰¹æ®Šæ¨¡æ¿ï¼ˆæ˜¾ç¤ºå™¨å…·ï¼ŒæŒ‰å™¨å…·åˆ†ç»„ï¼‰ -->
                      <template v-else-if="isSA14Product">
                      <!-- å•æ®å¤´éƒ¨ -->
                      <div class="mb-6">
                        <div class="flex justify-between items-start mb-4">
                          <div>
                            <h2 class="text-xl font-bold text-gray-900 mb-2">å·¥å•é…æ–™å•</h2>
                            <div class="space-y-1 text-sm text-gray-700">
                              <div><span class="font-semibold">å·¥å•å·ï¼š</span>{{ selectedWorkOrder['å·¥å•å·'] || selectedWorkOrder.work_order || selectedWorkOrder.å·¥å•å· }}</div>
                              <div><span class="font-semibold">ä½¿ç”¨æ—¶é—´ï¼š</span>{{ selectedWorkOrder['ä½¿ç”¨æ—¥æœŸ'] || selectedWorkOrder.arrival_date || selectedWorkOrder.åˆ°è¾¾æ—¥æœŸ || selectedWorkOrder.ä½¿ç”¨æ—¥æœŸ || '--' }}</div>
                              <div><span class="font-semibold">æ‰“å°æ—¶é—´ï¼š</span>{{ printTime || '--' }}</div>
                              <!-- ECO è­¦ç¤ºè¯­ï¼ˆæ‰“å°æ—¶æ˜¾ç¤ºï¼‰ -->
                              <div v-if="selectedWorkOrder.hasEco" class="mt-2 p-2 bg-red-50 border border-red-300 rounded print:bg-white print:border-red-900">
                                <span class="font-bold text-red-600 print:text-red-900 print:font-bold">âš ï¸ æ³¨æ„ï¼šæœ¬å•åŒ…å« ECO å˜æ›´ï¼Œè¯·æ ¸å¯¹ç‰©æ–™ï¼</span>
                              </div>
                              <div><span class="font-semibold">äº§å“ï¼š</span>{{ selectedWorkOrder['äº§å“æè¿°'] || selectedWorkOrder.description || selectedWorkOrder.äº§å“æè¿° }}</div>
                              <div><span class="font-semibold">åŠ å·¥åºåˆ—å·ï¼š</span>{{ selectedWorkOrder['åŠ å·¥åºåˆ—å·'] || selectedWorkOrder.seq_no || selectedWorkOrder.åŠ å·¥åºåˆ—å· || selectedWorkOrder['å°å¥—'] || selectedWorkOrder.å°å¥— || '--' }}</div>
                              <div><span class="font-semibold">OPï¼š</span>{{ selectedWorkOrder['OP'] || selectedWorkOrder.op || selectedWorkOrder.OP }}</div>
                              <div><span class="font-semibold">ä»“åº“ï¼š</span>SUN</div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- ECO è­¦ç¤ºè¯­ï¼ˆå¦‚æœæœ‰ECOå˜æ›´ï¼‰ -->
                      <div v-if="selectedWorkOrder.hasEco" class="mb-4 p-3 bg-red-50 border-l-4 border-red-500 rounded print:bg-white print:border-red-900 print:border-2">
                        <div class="flex items-center text-red-700 font-semibold print:text-black print:font-bold">
                          <span class="text-lg mr-2">âš ï¸</span>
                          <span>æ³¨æ„ï¼šæœ¬å•åŒ…å« ECO å˜æ›´ï¼Œè¯·æ ¸å¯¹ç‰©æ–™ï¼</span>
                        </div>
                      </div>

                        <!-- SA14 äº§å“ï¼šæŒ‰ tool_type åˆ†ç»„æ˜¾ç¤ºå¤šä¸ªè¡¨æ ¼ -->
                        <template v-if="groupedMaterialsByToolType.length > 0">
                          <div
                            v-for="(group, groupIdx) in groupedMaterialsByToolType"
                            :key="groupIdx"
                            class="mb-8 print:page-break-before-always print:break-before-page"
                            :style="groupIdx > 0 ? 'page-break-before: always;' : ''"
                          >
                            <div class="mb-3 text-lg font-bold text-gray-900 print:text-black">
                              [{{ selectedWorkOrder['äº§å“æè¿°'] || selectedWorkOrder.description || selectedWorkOrder.äº§å“æè¿° }}] - {{ group.toolType || 'æœªåˆ†ç±»' }}
                            </div>
                            <table class="w-full border-collapse border border-gray-300 text-sm">
                              <thead>
                                <tr class="bg-gray-100">
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">åºå·</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">ç‰©æ–™å·</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">åº“ä½</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">æ•°é‡</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">ECOå˜æ›´</th>
                                  <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">å¤‡æ³¨</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr
                                  v-for="(material, idx) in group.materials"
                                  :key="idx"
                                  :class="[
                                    'hover:bg-gray-50',
                                    material.ecoInfo && material.ecoInfo.ecoNo ? 'bg-red-50 print:bg-white' : ''
                                  ]"
                                >
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ idx + 1 }}</td>
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900 font-semibold">{{ material['Component'] || material.Component || '--' }}</td>
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['PENDING_LOCATOR'] || material.PENDING_LOCATOR || '--' }}</td>
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['Required'] || material.Required || '--' }}</td>
                                  <td class="border border-gray-300 px-3 py-2">
                                    <div v-if="material.ecoInfo && material.ecoInfo.ecoNo" class="text-red-600 print:text-black">
                                      <div class="font-bold">
                                        <span v-if="material.ecoInfo.matchedCount > 1" class="text-xs text-orange-600 mr-1">[{{ material.ecoInfo.matchedCount }}æ¡]</span>
                                        <template v-if="material.ecoInfo.ecoNos && material.ecoInfo.ecoNos.length > 1">
                                          <span v-for="(ecoNo, idx) in material.ecoInfo.ecoNos" :key="idx">
                                            ECO-{{ ecoNo }}<span v-if="idx < material.ecoInfo.ecoNos.length - 1">, </span>
                                          </span>
                                        </template>
                                        <span v-else>ECO-{{ material.ecoInfo.ecoNo }}</span>
                                      </div>
                                      <div v-if="material.ecoInfo.changeDetails" class="text-xs mt-1 font-normal">
                                        {{ material.ecoInfo.changeDetails }}
                                      </div>
                                    </div>
                                    <span v-else class="text-gray-400">--</span>
                                  </td>
                                  <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['å¤‡æ³¨'] || material.å¤‡æ³¨ || '--' }}</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </template>
                        <div v-else class="text-center text-gray-500 py-8">
                          æš‚æ— ç‰©æ–™æ˜ç»†
                        </div>
                      </template>

                      <!-- é»˜è®¤æ¨¡æ¿ï¼šå•è¡¨æ ¼æ˜¾ç¤º -->
                      <template v-else>
                        <!-- å•æ®å¤´éƒ¨ -->
                        <div class="mb-6">
                          <div class="flex justify-between items-start mb-4">
                            <div>
                              <h2 class="text-xl font-bold text-gray-900 mb-2">å·¥å•é…æ–™å•</h2>
                              <div class="space-y-1 text-sm text-gray-700">
                                <div><span class="font-semibold">å·¥å•å·ï¼š</span>{{ selectedWorkOrder['å·¥å•å·'] || selectedWorkOrder.work_order || selectedWorkOrder.å·¥å•å· }}</div>
                                <div><span class="font-semibold">ä½¿ç”¨æ—¶é—´ï¼š</span>{{ selectedWorkOrder['ä½¿ç”¨æ—¥æœŸ'] || selectedWorkOrder.arrival_date || selectedWorkOrder.åˆ°è¾¾æ—¥æœŸ || selectedWorkOrder.ä½¿ç”¨æ—¥æœŸ || '--' }}</div>
                                <div><span class="font-semibold">æ‰“å°æ—¶é—´ï¼š</span>{{ printTime || '--' }}</div>
                                <!-- ECO è­¦ç¤ºè¯­ï¼ˆæ‰“å°æ—¶æ˜¾ç¤ºï¼‰ -->
                                <div v-if="selectedWorkOrder.hasEco" class="mt-2 p-2 bg-red-50 border border-red-300 rounded print:bg-white print:border-red-900">
                                  <span class="font-bold text-red-600 print:text-red-900 print:font-bold">âš ï¸ æ³¨æ„ï¼šæœ¬å•åŒ…å« ECO å˜æ›´ï¼Œè¯·æ ¸å¯¹ç‰©æ–™ï¼</span>
                                </div>
                                <div><span class="font-semibold">äº§å“ï¼š</span>{{ selectedWorkOrder['äº§å“æè¿°'] || selectedWorkOrder.description || selectedWorkOrder.äº§å“æè¿° }}</div>
                                <div><span class="font-semibold">åŠ å·¥åºåˆ—å·ï¼š</span>{{ selectedWorkOrder['åŠ å·¥åºåˆ—å·'] || selectedWorkOrder.seq_no || selectedWorkOrder.åŠ å·¥åºåˆ—å· || selectedWorkOrder['å°å¥—'] || selectedWorkOrder.å°å¥— || '--' }}</div>
                                <div><span class="font-semibold">OPï¼š</span>{{ selectedWorkOrder['OP'] || selectedWorkOrder.op || selectedWorkOrder.OP }}</div>
                                <div><span class="font-semibold">ä»“åº“ï¼š</span>SUN</div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- ECO è­¦ç¤ºè¯­ï¼ˆå¦‚æœæœ‰ECOå˜æ›´ï¼‰ -->
                        <div v-if="selectedWorkOrder.hasEco" class="mb-4 p-3 bg-red-50 border-l-4 border-red-500 rounded print:bg-white print:border-red-900 print:border-2">
                          <div class="flex items-center text-red-700 font-semibold print:text-black print:font-bold">
                            <span class="text-lg mr-2">âš ï¸</span>
                            <span>æ³¨æ„ï¼šæœ¬å•åŒ…å« ECO å˜æ›´ï¼Œè¯·æ ¸å¯¹ç‰©æ–™ï¼</span>
                          </div>
                        </div>

                        <!-- é»˜è®¤äº§å“ï¼šå•è¡¨æ ¼æ˜¾ç¤º -->
                      <table class="w-full border-collapse border border-gray-300 text-sm">
                        <thead>
                          <tr class="bg-gray-100">
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">åºå·</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">ç‰©æ–™å·</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">åº“ä½</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">æ•°é‡</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">ECOå˜æ›´</th>
                            <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-gray-900">å¤‡æ³¨</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-if="!selectedWorkOrder.materials || selectedWorkOrder.materials.length === 0">
                            <td colspan="6" class="border border-gray-300 px-3 py-4 text-center text-gray-500">
                              æš‚æ— ç‰©æ–™æ˜ç»†
                            </td>
                          </tr>
                          <tr
                            v-else
                            v-for="(material, idx) in sortedMaterials"
                            :key="idx"
                            :class="[
                              'hover:bg-gray-50',
                              material.ecoInfo && material.ecoInfo.ecoNo ? 'bg-red-50 print:bg-white' : ''
                            ]"
                          >
                            <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ idx + 1 }}</td>
                            <td class="border border-gray-300 px-3 py-2 text-gray-900 font-semibold">{{ material['Component'] || material.Component || '--' }}</td>
                            <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['PENDING_LOCATOR'] || material.PENDING_LOCATOR || '--' }}</td>
                            <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['Required'] || material.Required || '--' }}</td>
                            <td class="border border-gray-300 px-3 py-2">
                              <div v-if="material.ecoInfo && material.ecoInfo.ecoNo" class="text-red-600 print:text-black">
                                <div class="font-bold">
                                  <span v-if="material.ecoInfo.matchedCount > 1" class="text-xs text-orange-600 mr-1">[{{ material.ecoInfo.matchedCount }}æ¡]</span>
                                  <template v-if="material.ecoInfo.ecoNos && material.ecoInfo.ecoNos.length > 1">
                                    <span v-for="(ecoNo, idx) in material.ecoInfo.ecoNos" :key="idx">
                                      ECO-{{ ecoNo }}<span v-if="idx < material.ecoInfo.ecoNos.length - 1">, </span>
                                    </span>
                                  </template>
                                  <span v-else>ECO-{{ material.ecoInfo.ecoNo }}</span>
                                </div>
                                <div v-if="material.ecoInfo.changeDetails" class="text-xs mt-1 font-normal">
                                  {{ material.ecoInfo.changeDetails }}
                                </div>
                              </div>
                              <span v-else class="text-gray-400">--</span>
                            </td>
                            <td class="border border-gray-300 px-3 py-2 text-gray-900">{{ material['å¤‡æ³¨'] || material.å¤‡æ³¨ || '--' }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div v-else class="text-center text-gray-500 py-12">
                    è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªå·¥å•æŸ¥çœ‹è¯¦æƒ…
                  </div>
                </div>
              </div>

              <!-- ç©ºçŠ¶æ€ -->
              <div v-else class="bg-white rounded-lg border border-gray-200 p-12 text-center">
                <div class="text-gray-400 text-lg mb-2">ğŸ“‹</div>
                <div class="text-gray-600">è¯·ä¸Šä¼ ç”Ÿäº§è®¡åˆ’è¡¨å’Œ GE BOMæºè¡¨ä»¥å¼€å§‹åŒ¹é…</div>
              </div>
            </div>
          </div>

          <!-- å…¶ä»–èœå•å ä½ -->
          <div v-else-if="!['production', 'workorder', 'vehicle', 'eco', 'billing', 'supplier', 'arrival', 'discrepancy', 'bi', 'defect', 'picking'].includes(currentMenu)" class="h-full flex items-center justify-center">
            <div class="text-center text-gray-500">
              <p class="text-lg mb-2">{{ currentMenuName }}</p>
              <p class="text-sm">åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- æ–°å¢ ECO æ¨¡æ€æ¡†ï¼ˆä¸»ä»è¡¨ç»“æ„ï¼‰ -->
    <div
      v-if="showCreateModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-2xl shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">æ–°å¢ ECO</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeCreateModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[80vh] overflow-y-auto">
          <div class="space-y-6">
            <!-- å…¬å…±åŒº -->
            <div class="space-y-4">
              <h4 class="text-sm font-semibold text-gray-700 border-b pb-2">åŸºæœ¬ä¿¡æ¯</h4>
              <div>
                <label class="block text-sm text-gray-700 mb-1">ECOå· <span class="text-red-500">*</span></label>
                <input
                  v-model="newEco.eco_no"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š401"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">äº§å“æè¿° <span class="text-red-500">*</span></label>
                <input
                  v-model="newEco.description"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼šHAL-X NC1"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">å·¥åº <span class="text-red-500">*</span></label>
                <input
                  v-model="newEco.op"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼šOP220"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">èµ·å§‹å°å¥— <span class="text-red-500">*</span></label>
                <input
                  v-model="newEco.start_set"
                  type="number"
                  min="1"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š25ï¼ˆä»ç¬¬25å°å¼€å§‹ç”Ÿæ•ˆï¼‰"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">å˜æ›´è¯¦æƒ… <span class="text-red-500">*</span></label>
                <textarea
                  v-model="newEco.change_details"
                  rows="3"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                  placeholder="å¦‚ï¼šæ›´æ¢ä¸ºV2ç‰ˆæœ¬ï¼Œæ³¨æ„å®‰è£…å­”ä½"
                ></textarea>
              </div>
            </div>
            
            <!-- æ˜ç»†åŒºï¼šæ¶‰åŠç‰©æ–™æ¸…å• -->
            <div class="space-y-4">
              <div class="flex items-center justify-between border-b pb-2">
                <h4 class="text-sm font-semibold text-gray-700">æ¶‰åŠç‰©æ–™æ¸…å•</h4>
                <button
                  @click="addEcoMaterial"
                  class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-lg transition"
                >
                  + æ·»åŠ ç‰©æ–™
                </button>
              </div>
              <div v-if="newEco.materials.length === 0" class="text-sm text-gray-500 text-center py-4">
                æš‚æ— ç‰©æ–™ï¼Œè¯·ç‚¹å‡»"æ·»åŠ ç‰©æ–™"æŒ‰é’®
              </div>
              <div v-else class="space-y-2">
                <div
                  v-for="(material, matIndex) in newEco.materials"
                  :key="matIndex"
                  class="flex gap-2 items-center"
                >
                  <input
                    v-model="newEco.materials[matIndex]"
                    type="text"
                    class="flex-1 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                    :placeholder="`ç‰©æ–™å· ${matIndex + 1}`"
                  />
                  <button
                    @click="removeEcoMaterial(matIndex)"
                    class="px-3 py-2 bg-red-100 hover:bg-red-200 text-red-700 text-xs rounded-lg transition"
                  >
                    åˆ é™¤
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeCreateModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveNewEco"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- åˆ°è´§å¼‚å¸¸ ç™»è®°æ¨¡æ€æ¡† -->
    <div
      v-if="showDiscrepancyModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-2xl shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°åˆ°è´§å¼‚å¸¸</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeDiscrepancyModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[80vh] overflow-y-auto">
          <div class="space-y-6 text-sm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-gray-700 mb-1">ä¾›åº”å•† <span class="text-red-500">*</span></label>
                <input
                  v-model="newDiscrepancy.supplier"
                  type="text"
                  list="supplier-list"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼šè²å°¼å…‹æ–¯"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">åˆ°è´§æ—¥æœŸ <span class="text-red-500">*</span></label>
                <input
                  v-model="newDiscrepancy.date"
                  type="date"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">POå· <span class="text-red-500">*</span></label>
                <input
                  v-model="newDiscrepancy.po"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼šPO-20250101"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">ç‰©æ–™å· <span class="text-red-500">*</span></label>
                <input
                  v-model="newDiscrepancy.material"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">è¡Œå·</label>
                <input
                  v-model="newDiscrepancy.line_no"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š10"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">æ•°é‡ <span class="text-red-500">*</span></label>
                <input
                  v-model.number="newDiscrepancy.qty"
                  type="number"
                  min="0"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š100"
                />
              </div>
              <div>
                <label class="block text-gray-700 mb-1">æ˜¯å¦ä¿ç¨</label>
                <div class="flex items-center gap-4">
                  <label class="flex items-center gap-1 text-gray-700 text-sm">
                    <input type="radio" v-model="newDiscrepancy.is_bonded" :value="true" />
                    æ˜¯
                  </label>
                  <label class="flex items-center gap-1 text-gray-700 text-sm">
                    <input type="radio" v-model="newDiscrepancy.is_bonded" :value="false" />
                    å¦
                  </label>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <div>
                <label class="block text-gray-700 mb-1">å¼‚å¸¸åˆ†ç±» <span class="text-red-500">*</span></label>
                <select
                  v-model="newDiscrepancy.category"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                >
                  <option value="ç³»ç»Ÿé—®é¢˜">ç³»ç»Ÿé—®é¢˜</option>
                  <option value="å•æ®é—®é¢˜">å•æ®é—®é¢˜</option>
                  <option value="å®ç‰©ç ´æŸ">å®ç‰©ç ´æŸ</option>
                  <option value="æ•°é‡å·®å¼‚">æ•°é‡å·®å¼‚</option>
                  <option value="æ ‡ç­¾é”™è¯¯">æ ‡ç­¾é”™è¯¯</option>
                </select>
              </div>
              <div>
                <label class="block text-gray-700 mb-1">è¯¦ç»†æè¿° <span class="text-red-500">*</span></label>
                <textarea
                  v-model="newDiscrepancy.description"
                  rows="3"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                  placeholder="è¯·æè¿°å…·ä½“å¼‚å¸¸ï¼Œå¦‚ç ´æŸä½ç½®ã€æ•°é‡å·®å¼‚ç­‰"
                ></textarea>
              </div>
              <div>
                <label class="block text-gray-700 mb-1">ç°åœºç…§ç‰‡</label>
                <input
                  ref="discrepancyPhotoInput"
                  type="file"
                  multiple
                  @change="handleDiscrepancyPhotos"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                />
                <div v-if="newDiscrepancy.photos && newDiscrepancy.photos.length" class="text-xs text-gray-600 mt-2">
                  å·²é€‰æ‹©ï¼š{{ newDiscrepancy.photos.join(', ') }}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeDiscrepancyModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveDiscrepancy"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- åˆ°è´§å¼‚å¸¸ è¯¦æƒ…/å¤„ç†æ¨¡æ€æ¡† -->
    <div
      v-if="showDiscrepancyDetailModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-3xl shadow-xl max-h-[90vh] overflow-hidden flex flex-col">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">
            {{ currentDiscrepancyItem && currentDiscrepancyItem.status === 'å·²é—­ç¯' ? 'å¼‚å¸¸è¯¦æƒ…' : 'å¤„ç†å¼‚å¸¸' }}
          </h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeDiscrepancyDetailModal">Ã—</button>
        </div>
        <div class="px-5 py-4 overflow-y-auto flex-1">
          <!-- ä¸ŠåŠéƒ¨åˆ†ï¼šåŸå§‹ç™»è®°ä¿¡æ¯ï¼ˆåªè¯»ï¼‰ -->
          <div class="space-y-4 mb-6 pb-6 border-b border-gray-200">
            <h4 class="text-sm font-semibold text-gray-700 mb-3">åŸå§‹ç™»è®°ä¿¡æ¯</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
              <div>
                <label class="text-gray-500 text-xs">ç¼–å·</label>
                <div class="text-gray-800 font-medium">{{ currentDiscrepancyItem?.report_id || '--' }}</div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">åˆ°è´§æ—¥æœŸ</label>
                <div class="text-gray-800">{{ currentDiscrepancyItem?.date || '--' }}</div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">ä¾›åº”å•†</label>
                <div class="text-gray-800">{{ currentDiscrepancyItem?.supplier || '--' }}</div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">POå·</label>
                <div class="text-gray-800">{{ currentDiscrepancyItem?.po || '--' }}</div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">ç‰©æ–™å·</label>
                <div class="text-gray-800">{{ currentDiscrepancyItem?.material || '--' }}</div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">è¡Œå·</label>
                <div class="text-gray-800">{{ currentDiscrepancyItem?.line_no || '--' }}</div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">æ•°é‡</label>
                <div class="text-gray-800">{{ currentDiscrepancyItem?.qty || 0 }}</div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">æ˜¯å¦ä¿ç¨</label>
                <div class="text-gray-800">{{ currentDiscrepancyItem?.is_bonded ? 'æ˜¯' : 'å¦' }}</div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">å¼‚å¸¸åˆ†ç±»</label>
                <div class="text-gray-800">
                  <span :class="discrepancyCategoryClass(currentDiscrepancyItem?.category)" class="status-badge">
                    {{ currentDiscrepancyItem?.category || '--' }}
                  </span>
                </div>
              </div>
              <div>
                <label class="text-gray-500 text-xs">å½“å‰çŠ¶æ€</label>
                <div class="text-gray-800">
                  <span :class="discrepancyStatusClass(currentDiscrepancyItem?.status)" class="status-badge">
                    {{ currentDiscrepancyItem?.status || '--' }}
                  </span>
                </div>
              </div>
              <div class="md:col-span-2">
                <label class="text-gray-500 text-xs">è¯¦ç»†æè¿°</label>
                <div class="text-gray-800 bg-gray-50 p-3 rounded-lg mt-1">{{ currentDiscrepancyItem?.description || '--' }}</div>
              </div>
              <div v-if="currentDiscrepancyItem?.photos && currentDiscrepancyItem.photos.length > 0" class="md:col-span-2">
                <label class="text-gray-500 text-xs">ç°åœºç…§ç‰‡</label>
                <div class="text-gray-800 mt-1">{{ currentDiscrepancyItem.photos.join(', ') }}</div>
              </div>
              <div v-if="currentDiscrepancyItem?.result" class="md:col-span-2">
                <label class="text-gray-500 text-xs">å¤„ç†ç»“æœ</label>
                <div class="text-gray-800 bg-gray-50 p-3 rounded-lg mt-1">{{ currentDiscrepancyItem.result }}</div>
              </div>
            </div>
          </div>

          <!-- ä¸‹åŠéƒ¨åˆ†ï¼šå¤„ç†åé¦ˆåŒºï¼ˆä»…å½“çŠ¶æ€ä¸æ˜¯å·²é—­ç¯æ—¶æ˜¾ç¤ºï¼‰ -->
          <div v-if="currentDiscrepancyItem && currentDiscrepancyItem.status !== 'å·²é—­ç¯'" class="space-y-4">
            <h4 class="text-sm font-semibold text-gray-700 mb-3">å¤„ç†åé¦ˆ</h4>
            <div>
              <label class="block text-gray-700 mb-1 text-sm">å¤„ç†ç»“æœ <span class="text-red-500">*</span></label>
              <textarea
                v-model="discrepancyHandleResult"
                rows="4"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                placeholder="è¯·å¡«å†™è§£å†³æ–¹æ¡ˆæˆ–å¤„ç†åé¦ˆ..."
              ></textarea>
            </div>
            <div>
              <label class="block text-gray-700 mb-1 text-sm">æ›´æ–°çŠ¶æ€ <span class="text-red-500">*</span></label>
              <div class="flex items-center gap-4">
                <label class="flex items-center gap-2 text-gray-700 text-sm cursor-pointer">
                  <input 
                    type="radio" 
                    v-model="discrepancyHandleStatus" 
                    value="å¤„ç†ä¸­"
                    class="cursor-pointer"
                  />
                  <span>å¤„ç†ä¸­</span>
                </label>
                <label class="flex items-center gap-2 text-gray-700 text-sm cursor-pointer">
                  <input 
                    type="radio" 
                    v-model="discrepancyHandleStatus" 
                    value="å·²é—­ç¯"
                    class="cursor-pointer"
                  />
                  <span>å·²é—­ç¯</span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeDiscrepancyDetailModal"
          >
            å…³é—­
          </button>
          <button
            v-if="currentDiscrepancyItem && currentDiscrepancyItem.status !== 'å·²é—­ç¯'"
            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm text-white"
            @click="saveDiscrepancyHandle"
          >
            ä¿å­˜å¤„ç†ç»“æœ
          </button>
        </div>
      </div>
    </div>

    <!-- ç™»è®°è´¹ç”¨ æ¨¡æ€æ¡† -->
    <div
      v-if="showBillingModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-xl shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°è´¹ç”¨</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeBillingModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[75vh] overflow-y-auto">
          <div class="space-y-4 text-sm">
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®¢æˆ·åç§° <span class="text-red-500">*</span></label>
              <select
                v-model="newBilling.å®¢æˆ·åç§°"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="">è¯·é€‰æ‹©å®¢æˆ·</option>
                <option v-for="c in uniqueBillingCustomers" :key="c" :value="c">{{ c }}</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è´¹ç”¨ç±»å‹ <span class="text-red-500">*</span></label>
              <select
                v-model="newBilling.è´¹ç”¨ç±»å‹"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="ä»“å‚¨è´¹">ä»“å‚¨è´¹</option>
                <option value="è¿è¾“è´¹">è¿è¾“è´¹</option>
              </select>
            </div>
            <div v-if="newBilling.è´¹ç”¨ç±»å‹ === 'ä»“å‚¨è´¹'">
              <label class="block text-sm text-gray-700 mb-1">é¢ç§¯ (ã¡) <span class="text-red-500">*</span></label>
              <input
                type="number"
                min="0"
                v-model="newBilling.é¢ç§¯"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="å¦‚ï¼š100"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ç»“ç®—å‘¨æœŸ <span class="text-red-500">*</span></label>
              <select
                v-model="newBilling.ç»“ç®—å‘¨æœŸ"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="">è¯·é€‰æ‹©ç»“ç®—å‘¨æœŸ</option>
                <option value="æœˆç»“">æœˆç»“</option>
                <option value="å­£ç»“">å­£ç»“</option>
                <option value="å•æ¬¡">å•æ¬¡</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è´¹ç”¨è¯´æ˜</label>
              <input
                type="text"
                v-model="newBilling.è´¹ç”¨è¯´æ˜"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="å¦‚ï¼š1æœˆä»“å‚¨è´¹"
              />
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm text-gray-700 mb-1">å‘ç”Ÿæ—¥æœŸ <span class="text-red-500">*</span></label>
                <input
                  type="date"
                  v-model="newBilling.å‘ç”Ÿæ—¥æœŸ"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">é‡‘é¢ (Â¥) <span class="text-red-500">*</span></label>
                <input
                  type="number"
                  min="0"
                  v-model="newBilling.é‡‘é¢"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="å¦‚ï¼š12000"
                />
              </div>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeBillingModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveNewBilling"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- åˆ°è´§ç™»è®° æ¨¡æ€æ¡† -->
    <div
      v-if="showArrivalModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-md shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°åˆ°è´§</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeArrivalModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[75vh] overflow-y-auto">
          <div class="space-y-4 text-sm">
            <div>
              <label class="block text-sm text-gray-700 mb-1">æ—¥æœŸ <span class="text-red-500">*</span></label>
              <input
                type="date"
                v-model="newArrival.æ—¥æœŸ"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">æ—¶é—´ <span class="text-red-500">*</span></label>
              <input
                type="time"
                v-model="newArrival.æ—¶é—´"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ä¾›åº”å•†åç§° <span class="text-red-500">*</span></label>
              <input
                type="text"
                v-model="newArrival.ä¾›åº”å•†åç§°"
                list="supplier-options"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¾“å…¥ä¾›åº”å•†åç§°ï¼Œæ”¯æŒè‡ªåŠ¨è”æƒ³"
                required
              />
              <datalist id="supplier-options">
                <option v-for="supplier in savedSupplierNames" :key="supplier" :value="supplier"></option>
              </datalist>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®ç‰©æ•°é‡ <span class="text-red-500">*</span></label>
              <div class="flex gap-2">
                <input
                  type="number"
                  v-model="newArrival.å®ç‰©æ•°é‡"
                  min="1"
                  class="flex-1 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="ä¾‹å¦‚ï¼š5"
                  required
                />
                <select
                  v-model="newArrival.å•ä½"
                  class="w-24 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                >
                  <option value="æ‰˜">æ‰˜</option>
                  <option value="ç®±">ç®±</option>
                  <option value="ä»¶">ä»¶</option>
                  <option value="æ†">æ†</option>
                </select>
              </div>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">é€è´§å•å·</label>
              <input
                type="text"
                v-model="newArrival.é€è´§å•å·"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="é€‰å¡«"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å¤‡æ³¨</label>
              <textarea
                v-model="newArrival.å¤‡æ³¨"
                rows="3"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                placeholder="é€‰å¡«"
              ></textarea>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeArrivalModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveArrivalRecord"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- æ”¶è´§åé¦ˆ æ¨¡æ€æ¡† -->
    <div
      v-if="showArrivalFeedbackModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-md shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">æ”¶è´§åé¦ˆ</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeArrivalFeedbackModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[75vh] overflow-y-auto">
          <div class="space-y-4 text-sm">
            <div v-if="currentArrivalFeedbackIndex >= 0 && arrivalLog[currentArrivalFeedbackIndex]">
              <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                <div class="text-sm text-gray-600 mb-2">
                  <span class="font-semibold">ä¾›åº”å•†ï¼š</span>
                  <span>{{ arrivalLog[currentArrivalFeedbackIndex].ä¾›åº”å•†åç§° || '--' }}</span>
                </div>
                <div class="text-sm text-gray-600">
                  <span class="font-semibold">åˆ°è´§æ—¥æœŸï¼š</span>
                  <span>{{ arrivalLog[currentArrivalFeedbackIndex].æ—¥æœŸ || '--' }}</span>
                </div>
              </div>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®é™…æ”¶è´§æ•°é‡ <span class="text-red-500">*</span></label>
              <input
                type="number"
                v-model="arrivalFeedback.actual_qty"
                min="0"
                step="0.01"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¯·è¾“å…¥å®é™…æ”¶è´§æ•°é‡"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å¤‡æ³¨è¡¥å……</label>
              <textarea
                v-model="arrivalFeedback.feedback_remark"
                rows="3"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                placeholder="é€‰å¡«ï¼Œç”¨äºè®°å½•å·®å¼‚åŸå› ï¼Œå¦‚"å°‘2ç®±""
              ></textarea>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeArrivalFeedbackModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg text-sm text-white"
            @click="saveArrivalFeedback"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- æ–°å»ºä¾›åº”å•†æ”¶è´§ä»»åŠ¡ æ¨¡æ€æ¡† -->
    <div
      v-if="showNewReceivingModal"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-md shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°æ–°åˆ°è´§</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeNewReceivingModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[70vh] overflow-y-auto">
          <div class="space-y-4 text-sm">
            <div>
              <label class="block text-sm text-gray-700 mb-1">ä¾›åº”å•†åç§° <span class="text-red-500">*</span></label>
              <div class="relative">
                <input
                  v-model="supplierSearchInput"
                  @input="onSupplierSearchInput"
                  @focus="showSupplierDropdown = true"
                  type="text"
                  class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="è¾“å…¥è‹±æ–‡åç§°ï¼Œå¦‚ï¼šJABIL"
                />
                <div
                  v-if="showSupplierDropdown && filteredSupplierOptions.length > 0"
                  class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto"
                >
                  <div
                    v-for="(option, idx) in filteredSupplierOptions"
                    :key="idx"
                    @click="selectSupplier(option)"
                    class="px-3 py-2 hover:bg-blue-50 cursor-pointer text-sm"
                  >
                    <div class="font-semibold text-gray-900">{{ option.en }}</div>
                    <div class="text-xs text-gray-500">{{ option.cn }}</div>
                  </div>
                </div>
              </div>
              <div v-if="selectedSupplier" class="mt-2 text-xs text-green-600">
                âœ“ å·²é€‰æ‹©ï¼š{{ selectedSupplier.en }} - {{ selectedSupplier.cn }}
              </div>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">åˆ°è´§æ—¶é—´</label>
              <input
                v-model="newReceivingTask.åˆ°è´§æ—¥æœŸ"
                type="datetime-local"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®ç‰©æ•°é‡ <span class="text-red-500">*</span></label>
              <div class="flex gap-2">
                <input
                  v-model="newReceivingTask.physical_qty"
                  type="number"
                  min="1"
                  class="flex-1 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                  placeholder="ä¾‹å¦‚ï¼š5"
                />
                <select
                  v-model="newReceivingTask.unit"
                  class="w-24 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                >
                  <option value="æ‰˜">æ‰˜</option>
                  <option value="ç®±">ç®±</option>
                  <option value="ä»¶">ä»¶</option>
                </select>
              </div>
            </div>
            <div class="text-xs text-gray-500 bg-gray-50 p-2 rounded">
              ğŸ’¡ æç¤ºï¼šç³»ç»Ÿæ€»è¡Œæ•°å°†åœ¨ä¸Šä¼  GE æŠ¥è¡¨åè‡ªåŠ¨å›å¡«
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰</label>
              <textarea
                v-model="newReceivingTask.å¤‡æ³¨"
                rows="3"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                placeholder="å¯å¡«å†™ç‰¹æ®Šè¦æ±‚ã€åˆ°è´§è¯´æ˜ç­‰"
              ></textarea>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeNewReceivingModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveNewReceivingTask"
          >
            ç¡®è®¤ç™»è®°
          </button>
        </div>
      </div>
    </div>

    <!-- æœªçŸ¥ä¾›åº”å•†å…³è”ä¸­æ–‡å æ¨¡æ€æ¡† -->
    <div
      v-if="showUnknownSupplierModal"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-md shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">å…³è”ä¾›åº”å•†ä¸­æ–‡å</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="skipUnknownSupplier">è·³è¿‡</button>
        </div>
        <div class="px-5 py-4 modal-body">
          <div class="space-y-4 text-sm">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
              <div class="text-xs text-yellow-800 mb-1">âš ï¸ å‘ç°æœªåœ¨å­—å…¸ä¸­çš„ä¾›åº”å•†</div>
              <div class="font-semibold text-gray-900">{{ currentUnknownSupplier }}</div>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è¯·è¾“å…¥ä¸­æ–‡åç§° <span class="text-red-500">*</span></label>
              <input
                v-model="unknownSupplierCnInput"
                type="text"
                @keydown.enter="saveUnknownSupplierMapping"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="ä¾‹å¦‚ï¼šæ·æ™®ç”µå­"
              />
            </div>
            <div class="text-xs text-gray-500 bg-gray-50 p-2 rounded">
              ğŸ’¡ æç¤ºï¼šè¾“å…¥åä¼šè‡ªåŠ¨æ·»åŠ åˆ°ä¾›åº”å•†å­—å…¸ï¼Œåç»­åŒ¹é…å°†è‡ªåŠ¨è¯†åˆ«
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="skipUnknownSupplier"
          >
            è·³è¿‡
          </button>
          <button
            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg text-sm text-white"
            @click="saveUnknownSupplierMapping"
            :disabled="!unknownSupplierCnInput.trim()"
          >
            ä¿å­˜å¹¶ç»§ç»­
          </button>
        </div>
      </div>
    </div>

    <!-- ç™»è®°è½¦æ¬¡ æ¨¡æ€æ¡† -->
    <div
      v-if="showVehicleLogModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-md shadow-xl">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°è½¦æ¬¡</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeVehicleLogModal">Ã—</button>
        </div>
        <div class="px-5 py-4 modal-body max-h-[70vh] overflow-y-auto">
          <div class="space-y-4">
            <div>
              <label class="block text-sm text-gray-700 mb-1">æ—¥æœŸ <span class="text-red-500">*</span></label>
              <input
                v-model="newVehicleLog.æ—¥æœŸ"
                type="date"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">æ—¶é—´ <span class="text-red-500">*</span></label>
              <input
                v-model="newVehicleLog.æ—¶é—´"
                type="time"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è½¦å‹ <span class="text-red-500">*</span></label>
              <select
                v-model="newVehicleLog.è½¦å‹"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              >
                <option value="">è¯·é€‰æ‹©è½¦å‹</option>
                <option value="SUV">SUV</option>
                <option value="9.6ç±³æ¿è½¦">9.6ç±³æ¿è½¦</option>
                <option value="9.6ç±³ç®±è´§">9.6ç±³ç®±è´§</option>
                <option value="4.2ç±³ç®±è´§">4.2ç±³ç®±è´§</option>
                <option value="å¤‡ç”¨è½¦">å¤‡ç”¨è½¦</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å¸æœºå§“å <span class="text-red-500">*</span></label>
              <input
                v-model="newVehicleLog.å¸æœºå§“å"
                type="text"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¯·è¾“å…¥å¸æœºå§“å"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®¢æˆ·åç§° <span class="text-red-500">*</span></label>
              <input
                v-model="newVehicleLog.å®¢æˆ·åç§°"
                type="text"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¯·è¾“å…¥å®¢æˆ·åç§°"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å®¢æˆ·ç­¾æ”¶äºº</label>
              <input
                v-model="newVehicleLog.å®¢æˆ·ç­¾æ”¶äºº"
                type="text"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="è¯·è¾“å…¥å®¢æˆ·ç­¾æ”¶äºº"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å†…å®¹ <span class="text-red-500">*</span></label>
              <select
                v-model="newVehicleLog.å†…å®¹"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                required
              >
                <option value="">è¯·é€‰æ‹©å†…å®¹</option>
                <option value="é€è´§">é€è´§</option>
                <option value="æè´§">æè´§</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å¤‡æ³¨</label>
              <textarea
                v-model="newVehicleLog.å¤‡æ³¨"
                rows="3"
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
                placeholder="å¯å¡«å†™ç‰¹æ®Šè¯´æ˜ã€è´§ç‰©ä¿¡æ¯ç­‰"
              ></textarea>
            </div>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeVehicleLogModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveNewVehicleLog"
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>


    <!-- æ–°å¢ç¼ºé™· æ¨¡æ€æ¡† -->
    <div
      v-if="showDefectModal"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-2xl shadow-xl max-h-[90vh] overflow-hidden flex flex-col">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ç™»è®°ç¼ºé™·</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeDefectModal">Ã—</button>
        </div>
        <div class="px-5 py-4 space-y-4 overflow-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <label class="block text-sm text-gray-700 mb-1">å‘ç°æ—¥æœŸ <span class="text-red-500">*</span></label>
              <input
                v-model="newDefect.å‘ç°æ—¥æœŸ"
                type="date"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ç±»å‹ <span class="text-red-500">*</span></label>
              <select
                v-model="newDefect.ç±»å‹"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="">è¯·é€‰æ‹©</option>
                <option value="Bç±»">Bç±»</option>
                <option value="Cç±»">Cç±»</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">ç§ç±» <span class="text-red-500">*</span></label>
              <select
                v-model="newDefect.ç§ç±»"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              >
                <option value="">è¯·é€‰æ‹©</option>
                <option value="æ¼é…">æ¼é…</option>
                <option value="é”™é…">é”™é…</option>
                <option value="ç‰©æ–™æ‘†å">ç‰©æ–™æ‘†å</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">äº§å“ <span class="text-red-500">*</span></label>
              <input
                v-model="newDefect.äº§å“"
                type="text"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                placeholder="å¦‚ï¼šTB, 19DTA"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">å‘ç°äºº <span class="text-red-500">*</span></label>
              <input
                v-model="newDefect.å‘ç°äºº"
                type="text"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">è´£ä»»äºº <span class="text-red-500">*</span></label>
              <input
                v-model="newDefect.è´£ä»»äºº"
                type="text"
                required
                class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
            </div>
          </div>
          
          <div>
            <label class="block text-sm text-gray-700 mb-1">é—®é¢˜æè¿° <span class="text-red-500">*</span></label>
            <textarea
              v-model="newDefect.é—®é¢˜æè¿°"
              rows="3"
              required
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
              placeholder="è¯·è¯¦ç»†æè¿°å‘ç°çš„é—®é¢˜"
            ></textarea>
          </div>

          <div>
            <label class="block text-sm text-gray-700 mb-1">åŸå› </label>
            <textarea
              v-model="newDefect.åŸå› "
              rows="2"
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
              placeholder="åˆ†æé—®é¢˜äº§ç”Ÿçš„åŸå› "
            ></textarea>
          </div>

          <div>
            <label class="block text-sm text-gray-700 mb-1">è§£å†³æ–¹æ¡ˆ</label>
            <textarea
              v-model="newDefect.è§£å†³æ–¹æ¡ˆ"
              rows="2"
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
              placeholder="æè¿°é‡‡å–çš„è§£å†³æ–¹æ¡ˆ"
            ></textarea>
          </div>

          <!-- å…³é”®ï¼šæ˜¯å¦æŒ‰ç¯è§¦å‘çš„å•é€‰æ¡† -->
          <div>
            <label class="block text-sm text-gray-700 mb-2">æ˜¯å¦æŒ‰ç¯è§¦å‘ï¼Ÿ <span class="text-red-500">*</span></label>
            <div class="flex gap-4">
              <label class="flex items-center">
                <input
                  type="radio"
                  v-model="newDefect.æ˜¯å¦æŒ‰ç¯"
                  :value="true"
                  @change="onAndonChange"
                  class="mr-2"
                />
                <span class="text-sm text-gray-700">æ˜¯</span>
              </label>
              <label class="flex items-center">
                <input
                  type="radio"
                  v-model="newDefect.æ˜¯å¦æŒ‰ç¯"
                  :value="false"
                  @change="onAndonChange"
                  class="mr-2"
                />
                <span class="text-sm text-gray-700">å¦</span>
              </label>
            </div>
          </div>

          <!-- åŠ¨æ€æ˜¾ç¤ºçš„æ–‡ä»¶ä¸Šä¼ æ¡†ï¼ˆä»…å½“é€‰æ‹©"æ˜¯"æ—¶æ˜¾ç¤ºï¼‰ -->
          <div v-if="newDefect.æ˜¯å¦æŒ‰ç¯ === true" class="border border-orange-200 bg-orange-50 rounded-lg p-4">
            <label class="block text-sm text-gray-700 mb-2">
              ä¸Šä¼  5WHY åˆ†ææŠ¥å‘Š <span class="text-red-500">*</span>
            </label>
            <input
              type="file"
              ref="fileInput"
              accept=".pdf,.doc,.docx"
              @change="onFileChange"
              required
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
            />
            <p class="text-xs text-gray-500 mt-1">æ”¯æŒ PDFã€Word æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 10MB</p>
          </div>

          <div>
            <label class="block text-sm text-gray-700 mb-1">å¤‡æ³¨</label>
            <textarea
              v-model="newDefect.å¤‡æ³¨"
              rows="2"
              class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-800 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none"
              placeholder="å…¶ä»–è¡¥å……è¯´æ˜"
            ></textarea>
          </div>
        </div>
        <div class="px-5 py-4 border-t border-gray-200 flex justify-end gap-3">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeDefectModal"
          >
            å–æ¶ˆ
          </button>
          <button
            class="px-4 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg text-sm text-white"
            @click="saveDefect"
          >
            ç¡®è®¤ç™»è®°
          </button>
        </div>
      </div>
    </div>

    <!-- ä¾›åº”å•†æ”¶è´§è¯¦æƒ… æ¨¡æ€æ¡† -->
    <div
      v-if="showReceivingDetailModal && currentReceivingDetailTask"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
    >
      <div class="bg-white border border-gray-200 rounded-xl w-full max-w-2xl shadow-xl max-h-[80vh] overflow-hidden flex flex-col">
        <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">æ”¶è´§è¯¦æƒ… - {{ currentReceivingDetailTask.ä¾›åº”å•†åç§° }}</h3>
          <button class="text-gray-400 hover:text-gray-600 text-xl" @click="closeReceivingDetailModal">Ã—</button>
        </div>
        <div class="px-5 py-4 space-y-4 overflow-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
            <div>
              <div class="text-gray-500 text-xs mb-1">ä¾›åº”å•†åç§°</div>
              <div class="font-medium">{{ currentReceivingDetailTask.ä¾›åº”å•†åç§° || '--' }}</div>
            </div>
            <div>
              <div class="text-gray-500 text-xs mb-1">åˆ°è´§æ—¶é—´</div>
              <div class="font-medium">{{ currentReceivingDetailTask.åˆ°è´§æ—¥æœŸ || '--' }}</div>
            </div>
            <div>
              <div class="text-gray-500 text-xs mb-1">æ€»è¡Œæ•°</div>
              <div class="font-medium">{{ currentReceivingDetailTask.æ€»è¡Œæ•° || 0 }} æ¡</div>
            </div>
            <div>
              <div class="text-gray-500 text-xs mb-1">ç³»ç»Ÿå·²æ”¶</div>
              <div class="font-medium" v-if="currentReceivingDetailTask.data_source === 'synced' && currentReceivingDetailTask.æ€»è¡Œæ•° > 0">
                {{ currentReceivingDetailTask.æ€»è¡Œæ•° }} æ¡
              </div>
              <div class="font-medium text-gray-400" v-else>
                ç­‰å¾…ç³»ç»Ÿæ•°æ®...
              </div>
            </div>
          </div>

          <div class="mt-2">
            <h4 class="text-sm font-semibold text-gray-800 mb-2">æ•°æ®è¯´æ˜</h4>
            <div class="text-xs text-gray-600 py-2">
              <div v-if="currentReceivingDetailTask.data_source === 'synced' && currentReceivingDetailTask.æ€»è¡Œæ•° > 0">
                æ•°æ®æ¥æºï¼šåŒè¡¨åŒ¹é…ç»Ÿè®¡ï¼ˆæ”¶è´§æµæ°´è¡¨ + ç‰©æ–™å…³ç³»è¡¨ï¼‰
              </div>
              <div v-else class="text-gray-400">
                ç­‰å¾…ä¸Šä¼ åŒè¡¨è¿›è¡ŒåŒ¹é…ç»Ÿè®¡
              </div>
            </div>
          </div>
        </div>
        <div class="px-5 py-3 border-t border-gray-200 flex justify-end">
          <button
            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700"
            @click="closeReceivingDetailModal"
          >
            å…³é—­
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // è°ƒè¯•ï¼šæ£€æŸ¥ Vue æ˜¯å¦åŠ è½½
    console.log('=== å¼€å§‹åŠ è½½è„šæœ¬ ===');
    console.log('Vue æ˜¯å¦å®šä¹‰:', typeof Vue !== 'undefined');
    
    if (typeof Vue === 'undefined') {
      console.error('âŒ Vue åº“æœªåŠ è½½ï¼è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ– CDN åœ°å€');
      alert('Vue åº“åŠ è½½å¤±è´¥ï¼Œé¡µé¢æ— æ³•æ­£å¸¸å·¥ä½œï¼');
    } else {
      console.log('âœ… Vue åº“å·²åŠ è½½');
    }
    
    const { createApp } = Vue;
    console.log('createApp æ˜¯å¦å®šä¹‰:', typeof createApp !== 'undefined');

    // Mock æ•°æ® - ç›´æ¥å†…åµŒåœ¨ HTML ä¸­
    const mockData = {
      // 1. ç”Ÿäº§è®¡åˆ’ (Production Plan)
      productionPlan: [
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-15",
          å‘è½¦æ—¶é—´: "08:30",
          è½¦æ¬¡: "VH-2024-0015",
          å·¥åºå·: "OP70",
          äº§çº¿åç§°: "äº§çº¿A-è£…é…çº¿",
          åˆ°åœºæ—¶é—´: "09:15",
          äº§å“æè¿°: "GEç‡ƒæ°”è½®æœºå¶ç‰‡ç»„ä»¶-TB-4502",
          å·¥å•å·: "WO-2024-0123",
          åŠ å·¥åºåˆ—å·: "SEQ-001",
          å·¥åºæè¿°: "CDFé—¨è£…é…"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-15",
          å‘è½¦æ—¶é—´: "10:00",
          è½¦æ¬¡: "VH-2024-0016",
          å·¥åºå·: "OP50",
          äº§çº¿åç§°: "äº§çº¿B-æœºåŠ å·¥çº¿",
          åˆ°åœºæ—¶é—´: "10:45",
          äº§å“æè¿°: "è¥¿é—¨å­ç”µæœºå®šå­ç»„ä»¶-SI-7821",
          å·¥å•å·: "WO-2024-0124",
          åŠ å·¥åºåˆ—å·: "SEQ-002",
          å·¥åºæè¿°: "ç²¾å¯†é“£å‰ŠåŠ å·¥"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-16",
          å‘è½¦æ—¶é—´: "07:45",
          è½¦æ¬¡: "VH-2024-0017",
          å·¥åºå·: "OP80",
          äº§çº¿åç§°: "äº§çº¿C-ç„Šæ¥çº¿",
          åˆ°åœºæ—¶é—´: "08:30",
          äº§å“æè¿°: "ABBå˜é¢‘å™¨å¤–å£³ç»„ä»¶-ABB-3350",
          å·¥å•å·: "WO-2024-0125",
          åŠ å·¥åºåˆ—å·: "SEQ-003",
          å·¥åºæè¿°: "æ°©å¼§ç„Šç„Šæ¥"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-16",
          å‘è½¦æ—¶é—´: "13:20",
          è½¦æ¬¡: "VH-2024-0018",
          å·¥åºå·: "OP60",
          äº§çº¿åç§°: "äº§çº¿A-è£…é…çº¿",
          åˆ°åœºæ—¶é—´: "14:05",
          äº§å“æè¿°: "GEå‹ç¼©æœºè½¬å­ç»„ä»¶-CP-2891",
          å·¥å•å·: "WO-2024-0126",
          åŠ å·¥åºåˆ—å·: "SEQ-004",
          å·¥åºæè¿°: "åŠ¨å¹³è¡¡æ£€æµ‹"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-17",
          å‘è½¦æ—¶é—´: "09:00",
          è½¦æ¬¡: "VH-2024-0019",
          å·¥åºå·: "OP90",
          äº§çº¿åç§°: "äº§çº¿D-å–·æ¶‚çº¿",
          åˆ°åœºæ—¶é—´: "09:50",
          äº§å“æè¿°: "è¥¿é—¨å­æ§åˆ¶æŸœé¢æ¿-SI-9012",
          å·¥å•å·: "WO-2024-0127",
          åŠ å·¥åºåˆ—å·: "SEQ-005",
          å·¥åºæè¿°: "é™ç”µå–·æ¶‚"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-17",
          å‘è½¦æ—¶é—´: "11:30",
          è½¦æ¬¡: "VH-2024-0020",
          å·¥åºå·: "OP70",
          äº§çº¿åç§°: "äº§çº¿B-æœºåŠ å·¥çº¿",
          åˆ°åœºæ—¶é—´: "12:15",
          äº§å“æè¿°: "ABBä¼ºæœç”µæœºè½´-ABB-4456",
          å·¥å•å·: "WO-2024-0128",
          åŠ å·¥åºåˆ—å·: "SEQ-006",
          å·¥åºæè¿°: "CDFé—¨è£…é…"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-18",
          å‘è½¦æ—¶é—´: "08:15",
          è½¦æ¬¡: "VH-2024-0021",
          å·¥åºå·: "OP55",
          äº§çº¿åç§°: "äº§çº¿C-ç„Šæ¥çº¿",
          åˆ°åœºæ—¶é—´: "09:00",
          äº§å“æè¿°: "GEå‘ç”µæœºç«¯ç›–ç»„ä»¶-GE-5678",
          å·¥å•å·: "WO-2024-0129",
          åŠ å·¥åºåˆ—å·: "SEQ-007",
          å·¥åºæè¿°: "æ¿€å…‰ç„Šæ¥"
        },
        {
          ä½¿ç”¨æ—¥æœŸ: "2024-01-18",
          å‘è½¦æ—¶é—´: "14:00",
          è½¦æ¬¡: "VH-2024-0022",
          å·¥åºå·: "OP75",
          äº§çº¿åç§°: "äº§çº¿A-è£…é…çº¿",
          åˆ°åœºæ—¶é—´: "14:45",
          äº§å“æè¿°: "è¥¿é—¨å­å˜é¢‘å™¨æ•£çƒ­å™¨-SI-6789",
          å·¥å•å·: "WO-2024-0130",
          åŠ å·¥åºåˆ—å·: "SEQ-008",
          å·¥åºæè¿°: "çƒ­å‹è£…é…"
        }
      ],

      // 2. è½¦æ¬¡ç®¡ç† (Vehicle Log)
      vehicleLog: [
        {
          æ—¥æœŸ: "2024-01-15",
          æ—¶é—´: "08:30",
          è½¦å‹: "9.6ç±³æ¿è½¦",
          å¸æœºå§“å: "å¼ å¸ˆå‚…",
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          å®¢æˆ·ç­¾æ”¶äºº: "æç»ç†",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "GEç‡ƒæ°”è½®æœºå¶ç‰‡ç»„ä»¶ï¼Œå…±3ç®±ï¼Œå·²ç­¾æ”¶"
        },
        {
          æ—¥æœŸ: "2024-01-15",
          æ—¶é—´: "10:00",
          è½¦å‹: "7.2ç±³å¢å¼è½¦",
          å¸æœºå§“å: "ç‹å¸ˆå‚…",
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          å®¢æˆ·ç­¾æ”¶äºº: "é™ˆä¸»ç®¡",
          å†…å®¹: "æè´§",
          å¤‡æ³¨: "æå–è¥¿é—¨å­ç”µæœºå®šå­ç»„ä»¶ï¼Œå¾…åŠ å·¥"
        },
        {
          æ—¥æœŸ: "2024-01-16",
          æ—¶é—´: "07:45",
          è½¦å‹: "9.6ç±³æ¿è½¦",
          å¸æœºå§“å: "åˆ˜å¸ˆå‚…",
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          å®¢æˆ·ç­¾æ”¶äºº: "å‘¨ä¸»ä»»",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "ABBå˜é¢‘å™¨å¤–å£³ç»„ä»¶ï¼Œå…±5ç®±ï¼Œå·²é€è¾¾"
        },
        {
          æ—¥æœŸ: "2024-01-16",
          æ—¶é—´: "13:20",
          è½¦å‹: "12ç±³åŠæŒ‚è½¦",
          å¸æœºå§“å: "èµµå¸ˆå‚…",
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          å®¢æˆ·ç­¾æ”¶äºº: "å´ç»ç†",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "GEå‹ç¼©æœºè½¬å­ç»„ä»¶ï¼Œå¤§å‹è®¾å¤‡ï¼Œéœ€å‰è½¦å¸è´§"
        },
        {
          æ—¥æœŸ: "2024-01-17",
          æ—¶é—´: "09:00",
          è½¦å‹: "7.2ç±³å¢å¼è½¦",
          å¸æœºå§“å: "å­™å¸ˆå‚…",
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          å®¢æˆ·ç­¾æ”¶äºº: "éƒ‘ä¸»ç®¡",
          å†…å®¹: "æè´§",
          å¤‡æ³¨: "æå–è¥¿é—¨å­æ§åˆ¶æŸœé¢æ¿ï¼Œè¿”å›å·¥å‚"
        },
        {
          æ—¥æœŸ: "2024-01-17",
          æ—¶é—´: "11:30",
          è½¦å‹: "9.6ç±³æ¿è½¦",
          å¸æœºå§“å: "é’±å¸ˆå‚…",
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          å®¢æˆ·ç­¾æ”¶äºº: "å†¯ä¸»ä»»",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "ABBä¼ºæœç”µæœºè½´ï¼Œå…±2ç®±ï¼Œå·²ç­¾æ”¶"
        },
        {
          æ—¥æœŸ: "2024-01-18",
          æ—¶é—´: "08:15",
          è½¦å‹: "12ç±³åŠæŒ‚è½¦",
          å¸æœºå§“å: "å‘¨å¸ˆå‚…",
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          å®¢æˆ·ç­¾æ”¶äºº: "æç»ç†",
          å†…å®¹: "é€è´§",
          å¤‡æ³¨: "GEå‘ç”µæœºç«¯ç›–ç»„ä»¶ï¼Œå…±8ç®±ï¼Œå·²å…¨éƒ¨é€è¾¾"
        },
        {
          æ—¥æœŸ: "2024-01-18",
          æ—¶é—´: "14:00",
          è½¦å‹: "7.2ç±³å¢å¼è½¦",
          å¸æœºå§“å: "å´å¸ˆå‚…",
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          å®¢æˆ·ç­¾æ”¶äºº: "é™ˆä¸»ç®¡",
          å†…å®¹: "æè´§",
          å¤‡æ³¨: "æå–è¥¿é—¨å­å˜é¢‘å™¨æ•£çƒ­å™¨ï¼Œè¿”å›åŠ å·¥"
        }
      ],

      // 3. ECO å˜æ›´ç®¡ç† (ECO List) - é‡æ„ä¸ºæ”¯æŒå¤šç‰©æ–™ç»“æ„
      ecoList: [
        {
          eco_no: "401",
          description: "HAL-X NC1",
          op: "OP220",
          start_set: 1,
          change_details: "æ›´æ¢ä¸ºV2ç‰ˆæœ¬ï¼Œæ³¨æ„å®‰è£…å­”ä½",
          materials: ["151X1249KA08NP17", "151X1249KA08NP18", "151X1249KA08NP19"],
          status: "è¿›è¡Œä¸­",
          update_time: "2024-01-20 10:00",
          é…æ–™å‘˜: "ç‹é…æ–™"
        },
        {
          eco_no: "323",
          description: "GEç‡ƒæ°”è½®æœºå¶ç‰‡ç»„ä»¶-TB-4502",
          op: "OP70",
          start_set: 25,
          change_details: "æ›´æ¢ä¸ºV2ç‰ˆæœ¬ï¼Œæ³¨æ„å®‰è£…å­”ä½",
          materials: ["MAT-GE-TB4502-V2", "MAT-GE-TB4502-V2-BOLT"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-10 14:30",
          é…æ–™å‘˜: "å¼ é…æ–™"
        },
        {
          eco_no: "324",
          description: "è¥¿é—¨å­ç”µæœºå®šå­ç»„ä»¶-SI-7821",
          op: "OP50",
          start_set: 20,
          change_details: "å‡çº§åˆ°V3ç‰ˆæœ¬ï¼Œå¢åŠ æ•£çƒ­ç‰‡",
          materials: ["MAT-SI-7821-V3", "MAT-SI-7821-HEATSINK"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-11 09:15",
          é…æ–™å‘˜: "æé…æ–™"
        },
        {
          eco_no: "325",
          description: "ABBå˜é¢‘å™¨å¤–å£³ç»„ä»¶-ABB-3350",
          op: "OP80",
          start_set: 12,
          change_details: "æ›´æ¢å¤–å£³æè´¨ï¼Œæé«˜è€çƒ­æ€§",
          materials: ["MAT-ABB-3350-V1", "MAT-ABB-3350-SEAL"],
          status: "å·²è¿‡æœŸ",
          update_time: "2023-12-20 16:45",
          é…æ–™å‘˜: "ç‹é…æ–™"
        },
        {
          eco_no: "326",
          description: "GEå‹ç¼©æœºè½¬å­ç»„ä»¶-CP-2891",
          op: "OP60",
          start_set: 6,
          change_details: "ä¼˜åŒ–è½¬å­å¹³è¡¡ï¼Œè°ƒæ•´é…é‡",
          materials: ["MAT-GE-CP2891-V2"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-12 11:20",
          é…æ–™å‘˜: "åˆ˜é…æ–™"
        },
        {
          eco_no: "327",
          description: "è¥¿é—¨å­æ§åˆ¶æŸœé¢æ¿-SI-9012",
          op: "OP90",
          start_set: 30,
          change_details: "æ›´æ–°é¢æ¿å¸ƒå±€ï¼Œå¢åŠ æ¥å£",
          materials: ["MAT-SI-9012-V4", "MAT-SI-9012-CONNECTOR"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-13 15:00",
          é…æ–™å‘˜: "èµµé…æ–™"
        },
        {
          eco_no: "328",
          description: "ABBä¼ºæœç”µæœºè½´-ABB-4456",
          op: "OP70",
          start_set: 15,
          change_details: "æ›´æ¢è½´ææ–™ï¼Œæé«˜å¼ºåº¦",
          materials: ["MAT-ABB-4456-V2"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-14 10:30",
          é…æ–™å‘˜: "å­™é…æ–™"
        },
        {
          eco_no: "329",
          description: "GEå‘ç”µæœºç«¯ç›–ç»„ä»¶-GE-5678",
          op: "OP55",
          start_set: 8,
          change_details: "ä¼˜åŒ–å¯†å°ç»“æ„",
          materials: ["MAT-GE-5678-V1", "MAT-GE-5678-GASKET"],
          status: "å·²è¿‡æœŸ",
          update_time: "2023-12-15 13:10",
          é…æ–™å‘˜: "é’±é…æ–™"
        },
        {
          eco_no: "330",
          description: "è¥¿é—¨å­å˜é¢‘å™¨æ•£çƒ­å™¨-SI-6789",
          op: "OP75",
          start_set: 25,
          change_details: "å¢åŠ æ•£çƒ­é¢ç§¯ï¼Œä¼˜åŒ–é£é“",
          materials: ["MAT-SI-6789-V3", "MAT-SI-6789-FAN"],
          status: "å·²å®Œæˆ",
          update_time: "2024-01-15 08:45",
          é…æ–™å‘˜: "å‘¨é…æ–™"
        }
      ],
      // 4. åˆ°è´§å¼‚å¸¸ç®¡ç† (Inbound Discrepancy)
      discrepancyList: [
        {
          report_id: "W-2025-0102",
          date: "2025-01-15",
          supplier: "è²å°¼å…‹æ–¯",
          po: "PO-889912",
          material: "PHX-TERM-1102",
          qty: 120,
          is_bonded: false,
          category: "å®ç‰©ç ´æŸ",
          description: "å¤–ç®±ç ´æŸï¼Œå†…éƒ¨ç«¯å­æœ‰ç£•ç¢°ï¼Œéœ€äºŒæ¬¡æ£€éªŒ",
          photos: ["damage-box.jpg", "terminal-scratch.jpg"],
          status: "å¾…å¤„ç†",
          result: "",
          duration: 0
        },
        {
          report_id: "W-2025-0103",
          date: "2025-01-14",
          supplier: "ABB",
          po: "PO-776601",
          material: "ABB-MOTOR-4421",
          qty: 50,
          is_bonded: true,
          category: "æ•°é‡å·®å¼‚",
          description: "é€è´§å• 50 ä»¶ï¼Œå®æ”¶ 48 ä»¶ï¼Œå·®å¼‚ 2 ä»¶",
          photos: ["short-qty.jpg"],
          status: "å¤„ç†ä¸­",
          result: "ä¾›åº”å•†æ ¸å¯¹ä¸­",
          duration: 1
        },
        {
          report_id: "W-2025-0104",
          date: "2025-01-12",
          supplier: "åŒ—äº¬ç¦æ¶¦è¾¾",
          po: "PO-770021",
          material: "BRD-FILTER-9001",
          qty: 200,
          is_bonded: false,
          category: "æ ‡ç­¾é”™è¯¯",
          description: "å¤–åŒ…è£…æ ‡ç­¾ä¸å†…ä»¶ç‰©æ–™å·ä¸ä¸€è‡´ï¼Œéœ€é‡æ–°è´´æ ‡",
          photos: ["label-mismatch.jpg"],
          status: "å·²é—­ç¯",
          result: "å·²é‡æ–°è´´æ ‡å¹¶å¤æ ¸",
          duration: 2
        },
        {
          report_id: "W-2025-0105",
          date: "2025-01-11",
          supplier: "è¥¿é—¨å­",
          po: "PO-665512",
          material: "SI-PLC-1200",
          qty: 30,
          is_bonded: false,
          category: "ç³»ç»Ÿé—®é¢˜",
          description: "åˆ°è´§é€šçŸ¥æœªåŒæ­¥ï¼Œç³»ç»Ÿæ—  ASNï¼Œéœ€æ‰‹å·¥å»ºå•",
          photos: [],
          status: "å¾…å¤„ç†",
          result: "",
          duration: 0
        },
        {
          report_id: "W-2025-0106",
          date: "2025-01-10",
          supplier: "ä¼å°”ç‰¹",
          po: "PO-551120",
          material: "WUR-SCREW-9901",
          qty: 1000,
          is_bonded: false,
          category: "å•æ®é—®é¢˜",
          description: "å‘ç¥¨ä¸é€è´§å•æ•°é‡ä¸ä¸€è‡´ï¼Œéœ€ä¾›åº”å•†é‡å¼€å‘ç¥¨",
          photos: ["invoice-issue.jpg"],
          status: "å¤„ç†ä¸­",
          result: "ä¾›åº”å•†è¡¥å¼€ç¥¨",
          duration: 4
        }
      ],

      // 4. å®¢æˆ·è´¹ç”¨ç»“ç®— (Billing Record)
      billingRecord: [
        {
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          è´¹ç”¨ç±»å‹: "ä»“å‚¨è´¹",
          ç»“ç®—å‘¨æœŸ: "å­£ç»“",
          è´¹ç”¨è¯´æ˜: "Q1å­£åº¦ä»“å‚¨è´¹",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-15",
          é¢ç§¯: 100,
          é‡‘é¢: 125000,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-04-01"
        },
        {
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          è´¹ç”¨ç±»å‹: "è¿è¾“è´¹",
          ç»“ç®—å‘¨æœŸ: "å•æ¬¡",
          è´¹ç”¨è¯´æ˜: "è´§è½¦é€æŸœ",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-15",
          é¢ç§¯: 0,
          é‡‘é¢: 8500,
          ç»“ç®—çŠ¶æ€: "å·²å›æ¬¾",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: ""
        },
        {
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          è´¹ç”¨ç±»å‹: "è¿è¾“è´¹",
          ç»“ç®—å‘¨æœŸ: "æœˆç»“",
          è´¹ç”¨è¯´æ˜: "1æœˆè¿è¾“è´¹",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-16",
          é¢ç§¯: 0,
          é‡‘é¢: 12000,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-02-01"
        },
        {
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          è´¹ç”¨ç±»å‹: "ä»“å‚¨è´¹",
          ç»“ç®—å‘¨æœŸ: "å­£ç»“",
          è´¹ç”¨è¯´æ˜: "Q1å­£åº¦ä»“å‚¨è´¹",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-16",
          é¢ç§¯: 120,
          é‡‘é¢: 98000,
          ç»“ç®—çŠ¶æ€: "å·²å›æ¬¾",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: ""
        },
        {
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          è´¹ç”¨ç±»å‹: "ä»“å‚¨è´¹",
          ç»“ç®—å‘¨æœŸ: "æœˆç»“",
          è´¹ç”¨è¯´æ˜: "1æœˆä»“å‚¨è´¹",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-17",
          é¢ç§¯: 70,
          é‡‘é¢: 45000,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-02-02"
        },
        {
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          è´¹ç”¨ç±»å‹: "è¿è¾“è´¹",
          ç»“ç®—å‘¨æœŸ: "å•æ¬¡",
          è´¹ç”¨è¯´æ˜: "è´§è½¦é€æŸœ",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-17",
          é¢ç§¯: 0,
          é‡‘é¢: 6500,
          ç»“ç®—çŠ¶æ€: "å·²å›æ¬¾",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: ""
        },
        {
          å®¢æˆ·åç§°: "å“ˆå¾·æ°",
          è´¹ç”¨ç±»å‹: "è¿è¾“è´¹",
          ç»“ç®—å‘¨æœŸ: "å•æ¬¡",
          è´¹ç”¨è¯´æ˜: "å¤§å‹è®¾å¤‡è¿è¾“",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-18",
          é¢ç§¯: 0,
          é‡‘é¢: 18500,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: ""
        },
        {
          å®¢æˆ·åç§°: "ä¸Šæµ·ç«æ»¡",
          è´¹ç”¨ç±»å‹: "ä»“å‚¨è´¹",
          è´¹ç”¨è¯¦æƒ…: "æœˆåº¦ä»“å‚¨è´¹",
          å‘ç”Ÿæ—¥æœŸ: "2024-01-18",
          é¢ç§¯: 95,
          é‡‘é¢: 32000,
          ç»“ç®—çŠ¶æ€: "å¾…ç»“ç®—",
          ä¸‹æ¬¡æé†’æ—¥æœŸ: "2024-01-28"
        }
      ],

      // ä¾›åº”å•†å­—å…¸ (Supplier Dictionary - ä¸­è‹±æ–‡å¯¹ç…§)
      supplierDict: [
        { en: 'JABIL CIRCUITS INC', cn: 'æ·æ™®ç”µå­' },
        { en: 'Semikron Hong Kong Co Ltd', cn: 'èµ›ç±³æ§' },
        { en: 'Eaton Corporation', cn: 'ä¼Šé¡¿' },
        { en: 'GE DRIVES & CONTROLS, INC.', cn: 'GE é©±åŠ¨æ§åˆ¶' },
        { en: 'Bossard', cn: 'åšè¨å¾·ç´§å›ºä»¶' },
        { en: 'Siemens', cn: 'è¥¿é—¨å­' },
        { en: 'ABB', cn: 'ABB' }
      ],

      // 5. ä¾›åº”å•†æ”¶è´§ç›‘æ§ (Receiving Tasks)
      receivingTasks: [
        {
          ä¾›åº”å•†åç§°: "Bossard åšè¨å¾·ç´§å›ºä»¶",
          supplier_en: "Bossard",
          supplier_cn: "åšè¨å¾·ç´§å›ºä»¶",
          åˆ°è´§æ—¥æœŸ: "2024-01-18 10:00",
          æ€»è¡Œæ•°: 120,
          physical_qty: 5,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 65,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-18", count: 45, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-19", count: 20, operator: "ä»“åº“æ”¶è´§å‘˜-å¼ å¼º" }
          ],
          å½“å‰çŠ¶æ€: "âš ï¸æœ‰ç§¯å‹"
        },
        {
          ä¾›åº”å•†åç§°: "GE èƒ½æºé›¶éƒ¨ä»¶ä¸­å¿ƒ",
          supplier_en: "GE DRIVES & CONTROLS, INC.",
          supplier_cn: "GE é©±åŠ¨æ§åˆ¶",
          åˆ°è´§æ—¥æœŸ: "2024-01-17 15:30",
          æ€»è¡Œæ•°: 80,
          physical_qty: 3,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 80,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-17", count: 50, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-18", count: 30, operator: "ä»“åº“æ”¶è´§å‘˜-ææ•" }
          ],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "Siemens - è¥¿é—¨å­",
          supplier_en: "Siemens",
          supplier_cn: "è¥¿é—¨å­",
          åˆ°è´§æ—¥æœŸ: "2024-01-16 09:00",
          æ€»è¡Œæ•°: 150,
          physical_qty: 8,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 92,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-16", count: 40, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-17", count: 30, operator: "ä»“åº“æ”¶è´§å‘˜-ç‹å»º" },
            { date: "2024-01-18", count: 22, operator: "ä»“åº“æ”¶è´§å‘˜-ç‹å»º" }
          ],
          å½“å‰çŠ¶æ€: "âš ï¸æœ‰ç§¯å‹"
        },
        {
          ä¾›åº”å•†åç§°: "ABB - ABB",
          supplier_en: "ABB",
          supplier_cn: "ABB",
          åˆ°è´§æ—¥æœŸ: "2024-01-15 14:20",
          æ€»è¡Œæ•°: 200,
          physical_qty: 12,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 150,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-15", count: 60, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-16", count: 55, operator: "ä»“åº“æ”¶è´§å‘˜-åˆ˜ä¼Ÿ" },
            { date: "2024-01-17", count: 35, operator: "ä»“åº“æ”¶è´§å‘˜-åˆ˜ä¼Ÿ" }
          ],
          å½“å‰çŠ¶æ€: "ğŸ”´å·²è¶…æ—¶"
        },
        {
          ä¾›åº”å•†åç§°: "å…ˆå¯¼ç²¾å¯†åŒ…è£…ææ–™",
          supplier_en: "",
          supplier_cn: "å…ˆå¯¼ç²¾å¯†åŒ…è£…ææ–™",
          åˆ°è´§æ—¥æœŸ: "2024-01-18 08:30",
          æ€»è¡Œæ•°: 60,
          physical_qty: 2,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 18,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-18", count: 18, operator: "ç³»ç»Ÿå¯¼å…¥" }
          ],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "å¯Œåˆ›ç²¾å¯†æœºåŠ ä»¶",
          supplier_en: "",
          supplier_cn: "å¯Œåˆ›ç²¾å¯†æœºåŠ ä»¶",
          åˆ°è´§æ—¥æœŸ: "2024-01-17 11:10",
          æ€»è¡Œæ•°: 90,
          physical_qty: 4,
          unit: "ç®±",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 40,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-17", count: 25, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-18", count: 15, operator: "ä»“åº“æ”¶è´§å‘˜-å‘¨é’" }
          ],
          å½“å‰çŠ¶æ€: "âš ï¸æœ‰ç§¯å‹"
        },
        // æ–°å¢ï¼šç­‰å¾… GE æŠ¥è¡¨å¯¼å…¥çš„ç¤ºä¾‹æ•°æ®ï¼ˆpending çŠ¶æ€ï¼‰
        {
          ä¾›åº”å•†åç§°: "JABIL CIRCUITS INC - æ·æ™®ç”µå­",
          supplier_en: "JABIL CIRCUITS INC",
          supplier_cn: "æ·æ™®ç”µå­",
          åˆ°è´§æ—¥æœŸ: "2024-01-19 09:00",
          æ€»è¡Œæ•°: 0,
          physical_qty: 6,
          unit: "æ‰˜",
          data_source: "pending",
          å·²å®Œæˆæ•°é‡: 0,
          æ¯æ—¥è¿›åº¦è®°å½•: [],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "Semikron Hong Kong Co Ltd - èµ›ç±³æ§",
          supplier_en: "Semikron Hong Kong Co Ltd",
          supplier_cn: "èµ›ç±³æ§",
          åˆ°è´§æ—¥æœŸ: "2024-01-19 14:30",
          æ€»è¡Œæ•°: 0,
          physical_qty: 3,
          unit: "ç®±",
          data_source: "pending",
          å·²å®Œæˆæ•°é‡: 0,
          æ¯æ—¥è¿›åº¦è®°å½•: [],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "Eaton Corporation - ä¼Šé¡¿",
          supplier_en: "Eaton Corporation",
          supplier_cn: "ä¼Šé¡¿",
          åˆ°è´§æ—¥æœŸ: "2024-01-18 16:00",
          æ€»è¡Œæ•°: 0,
          physical_qty: 10,
          unit: "ä»¶",
          data_source: "pending",
          å·²å®Œæˆæ•°é‡: 0,
          æ¯æ—¥è¿›åº¦è®°å½•: [],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "GE DRIVES & CONTROLS, INC. - GE é©±åŠ¨æ§åˆ¶",
          supplier_en: "GE DRIVES & CONTROLS, INC.",
          supplier_cn: "GE é©±åŠ¨æ§åˆ¶",
          åˆ°è´§æ—¥æœŸ: "2024-01-20 08:00",
          æ€»è¡Œæ•°: 0,
          physical_qty: 7,
          unit: "æ‰˜",
          data_source: "pending",
          å·²å®Œæˆæ•°é‡: 0,
          æ¯æ—¥è¿›åº¦è®°å½•: [],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        },
        {
          ä¾›åº”å•†åç§°: "JABIL CIRCUITS INC - æ·æ™®ç”µå­",
          supplier_en: "JABIL CIRCUITS INC",
          supplier_cn: "æ·æ™®ç”µå­",
          åˆ°è´§æ—¥æœŸ: "2024-01-17 13:20",
          æ€»è¡Œæ•°: 180,
          physical_qty: 9,
          unit: "æ‰˜",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 120,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-17", count: 80, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-18", count: 40, operator: "ä»“åº“æ”¶è´§å‘˜-èµµæ˜" }
          ],
          å½“å‰çŠ¶æ€: "âš ï¸æœ‰ç§¯å‹"
        },
        {
          ä¾›åº”å•†åç§°: "Eaton Corporation - ä¼Šé¡¿",
          supplier_en: "Eaton Corporation",
          supplier_cn: "ä¼Šé¡¿",
          åˆ°è´§æ—¥æœŸ: "2024-01-16 11:00",
          æ€»è¡Œæ•°: 95,
          physical_qty: 5,
          unit: "ç®±",
          data_source: "synced",
          å·²å®Œæˆæ•°é‡: 95,
          æ¯æ—¥è¿›åº¦è®°å½•: [
            { date: "2024-01-16", count: 50, operator: "ç³»ç»Ÿå¯¼å…¥" },
            { date: "2024-01-17", count: 45, operator: "ä»“åº“æ”¶è´§å‘˜-é™ˆä¸½" }
          ],
          å½“å‰çŠ¶æ€: "æ­£å¸¸"
        }
      ],

      // 6. ç¼ºé™·ç®¡ç† (Defect Management)
      defectList: [
        {
          å‘ç°æ—¥æœŸ: "2024-01-18",
          ç±»å‹: "Bç±»",
          ç§ç±»: "æ¼é…",
          æ˜¯å¦æŒ‰ç¯: true,
          äº§å“: "TB",
          é—®é¢˜æè¿°: "å·¥å•TB-2024-0123ç¼ºå°‘2ä¸ªM6èºæ “",
          å‘ç°äºº: "å¼ è´¨æ£€",
          è´£ä»»äºº: "æé…æ–™",
          åŸå› : "é…æ–™æ¸…å•æœªå®Œæ•´æ ¸å¯¹",
          è§£å†³æ–¹æ¡ˆ: "è¡¥å……ç¼ºå¤±ç‰©æ–™ï¼ŒåŠ å¼ºæ¸…å•å¤æ ¸",
          '5WHYæ–‡ä»¶': "5why-tb-2024-0123.pdf",
          å¤‡æ³¨: "å·²è¡¥å‘ï¼Œåç»­åŠ å¼ºæ£€æŸ¥"
        },
        {
          å‘ç°æ—¥æœŸ: "2024-01-17",
          ç±»å‹: "Cç±»",
          ç§ç±»: "é”™é…",
          æ˜¯å¦æŒ‰ç¯: false,
          äº§å“: "19DTA",
          é—®é¢˜æè¿°: "ä½¿ç”¨äº†é”™è¯¯è§„æ ¼çš„å¯†å°åœˆ",
          å‘ç°äºº: "ç‹æ£€éªŒ",
          è´£ä»»äºº: "å‘¨è£…é…",
          åŸå› : "ç‰©æ–™æ ‡è¯†ä¸æ¸…ï¼Œæœªä»”ç»†æ ¸å¯¹",
          è§£å†³æ–¹æ¡ˆ: "é‡æ–°æ ‡è¯†ç‰©æ–™ï¼ŒåŸ¹è®­æ“ä½œè§„èŒƒ",
          '5WHYæ–‡ä»¶': "",
          å¤‡æ³¨: "å·²æ›´æ¢æ­£ç¡®ç‰©æ–™"
        },
        {
          å‘ç°æ—¥æœŸ: "2024-01-16",
          ç±»å‹: "Bç±»",
          ç§ç±»: "ç‰©æ–™æ‘†å",
          æ˜¯å¦æŒ‰ç¯: true,
          äº§å“: "TB",
          é—®é¢˜æè¿°: "ç”µæœºå®šå­å®‰è£…æ–¹å‘é”™è¯¯",
          å‘ç°äºº: "èµµè´¨æ£€",
          è´£ä»»äºº: "å´è£…é…",
          åŸå› : "è£…é…å›¾çº¸ç†è§£æœ‰è¯¯",
          è§£å†³æ–¹æ¡ˆ: "é‡æ–°åŸ¹è®­è£…é…æµç¨‹ï¼Œæ˜ç¡®æ–¹å‘æ ‡è¯†",
          '5WHYæ–‡ä»¶': "5why-tb-motor-2024-0116.pdf",
          å¤‡æ³¨: "å·²è¿”å·¥ï¼Œæ›´æ–°ä½œä¸šæŒ‡å¯¼ä¹¦"
        },
        {
          å‘ç°æ—¥æœŸ: "2024-01-15",
          ç±»å‹: "Cç±»",
          ç§ç±»: "æ¼é…",
          æ˜¯å¦æŒ‰ç¯: false,
          äº§å“: "19DTA",
          é—®é¢˜æè¿°: "ç¼ºå°‘åŒ…è£…æ ‡ç­¾",
          å‘ç°äºº: "å­™åŒ…è£…",
          è´£ä»»äºº: "éƒ‘åŒ…è£…",
          åŸå› : "åŒ…è£…æµç¨‹é—æ¼æ ‡ç­¾ç¯èŠ‚",
          è§£å†³æ–¹æ¡ˆ: "å®Œå–„åŒ…è£…æ£€æŸ¥æ¸…å•",
          '5WHYæ–‡ä»¶': "",
          å¤‡æ³¨: "å·²è¡¥æ‰“æ ‡ç­¾"
        },
        {
          å‘ç°æ—¥æœŸ: "2024-01-14",
          ç±»å‹: "Bç±»",
          ç§ç±»: "é”™é…",
          æ˜¯å¦æŒ‰ç¯: true,
          äº§å“: "TB",
          é—®é¢˜æè¿°: "ä½¿ç”¨äº†éæ ‡å‡†ä»¶æ›¿ä»£æ ‡å‡†ä»¶",
          å‘ç°äºº: "é’±è´¨æ£€",
          è´£ä»»äºº: "å†¯é‡‡è´­",
          åŸå› : "ç´§æ€¥é‡‡è´­æ—¶æœªä¸¥æ ¼æŒ‰è§„æ ¼æ‰§è¡Œ",
          è§£å†³æ–¹æ¡ˆ: "å»ºç«‹ç´§æ€¥é‡‡è´­å®¡æ‰¹æµç¨‹ï¼Œç¦æ­¢éšæ„æ›¿ä»£",
          '5WHYæ–‡ä»¶': "5why-tb-nonstandard-2024-0114.pdf",
          å¤‡æ³¨: "å·²æ›´æ¢æ ‡å‡†ä»¶ï¼Œæµç¨‹å·²æ›´æ–°"
        }
      ]
    };

    // BI Dashboard Mock æ•°æ®
    const biMockData = {
      kpi: {
        monthlyProduction: 25320,
        avgDPMO: 76.3,
        receivingOnTimeRate: 99.8,
        supplierIssues: 45
      },
      // äº§é‡ä¸ç¼ºé™·ç‡è¶‹åŠ¿ï¼ˆ1-12æœˆï¼‰
      productionDefectTrend: {
        months: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
        production: [18500, 21200, 19800, 22800, 24500, 23800, 25200, 26800, 25320, 24100, 23500, 24800],
        dmpo: [82.5, 78.2, 85.1, 75.8, 72.3, 79.5, 74.2, 71.6, 76.3, 78.9, 80.1, 77.5]
      },
      // æ”¶å‘è´§ç¼ºé™·åˆ†å¸ƒ
      defectDistribution: {
        categories: ['åˆ°è´§ç¼ºé™·', 'å‘è´§ç¼ºé™·'],
        series: [
          { name: 'æ¸…ç‚¹é—®é¢˜', data: [45, 28] },
          { name: 'ä¸Šæ¶é—®é¢˜', data: [32, 15] },
          { name: 'å‘è½¦é—®é¢˜', data: [0, 42] },
          { name: 'åŒ…è£…é—®é¢˜', data: [18, 12] },
          { name: 'å…¶ä»–', data: [8, 5] }
        ]
      },
      // æ”¶å‘è´§åŠæ—¶æ€§å¯¹æ¯”ï¼ˆ9æœˆä»½æ¯å¤©ï¼‰
      receivingShippingTimeliness: {
        dates: Array.from({ length: 30 }, (_, i) => `${i + 1}æ—¥`),
        receiving: [120, 135, 128, 142, 138, 145, 132, 150, 148, 140, 155, 142, 138, 145, 132, 148, 152, 145, 140, 135, 142, 148, 150, 145, 138, 142, 148, 152, 145, 140],
        shipping: [115, 130, 125, 140, 135, 142, 128, 145, 143, 135, 150, 138, 132, 140, 125, 142, 145, 138, 132, 128, 135, 142, 145, 140, 132, 138, 142, 148, 140, 135]
      },
      // ä¾›åº”å•†é—®é¢˜åˆ†å¸ƒ
      supplierIssueDistribution: [
        { name: 'ç³»ç»Ÿé—®é¢˜', value: 70 },
        { name: 'å•æ®é—®é¢˜', value: 27 },
        { name: 'å®ç‰©é—®é¢˜', value: 3 }
      ]
    };

    const app = createApp({
      data() {
        return {
          // 1. å…¨å±€å½“å‰ç”¨æˆ·çŠ¶æ€
          currentUser: {
            name: 'ç®¡ç†å‘˜',
            role: 'admin' // å¯é€‰å€¼: admin, role_a, role_b, role_c, receiver
          },
          
          // 2. è§’è‰²æƒé™å®šä¹‰ (RBAC)
          roles: {
            admin: {
              name: 'ç®¡ç†å‘˜',
              menus: ['bi', 'production', 'workorder', 'supplier', 'arrival', 'discrepancy', 'vehicle', 'picking', 'defect', 'billing', 'eco'],
              canViewAmount: true
            },
            role_a: {
              name: 'ç”Ÿäº§ä¸“å‘˜',
              menus: ['bi', 'production', 'workorder', 'picking', 'defect', 'arrival'],
              canViewAmount: false
            },
            role_b: {
              name: 'GEç‰©æµ',
              menus: ['bi', 'production', 'workorder', 'supplier', 'arrival', 'discrepancy', 'vehicle'],
              canViewAmount: false
            },
            role_c: {
              name: 'ç»¼åˆè´¢åŠ¡',
              menus: ['bi', 'production', 'workorder', 'eco', 'billing', 'vehicle', 'arrival'],
              canViewAmount: false
            },
            receiver: {
              name: 'æ”¶è´§å‘˜',
              menus: ['arrival'],
              canViewAmount: false
            }
          },

          // 3. èœå•é¡¹å®šä¹‰ (å·²æŒ‰æœ€æ–°ä¸šåŠ¡é€»è¾‘æ’åº)
          menuItems: [
            // --- å…¬å…±æŸ¥è¯¢åŒº ---
            { id: 'bi', key: 'bi', name: 'ğŸ“Š ç»è¥æŠ¥è¡¨', icon: 'chart-bar' },
            { id: 'production', key: 'production', name: 'ğŸ“… ç”Ÿäº§è®¡åˆ’', icon: 'calendar' },
            { id: 'workorder', key: 'workorder', name: 'ğŸ“‹ å·¥å•ç®¡ç†', icon: 'list-alt' },
            
            // --- ç‰©æµä¸ä¾›åº”é“¾ (Role B) ---
            { id: 'supplier', key: 'supplier', name: 'ğŸšš ä¾›åº”å•†æ”¶è´§ç›‘æ§', icon: 'truck' },
            { id: 'arrival', key: 'arrival', name: 'ğŸ“ åˆ°è´§ç™»è®°', icon: 'clipboard-list' },
            { id: 'discrepancy', key: 'discrepancy', name: 'âš ï¸ åˆ°è´§å¼‚å¸¸ç®¡ç†', icon: 'exclamation-circle' },
            { id: 'vehicle', key: 'vehicle', name: 'ğŸš› è½¦æ¬¡ç®¡ç†', icon: 'shipping-fast' },

            // --- ç”Ÿäº§ä¸æ‰§è¡Œ (Role A) ---
            { id: 'picking', key: 'picking', name: 'ğŸ­ å·¥å•é…æ–™', icon: 'boxes' },
            { id: 'defect', key: 'defect', name: 'ğŸ› ï¸ ç¼ºé™·ç®¡ç†', icon: 'tools' },

            // --- è´¢åŠ¡ä¸å˜æ›´ (Role C / Common) ---
            { id: 'billing', key: 'billing', name: 'ğŸ’° å®¢æˆ·è´¹ç”¨ç»“ç®—', icon: 'file-invoice-dollar' },
            { id: 'eco', key: 'eco', name: 'ğŸ”„ ECO å˜æ›´ç®¡ç†', icon: 'sync' }
          ],

          // 4. å½“å‰é€‰ä¸­çš„èœå•
          currentMenu: 'bi', // é»˜è®¤é€‰ä¸­ç»è¥æŠ¥è¡¨
          
          // 5. UI çŠ¶æ€æ§åˆ¶
          showRoleDropdown: false,
          showResetConfirm: false,
          resetConfirmInput: '',
          
          // 6. å„ä¸ªæ¨¡å—çš„æ•°æ®æº (Mock Data + LocalStorage)
          // ä¼˜å…ˆä» localStorage è¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ mockData
          productionPlan: (() => {
            try {
              const saved = localStorage.getItem('productionPlanData');
              if (saved) {
                return JSON.parse(saved);
              }
            } catch (e) {
              console.error('è¯»å– localStorage å¤±è´¥:', e);
            }
            return mockData.productionPlan || [];
          })(),
          planUpdateTime: localStorage.getItem('planUpdateTime') || null,
          // ç”Ÿäº§è®¡åˆ’æŸ¥è¯¢ç­›é€‰
          productionPlanSearchKeyword: '',
          productionPlanSearchDate: '',
          // å·¥å•ç®¡ç†ï¼šæ•°æ®æ¥æºä¸ç”Ÿäº§è®¡åˆ’ä¸€è‡´
          workOrderList: [],
          workOrderSearchKeyword: '',
          // è½¦æ¬¡ç®¡ç†ï¼šä¼˜å…ˆä» localStorage è¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ mockData
          vehicleLog: (() => {
            try {
              const saved = localStorage.getItem('vehicleLogData');
              if (saved) {
                return JSON.parse(saved);
              }
            } catch (e) {
              console.error('è¯»å– vehicleLog localStorage å¤±è´¥:', e);
            }
            return mockData.vehicleLog || [];
          })(),
          // ECO å˜æ›´ç®¡ç†ï¼šä¼˜å…ˆä» localStorage è¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ mockDataï¼ˆå®Œå…¨æœ¬åœ°åŒ–ï¼Œæ— äº‘ä¾èµ–ï¼‰
          ecoList: (() => {
            try {
              // ä¼˜å…ˆè¯»å–æ–° key
              let saved = localStorage.getItem('localEcoList');
              if (!saved) {
                // å…¼å®¹æ—§ keyï¼Œå¦‚æœå­˜åœ¨åˆ™è¿ç§»
                saved = localStorage.getItem('localEcoData');
                if (saved) {
                  localStorage.setItem('localEcoList', saved);
                  localStorage.removeItem('localEcoData'); // æ¸…ç†æ—§ key
                }
              }
              if (saved) {
                const parsed = JSON.parse(saved);
                if (Array.isArray(parsed) && parsed.length > 0) {
                  return parsed;
                }
              }
            } catch (e) {
              console.error('è¯»å– localStorage ECO æ•°æ®å¤±è´¥:', e);
            }
            // å¦‚æœ localStorage ä¸ºç©ºï¼Œä½¿ç”¨ mockData ä½œä¸ºé»˜è®¤æ•°æ®
            return mockData.ecoList || [];
          })(),
          billingRecord: mockData.billingRecord || [],
          discrepancyList: mockData.discrepancyList || [],
          receivingTasks: mockData.receivingTasks || [],
          defectList: mockData.defectList || [],
          userRole: 'staff', // ä¿ç•™å…¼å®¹æ€§ï¼Œä½†ç»Ÿä¸€ä½¿ç”¨ currentUser.role
          isBossMode: false, // ä¿ç•™å…¼å®¹æ€§
          searchKeywordDiscrepancy: '',
          // ç¼ºé™·ç®¡ç†ç­›é€‰
          defectFilterMonth: '',
          defectFilterType: '',
          showDiscrepancyModal: false,
          showDiscrepancyDetailModal: false,
          currentDiscrepancyItem: null,
          discrepancyHandleResult: '',
          discrepancyHandleStatus: 'å¤„ç†ä¸­',
          newDiscrepancy: {
            supplier: '',
            date: '',
            po: '',
            material: '',
            line_no: '',
            qty: '',
            is_bonded: false,
            category: 'ç³»ç»Ÿé—®é¢˜',
            description: '',
            photos: [],
            status: 'å¾…å¤„ç†',
            result: ''
          },
          // BI Dashboard æ•°æ®
          biData: biMockData,
          chartInstances: {
            chart1: null,
            chart2: null,
            chart3: null,
            chart4: null
          },
          searchKeyword: '',
          searchKeywordVehicle: '',
          searchKeywordBilling: '',
          searchKeywordArrival: '',
          receivingSearchKeyword: '',
          // åˆ°è´§ç™»è®°æ•°æ®
          arrivalLog: (() => {
            try {
              const saved = localStorage.getItem('arrivalLogData');
              if (saved) {
                return JSON.parse(saved);
              }
            } catch (e) {
              console.error('è¯»å–åˆ°è´§ç™»è®°æ•°æ®å¤±è´¥:', e);
            }
            return [];
          })(),
          // ä¾›åº”å•†åç§°è‡ªåŠ¨è®°å¿†
          savedSupplierNames: (() => {
            try {
              const saved = localStorage.getItem('savedSupplierNames');
              if (saved) {
                return JSON.parse(saved);
              }
            } catch (e) {
              console.error('è¯»å–ä¾›åº”å•†åç§°åˆ—è¡¨å¤±è´¥:', e);
            }
            // é¢„ç½®å¸¸ç”¨ä¾›åº”å•†åç§°
            return ['GEå·¥å‚', 'å“ˆå¾·æ°', 'ä¸Šæµ·ç«æ»¡', 'JABIL', 'Grundfos'];
          })(),
          showArrivalModal: false,
          newArrival: {
            æ—¥æœŸ: '',
            æ—¶é—´: '',
            ä¾›åº”å•†åç§°: '',
            å®ç‰©æ•°é‡: '',
            å•ä½: 'æ‰˜',
            é€è´§å•å·: '',
            å¤‡æ³¨: ''
          },
          showArrivalFeedbackModal: false,
          currentArrivalFeedbackIndex: -1,
          arrivalFeedback: {
            actual_qty: '',
            feedback_remark: ''
          },
          activeReceivingTab: 'ongoing',
          receivingPage: 1,
          receivingPageSize: 10,
          showCreateModal: false,
          showNewReceivingModal: false,
          showReceivingDetailModal: false,
          showVehicleLogModal: false,
          currentReceivingDetailTask: null,
          // åŒè¡¨ä¸Šä¼ ç›¸å…³æ•°æ®
          transactionLogFile: null,
          mappingTableFile: null,
          transactionLogData: null,
          mappingTableData: null,
          itemToSupplierMap: {},
          unknownSupplierCount: 0,
          // æœªçŸ¥ä¾›åº”å•†å…³è”å¼¹çª—
          showUnknownSupplierModal: false,
          unknownSuppliersQueue: [],
          currentUnknownSupplier: null,
          unknownSupplierCnInput: '',
          newReceivingTask: {
            ä¾›åº”å•†åç§°: '',
            supplier_en: '',
            supplier_cn: '',
            åˆ°è´§æ—¥æœŸ: '',
            æ€»è¡Œæ•°: 0,
            physical_qty: '',
            unit: 'æ‰˜',
            data_source: 'pending',
            å¤‡æ³¨: ''
          },
          supplierSearchInput: '',
          selectedSupplier: null,
          showSupplierDropdown: false,
          filteredSupplierOptions: [],
          showBillingModal: false,
          newBilling: {
            å®¢æˆ·åç§°: '',
            è´¹ç”¨ç±»å‹: '',
            é¢ç§¯: '',
            ç»“ç®—å‘¨æœŸ: '',
            è´¹ç”¨è¯´æ˜: '',
            å‘ç”Ÿæ—¥æœŸ: '',
            é‡‘é¢: ''
          },
          newEco: {
            eco_no: '',
            description: '',
            op: '',
            start_set: '',
            change_details: '',
            materials: [],
            status: 'è¿›è¡Œä¸­'
          },
          newVehicleLog: {
            æ—¥æœŸ: '',
            æ—¶é—´: '',
            è½¦å‹: '',
            å¸æœºå§“å: '',
            å®¢æˆ·åç§°: '',
            å®¢æˆ·ç­¾æ”¶äºº: '',
            å†…å®¹: '',
            å¤‡æ³¨: ''
          },
          showDefectModal: false,
          newDefect: {
            å‘ç°æ—¥æœŸ: '',
            ç±»å‹: '',
            ç§ç±»: '',
            æ˜¯å¦æŒ‰ç¯: false,
            äº§å“: '',
            é—®é¢˜æè¿°: '',
            å‘ç°äºº: '',
            è´£ä»»äºº: '',
            åŸå› : '',
            è§£å†³æ–¹æ¡ˆ: '',
            '5WHYæ–‡ä»¶': '',
            å¤‡æ³¨: ''
          },
          defectFile: null,
          excelFileInput: null,
          // å·¥å•é…æ–™ç®¡ç†æ•°æ®
          planData: [],
          bomData: [],
          matchedWorkOrders: [],
          selectedWorkOrderIndex: -1,
          // å·¥å•é…æ–™ï¼šæ—¥æœŸç­›é€‰
          pickingSearchDate: '',
          // å·¥å•é…æ–™ï¼šæ‰“å°æ—¶é—´
          printTime: ''
        };
      },
      computed: {
        currentMenuName() {
          const menu = this.menuItems.find(m => m.key === this.currentMenu);
          return menu ? menu.name : '';
        },
        // æ ¹æ®å½“å‰è§’è‰²è¿‡æ»¤å¯è§èœå•ï¼ˆå…¬å…±æ¨¡å—æ‰€æœ‰äººå¯è§ï¼Œæ”¶è´§å‘˜é™¤å¤–ï¼‰
        visibleMenuItems() {
          const roleConfig = this.roles[this.currentUser.role];
          if (!roleConfig) return [];
          
          // æ”¶è´§å‘˜è§’è‰²ï¼šåªèƒ½çœ‹åˆ°"åˆ°è´§ç™»è®°"æ¨¡å—
          if (this.currentUser.role === 'receiver') {
            return this.menuItems.filter(item => item.id === 'arrival');
          }
          
          // å…¬å…±æ¨¡å—ï¼šdashboard, plan, work_order (å…¶ä»–äººå¯è§)
          const commonMenus = ['bi', 'production', 'workorder'];
          
          // è·å–è§’è‰²ä¸“å±èœå•
          const roleMenus = roleConfig.menus || [];
          
          // åˆå¹¶å…¬å…±æ¨¡å—å’Œè§’è‰²ä¸“å±èœå•
          const allVisibleMenus = [...new Set([...commonMenus, ...roleMenus])];
          
          return this.menuItems.filter(item => allVisibleMenus.includes(item.id));
        },
        // è®¡ç®—å±æ€§ï¼šæ ¹æ®æœç´¢å…³é”®å­—è¿‡æ»¤æœ¬åœ° ecoListï¼ˆæ”¯æŒæ–°æ—§æ•°æ®ç»“æ„ï¼‰
        filteredEcoList() {
          const kw = (this.searchKeyword || '').trim().toLowerCase();
          if (!kw) return this.ecoList;
          return this.ecoList.filter(item => {
            const ecoNo = String(item.eco_no || item.ECOå· || '').toLowerCase();
            const desc = String(item.description || item.äº§å“æè¿° || '').toLowerCase();
            // æ”¯æŒæœç´¢ç‰©æ–™å·ï¼ˆæ–°ç»“æ„ä¸­çš„ materials æ•°ç»„ï¼‰
            const materials = item.materials || [];
            const materialMatch = materials.some(mat => String(mat || '').toLowerCase().includes(kw));
            // å…¼å®¹æ—§ç»“æ„çš„å•ç‰©æ–™å·
            const oldMaterial = String(item.ç‰©æ–™å· || '').toLowerCase();
            return ecoNo.includes(kw) || desc.includes(kw) || materialMatch || oldMaterial.includes(kw);
          });
        },
        // è¿‡æ»¤è½¦æ¬¡ç®¡ç†æ•°æ®
        filteredVehicleLog() {
          const kw = (this.searchKeywordVehicle || '').trim().toLowerCase();
          if (!kw) return this.vehicleLog;
          return this.vehicleLog.filter(item => {
            const customer = String(item.å®¢æˆ·åç§° || '').toLowerCase();
            const driver = String(item.å¸æœºå§“å || '').toLowerCase();
            const vehicle = String(item.è½¦å‹ || '').toLowerCase();
            return customer.includes(kw) || driver.includes(kw) || vehicle.includes(kw);
          });
        },
        // è¿‡æ»¤å®¢æˆ·è´¹ç”¨ç»“ç®—æ•°æ®
        filteredBillingRecord() {
          const kw = (this.searchKeywordBilling || '').trim().toLowerCase();
          if (!kw) return this.billingRecord;
          return this.billingRecord.filter(item => {
            const customer = String(item.å®¢æˆ·åç§° || '').toLowerCase();
            const type = String(item.è´¹ç”¨ç±»å‹ || '').toLowerCase();
            return customer.includes(kw) || type.includes(kw);
          });
        },
        // è¿‡æ»¤åˆ°è´§ç™»è®°æ•°æ®
        filteredArrivalLog() {
          const kw = (this.searchKeywordArrival || '').trim().toLowerCase();
          if (!kw) {
            // æŒ‰æ—¥æœŸå€’åºæ’åˆ—
            return [...this.arrivalLog].sort((a, b) => {
              const dateA = new Date(a.æ—¥æœŸ || '');
              const dateB = new Date(b.æ—¥æœŸ || '');
              return dateB - dateA;
            });
          }
          return this.arrivalLog.filter(item => {
            const supplier = String(item.ä¾›åº”å•†åç§° || '').toLowerCase();
            const date = String(item.æ—¥æœŸ || '').toLowerCase();
            return supplier.includes(kw) || date.includes(kw);
          }).sort((a, b) => {
            const dateA = new Date(a.æ—¥æœŸ || '');
            const dateB = new Date(b.æ—¥æœŸ || '');
            return dateB - dateA;
          });
        },
        // è¿‡æ»¤åˆ°è´§å¼‚å¸¸æ•°æ®
        filteredDiscrepancyList() {
          const kw = (this.searchKeywordDiscrepancy || '').trim().toLowerCase();
          if (!kw) return this.discrepancyList || [];
          return (this.discrepancyList || []).filter(item => {
            const supplier = String(item.supplier || '').toLowerCase();
            const po = String(item.po || '').toLowerCase();
            const material = String(item.material || '').toLowerCase();
            const category = String(item.category || '').toLowerCase();
            const status = String(item.status || '').toLowerCase();
            const desc = String(item.description || '').toLowerCase();
            return (
              supplier.includes(kw) ||
              po.includes(kw) ||
              material.includes(kw) ||
              category.includes(kw) ||
              status.includes(kw) ||
              desc.includes(kw)
            );
          });
        },
        // ç¼ºé™·ç®¡ç†ï¼šæŒ‰æœˆä»½ã€ç±»å‹ç­›é€‰
        filteredDefectList() {
          let list = this.defectList || [];

          // æŒ‰æœˆä»½ç­›é€‰ï¼ˆå‘ç°æ—¥æœŸå‰7ä½å¦‚ 2024-01ï¼‰
          if (this.defectFilterMonth) {
            const month = this.defectFilterMonth; // æ ¼å¼ï¼šYYYY-MM
            list = list.filter(item => {
              const dateStr = String(item.å‘ç°æ—¥æœŸ || '').trim().replace(/\//g, '-');
              return dateStr.startsWith(month);
            });
          }

          // æŒ‰ç±»å‹ç­›é€‰ï¼ˆBç±»/Cç±»ç­‰ï¼‰
          if (this.defectFilterType) {
            const type = this.defectFilterType;
            list = list.filter(item => String(item.ç±»å‹ || '').trim() === type);
          }

          return list;
        },
        uniqueBillingCustomers() {
          const set = new Set();
          (this.billingRecord || []).forEach(item => {
            if (item.å®¢æˆ·åç§°) set.add(item.å®¢æˆ·åç§°);
          });
          return Array.from(set);
        },
        // ä¾›åº”å•†æ”¶è´§ç›‘æ§ï¼šæ ¹æ®æ ‡ç­¾å’Œæœç´¢è¿‡æ»¤
        filteredReceivingTasks() {
          const kw = (this.receivingSearchKeyword || '').trim().toLowerCase();
          return (this.receivingTasks || []).filter(task => {
            // çŠ¶æ€æ ‡ç­¾è¿‡æ»¤
            if (this.activeReceivingTab === 'ongoing') {
              const isBacklog = String(task.å½“å‰çŠ¶æ€ || '').includes('æœ‰ç§¯å‹') || String(task.å½“å‰çŠ¶æ€ || '').includes('âš ï¸');
              const isNormalOngoing = String(task.å½“å‰çŠ¶æ€ || '').includes('æ­£å¸¸') && (task.data_source === 'synced' && task.æ€»è¡Œæ•° > 0);
              if (!isBacklog && !isNormalOngoing) return false;
            }
            // æœç´¢è¿‡æ»¤
            if (!kw) return true;
            const name = String(task.ä¾›åº”å•†åç§° || '').toLowerCase();
            return name.includes(kw);
          });
        },
        // ä¾›åº”å•†æ”¶è´§ç›‘æ§ï¼šåˆ†é¡µåçš„åˆ—è¡¨
        pagedReceivingTasks() {
          const list = this.filteredReceivingTasks;
          const size = this.receivingPageSize || 10;
          const page = Math.max(1, this.receivingPage || 1);
          const start = (page - 1) * size;
          return list.slice(start, start + size);
        },
        receivingTotalPages() {
          const size = this.receivingPageSize || 10;
          if (!size) return 1;
          const total = this.filteredReceivingTasks.length;
          return total === 0 ? 1 : Math.ceil(total / size);
        },
        // ä» mockData ä¸­æå–æ‰€æœ‰å”¯ä¸€çš„ä¾›åº”å•†åç§°
        uniqueSuppliers() {
          const suppliers = new Set();
          // ä» receivingTasks ä¸­æå–ä¾›åº”å•†åç§°
          (this.receivingTasks || []).forEach(task => {
            if (task.ä¾›åº”å•†åç§°) {
              suppliers.add(task.ä¾›åº”å•†åç§°);
            }
          });
          // è¿”å›æ’åºåçš„æ•°ç»„ï¼Œä¾¿äºç”¨æˆ·æŸ¥æ‰¾
          return Array.from(suppliers).sort();
        },
        // å·¥å•é…æ–™ï¼šè·å–ç»è¿‡ç­›é€‰ä¸æ’åºåçš„å·¥å•åˆ—è¡¨
        pickingFilteredAndSortedWorkOrders() {
          let list = this.matchedWorkOrders ? [...this.matchedWorkOrders] : [];

          // 0ï¼‰å»é‡ï¼šæ ¹æ® work_order (å·¥å•å·) å’Œ op (å·¥åº) çš„ç»„åˆå»é‡ï¼Œåªä¿ç•™ç¬¬ä¸€æ¡
          const seenKeys = new Set();
          list = list.filter(item => {
            // æå–å·¥å•å·å’Œå·¥åºï¼Œå…¼å®¹æ–°æ—§å­—æ®µå
            const workOrder = String(item['å·¥å•å·'] || item.work_order || item.å·¥å•å· || '').trim();
            const op = String(item['OP'] || item.op || item.OP || '').trim();
            
            // å¦‚æœå·¥å•å·æˆ–å·¥åºä¸ºç©ºï¼Œè·³è¿‡
            if (!workOrder || !op) {
              return false;
            }
            
            // ç”Ÿæˆå”¯ä¸€é”®ï¼šå·¥å•å· + å·¥åº
            const uniqueKey = `${workOrder}|${op}`;
            
            // å¦‚æœå·²ç»å­˜åœ¨ï¼Œè·³è¿‡ï¼ˆå»é‡ï¼‰
            if (seenKeys.has(uniqueKey)) {
              return false;
            }
            
            // æ·»åŠ åˆ°å·²è§é›†åˆï¼Œä¿ç•™è¿™æ¡è®°å½•
            seenKeys.add(uniqueKey);
            return true;
          });

          // 1ï¼‰æŒ‰ä½¿ç”¨æ—¥æœŸç­›é€‰ï¼ˆä¸ç”Ÿäº§è®¡åˆ’çš„æ—¥æœŸç­›é€‰è§„åˆ™ä¿æŒä¸€è‡´ï¼Œå…¼å®¹æ–°æ—§å­—æ®µåï¼‰
          if (this.pickingSearchDate) {
            const searchDate = this.pickingSearchDate; // YYYY-MM-DD
            list = list.filter(item => {
              const itemDate = String(item['ä½¿ç”¨æ—¥æœŸ'] || item.arrival_date || item.åˆ°è¾¾æ—¥æœŸ || item.ä½¿ç”¨æ—¥æœŸ || '').trim();
              if (!itemDate) return false;
              const normalizedItemDate = itemDate.replace(/\//g, '-').substring(0, 10);
              return normalizedItemDate === searchDate || normalizedItemDate.includes(searchDate);
            });
          }

          // 2ï¼‰å…¨å±€æ’åºï¼šPitch äº§å“ä¼˜å…ˆæŒ‰ agv_time æ’åºï¼Œå…¶ä»–äº§å“æŒ‰äº§å“æè¿°+OPæ’åº
          list.sort((a, b) => {
            const descA = String(a['äº§å“æè¿°'] || a.description || a.äº§å“æè¿° || '').trim().toLowerCase();
            const descB = String(b['äº§å“æè¿°'] || b.description || b.äº§å“æè¿° || '').trim().toLowerCase();
            
            // åˆ¤æ–­æ˜¯å¦ä¸º Pitch äº§å“
            const isPitchA = descA.includes('pitch');
            const isPitchB = descB.includes('pitch');
            
            // å¦‚æœéƒ½æ˜¯ Pitch äº§å“ï¼ŒæŒ‰ agv_time å‡åºæ’åº
            if (isPitchA && isPitchB) {
              const agvTimeA = String(a.agv_time || a['AGVå‘è½¦æ—¶é—´'] || a['å‘è½¦æ—¶é—´'] || '').trim();
              const agvTimeB = String(b.agv_time || b['AGVå‘è½¦æ—¶é—´'] || b['å‘è½¦æ—¶é—´'] || '').trim();
              
              // æ—¶é—´æ ¼å¼è½¬æ¢ï¼šHH:MM æˆ– HH:MM:SS
              const parseTime = (timeStr) => {
                if (!timeStr) return Number.MAX_SAFE_INTEGER;
                const parts = timeStr.split(':');
                if (parts.length >= 2) {
                  const hours = parseInt(parts[0], 10) || 0;
                  const minutes = parseInt(parts[1], 10) || 0;
                  return hours * 60 + minutes; // è½¬æ¢ä¸ºåˆ†é’Ÿæ•°
                }
                return Number.MAX_SAFE_INTEGER;
              };
              
              const timeA = parseTime(agvTimeA);
              const timeB = parseTime(agvTimeB);
              
              if (timeA !== timeB) return timeA - timeB;
            }
            
            // é Pitch äº§å“æˆ–æ—¶é—´ç›¸åŒæ—¶ï¼ŒæŒ‰äº§å“æè¿°æ’åº
            const cmpDesc = descA.localeCompare(descB, 'zh-CN');
            if (cmpDesc !== 0) return cmpDesc;

            const opA = String(a['OP'] || a.op || a.OP || '').trim();
            const opB = String(b['OP'] || b.op || b.OP || '').trim();

            // å»æ‰ OP å‰ç¼€åšæ•°å­—æ¯”è¾ƒï¼Œé¿å… "OP100" < "OP20" çš„é—®é¢˜
            const numA = parseInt(opA.replace(/^OP/i, ''), 10);
            const numB = parseInt(opB.replace(/^OP/i, ''), 10);

            const finalNumA = isNaN(numA) ? Number.MAX_SAFE_INTEGER : numA;
            const finalNumB = isNaN(numB) ? Number.MAX_SAFE_INTEGER : numB;

            if (finalNumA !== finalNumB) return finalNumA - finalNumB;

            // å†æŒ‰å·¥å•å·ç¨³å®šæ’åºï¼Œé¿å…å®Œå…¨ç›¸åŒæ—¶é¡ºåºä¸ç¨³å®š
            const jobA = String(a['å·¥å•å·'] || a.work_order || a.å·¥å•å· || '').trim();
            const jobB = String(b['å·¥å•å·'] || b.work_order || b.å·¥å•å· || '').trim();
            return jobA.localeCompare(jobB, 'zh-CN');
          });

          return list;
        },
        // å·¥å•é…æ–™ï¼šè·å–é€‰ä¸­çš„å·¥å•
        selectedWorkOrder() {
          const list = this.pickingFilteredAndSortedWorkOrders || [];
          if (this.selectedWorkOrderIndex >= 0 && this.selectedWorkOrderIndex < list.length) {
            const workOrder = list[this.selectedWorkOrderIndex];
            // ç¡®ä¿ materials å±æ€§å­˜åœ¨
            if (workOrder && !workOrder.materials) {
              workOrder.materials = [];
            }
            return workOrder;
          }
          return null;
        },
        // å·¥å•é…æ–™ï¼šåˆ¤æ–­æ˜¯å¦ä¸º SA14 äº§å“
        isSA14Product() {
          const workOrder = this.selectedWorkOrder;
          if (!workOrder) return false;
          const desc = String(workOrder['äº§å“æè¿°'] || workOrder.description || workOrder.äº§å“æè¿° || '').trim().toLowerCase();
          return desc.includes('sa14');
        },
        // å·¥å•é…æ–™ï¼šåˆ¤æ–­æ˜¯å¦ä¸º Pitch äº§å“
        isPitchProduct() {
          const workOrder = this.selectedWorkOrder;
          if (!workOrder) return false;
          const desc = String(workOrder['äº§å“æè¿°'] || workOrder.description || workOrder.äº§å“æè¿° || '').trim().toLowerCase();
          return desc.includes('pitch');
        },
        // å·¥å•é…æ–™ï¼šå½“å‰é€‰ä¸­å·¥å•çš„ç‰©æ–™æŒ‰åº“ä½æ’åºï¼ˆå‡åºï¼‰ï¼ŒSA14 äº§å“æŒ‰ tool_type åˆ†ç»„
        sortedMaterials() {
          const workOrder = this.selectedWorkOrder;
          if (!workOrder || !Array.isArray(workOrder.materials)) {
            return [];
          }
          const list = [...workOrder.materials];
          
          // å¦‚æœæ˜¯ SA14 äº§å“ï¼ŒæŒ‰ tool_type åˆ†ç»„ï¼Œæ¯ç»„å†…æŒ‰åº“ä½æ’åº
          if (this.isSA14Product) {
            // å…ˆæŒ‰åº“ä½æ’åºï¼ˆæ¯ç»„å†…éƒ¨ï¼‰
            list.sort((a, b) => {
              const locA = String(a['PENDING_LOCATOR'] || a.PENDING_LOCATOR || '').trim();
              const locB = String(b['PENDING_LOCATOR'] || b.PENDING_LOCATOR || '').trim();
              return locA.localeCompare(locB, 'zh-CN');
            });
            // è¿”å›åˆ†ç»„åçš„æ•°æ®ç»“æ„ï¼ˆç”¨äº UI æ˜¾ç¤ºï¼‰
            return list;
          }
          
          // é SA14 äº§å“ï¼šç›´æ¥æŒ‰åº“ä½æ’åº
          list.sort((a, b) => {
            const locA = String(a['PENDING_LOCATOR'] || a.PENDING_LOCATOR || '').trim();
            const locB = String(b['PENDING_LOCATOR'] || b.PENDING_LOCATOR || '').trim();
            return locA.localeCompare(locB, 'zh-CN');
          });
          return list;
        },
        // å·¥å•é…æ–™ï¼šSA14/Pitch äº§å“æŒ‰ tool_type åˆ†ç»„åçš„æ•°æ®
        groupedMaterialsByToolType() {
          if (!this.isSA14Product && !this.isPitchProduct) {
            return [];
          }
          const materials = this.sortedMaterials;
          if (!materials || materials.length === 0) {
            return [];
          }
          
          // æŒ‰ tool_type åˆ†ç»„
          const groups = {};
          materials.forEach(material => {
            const toolType = String(material.tool_type || material['tool_type'] || 'æœªåˆ†ç±»').trim();
            if (!groups[toolType]) {
              groups[toolType] = [];
            }
            groups[toolType].push(material);
          });
          
          // è½¬æ¢ä¸ºæ•°ç»„æ ¼å¼ï¼Œæ¯ç»„å†…æŒ‰åº“ä½æ’åº
          return Object.keys(groups).map(toolType => ({
            toolType: toolType,
            materials: groups[toolType].sort((a, b) => {
              const locA = String(a['PENDING_LOCATOR'] || a.PENDING_LOCATOR || '').trim();
              const locB = String(b['PENDING_LOCATOR'] || b.PENDING_LOCATOR || '').trim();
              return locA.localeCompare(locB, 'zh-CN');
            })
          }));
        },
        // ç”Ÿäº§è®¡åˆ’ï¼šæ ¹æ®å…³é”®è¯å’Œæ—¥æœŸç­›é€‰
        filteredProductionPlan() {
          let result = this.productionPlan || [];
          
          // æ—¥æœŸç­›é€‰ï¼ˆæ”¯æŒ YYYY-MM-DD æ ¼å¼åŒ¹é…ï¼Œå…¼å®¹æ–°æ—§å­—æ®µåï¼‰
          if (this.productionPlanSearchDate) {
            const searchDate = this.productionPlanSearchDate; // æ ¼å¼ï¼šYYYY-MM-DD
            result = result.filter(item => {
              const itemDate = String(item.arrival_date || item.åˆ°è¾¾æ—¥æœŸ || item.ä½¿ç”¨æ—¥æœŸ || '').trim();
              // æ ‡å‡†åŒ–æ—¥æœŸæ ¼å¼è¿›è¡Œæ¯”è¾ƒï¼ˆæ”¯æŒå¤šç§æ—¥æœŸæ ¼å¼ï¼‰
              const normalizedItemDate = itemDate.replace(/\//g, '-').substring(0, 10);
              return normalizedItemDate === searchDate || normalizedItemDate.includes(searchDate);
            });
          }
          
          // å…³é”®è¯æœç´¢ï¼ˆå·¥å•å·/äº§å“/äº§çº¿ï¼Œå…¼å®¹æ–°æ—§å­—æ®µåï¼‰
          const keyword = (this.productionPlanSearchKeyword || '').trim().toLowerCase();
          if (keyword) {
            result = result.filter(item => {
              const workOrder = String(item.work_order || item.å·¥å•å· || '').toLowerCase();
              const product = String(item.description || item.äº§å“æè¿° || '').toLowerCase();
              const line = String(item.line || item.äº§çº¿ || item.äº§çº¿åç§° || '').toLowerCase();
              return workOrder.includes(keyword) || product.includes(keyword) || line.includes(keyword);
            });
          }
          
          return result;
        },
        // å·¥å•ç®¡ç†ï¼šæ ¹æ®å…³é”®è¯è¿‡æ»¤ï¼ˆå·¥å•å·/äº§å“æè¿°ï¼‰
        filteredWorkOrderList() {
          const keyword = (this.workOrderSearchKeyword || '').trim().toLowerCase();
          if (!keyword) return this.workOrderList || [];
          return (this.workOrderList || []).filter(item => {
            const workOrder = String(item.å·¥å•å· || '').toLowerCase();
            const product = String(item.äº§å“æè¿° || '').toLowerCase();
            return workOrder.includes(keyword) || product.includes(keyword);
          });
        }
      },
      mounted() {
        console.log('Dashboard ä»¥ Mock æ¨¡å¼è¿è¡Œï¼ˆæœ¬åœ°å‡æ•°æ®ï¼‰');
        // åˆå§‹åŒ–æ—¶åŠ è½½ç”Ÿäº§è®¡åˆ’æ•°æ®ï¼ˆä» localStorage æˆ–ä½¿ç”¨ mockDataï¼‰
        this.loadProductionPlanFromStorage();
        // åˆå§‹åŒ–æ—¶åŠ è½½è½¦æ¬¡ç®¡ç†æ•°æ®ï¼ˆä» localStorage æˆ–ä½¿ç”¨ mockDataï¼‰
        this.loadVehicleLogFromStorage();
        // åˆå§‹åŒ–æ—¶åŠ è½½å·¥å•ç®¡ç†æ•°æ®ï¼ˆä» localStorage æˆ–ä½¿ç”¨ mockDataï¼‰
        this.loadWorkOrderFromStorage();
        console.log('Mock æ•°æ®å·²åŠ è½½:', {
          productionPlan: this.productionPlan.length,
          vehicleLog: this.vehicleLog.length,
          ecoList: this.ecoList.length,
          billingRecord: this.billingRecord.length,
          receivingTasks: this.receivingTasks.length,
          defectList: this.defectList.length
        });
        // åˆå§‹åŒ–BIå›¾è¡¨
        this.$nextTick(() => {
          if (this.currentMenu === 'bi') {
            this.initBICharts();
          }
          // å·¥å•é…æ–™ï¼šåŠ è½½æ¨¡æ‹Ÿæ•°æ®
          if (this.currentMenu === 'picking') {
            this.loadMockData();
          }
        });
      },
      watch: {
        currentMenu(newVal) {
          if (newVal === 'bi') {
            this.$nextTick(() => {
              this.initBICharts();
            });
          } else if (newVal === 'picking') {
            this.$nextTick(() => {
              // å¦‚æœè¿˜æ²¡æœ‰æ•°æ®ï¼ŒåŠ è½½æ¨¡æ‹Ÿæ•°æ®
              if (this.planData.length === 0 && this.bomData.length === 0) {
                this.loadMockData();
              }
            });
          } else if (newVal === 'production') {
            // åˆ‡æ¢åˆ°ç”Ÿäº§è®¡åˆ’æ—¶ï¼Œä» localStorage è¯»å–æœ€æ–°æ•°æ®
            this.loadProductionPlanFromStorage();
          } else if (newVal === 'vehicle') {
            // åˆ‡æ¢åˆ°è½¦æ¬¡ç®¡ç†æ—¶ï¼Œä» localStorage è¯»å–æœ€æ–°æ•°æ®
            this.loadVehicleLogFromStorage();
          } else if (newVal === 'workorder') {
            // åˆ‡æ¢åˆ°å·¥å•ç®¡ç†æ—¶ï¼Œä» localStorage è¯»å–æœ€æ–°æ•°æ®ï¼ˆä¸ç”Ÿäº§è®¡åˆ’æ•°æ®æºä¸€è‡´ï¼‰
            this.loadWorkOrderFromStorage();
          } else {
            // é”€æ¯å›¾è¡¨å®ä¾‹ä»¥é‡Šæ”¾èµ„æº
            Object.values(this.chartInstances).forEach(chart => {
              if (chart) {
                chart.dispose();
              }
            });
            this.chartInstances = {
              chart1: null,
              chart2: null,
              chart3: null,
              chart4: null
            };
          }
        }
      },
      methods: {
        // åˆ‡æ¢èœå•
        switchMenu(key) {
          this.currentMenu = key;
        },
        // ä» localStorage åŠ è½½ç”Ÿäº§è®¡åˆ’æ•°æ®
        loadProductionPlanFromStorage() {
          try {
            const saved = localStorage.getItem('productionPlanData');
            if (saved) {
              this.productionPlan = JSON.parse(saved);
              this.planUpdateTime = localStorage.getItem('planUpdateTime') || null;
            } else {
              // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨ mockData
              this.productionPlan = mockData.productionPlan || [];
              this.planUpdateTime = null;
            }
          } catch (e) {
            console.error('è¯»å– localStorage å¤±è´¥:', e);
            this.productionPlan = mockData.productionPlan || [];
            this.planUpdateTime = null;
          }
        },
        // ä» localStorage åŠ è½½è½¦æ¬¡ç®¡ç†æ•°æ®
        loadVehicleLogFromStorage() {
          try {
            const saved = localStorage.getItem('vehicleLogData');
            if (saved) {
              this.vehicleLog = JSON.parse(saved);
            } else {
              // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨ mockData
              this.vehicleLog = mockData.vehicleLog || [];
            }
          } catch (e) {
            console.error('è¯»å– vehicleLog localStorage å¤±è´¥:', e);
            this.vehicleLog = mockData.vehicleLog || [];
          }
        },
        // ä» localStorage åŠ è½½å·¥å•ç®¡ç†æ•°æ®ï¼ˆä¸ç”Ÿäº§è®¡åˆ’æ•°æ®æºä¸€è‡´ï¼‰
        loadWorkOrderFromStorage() {
          try {
            const saved = localStorage.getItem('productionPlanData');
            if (saved) {
              this.workOrderList = JSON.parse(saved);
            } else {
              // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨ mockData
              this.workOrderList = mockData.productionPlan || [];
            }
          } catch (e) {
            console.error('è¯»å–å·¥å•ç®¡ç† localStorage å¤±è´¥:', e);
            this.workOrderList = mockData.productionPlan || [];
          }
        },
        // ä» localStorage åŠ è½½ ECO æ•°æ®ï¼ˆå®Œå…¨æœ¬åœ°åŒ–ï¼Œæ— äº‘ä¾èµ–ï¼‰
        loadEcoFromStorage() {
          try {
            const saved = localStorage.getItem('localEcoList');
            if (saved) {
              const parsed = JSON.parse(saved);
              if (Array.isArray(parsed)) {
                this.ecoList = parsed;
                return;
              }
            }
          } catch (e) {
            console.error('è¯»å– localStorage ECO æ•°æ®å¤±è´¥:', e);
          }
          // å¦‚æœ localStorage ä¸ºç©ºæˆ–è§£æå¤±è´¥ï¼Œä½¿ç”¨ mockData ä½œä¸ºé»˜è®¤æ•°æ®
          this.ecoList = mockData.ecoList || [];
        },
        // ä¿å­˜ ECO æ•°æ®åˆ° localStorageï¼ˆå®Œå…¨æœ¬åœ°åŒ–ï¼Œæ— äº‘ä¾èµ–ï¼‰
        saveEcoToStorage() {
          try {
            localStorage.setItem('localEcoList', JSON.stringify(this.ecoList));
          } catch (e) {
            console.error('ä¿å­˜ localStorage ECO æ•°æ®å¤±è´¥:', e);
            alert('ä¿å­˜å¤±è´¥ï¼š' + e.message);
          }
        },
        // åˆ·æ–°æ•°æ®ï¼ˆä» localStorage é‡æ–°åŠ è½½ï¼‰
        refreshData() {
          if (this.currentMenu === 'production') {
            this.loadProductionPlanFromStorage();
          } else if (this.currentMenu === 'vehicle') {
            this.loadVehicleLogFromStorage();
          } else if (this.currentMenu === 'workorder') {
            this.loadWorkOrderFromStorage();
          } else if (this.currentMenu === 'eco') {
            this.loadEcoFromStorage();
            alert('ECO æ•°æ®å·²åˆ·æ–°');
            return;
          } else {
            // å…¶ä»–æ¨¡å—çš„åˆ·æ–°é€»è¾‘
            alert('å½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ï¼ˆMock æ•°æ®ï¼‰ï¼Œåˆ·æ–°ä¸ä¼šè®¿é—®çœŸå®æ•°æ®åº“ã€‚');
            return;
          }
          alert('æ•°æ®å·²åˆ·æ–°');
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šæ‰“å¼€ç™»è®°å¼¹çª—
        openBillingModal() {
          this.newBilling = {
            å®¢æˆ·åç§°: this.uniqueBillingCustomers[0] || '',
            è´¹ç”¨ç±»å‹: 'ä»“å‚¨è´¹',
            é¢ç§¯: '',
            ç»“ç®—å‘¨æœŸ: '',
            è´¹ç”¨è¯´æ˜: '',
            å‘ç”Ÿæ—¥æœŸ: '',
            é‡‘é¢: ''
          };
          this.showBillingModal = true;
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šå…³é—­å¼¹çª—
        closeBillingModal() {
          this.showBillingModal = false;
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šä¿å­˜ç™»è®°
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šè®¡ç®—æé†’æ—¥æœŸ
        calculateReminderDate(occurrenceDate, billingCycle) {
          if (!occurrenceDate || !billingCycle || billingCycle === 'å•æ¬¡') {
            return null;
          }
          
          const date = new Date(occurrenceDate);
          if (isNaN(date)) return null;
          
          let reminderDate = new Date(date);
          
          if (billingCycle === 'æœˆç»“') {
            // å‘ç”Ÿæ—¥æœŸ + 1ä¸ªæœˆ - 15å¤©
            reminderDate.setMonth(reminderDate.getMonth() + 1);
            reminderDate.setDate(reminderDate.getDate() - 15);
          } else if (billingCycle === 'å­£ç»“') {
            // å‘ç”Ÿæ—¥æœŸ + 3ä¸ªæœˆ - 15å¤©
            reminderDate.setMonth(reminderDate.getMonth() + 3);
            reminderDate.setDate(reminderDate.getDate() - 15);
          }
          
          // æ ¼å¼åŒ–ä¸º YYYY-MM-DD
          const year = reminderDate.getFullYear();
          const month = String(reminderDate.getMonth() + 1).padStart(2, '0');
          const day = String(reminderDate.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šåˆ¤æ–­æé†’æ—¥æœŸæ˜¯å¦é€¾æœŸ
        isReminderDateOverdue(reminderDate) {
          if (!reminderDate) return false;
          const reminder = new Date(reminderDate);
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          reminder.setHours(0, 0, 0, 0);
          return reminder < today;
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šä¿å­˜ç™»è®°
        saveNewBilling() {
          const item = this.newBilling || {};
          if (!item.å®¢æˆ·åç§° || !item.è´¹ç”¨ç±»å‹ || !item.ç»“ç®—å‘¨æœŸ || !item.å‘ç”Ÿæ—¥æœŸ || !item.é‡‘é¢) {
            alert('è¯·å¡«å†™å®¢æˆ·åç§°ã€è´¹ç”¨ç±»å‹ã€ç»“ç®—å‘¨æœŸã€å‘ç”Ÿæ—¥æœŸå’Œé‡‘é¢');
            return;
          }
          if (item.è´¹ç”¨ç±»å‹ === 'ä»“å‚¨è´¹' && (!item.é¢ç§¯ && item.é¢ç§¯ !== 0)) {
            alert('ä»“å‚¨è´¹éœ€å¡«å†™é¢ç§¯');
            return;
          }
          
          // è‡ªåŠ¨è®¡ç®—æé†’æ—¥æœŸ
          const reminderDate = this.calculateReminderDate(item.å‘ç”Ÿæ—¥æœŸ, item.ç»“ç®—å‘¨æœŸ);
          
          const newItem = {
            å®¢æˆ·åç§°: item.å®¢æˆ·åç§°,
            è´¹ç”¨ç±»å‹: item.è´¹ç”¨ç±»å‹,
            ç»“ç®—å‘¨æœŸ: item.ç»“ç®—å‘¨æœŸ,
            è´¹ç”¨è¯´æ˜: item.è´¹ç”¨è¯´æ˜ || '',
            å‘ç”Ÿæ—¥æœŸ: item.å‘ç”Ÿæ—¥æœŸ,
            é¢ç§¯: item.é¢ç§¯ ? Number(item.é¢ç§¯) : 0,
            é‡‘é¢: Number(item.é‡‘é¢),
            ç»“ç®—çŠ¶æ€: 'å¾…ç»“ç®—', // é»˜è®¤å¾…ç»“ç®—
            ä¸‹æ¬¡æé†’æ—¥æœŸ: reminderDate || ''
          };
          this.billingRecord.unshift(newItem);
          this.showBillingModal = false;
          alert('è´¹ç”¨ç™»è®°æˆåŠŸï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼Œä»…å‰ç«¯ï¼‰');
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šç¡®è®¤å›æ¬¾
        confirmBillingPayment(item) {
          if (confirm('ç¡®è®¤è¯¥ç¬”è´¹ç”¨å·²æ”¶åˆ°æ¬¾é¡¹ï¼Ÿ')) {
            const index = this.billingRecord.findIndex(record => 
              record.å®¢æˆ·åç§° === item.å®¢æˆ·åç§° &&
              record.å‘ç”Ÿæ—¥æœŸ === item.å‘ç”Ÿæ—¥æœŸ &&
              record.é‡‘é¢ === item.é‡‘é¢
            );
            if (index !== -1) {
              this.billingRecord[index].ç»“ç®—çŠ¶æ€ = 'å·²å›æ¬¾';
              alert('å›æ¬¾çŠ¶æ€å·²æ›´æ–°');
            }
          }
        },
        // æ‰“å¼€æ–°å¢å¼¹çª—
        openCreateModal() {
          this.newEco = {
            eco_no: '',
            description: '',
            op: '',
            start_set: '',
            change_details: '',
            materials: [],
            status: 'è¿›è¡Œä¸­'
          };
          this.showCreateModal = true;
        },
        closeCreateModal() {
          this.showCreateModal = false;
        },
        // æ·»åŠ ç‰©æ–™
        addEcoMaterial() {
          this.newEco.materials.push('');
        },
        // åˆ é™¤ç‰©æ–™
        removeEcoMaterial(index) {
          this.newEco.materials.splice(index, 1);
        },
        // ä¿å­˜æ–°å¢ ECOï¼špush åˆ°æœ¬åœ°æ•°ç»„
        saveNewEco() {
          if (!this.newEco.eco_no || !this.newEco.description || !this.newEco.op || !this.newEco.start_set || !this.newEco.change_details) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼ˆECOå·ã€äº§å“æè¿°ã€å·¥åºã€èµ·å§‹å°å¥—ã€å˜æ›´è¯¦æƒ…ï¼‰');
            return;
          }
          if (!this.newEco.materials || this.newEco.materials.length === 0) {
            alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªç‰©æ–™');
            return;
          }
          
          // è¿‡æ»¤ç©ºç‰©æ–™å·
          const validMaterials = this.newEco.materials.filter(mat => mat && mat.trim());
          if (validMaterials.length === 0) {
            alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæœ‰æ•ˆçš„ç‰©æ–™å·');
            return;
          }
          
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const hour = String(now.getHours()).padStart(2, '0');
          const minute = String(now.getMinutes()).padStart(2, '0');
          const second = String(now.getSeconds()).padStart(2, '0');
          const timeStr = `${year}-${month}-${day} ${hour}:${minute}:${second}`;
          
          // ç”Ÿæˆå”¯ä¸€ IDï¼šæ—¶é—´æˆ³ + éšæœºæ•°ï¼ˆç¡®ä¿æ¯æ¡è®°å½•éƒ½æœ‰å”¯ä¸€æ ‡è¯†ï¼‰
          const uniqueId = `eco_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
          
          const newItem = {
            id: uniqueId, // å”¯ä¸€æ ‡è¯†ï¼ˆPrimary Keyï¼‰
            eco_no: this.newEco.eco_no.trim(), // ECOå·ï¼ˆå…è®¸é‡å¤ï¼‰
            description: this.newEco.description.trim(),
            op: this.newEco.op.trim(),
            start_set: Number(this.newEco.start_set),
            change_details: this.newEco.change_details.trim(),
            materials: validMaterials.map(mat => mat.trim()),
            status: this.newEco.status || 'è¿›è¡Œä¸­',
            update_time: timeStr,
            é…æ–™å‘˜: 'ç³»ç»Ÿ'
          };
          this.ecoList.unshift(newItem);
          // ä¿å­˜åˆ° localStorage
          this.saveEcoToStorage();
          this.showCreateModal = false;
          alert('ECO å·²æ–°å¢å¹¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
        },
        // è½¦æ¬¡ç®¡ç†ï¼šæ‰“å¼€ç™»è®°è½¦æ¬¡æ¨¡æ€æ¡†
        openVehicleLogModal() {
          // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
          const today = new Date();
          const dateStr = today.toISOString().split('T')[0];
          const timeStr = today.toTimeString().slice(0, 5); // HH:mm
          
          this.newVehicleLog = {
            æ—¥æœŸ: dateStr,
            æ—¶é—´: timeStr,
            è½¦å‹: '',
            å¸æœºå§“å: '',
            å®¢æˆ·åç§°: '',
            å®¢æˆ·ç­¾æ”¶äºº: '',
            å†…å®¹: '',
            å¤‡æ³¨: ''
          };
          this.showVehicleLogModal = true;
        },
        // è½¦æ¬¡ç®¡ç†ï¼šå…³é—­ç™»è®°è½¦æ¬¡æ¨¡æ€æ¡†
        closeVehicleLogModal() {
          this.showVehicleLogModal = false;
        },
        // è½¦æ¬¡ç®¡ç†ï¼šä¿å­˜æ–°ç™»è®°çš„è½¦æ¬¡
        saveNewVehicleLog() {
          // éªŒè¯å¿…å¡«é¡¹
          if (!this.newVehicleLog.æ—¥æœŸ || !this.newVehicleLog.æ—¶é—´ || !this.newVehicleLog.è½¦å‹ || 
              !this.newVehicleLog.å¸æœºå§“å || !this.newVehicleLog.å®¢æˆ·åç§° || !this.newVehicleLog.å†…å®¹) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼ˆæ—¥æœŸã€æ—¶é—´ã€è½¦å‹ã€å¸æœºå§“åã€å®¢æˆ·åç§°ã€å†…å®¹ï¼‰');
            return;
          }
          
          // åˆ›å»ºæ–°è®°å½•
          const newItem = {
            æ—¥æœŸ: this.newVehicleLog.æ—¥æœŸ,
            æ—¶é—´: this.newVehicleLog.æ—¶é—´,
            è½¦å‹: this.newVehicleLog.è½¦å‹,
            å¸æœºå§“å: this.newVehicleLog.å¸æœºå§“å,
            å®¢æˆ·åç§°: this.newVehicleLog.å®¢æˆ·åç§°,
            å®¢æˆ·ç­¾æ”¶äºº: this.newVehicleLog.å®¢æˆ·ç­¾æ”¶äºº || '',
            å†…å®¹: this.newVehicleLog.å†…å®¹,
            å¤‡æ³¨: this.newVehicleLog.å¤‡æ³¨ || ''
          };
          
          // æ·»åŠ åˆ°æ•°ç»„æœ€å‰é¢
          this.vehicleLog.unshift(newItem);
          
          // ä¿å­˜åˆ° localStorage
          try {
            localStorage.setItem('vehicleLogData', JSON.stringify(this.vehicleLog));
          } catch (e) {
            console.error('ä¿å­˜åˆ° localStorage å¤±è´¥:', e);
          }
          
          // å…³é—­æ¨¡æ€æ¡†å¹¶æç¤º
          this.showVehicleLogModal = false;
          alert('ç™»è®°æˆåŠŸ');
        },
        // åˆ°è´§ç™»è®°ï¼šæ‰“å¼€å¼¹çª—
        openArrivalModal() {
          const today = new Date().toISOString().split('T')[0];
          const now = new Date().toTimeString().substring(0, 5);
          this.newArrival = {
            æ—¥æœŸ: today,
            æ—¶é—´: now,
            ä¾›åº”å•†åç§°: '',
            å®ç‰©æ•°é‡: '',
            å•ä½: 'æ‰˜',
            é€è´§å•å·: '',
            å¤‡æ³¨: ''
          };
          this.showArrivalModal = true;
        },
        // åˆ°è´§ç™»è®°ï¼šå…³é—­å¼¹çª—
        closeArrivalModal() {
          this.showArrivalModal = false;
        },
        // åˆ°è´§ç™»è®°ï¼šä¿å­˜è®°å½•
        saveArrivalRecord() {
          const item = this.newArrival || {};
          if (!item.æ—¥æœŸ || !item.æ—¶é—´ || !item.ä¾›åº”å•†åç§° || !item.å®ç‰©æ•°é‡) {
            alert('è¯·å¡«å†™æ—¥æœŸã€æ—¶é—´ã€ä¾›åº”å•†åç§°å’Œå®ç‰©æ•°é‡');
            return;
          }
          
          const physicalQty = Number(item.å®ç‰©æ•°é‡);
          if (Number.isNaN(physicalQty) || physicalQty <= 0) {
            alert('å®ç‰©æ•°é‡å¿…é¡»ä¸ºå¤§äº 0 çš„æ•°å­—');
            return;
          }
          
          // ä¾›åº”å•†è‡ªåŠ¨è®°å¿†ï¼šå¦‚æœè¾“å…¥çš„ä¾›åº”å•†åç§°ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œè‡ªåŠ¨æ·»åŠ 
          const supplierName = item.ä¾›åº”å•†åç§°.trim();
          if (supplierName && !this.savedSupplierNames.includes(supplierName)) {
            this.savedSupplierNames.push(supplierName);
            try {
              localStorage.setItem('savedSupplierNames', JSON.stringify(this.savedSupplierNames));
            } catch (e) {
              console.warn('ä¿å­˜ä¾›åº”å•†åç§°åˆ—è¡¨å¤±è´¥:', e);
            }
          }
          
          const newRecord = {
            æ—¥æœŸ: item.æ—¥æœŸ,
            æ—¶é—´: item.æ—¶é—´,
            ä¾›åº”å•†åç§°: supplierName,
            å®ç‰©æ•°é‡: physicalQty,
            å•ä½: item.å•ä½ || 'æ‰˜',
            é€è´§å•å·: item.é€è´§å•å· || '',
            å¤‡æ³¨: item.å¤‡æ³¨ || '',
            actual_qty: null,
            status: 'å¾…æ”¶è´§',
            finish_time: ''
          };
          
          // æ·»åŠ åˆ°åˆ—è¡¨æœ€å‰é¢ï¼ˆæœ€æ–°è®°å½•åœ¨å‰ï¼‰
          this.arrivalLog.unshift(newRecord);
          
          // ä¿å­˜åˆ°localStorage
          try {
            localStorage.setItem('arrivalLogData', JSON.stringify(this.arrivalLog));
          } catch (e) {
            console.error('ä¿å­˜åˆ°è´§ç™»è®°æ•°æ®å¤±è´¥:', e);
          }
          
          this.showArrivalModal = false;
          alert('åˆ°è´§ç™»è®°æˆåŠŸ');
        },
        // åˆ°è´§ç™»è®°ï¼šåˆ é™¤è®°å½•
        deleteArrivalRecord(index) {
          if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
            return;
          }
          
          // æ‰¾åˆ°å®é™…ç´¢å¼•ï¼ˆå› ä¸ºfilteredArrivalLogæ˜¯è¿‡æ»¤åçš„ï¼‰
          const filteredItem = this.filteredArrivalLog[index];
          const actualIndex = this.arrivalLog.findIndex(item => 
            item.æ—¥æœŸ === filteredItem.æ—¥æœŸ &&
            item.æ—¶é—´ === filteredItem.æ—¶é—´ &&
            item.ä¾›åº”å•†åç§° === filteredItem.ä¾›åº”å•†åç§° &&
            item.å®ç‰©æ•°é‡ === filteredItem.å®ç‰©æ•°é‡
          );
          
          if (actualIndex !== -1) {
            this.arrivalLog.splice(actualIndex, 1);
            
            // ä¿å­˜åˆ°localStorage
            try {
              localStorage.setItem('arrivalLogData', JSON.stringify(this.arrivalLog));
            } catch (e) {
              console.error('ä¿å­˜åˆ°è´§ç™»è®°æ•°æ®å¤±è´¥:', e);
            }
            
            alert('åˆ é™¤æˆåŠŸ');
          }
        },
        // åˆ°è´§ç™»è®°ï¼šæ‰“å¼€æ”¶è´§åé¦ˆå¼¹çª—
        openArrivalFeedbackModal(index) {
          const filteredItem = this.filteredArrivalLog[index];
          const actualIndex = this.arrivalLog.findIndex(item => 
            item.æ—¥æœŸ === filteredItem.æ—¥æœŸ &&
            item.æ—¶é—´ === filteredItem.æ—¶é—´ &&
            item.ä¾›åº”å•†åç§° === filteredItem.ä¾›åº”å•†åç§° &&
            item.å®ç‰©æ•°é‡ === filteredItem.å®ç‰©æ•°é‡
          );
          
          if (actualIndex === -1) {
            alert('æœªæ‰¾åˆ°å¯¹åº”è®°å½•');
            return;
          }
          
          this.currentArrivalFeedbackIndex = actualIndex;
          
          // æå–ä¹‹å‰çš„åé¦ˆå¤‡æ³¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
          let previousRemark = '';
          const record = this.arrivalLog[actualIndex];
          if (record.å¤‡æ³¨) {
            // æŸ¥æ‰¾å¤‡æ³¨ä¸­æ˜¯å¦åŒ…å«"æ”¶è´§åé¦ˆï¼š"ï¼Œå¦‚æœæœ‰åˆ™æå–
            // æ”¯æŒæ ¼å¼ï¼šæ”¶è´§åé¦ˆï¼šxxx æˆ– xxx | æ”¶è´§åé¦ˆï¼šxxx
            const remarkMatch = record.å¤‡æ³¨.match(/æ”¶è´§åé¦ˆï¼š(.+?)(?:\s*\|\s*|$)/);
            if (remarkMatch) {
              previousRemark = remarkMatch[1].trim();
            } else {
              // å¦‚æœæ²¡æœ‰æ‰¾åˆ°"æ”¶è´§åé¦ˆï¼š"ï¼Œæ£€æŸ¥æ˜¯å¦æ•´ä¸ªå¤‡æ³¨å°±æ˜¯åé¦ˆï¼ˆæ—§æ ¼å¼å…¼å®¹ï¼‰
              const fullMatch = record.å¤‡æ³¨.match(/^æ”¶è´§åé¦ˆï¼š(.+)$/);
              if (fullMatch) {
                previousRemark = fullMatch[1].trim();
              }
            }
          }
          
          this.arrivalFeedback = {
            actual_qty: filteredItem.actual_qty !== null && filteredItem.actual_qty !== undefined ? filteredItem.actual_qty : '',
            feedback_remark: previousRemark
          };
          this.showArrivalFeedbackModal = true;
        },
        // åˆ°è´§ç™»è®°ï¼šå…³é—­æ”¶è´§åé¦ˆå¼¹çª—
        closeArrivalFeedbackModal() {
          this.showArrivalFeedbackModal = false;
          this.currentArrivalFeedbackIndex = -1;
          this.arrivalFeedback = {
            actual_qty: '',
            feedback_remark: ''
          };
        },
        // åˆ°è´§ç™»è®°ï¼šä¿å­˜æ”¶è´§åé¦ˆ
        saveArrivalFeedback() {
          const feedback = this.arrivalFeedback || {};
          
          if (!feedback.actual_qty || feedback.actual_qty === '') {
            alert('è¯·å¡«å†™å®é™…æ”¶è´§æ•°é‡');
            return;
          }
          
          const actualQty = Number(feedback.actual_qty);
          if (Number.isNaN(actualQty) || actualQty < 0) {
            alert('å®é™…æ”¶è´§æ•°é‡å¿…é¡»ä¸ºå¤§äºç­‰äº 0 çš„æ•°å­—');
            return;
          }
          
          if (this.currentArrivalFeedbackIndex === -1 || !this.arrivalLog[this.currentArrivalFeedbackIndex]) {
            alert('è®°å½•ä¸å­˜åœ¨');
            return;
          }
          
          const record = this.arrivalLog[this.currentArrivalFeedbackIndex];
          
          // åˆ¤æ–­æ˜¯æ–°å¢è¿˜æ˜¯ä¿®æ”¹
          const isEdit = record.status === 'å·²å®Œæˆ' && record.actual_qty !== null;
          
          // æ›´æ–°è®°å½•
          record.actual_qty = actualQty;
          record.status = 'å·²å®Œæˆ';
          record.finish_time = new Date().toLocaleString('zh-CN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
          });
          
          // å¤„ç†å¤‡æ³¨ï¼šå¦‚æœæ˜¯ä¿®æ”¹æ¨¡å¼ï¼Œéœ€è¦æ›¿æ¢ä¹‹å‰çš„åé¦ˆå¤‡æ³¨è€Œä¸æ˜¯è¿½åŠ 
          if (feedback.feedback_remark && feedback.feedback_remark.trim()) {
            if (isEdit && record.å¤‡æ³¨) {
              // ä¿®æ”¹æ¨¡å¼ï¼šç§»é™¤ä¹‹å‰çš„"æ”¶è´§åé¦ˆï¼š"éƒ¨åˆ†ï¼Œä¿ç•™åŸå§‹å¤‡æ³¨
              let originalRemark = record.å¤‡æ³¨
                .replace(/\s*\|\s*æ”¶è´§åé¦ˆï¼š.+?$/, '')  // ç§»é™¤æœ«å°¾çš„ | æ”¶è´§åé¦ˆï¼šxxx
                .replace(/^æ”¶è´§åé¦ˆï¼š.+?$/, '')          // ç§»é™¤å¼€å¤´çš„ æ”¶è´§åé¦ˆï¼šxxx
                .trim();
              record.å¤‡æ³¨ = originalRemark 
                ? `${originalRemark} | æ”¶è´§åé¦ˆï¼š${feedback.feedback_remark.trim()}`
                : `æ”¶è´§åé¦ˆï¼š${feedback.feedback_remark.trim()}`;
            } else {
              // æ–°å¢æ¨¡å¼ï¼šè¿½åŠ åˆ°åŸå¤‡æ³¨åé¢
              const originalRemark = record.å¤‡æ³¨ || '';
              record.å¤‡æ³¨ = originalRemark 
                ? `${originalRemark} | æ”¶è´§åé¦ˆï¼š${feedback.feedback_remark.trim()}`
                : `æ”¶è´§åé¦ˆï¼š${feedback.feedback_remark.trim()}`;
            }
          } else if (isEdit && record.å¤‡æ³¨) {
            // ä¿®æ”¹æ¨¡å¼ä½†æ–°å¤‡æ³¨ä¸ºç©ºï¼šç§»é™¤ä¹‹å‰çš„"æ”¶è´§åé¦ˆï¼š"éƒ¨åˆ†
            let cleanedRemark = record.å¤‡æ³¨
              .replace(/\s*\|\s*æ”¶è´§åé¦ˆï¼š.+?$/, '')  // ç§»é™¤æœ«å°¾çš„ | æ”¶è´§åé¦ˆï¼šxxx
              .replace(/^æ”¶è´§åé¦ˆï¼š.+?$/, '')          // ç§»é™¤å¼€å¤´çš„ æ”¶è´§åé¦ˆï¼šxxx
              .trim();
            record.å¤‡æ³¨ = cleanedRemark || '';
          }
          
          // ä¿å­˜åˆ°localStorage
          try {
            localStorage.setItem('arrivalLogData', JSON.stringify(this.arrivalLog));
          } catch (e) {
            console.error('ä¿å­˜åˆ°è´§ç™»è®°æ•°æ®å¤±è´¥:', e);
            alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
            return;
          }
          
          this.closeArrivalFeedbackModal();
          alert('æ”¶è´§åé¦ˆä¿å­˜æˆåŠŸ');
        },
        // åˆ°è´§ç™»è®°ï¼šå¯¼å‡ºExcel
        exportArrivalToExcel() {
          const dataToExport = this.filteredArrivalLog;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => {
              // è®¡ç®—çŠ¶æ€ï¼šå¦‚æœ actual_qty æœ‰å€¼ä¸”ä¸ physical_qty ä¸åŒï¼Œæ˜¾ç¤º"æœ‰å·®å¼‚"ï¼Œå¦åˆ™æ˜¾ç¤ºåŸæœ‰çŠ¶æ€
              let status = item.status || 'å¾…æ”¶è´§';
              if (item.actual_qty !== null && item.actual_qty !== undefined) {
                const physicalQty = Number(item.å®ç‰©æ•°é‡);
                const actualQty = Number(item.actual_qty);
                if (!isNaN(physicalQty) && !isNaN(actualQty) && physicalQty !== actualQty) {
                  status = 'æœ‰å·®å¼‚';
                }
              }
              
              return {
              'æ—¥æœŸ': item.æ—¥æœŸ || '',
              'æ—¶é—´': item.æ—¶é—´ || '',
              'ä¾›åº”å•†åç§°': item.ä¾›åº”å•†åç§° || '',
              'å®ç‰©æ•°é‡': item.å®ç‰©æ•°é‡ || '',
              'å®é™…æ”¶è´§': item.actual_qty !== null && item.actual_qty !== undefined ? item.actual_qty : '',
                'çŠ¶æ€': status,
              'å®Œæˆæ—¶é—´': item.finish_time || '',
              'å•ä½': item.å•ä½ || '',
              'é€è´§å•å·': item.é€è´§å•å· || '',
              'å¤‡æ³¨': item.å¤‡æ³¨ || ''
              };
            });
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'åˆ°è´§ç™»è®°è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `åˆ°è´§ç™»è®°è¡¨_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.arrivalLog.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // è½¦æ¬¡ç®¡ç†ï¼šè§¦å‘å¯¼å…¥
        triggerVehicleLogImport() {
          if (this.$refs.vehicleLogFileInput) {
            this.$refs.vehicleLogFileInput.click();
          }
        },
        // è½¦æ¬¡ç®¡ç†ï¼šå¤„ç†Excelå¯¼å…¥
        handleVehicleLogImport(event) {
          const file = event.target.files[0];
          if (!file) return;

          const fileName = file.name.toLowerCase();
          if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
            alert('è¯·é€‰æ‹© Excel æ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsï¼‰');
            event.target.value = '';
            return;
          }

          if (typeof XLSX === 'undefined') {
            alert('Excel è§£æåº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            event.target.value = '';
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              if (!jsonData || jsonData.length === 0) {
                alert('Excelæ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                event.target.value = '';
                return;
              }

              const importedData = jsonData.map(row => ({
                æ—¥æœŸ: this.normalizeExcelDate(row['æ—¥æœŸ'] || row['date'] || ''),
                æ—¶é—´: this.normalizeExcelTime(row['æ—¶é—´'] || row['time'] || ''),
                è½¦å‹: row['è½¦å‹'] || row['vehicle'] || '',
                å¸æœºå§“å: row['å¸æœºå§“å'] || row['driver'] || '',
                å®¢æˆ·åç§°: row['å®¢æˆ·åç§°'] || row['customer'] || '',
                å®¢æˆ·ç­¾æ”¶äºº: row['å®¢æˆ·ç­¾æ”¶äºº'] || row['signer'] || '',
                å†…å®¹: row['å†…å®¹'] || row['content'] || '',
                å¤‡æ³¨: row['å¤‡æ³¨'] || row['remark'] || ''
              })).filter(item => item.æ—¥æœŸ && item.æ—¶é—´ && item.è½¦å‹);

              if (importedData.length === 0) {
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ ¼å¼');
                event.target.value = '';
                return;
              }

              // è¿½åŠ åˆ°åˆ—è¡¨
              this.vehicleLog = [...importedData, ...this.vehicleLog];
              
              // ä¿å­˜åˆ°localStorage
              try {
                localStorage.setItem('vehicleLogData', JSON.stringify(this.vehicleLog));
              } catch (err) {
                console.warn('ä¿å­˜åˆ°localStorageå¤±è´¥:', err);
              }

              event.target.value = '';
              alert(`æˆåŠŸå¯¼å…¥ ${importedData.length} æ¡è½¦æ¬¡è®°å½•`);
            } catch (error) {
              console.error('å¯¼å…¥å¤±è´¥:', error);
              alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message);
              event.target.value = '';
            }
          };

          reader.onerror = () => {
            alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
            event.target.value = '';
          };

          reader.readAsArrayBuffer(file);
        },
        // è½¦æ¬¡ç®¡ç†ï¼šå¯¼å‡º Excelï¼ˆæ‰€è§å³æ‰€å¾—ï¼šå¯¼å‡ºå½“å‰è¡¨æ ¼æ˜¾ç¤ºçš„æ•°æ®ï¼‰
        exportVehicleLogToExcel() {
          // ä½¿ç”¨ filteredVehicleLogï¼ˆè®¡ç®—å±æ€§ï¼‰ï¼Œå®ç°"æ‰€è§å³æ‰€å¾—"å¯¼å‡º
          // å¦‚æœç”¨æˆ·è¿›è¡Œäº†ç­›é€‰ï¼Œå¯¼å‡ºç­›é€‰åçš„æ•°æ®ï¼›å¦‚æœæœªç­›é€‰ï¼Œå¯¼å‡ºå…¨éƒ¨æ•°æ®
          const dataToExport = this.filteredVehicleLog;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            // å‡†å¤‡å¯¼å‡ºæ•°æ®ï¼Œç¡®ä¿è¡¨å¤´æ˜¯ä¸­æ–‡
            const exportData = dataToExport.map(item => ({
              'æ—¥æœŸ': item.æ—¥æœŸ || '',
              'æ—¶é—´': item.æ—¶é—´ || '',
              'è½¦å‹': item.è½¦å‹ || '',
              'å¸æœºå§“å': item.å¸æœºå§“å || '',
              'å®¢æˆ·åç§°': item.å®¢æˆ·åç§° || '',
              'å®¢æˆ·ç­¾æ”¶äºº': item.å®¢æˆ·ç­¾æ”¶äºº || '',
              'å†…å®¹': item.å†…å®¹ || '',
              'å¤‡æ³¨': item.å¤‡æ³¨ || ''
            }));
            
            // åˆ›å»ºå·¥ä½œè¡¨
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'è½¦æ¬¡ç®¡ç†è¡¨');
            
            // ç”Ÿæˆæ–‡ä»¶åï¼ˆå¸¦å½“å‰æ—¥æœŸï¼‰
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `è½¦æ¬¡ç®¡ç†è¡¨_${dateStr}.xlsx`;
            
            // å¯¼å‡ºæ–‡ä»¶
            XLSX.writeFile(wb, fileName);
            
            // æç¤ºä¿¡æ¯ï¼šå¦‚æœè¿›è¡Œäº†ç­›é€‰ï¼Œæ˜¾ç¤ºç­›é€‰åçš„è®°å½•æ•°
            const totalCount = this.vehicleLog.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ç”Ÿäº§è®¡åˆ’ï¼šå¯¼å‡º Excel
        exportProductionPlanToExcel() {
          const dataToExport = this.filteredProductionPlan;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'ä½¿ç”¨æ—¥æœŸ': item.ä½¿ç”¨æ—¥æœŸ || '',
              'å‘è½¦æ—¶é—´': item.å‘è½¦æ—¶é—´ || '',
              'è½¦æ¬¡': item.è½¦æ¬¡ || '',
              'å·¥åºå·': item.å·¥åºå· || '',
              'äº§çº¿åç§°': item.äº§çº¿åç§° || '',
              'åˆ°åœºæ—¶é—´': item.åˆ°åœºæ—¶é—´ || '',
              'äº§å“æè¿°': item.äº§å“æè¿° || '',
              'å·¥å•å·': item.å·¥å•å· || '',
              'åŠ å·¥åºåˆ—å·': item.åŠ å·¥åºåˆ—å· || '',
              'å·¥åºæè¿°': item.å·¥åºæè¿° || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ç”Ÿäº§è®¡åˆ’è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `ç”Ÿäº§è®¡åˆ’_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.productionPlan.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // å·¥å•ç®¡ç†ï¼šå¯¼å‡º Excel
        exportWorkOrderToExcel() {
          const dataToExport = this.filteredWorkOrderList;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'å·¥å•å·': item.å·¥å•å· || '',
              'äº§å“æè¿°': item.äº§å“æè¿° || '',
              'å°å¥—': item.å°å¥— || '',
              'å·¥åº': item.å·¥åºå· || '',
              'åŠ å·¥åºåˆ—å·': item.åŠ å·¥åºåˆ—å· || '',
              'äº§çº¿åç§°': item.äº§çº¿åç§° || '',
              'ä½¿ç”¨æ—¥æœŸ': item.ä½¿ç”¨æ—¥æœŸ || '',
              'çŠ¶æ€': 'å¾…äº§'
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'å·¥å•ç®¡ç†è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `å·¥å•ç®¡ç†_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.workOrderList.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šè§¦å‘å¯¼å…¥
        triggerBillingImport() {
          if (this.$refs.billingFileInput) {
            this.$refs.billingFileInput.click();
          }
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šå¤„ç†Excelå¯¼å…¥
        handleBillingImport(event) {
          const file = event.target.files[0];
          if (!file) return;

          const fileName = file.name.toLowerCase();
          if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
            alert('è¯·é€‰æ‹© Excel æ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsï¼‰');
            event.target.value = '';
            return;
          }

          if (typeof XLSX === 'undefined') {
            alert('Excel è§£æåº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            event.target.value = '';
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              if (!jsonData || jsonData.length === 0) {
                alert('Excelæ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                event.target.value = '';
                return;
              }

              const importedData = jsonData.map(row => {
                // æ”¯æŒå¤šç§åˆ—åæ˜ å°„
                const customerName = row['å®¢æˆ·åç§°'] || row['å®¢æˆ·'] || row['customer'] || '';
                const feeType = row['è´¹ç”¨ç±»å‹'] || row['fee_type'] || '';
                const billingCycle = row['ç»“ç®—å‘¨æœŸ'] || row['ç»“ç®—æ–¹å¼'] || row['billing_cycle'] || '';
                const occurrenceDate = this.normalizeExcelDate(row['å‘ç”Ÿæ—¥æœŸ'] || row['occurrence_date'] || '');
                const reminderDate = this.calculateReminderDate(occurrenceDate, billingCycle);
                
                // å¤„ç†é¢ç§¯ï¼šæ”¯æŒ"100å¹³"è¿™æ ·çš„æ ¼å¼ï¼Œæå–æ•°å­—
                let area = 0;
                const areaRaw = row['é¢ç§¯'] || row['area'] || '';
                if (areaRaw) {
                  const areaStr = String(areaRaw).replace(/[^\d.]/g, ''); // ç§»é™¤éæ•°å­—å­—ç¬¦
                  area = Number(areaStr) || 0;
                }
                
                // å¤„ç†é‡‘é¢ï¼šå…è®¸ä¸ºç©ºï¼Œé»˜è®¤ä¸º0
                const amount = row['é‡‘é¢'] ? Number(row['é‡‘é¢']) : 0;
                
                return {
                  å®¢æˆ·åç§°: customerName,
                  è´¹ç”¨ç±»å‹: feeType,
                  ç»“ç®—å‘¨æœŸ: billingCycle,
                  è´¹ç”¨è¯´æ˜: row['è´¹ç”¨è¯´æ˜'] || row['å¤‡æ³¨'] || row['fee_description'] || row['è´¹ç”¨è¯¦æƒ…'] || '',
                  å‘ç”Ÿæ—¥æœŸ: occurrenceDate,
                  é¢ç§¯: area,
                  é‡‘é¢: amount,
                  ç»“ç®—çŠ¶æ€: row['ç»“ç®—çŠ¶æ€'] || 'å¾…ç»“ç®—',
                  ä¸‹æ¬¡æé†’æ—¥æœŸ: reminderDate || ''
                };
              }).filter(item => item.å®¢æˆ·åç§° && item.è´¹ç”¨ç±»å‹ && item.å‘ç”Ÿæ—¥æœŸ);

              if (importedData.length === 0) {
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ ¼å¼');
                event.target.value = '';
                return;
              }

              // è¿½åŠ åˆ°åˆ—è¡¨
              this.billingRecord = [...importedData, ...this.billingRecord];
              
              // ä¿å­˜åˆ°localStorage
              try {
                localStorage.setItem('billingRecordData', JSON.stringify(this.billingRecord));
              } catch (err) {
                console.warn('ä¿å­˜åˆ°localStorageå¤±è´¥:', err);
              }

              event.target.value = '';
              alert(`æˆåŠŸå¯¼å…¥ ${importedData.length} æ¡è´¹ç”¨è®°å½•`);
            } catch (error) {
              console.error('å¯¼å…¥å¤±è´¥:', error);
              alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message);
              event.target.value = '';
            }
          };

          reader.onerror = () => {
            alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
            event.target.value = '';
          };

          reader.readAsArrayBuffer(file);
        },
        // ECO å˜æ›´ç®¡ç†ï¼šè§¦å‘å¯¼å…¥
        triggerEcoImport() {
          if (this.$refs.ecoFileInput) {
            this.$refs.ecoFileInput.click();
          }
        },
        // ECO å˜æ›´ç®¡ç†ï¼šå¤„ç†Excelå¯¼å…¥ï¼ˆæ”¯æŒç‰©æ–™åˆ—é€—å·åˆ†éš”ï¼‰
        handleEcoImport(event) {
          const file = event.target.files[0];
          if (!file) return;

          const fileName = file.name.toLowerCase();
          if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
            alert('è¯·é€‰æ‹© Excel æ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsï¼‰');
            event.target.value = '';
            return;
          }

          if (typeof XLSX === 'undefined') {
            alert('Excel è§£æåº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            event.target.value = '';
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              if (!jsonData || jsonData.length === 0) {
                alert('Excelæ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                event.target.value = '';
                return;
              }

              const importedData = jsonData.map((row, index) => {
                // å¤„ç†ç‰©æ–™åˆ—ï¼šå¦‚æœæ˜¯é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè½¬ä¸ºæ•°ç»„
                let materials = [];
                const materialsStr = row['æ¶‰åŠç‰©æ–™'] || row['ç‰©æ–™'] || row['materials'] || '';
                if (materialsStr) {
                  if (typeof materialsStr === 'string') {
                    materials = materialsStr.split(/[,ï¼Œ]/).map(m => m.trim()).filter(m => m);
                  } else if (Array.isArray(materialsStr)) {
                    materials = materialsStr;
                  }
                }

                // ç”Ÿæˆå”¯ä¸€ID
                const timestamp = Date.now();
                const randomStr = Math.random().toString(36).substring(2, 8);
                const id = `eco_${timestamp}_${randomStr}`;

                return {
                  id: id,
                  eco_no: row['ECOå·'] || row['eco_no'] || '',
                  description: row['äº§å“æè¿°'] || row['description'] || '',
                  op: row['å·¥åº'] || row['op'] || row['é€‚ç”¨å·¥åº'] || '',
                  start_set: row['èµ·å§‹å°å¥—'] || row['start_set'] || row['å°å¥—'] || '',
                  change_details: row['å˜æ›´è¯¦æƒ…'] || row['change_details'] || '',
                  materials: materials,
                  status: row['å˜æ›´çŠ¶æ€'] || row['status'] || 'è¿›è¡Œä¸­',
                  update_time: row['æ›´æ–°æ—¶é—´'] || row['update_time'] || '',
                  é…æ–™å‘˜: row['é…æ–™å‘˜'] || ''
                };
              }).filter(item => item.eco_no);

              if (importedData.length === 0) {
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ ¼å¼');
                event.target.value = '';
                return;
              }

              // è¿½åŠ åˆ°åˆ—è¡¨
              this.ecoList = [...importedData, ...this.ecoList];
              
              // ä¿å­˜åˆ°localStorage
              try {
                localStorage.setItem('ecoListData', JSON.stringify(this.ecoList));
              } catch (err) {
                console.warn('ä¿å­˜åˆ°localStorageå¤±è´¥:', err);
              }

              event.target.value = '';
              alert(`æˆåŠŸå¯¼å…¥ ${importedData.length} æ¡ECOè®°å½•`);
            } catch (error) {
              console.error('å¯¼å…¥å¤±è´¥:', error);
              alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message);
              event.target.value = '';
            }
          };

          reader.onerror = () => {
            alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
            event.target.value = '';
          };

          reader.readAsArrayBuffer(file);
        },
        // ECO å˜æ›´ç®¡ç†ï¼šå¯¼å‡º Excelï¼ˆç‰¹æ®Šå¤„ç† materials æ•°ç»„ï¼‰
        exportEcoListToExcel() {
          const dataToExport = this.filteredEcoList;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => {
              // å¤„ç† materials æ•°ç»„ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²
              const materials = item.materials || [];
              let materialsStr = '';
              if (materials.length > 0) {
                materialsStr = materials.join(', ');
              } else {
                // å…¼å®¹æ—§ç»“æ„çš„å•ç‰©æ–™å·
                materialsStr = item.ç‰©æ–™å· || '';
              }
              
              return {
                'ECOå·': item.eco_no || item.ECOå· || '',
                'äº§å“æè¿°': item.description || item.äº§å“æè¿° || '',
                'å·¥åº': item.op || item.é€‚ç”¨å·¥åº || '',
                'èµ·å§‹å°å¥—': item.start_set || item.å°å¥— || '',
                'å˜æ›´è¯¦æƒ…': item.change_details || '',
                'æ¶‰åŠç‰©æ–™': materialsStr,
                'å˜æ›´çŠ¶æ€': item.status || item.å˜æ›´çŠ¶æ€ || '',
                'æ›´æ–°æ—¶é—´': item.update_time || item.å˜æ›´æ—¶é—´ || '',
                'é…æ–™å‘˜': item.é…æ–™å‘˜ || ''
              };
            });
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ECOå˜æ›´è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `ECOå˜æ›´ç®¡ç†_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.ecoList.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // å®¢æˆ·è´¹ç”¨ç»“ç®—ï¼šå¯¼å‡º Excel
        exportBillingToExcel() {
          const dataToExport = this.filteredBillingRecord;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'å®¢æˆ·åç§°': item.å®¢æˆ·åç§° || '',
              'è´¹ç”¨ç±»å‹': item.è´¹ç”¨ç±»å‹ || '',
              'é¢ç§¯(ã¡)': item.é¢ç§¯ !== undefined ? item.é¢ç§¯ : '',
              'è´¹ç”¨è¯¦æƒ…': item.è´¹ç”¨è¯¦æƒ… || '',
              'å‘ç”Ÿæ—¥æœŸ': item.å‘ç”Ÿæ—¥æœŸ || '',
              'é‡‘é¢': item.é‡‘é¢ || '',
              'ç»“ç®—çŠ¶æ€': item.ç»“ç®—çŠ¶æ€ || '',
              'ä¸‹æ¬¡æé†’æ—¥æœŸ': item.ä¸‹æ¬¡æé†’æ—¥æœŸ || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'å®¢æˆ·è´¹ç”¨ç»“ç®—è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `å®¢æˆ·è´¹ç”¨ç»“ç®—_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.billingRecord.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ç¼ºé™·ç®¡ç†ï¼šå¯¼å‡º Excel
        exportDefectsToExcel() {
          const dataToExport = this.defectList || [];
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'å‘ç°æ—¥æœŸ': item.å‘ç°æ—¥æœŸ || '',
              'ç±»å‹': item.ç±»å‹ || '',
              'ç§ç±»': item.ç§ç±» || '',
              'æŒ‰ç¯çŠ¶æ€': item.æ˜¯å¦æŒ‰ç¯ ? 'æ˜¯' : 'å¦',
              'äº§å“': item.äº§å“ || '',
              'é—®é¢˜æè¿°': item.é—®é¢˜æè¿° || '',
              'å‘ç°äºº': item.å‘ç°äºº || '',
              'è´£ä»»äºº': item.è´£ä»»äºº || '',
              'åŸå› ': item.åŸå›  || '',
              'è§£å†³æ–¹æ¡ˆ': item.è§£å†³æ–¹æ¡ˆ || '',
              '5WHYæŠ¥å‘Š': item['5WHYæ–‡ä»¶'] || '',
              'å¤‡æ³¨': item.å¤‡æ³¨ || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ç¼ºé™·ç®¡ç†è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `ç¼ºé™·ç®¡ç†_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${dataToExport.length} æ¡è®°å½•`);
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ä¾›åº”å•†æ”¶è´§ç›‘æ§ï¼šå¯¼å‡º Excel
        exportSupplierReceivingToExcel() {
          const dataToExport = this.filteredReceivingTasks;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => {
              const status = item.å½“å‰çŠ¶æ€ || (item.data_source === 'synced' && item.æ€»è¡Œæ•° > 0 ? 'å·²åŒæ­¥' : 'ç­‰å¾…æ•°æ®');
              
              return {
                'ä¾›åº”å•†åç§°': item.ä¾›åº”å•†åç§° || '',
                'åˆ°è´§æ—¶é—´': item.åˆ°è´§æ—¥æœŸ || '',
                'ç³»ç»Ÿå·²æ”¶': item.æ€»è¡Œæ•° || 0,
                'çŠ¶æ€': status
              };
            });
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ä¾›åº”å•†æ”¶è´§ç›‘æ§è¡¨');
            
            const today = new Date();
            const dateStr = today.getFullYear() + 
                          String(today.getMonth() + 1).padStart(2, '0') + 
                          String(today.getDate()).padStart(2, '0');
            const fileName = `ä¾›åº”å•†æ”¶è´§ç›‘æ§_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.receivingTasks.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // è·å– ECO ç‰©æ–™æ‘˜è¦ï¼ˆç”¨äºåˆ—è¡¨æ˜¾ç¤ºï¼‰
        getEcoMaterialsSummary(item) {
          const materials = item.materials || [];
          if (materials.length === 0) {
            // å…¼å®¹æ—§ç»“æ„
            return item.ç‰©æ–™å· || '--';
          }
          if (materials.length <= 2) {
            return materials.join(', ');
          }
          return `${materials[0]}, ${materials[1]} ç­‰ ${materials.length} é¡¹`;
        },
        // è·å– ECO ç‰©æ–™å®Œæ•´åˆ—è¡¨ï¼ˆç”¨äºæ‚¬åœæç¤ºï¼‰
        getEcoMaterialsFullList(item) {
          const materials = item.materials || [];
          if (materials.length === 0) {
            return item.ç‰©æ–™å· || '--';
          }
          return materials.join(', ');
        },
        // æŸ¥çœ‹è¯¦æƒ…ï¼ˆç®€å•å¼¹çª—ï¼‰
        viewDetail(item) {
          if (this.currentMenu === 'eco') {
            const ecoNo = item.eco_no || item.ECOå· || '--';
            const desc = item.description || item.äº§å“æè¿° || '--';
            const op = item.op || item.é€‚ç”¨å·¥åº || '--';
            const startSet = item.start_set || item.å°å¥— || '--';
            const changeDetails = item.change_details || '--';
            const materials = item.materials || [];
            const materialsStr = materials.length > 0 ? materials.join(', ') : (item.ç‰©æ–™å· || '--');
            const status = item.status || item.å˜æ›´çŠ¶æ€ || '--';
            const updateTime = item.update_time || item.å˜æ›´æ—¶é—´ || '--';
            const operator = item.é…æ–™å‘˜ || '--';
            
            alert(
              `ECOå·: ${ecoNo}\n` +
              `äº§å“æè¿°: ${desc}\n` +
              `å·¥åº: ${op}\n` +
              `èµ·å§‹å°å¥—: ç¬¬ ${startSet} å°èµ·\n` +
              `å˜æ›´è¯¦æƒ…: ${changeDetails}\n` +
              `æ¶‰åŠç‰©æ–™: ${materialsStr}\n` +
              `å˜æ›´çŠ¶æ€: ${status}\n` +
              `æ›´æ–°æ—¶é—´: ${updateTime}\n` +
              `é…æ–™å‘˜: ${operator}`
            );
          }
        },
        // æ‰§è¡Œ ECO å˜æ›´
        executeEco(item, index) {
          // å¼¹å‡ºç¡®è®¤æ¡†
          if (!confirm('ç¡®è®¤è¯¥ ECO å˜æ›´å·²æ‰§è¡Œå®Œæ¯•ï¼Ÿ')) {
            return;
          }
          
          // æ›´æ–°çŠ¶æ€ä¸º"å·²å®Œæˆ"ï¼ˆæ”¯æŒæ–°æ—§æ•°æ®ç»“æ„ï¼‰
          if (item.status !== undefined) {
            item.status = 'å·²å®Œæˆ';
          } else {
            item.å˜æ›´çŠ¶æ€ = 'å·²å®Œæˆ';
          }
          
          // æ›´æ–°å˜æ›´æ—¶é—´ä¸ºå½“å‰ç³»ç»Ÿæ—¶é—´
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const hour = String(now.getHours()).padStart(2, '0');
          const minute = String(now.getMinutes()).padStart(2, '0');
          const second = String(now.getSeconds()).padStart(2, '0');
          const timeStr = `${year}-${month}-${day} ${hour}:${minute}:${second}`;
          
          if (item.update_time !== undefined) {
            item.update_time = timeStr;
          } else {
            item.å˜æ›´æ—¶é—´ = timeStr;
          }
          
          // ä¿å­˜åˆ° localStorage
          this.saveEcoToStorage();
          
          // Vue ä¼šè‡ªåŠ¨å“åº”å¼æ›´æ–°ç•Œé¢ï¼ŒæŒ‰é’®ä¼šè‡ªåŠ¨å˜ä¸º"è¯¦æƒ…"
          alert('ECO å˜æ›´å·²æ ‡è®°ä¸ºå·²å®Œæˆå¹¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
        },
        // æ ¼å¼åŒ–é‡‘é¢
        formatCurrency(amount) {
          if (amount === null || amount === undefined) return '0.00';
          return Number(amount).toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        },
        displayBillingAmount(amount) {
          const roleConfig = this.roles[this.currentUser.role];
          if (roleConfig && roleConfig.canViewAmount) {
            return `Â¥${this.formatCurrency(amount)}`;
          }
          return '****';
        },
        toggleBossRole() {
          this.userRole = this.isBossMode ? 'boss' : 'staff';
          // å…¼å®¹æ—§é€»è¾‘ï¼Œä½†ç»Ÿä¸€ä½¿ç”¨ currentUser.role
          if (this.isBossMode) {
            this.currentUser.role = 'boss';
            this.currentUser.name = this.roles['boss'].name;
          }
        },
        // åˆ‡æ¢è§’è‰²
        switchRole(role) {
          if (!this.roles[role]) {
            alert('æ— æ•ˆçš„è§’è‰²');
            return;
          }
          this.currentUser.role = role;
          this.currentUser.name = this.roles[role].name;
          this.showRoleDropdown = false;
          
          // æ”¶è´§å‘˜è§’è‰²ï¼šåªèƒ½çœ‹åˆ°"åˆ°è´§ç™»è®°"æ¨¡å—
          if (role === 'receiver') {
            this.currentMenu = 'arrival';
          } else {
            // å…¬å…±æ¨¡å—ï¼šå…¶ä»–äººå¯è§
            const commonMenus = ['bi', 'production', 'workorder'];
            
            // å¦‚æœå½“å‰èœå•ä¸åœ¨æ–°è§’è‰²çš„æƒé™èŒƒå›´å†…ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨èœå•
            const roleConfig = this.roles[role];
            const allVisibleMenus = [...new Set([...commonMenus, ...(roleConfig.menus || [])])];
            
            if (!allVisibleMenus.includes(this.currentMenu)) {
              // ä¼˜å…ˆåˆ‡æ¢åˆ°å…¬å…±æ¨¡å—
              this.currentMenu = commonMenus[0] || (roleConfig.menus && roleConfig.menus[0]) || 'bi';
            }
          }
          
          // åŒæ­¥æ›´æ–°å…¼å®¹å­—æ®µ
          this.userRole = (role === 'admin') ? 'boss' : 'staff';
          this.isBossMode = (role === 'admin');
          
          alert(`å½“å‰èº«ä»½å·²åˆ‡æ¢ä¸ºï¼š${this.roles[role].name}`);
        },
        // åˆ°è´§å¼‚å¸¸ï¼šåˆ†ç±»æ ·å¼
        discrepancyCategoryClass(category) {
          const base = 'status-badge';
          switch (category) {
            case 'å®ç‰©ç ´æŸ':
              return `${base} status-pending`;
            case 'ç³»ç»Ÿé—®é¢˜':
              return `${base} status-ongoing`;
            case 'æ•°é‡å·®å¼‚':
            case 'å•æ®é—®é¢˜':
              return `${base} bg-yellow-50 text-yellow-700 border border-yellow-200`;
            case 'æ ‡ç­¾é”™è¯¯':
              return `${base} bg-indigo-50 text-indigo-700 border border-indigo-200`;
            default:
              return `${base} bg-gray-100 text-gray-700 border border-gray-200`;
          }
        },
        // åˆ°è´§å¼‚å¸¸ï¼šçŠ¶æ€æ ·å¼
        discrepancyStatusClass(status) {
          const base = 'status-badge';
          if (status === 'å¾…å¤„ç†') return `${base} status-pending`;
          if (status === 'å¤„ç†ä¸­') return `${base} status-ongoing`;
          return `${base} status-completed`;
        },
        // åˆ°è´§å¼‚å¸¸ï¼šå¤„ç†æ—¶é•¿
        getDiscrepancyDuration(item) {
          // å¦‚æœçŠ¶æ€ä¸º"å·²é—­ç¯"ï¼Œè¿”å›é”å®šçš„æ—¶é•¿
          if (item.status === 'å·²é—­ç¯' && item.duration !== undefined && item.duration !== null) {
            return item.duration;
          }
          
          // å¦‚æœå·²é—­ç¯ä½†æ²¡æœ‰durationï¼Œä½¿ç”¨handle_timeè®¡ç®—
          if (item.status === 'å·²é—­ç¯' && item.handle_time) {
            const startDate = new Date(item.date);
            const handleDate = new Date(item.handle_time);
            if (!isNaN(startDate) && !isNaN(handleDate)) {
              return Math.max(0, Math.floor((handleDate - startDate) / (1000 * 60 * 60 * 24)));
            }
          }
          
          // å…¶ä»–çŠ¶æ€ï¼šå®æ—¶è®¡ç®—
          const startDate = new Date(item.date || item.åˆ°è´§æ—¥æœŸ);
          if (isNaN(startDate)) return item.duration || 0;
          const now = new Date();
          return Math.max(0, Math.floor((now - startDate) / (1000 * 60 * 60 * 24)));
        },
        discrepancyDurationClass(item) {
          const days = this.getDiscrepancyDuration(item);
          if (item.status !== 'å·²é—­ç¯' && days > 3) {
            return 'text-red-600 font-semibold';
          }
          return '';
        },
        // åˆ°è´§å¼‚å¸¸ï¼šæ‰“å¼€/å…³é—­
        openDiscrepancyModal() {
          const today = new Date().toISOString().split('T')[0];
          this.newDiscrepancy = {
            supplier: '',
            date: today,
            po: '',
            material: '',
            line_no: '',
            qty: '',
            is_bonded: false,
            category: 'ç³»ç»Ÿé—®é¢˜',
            description: '',
            photos: [],
            status: 'å¾…å¤„ç†',
            result: ''
          };
          this.showDiscrepancyModal = true;
        },
        closeDiscrepancyModal() {
          this.showDiscrepancyModal = false;
        },
        handleDiscrepancyPhotos(event) {
          const files = event.target.files || [];
          this.newDiscrepancy.photos = Array.from(files).map(f => f.name);
        },
        // åˆ°è´§å¼‚å¸¸ï¼šä¿å­˜
        saveDiscrepancy() {
          const d = this.newDiscrepancy;
          if (!d.supplier || !d.date || !d.po || !d.material || !d.qty || !d.category || !d.description) {
            alert('è¯·å¡«å†™å¿…å¡«é¡¹ï¼šä¾›åº”å•†ã€æ—¥æœŸã€POã€ç‰©æ–™ã€æ•°é‡ã€åˆ†ç±»ã€æè¿°');
            return;
          }
          const todayStr = (d.date || '').replace(/-/g, '').substring(2); // åªå–å6ä½ï¼š250115
          const sameDayCount = (this.discrepancyList || []).filter(item => {
            const itemDate = (item.date || '').replace(/-/g, '').substring(2);
            return itemDate === todayStr;
          }).length + 1;
          const reportId = `#${todayStr}-${String(sameDayCount).padStart(2, '0')}`;
          const newItem = {
            report_id: reportId,
            date: d.date,
            supplier: d.supplier,
            po: d.po,
            material: d.material,
            line_no: d.line_no || '',
            qty: Number(d.qty) || 0,
            is_bonded: !!d.is_bonded,
            category: d.category,
            description: d.description,
            photos: d.photos || [],
            status: d.status || 'å¾…å¤„ç†',
            result: d.result || '',
            duration: 0
          };
          this.discrepancyList.unshift(newItem);
          this.closeDiscrepancyModal();
          alert('åˆ°è´§å¼‚å¸¸å·²ç™»è®°');
        },
        // åˆ°è´§å¼‚å¸¸ï¼šæŸ¥çœ‹è¯¦æƒ…ï¼ˆå·²é—­ç¯çŠ¶æ€ï¼‰
        viewDiscrepancyDetail(item) {
          this.currentDiscrepancyItem = { ...item };
          this.discrepancyHandleResult = '';
          this.discrepancyHandleStatus = 'å¤„ç†ä¸­';
          this.showDiscrepancyDetailModal = true;
        },
        // åˆ°è´§å¼‚å¸¸ï¼šå¤„ç†ï¼ˆå¾…å¤„ç†/å¤„ç†ä¸­çŠ¶æ€ï¼‰
        handleDiscrepancy(item) {
          this.currentDiscrepancyItem = { ...item };
          this.discrepancyHandleResult = item.result || '';
          this.discrepancyHandleStatus = item.status || 'å¤„ç†ä¸­';
          this.showDiscrepancyDetailModal = true;
        },
        // åˆ°è´§å¼‚å¸¸ï¼šå…³é—­è¯¦æƒ…/å¤„ç†å¼¹çª—
        closeDiscrepancyDetailModal() {
          this.showDiscrepancyDetailModal = false;
          this.currentDiscrepancyItem = null;
          this.discrepancyHandleResult = '';
          this.discrepancyHandleStatus = 'å¤„ç†ä¸­';
        },
        // åˆ°è´§å¼‚å¸¸ï¼šä¿å­˜å¤„ç†ç»“æœ
        saveDiscrepancyHandle() {
          if (!this.currentDiscrepancyItem) return;
          
          if (!this.discrepancyHandleResult || !this.discrepancyHandleResult.trim()) {
            alert('è¯·å¡«å†™å¤„ç†ç»“æœ');
            return;
          }
          
          if (!this.discrepancyHandleStatus) {
            alert('è¯·é€‰æ‹©æ›´æ–°çŠ¶æ€');
            return;
          }
          
          // æ‰¾åˆ°å¯¹åº”çš„è®°å½•å¹¶æ›´æ–°
          const index = this.discrepancyList.findIndex(item => 
            item.report_id === this.currentDiscrepancyItem.report_id
          );
          
          if (index !== -1) {
            const item = this.discrepancyList[index];
            item.result = this.discrepancyHandleResult.trim();
            item.status = this.discrepancyHandleStatus;
            
            // å¦‚æœçŠ¶æ€ä¸º"å·²é—­ç¯"ï¼Œè®°å½•å¤„ç†æ—¶é—´å¹¶é”å®šæ—¶é•¿
            if (this.discrepancyHandleStatus === 'å·²é—­ç¯') {
              item.handle_time = new Date().toISOString();
              // è®¡ç®—å¹¶é”å®šå¤„ç†æ—¶é•¿
              const startDate = new Date(item.date);
              const handleDate = new Date(item.handle_time);
              if (!isNaN(startDate) && !isNaN(handleDate)) {
                item.duration = Math.max(0, Math.floor((handleDate - startDate) / (1000 * 60 * 60 * 24)));
              }
            } else {
              // å¦‚æœæ”¹ä¸º"å¤„ç†ä¸­"ï¼Œæ¸…é™¤å¤„ç†æ—¶é—´
              item.handle_time = null;
            }
            
            this.closeDiscrepancyDetailModal();
            alert('å¤„ç†ç»“æœå·²ä¿å­˜');
          }
        },
        // åˆ°è´§å¼‚å¸¸ï¼šå¯¼å‡º
        // åˆ°è´§å¼‚å¸¸ç®¡ç†ï¼šè§¦å‘å¯¼å…¥
        triggerDiscrepancyImport() {
          if (this.$refs.discrepancyFileInput) {
            this.$refs.discrepancyFileInput.click();
          }
        },
        // åˆ°è´§å¼‚å¸¸ç®¡ç†ï¼šå¤„ç†Excelå¯¼å…¥
        handleDiscrepancyImport(event) {
          const file = event.target.files[0];
          if (!file) return;

          const fileName = file.name.toLowerCase();
          if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
            alert('è¯·é€‰æ‹© Excel æ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsï¼‰');
            event.target.value = '';
            return;
          }

          if (typeof XLSX === 'undefined') {
            alert('Excel è§£æåº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            event.target.value = '';
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              if (!jsonData || jsonData.length === 0) {
                alert('Excelæ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                event.target.value = '';
                return;
              }

              const importedData = jsonData.map((row, index) => {
                // å¤„ç†æ—¥æœŸ
                const date = this.normalizeExcelDate(row['åˆ°è´§æ—¥æœŸ'] || row['æ—¥æœŸ'] || row['date'] || '');
                
                // å¤„ç†æ˜¯å¦ä¿ç¨ï¼ˆæ”¯æŒ"æ˜¯"/"å¦"æˆ–true/falseï¼‰
                let isBonded = false;
                const bondedValue = row['æ˜¯å¦ä¿ç¨'] || row['is_bonded'] || '';
                if (bondedValue === 'æ˜¯' || bondedValue === true || bondedValue === 'true' || bondedValue === 'TRUE') {
                  isBonded = true;
                }
                
                // å¤„ç†ç…§ç‰‡ï¼ˆå¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼ŒæŒ‰é€—å·åˆ†éš”è½¬ä¸ºæ•°ç»„ï¼‰
                let photos = [];
                const photosStr = row['ç…§ç‰‡'] || row['photos'] || '';
                if (photosStr) {
                  if (typeof photosStr === 'string') {
                    photos = photosStr.split(/[,ï¼Œ]/).map(p => p.trim()).filter(p => p);
                  } else if (Array.isArray(photosStr)) {
                    photos = photosStr;
                  }
                }
                
                // ç”ŸæˆæŠ¥å‘Šç¼–å·ï¼ˆå¦‚æœæ²¡æœ‰æä¾›ï¼‰
                let reportId = row['æŠ¥å‘Šç¼–å·'] || row['report_id'] || '';
                if (!reportId && date) {
                  const dateStr = date.replace(/-/g, '').substring(2);
                  const sameDayCount = (this.discrepancyList || []).filter(item => {
                    const itemDate = (item.date || '').replace(/-/g, '').substring(2);
                    return itemDate === dateStr;
                  }).length + 1;
                  reportId = `#${dateStr}-${String(sameDayCount).padStart(2, '0')}`;
                }
                
                return {
                  report_id: reportId,
                  date: date,
                  supplier: row['ä¾›åº”å•†'] || row['supplier'] || '',
                  po: row['POå·'] || row['po'] || row['PO'] || '',
                  material: row['ç‰©æ–™å·'] || row['material'] || '',
                  line_no: row['è¡Œå·'] || row['line_no'] || '',
                  qty: row['æ•°é‡'] ? Number(row['æ•°é‡']) : 0,
                  is_bonded: isBonded,
                  category: row['é—®é¢˜åˆ†ç±»'] || row['category'] || 'ç³»ç»Ÿé—®é¢˜',
                  description: row['æè¿°'] || row['description'] || '',
                  photos: photos,
                  status: row['çŠ¶æ€'] || row['status'] || 'å¾…å¤„ç†',
                  result: row['å¤„ç†ç»“æœ'] || row['result'] || '',
                  duration: row['å¤„ç†æ—¶é•¿(å¤©)'] ? Number(row['å¤„ç†æ—¶é•¿(å¤©)']) : 0,
                  handle_time: row['å¤„ç†æ—¶é—´'] || row['handle_time'] || ''
                };
              }).filter(item => item.date && item.supplier);

              if (importedData.length === 0) {
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ ¼å¼');
                event.target.value = '';
                return;
              }

              // è¿½åŠ åˆ°åˆ—è¡¨
              this.discrepancyList = [...importedData, ...this.discrepancyList];
              
              // ä¿å­˜åˆ°localStorage
              try {
                localStorage.setItem('discrepancyListData', JSON.stringify(this.discrepancyList));
              } catch (err) {
                console.warn('ä¿å­˜åˆ°localStorageå¤±è´¥:', err);
              }

              event.target.value = '';
              alert(`æˆåŠŸå¯¼å…¥ ${importedData.length} æ¡å¼‚å¸¸è®°å½•`);
            } catch (error) {
              console.error('å¯¼å…¥å¤±è´¥:', error);
              alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message);
              event.target.value = '';
            }
          };

          reader.onerror = () => {
            alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
            event.target.value = '';
          };

          reader.readAsArrayBuffer(file);
        },
        exportDiscrepancyToExcel() {
          const dataToExport = this.filteredDiscrepancyList;
          
          if (!dataToExport || dataToExport.length === 0) {
            alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
            return;
          }
          
          try {
            const exportData = dataToExport.map(item => ({
              'æŠ¥å‘Šç¼–å·': item.report_id || '',
              'åˆ°è´§æ—¥æœŸ': item.date || '',
              'ä¾›åº”å•†': item.supplier || '',
              'POå·': item.po || '',
              'ç‰©æ–™å·': item.material || '',
              'è¡Œå·': item.line_no || '',
              'æ•°é‡': item.qty || 0,
              'æ˜¯å¦ä¿ç¨': item.is_bonded ? 'æ˜¯' : 'å¦',
              'é—®é¢˜åˆ†ç±»': item.category || '',
              'æè¿°': item.description || '',
              'ç…§ç‰‡': (item.photos || []).join(', '),
              'çŠ¶æ€': item.status || '',
              'å¤„ç†ç»“æœ': item.result || '',
              'å¤„ç†æ—¶é•¿(å¤©)': this.getDiscrepancyDuration(item)
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'åˆ°è´§å¼‚å¸¸ç®¡ç†');
            
            const today = new Date();
            const dateStr = today.getFullYear() + String(today.getMonth() + 1).padStart(2, '0') + String(today.getDate()).padStart(2, '0');
            const fileName = `åˆ°è´§å¼‚å¸¸ç®¡ç†_${dateStr}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
            
            const totalCount = this.discrepancyList.length;
            const filteredCount = dataToExport.length;
            if (filteredCount < totalCount) {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡ç­›é€‰åçš„è®°å½•ï¼ˆå…± ${totalCount} æ¡ï¼‰`);
            } else {
              alert(`å¯¼å‡ºæˆåŠŸï¼š${fileName}\nå·²å¯¼å‡º ${filteredCount} æ¡è®°å½•`);
            }
          } catch (error) {
            console.error('å¯¼å‡º Excel å¤±è´¥:', error);
            alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
          }
        },
        // ä¾›åº”å•†æ”¶è´§ï¼šè®¡ç®— SLA å€’è®¡æ—¶ä¿¡æ¯
        getSlaInfo(task) {
          if (!task || !task.åˆ°è´§æ—¥æœŸ) return { text: '--', type: 'normal' };
          const arrival = new Date(task.åˆ°è´§æ—¥æœŸ.replace(' ', 'T'));
          const now = new Date();
          const diffMs = now.getTime() - arrival.getTime();
          const diffHours = diffMs / (1000 * 60 * 60);
          const deadlineHours = 48;
          const hasData = task.data_source === 'synced' && task.æ€»è¡Œæ•° > 0;

          if (diffHours <= deadlineHours) {
            // æœªè¶…è¿‡ 48 å°æ—¶
            const remaining = Math.max(0, deadlineHours - diffHours);
            const remainingHours = Math.round(remaining);
            return {
              text: `å‰©ä½™ ${remainingHours} å°æ—¶`,
              type: hasData ? 'ok' : 'normal'
            };
          } else {
            const overtimeHours = Math.round(diffHours - deadlineHours);
            const days = Math.floor(overtimeHours / 24);
            const hours = overtimeHours % 24;
            const detail = days > 0 ? `${days} å¤©` : `${hours} å°æ—¶`;
            return {
              text: `å·²è¶…æ—¶ ${detail}`,
              type: 'overdue'
            };
          }
        },
        // ä¾›åº”å•†æ”¶è´§ï¼šçŠ¶æ€æ ·å¼
        getReceivingStatusBadge(task) {
          if (!task || !task.å½“å‰çŠ¶æ€) return 'bg-gray-100 text-gray-600 border border-gray-200';
          if (task.å½“å‰çŠ¶æ€.includes('æ­£å¸¸')) {
            return 'bg-green-50 text-green-700 border border-green-200';
          }
          if (task.å½“å‰çŠ¶æ€.includes('è¶…æ—¶') || task.å½“å‰çŠ¶æ€.includes('ğŸ”´')) {
            return 'bg-red-50 text-red-700 border border-red-200';
          }
          return 'bg-yellow-50 text-yellow-700 border border-yellow-200';
        },
        // æ‰“å¼€æ–°å»ºæ”¶è´§ä»»åŠ¡å¼¹çª—
        openNewReceivingModal() {
          const now = new Date();
          const pad = (n) => n.toString().padStart(2, '0');
          const value = `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
          this.newReceivingTask = {
            ä¾›åº”å•†åç§°: '',
            supplier_en: '',
            supplier_cn: '',
            åˆ°è´§æ—¥æœŸ: value,
            æ€»è¡Œæ•°: 0,
            physical_qty: '',
            unit: 'æ‰˜',
            data_source: 'pending',
            å¤‡æ³¨: ''
          };
          this.supplierSearchInput = '';
          this.selectedSupplier = null;
          this.showSupplierDropdown = false;
          this.showNewReceivingModal = true;
        },
        closeNewReceivingModal() {
          this.showNewReceivingModal = false;
        },
        // ä¾›åº”å•†è”æƒ³è¾“å…¥ï¼šæœç´¢
        onSupplierSearchInput() {
          const kw = (this.supplierSearchInput || '').trim().toLowerCase();
          if (!kw) {
            this.filteredSupplierOptions = [];
            return;
          }
          this.filteredSupplierOptions = (mockData.supplierDict || []).filter(item => {
            const en = String(item.en || '').toLowerCase();
            const cn = String(item.cn || '').toLowerCase();
            return en.includes(kw) || cn.includes(kw);
          });
        },
        // ä¾›åº”å•†è”æƒ³è¾“å…¥ï¼šé€‰æ‹©
        selectSupplier(option) {
          this.selectedSupplier = option;
          this.supplierSearchInput = option.en;
          this.newReceivingTask.supplier_en = option.en;
          this.newReceivingTask.supplier_cn = option.cn;
          this.newReceivingTask.ä¾›åº”å•†åç§° = `${option.en} - ${option.cn}`;
          this.showSupplierDropdown = false;
        },
        saveNewReceivingTask() {
          // éªŒè¯ä¾›åº”å•†ï¼šä¼˜å…ˆä½¿ç”¨ selectedSupplierï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥
          let supplierName = '';
          let supplierEn = '';
          let supplierCn = '';
          
          if (this.selectedSupplier) {
            // ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©çš„ä¾›åº”å•†
            supplierName = `${this.selectedSupplier.en} - ${this.selectedSupplier.cn}`;
            supplierEn = this.selectedSupplier.en;
            supplierCn = this.selectedSupplier.cn;
          } else if (this.supplierSearchInput && this.supplierSearchInput.trim()) {
            // ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥çš„ä¾›åº”å•†åç§°
            const inputValue = this.supplierSearchInput.trim();
            // å°è¯•è§£ææ ¼å¼ï¼šè‹±æ–‡ - ä¸­æ–‡
            if (inputValue.includes(' - ')) {
              const parts = inputValue.split(' - ');
              supplierEn = parts[0].trim();
              supplierCn = parts[1] ? parts[1].trim() : '';
            } else {
              // åªæœ‰è‹±æ–‡æˆ–åªæœ‰ä¸­æ–‡
              supplierEn = inputValue;
              supplierCn = inputValue;
            }
            supplierName = inputValue;
          } else {
            alert('è¯·é€‰æ‹©ä¾›åº”å•†æˆ–è¾“å…¥ä¾›åº”å•†åç§°');
            return;
          }
          
          // éªŒè¯å®ç‰©æ•°é‡
          if (!this.newReceivingTask.physical_qty) {
            alert('è¯·å¡«å†™å®ç‰©æ•°é‡');
            return;
          }
          
          const physicalQty = Number(this.newReceivingTask.physical_qty);
          if (Number.isNaN(physicalQty) || physicalQty <= 0) {
            alert('å®ç‰©æ•°é‡å¿…é¡»ä¸ºå¤§äº 0 çš„æ•°å­—');
            return;
          }
          
          const arrivalRaw = this.newReceivingTask.åˆ°è´§æ—¥æœŸ || '';
          const arrival = arrivalRaw.replace('T', ' ');
          
          const newTask = {
            ä¾›åº”å•†åç§°: supplierName,
            supplier_en: supplierEn,
            supplier_cn: supplierCn,
            åˆ°è´§æ—¥æœŸ: arrival,
            æ€»è¡Œæ•°: 0,
            physical_qty: physicalQty,
            unit: this.newReceivingTask.unit || 'æ‰˜',
            data_source: 'pending',
            å·²å®Œæˆæ•°é‡: 0,
            æ¯æ—¥è¿›åº¦è®°å½•: [],
            å½“å‰çŠ¶æ€: 'æ­£å¸¸',
            å¤‡æ³¨: this.newReceivingTask.å¤‡æ³¨ || ''
          };
          
          this.receivingTasks.unshift(newTask);
          this.showNewReceivingModal = false;
          this.receivingPage = 1;
          alert('å·²ç™»è®°æ–°çš„ä¾›åº”å•†åˆ°è´§ä»»åŠ¡ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼Œä»…å‰ç«¯ä¿å­˜äºå†…å­˜ï¼‰');
        },
        // æ‰“å¼€æ”¶è´§è¯¦æƒ…
        openReceivingDetail(task) {
          this.currentReceivingDetailTask = task;
          this.showReceivingDetailModal = true;
        },
        closeReceivingDetailModal() {
          this.showReceivingDetailModal = false;
          this.currentReceivingDetailTask = null;
        },
        // åˆ‡æ¢æ ‡ç­¾
        changeReceivingTab(tab) {
          if (this.activeReceivingTab === tab) return;
          this.activeReceivingTab = tab;
          this.receivingPage = 1;
        },
        // æœç´¢é‡ç½®é¡µç 
        onReceivingSearchInput() {
          this.receivingPage = 1;
        },
        // åŒè¡¨ä¸Šä¼ ï¼šè§¦å‘æ”¶è´§æµæ°´è¡¨æ–‡ä»¶é€‰æ‹©
        triggerTransactionLogUpload() {
          if (this.$refs.transactionLogFileInput) {
            this.$refs.transactionLogFileInput.click();
          }
        },
        // åŒè¡¨ä¸Šä¼ ï¼šå¤„ç†æ”¶è´§æµæ°´è¡¨æ–‡ä»¶
        handleTransactionLogUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              this.transactionLogFile = file;
              this.transactionLogData = jsonData;
              event.target.value = '';
              alert(`âœ“ æ”¶è´§æµæ°´è¡¨å·²ä¸Šä¼ ï¼Œå…± ${jsonData.length} è¡Œæ•°æ®`);
            } catch (error) {
              console.error('è§£ææ”¶è´§æµæ°´è¡¨é”™è¯¯:', error);
              alert('è§£æå¤±è´¥ï¼š' + error.message);
              event.target.value = '';
            }
          };
          reader.readAsArrayBuffer(file);
        },
        // åŒè¡¨ä¸Šä¼ ï¼šè§¦å‘ç‰©æ–™å…³ç³»è¡¨æ–‡ä»¶é€‰æ‹©
        triggerMappingTableUpload() {
          if (this.$refs.mappingTableFileInput) {
            this.$refs.mappingTableFileInput.click();
          }
        },
        // åŒè¡¨ä¸Šä¼ ï¼šå¤„ç†ç‰©æ–™å…³ç³»è¡¨æ–‡ä»¶
        handleMappingTableUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              this.mappingTableFile = file;
              this.mappingTableData = jsonData;
              event.target.value = '';
              alert(`âœ“ ç‰©æ–™å…³ç³»è¡¨å·²ä¸Šä¼ ï¼Œå…± ${jsonData.length} è¡Œæ•°æ®`);
            } catch (error) {
              console.error('è§£æç‰©æ–™å…³ç³»è¡¨é”™è¯¯:', error);
              alert('è§£æå¤±è´¥ï¼š' + error.message);
              event.target.value = '';
            }
          };
          reader.readAsArrayBuffer(file);
        },
        // åŒè¡¨åŒ¹é…ï¼šå¼€å§‹åŒ¹é…é€»è¾‘
        startMatching() {
          // æš‚æ—¶ç¦ç”¨åŒ¹é…åŠŸèƒ½ï¼Œç”¨äºæµ‹è¯•
          alert('åŒ¹é…åŠŸèƒ½å·²æš‚æ—¶ç¦ç”¨ï¼Œç”¨äºæµ‹è¯•å…¶ä»–åŠŸèƒ½');
          return;
          
          if (!this.transactionLogData || !this.mappingTableData) {
            alert('è¯·å…ˆä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶');
            return;
          }

          try {
            // ç¬¬ä¸€æ­¥ï¼šå¤„ç†å…³ç³»è¡¨ï¼Œç”Ÿæˆ itemToSupplierMap
            this.itemToSupplierMap = {};
            this.mappingTableData.forEach(row => {
              const item = String(row['Item'] || row['ç‰©æ–™å·'] || row['ç‰©æ–™ç¼–ç '] || '').trim();
              const supplier = String(row['Supplier'] || row['ä¾›åº”å•†'] || row['ä¾›åº”å•†åç§°'] || '').trim();
              if (item && supplier) {
                this.itemToSupplierMap[item] = supplier;
              }
            });

            console.log('ç‰©æ–™å…³ç³»è¡¨æ˜ å°„:', this.itemToSupplierMap);
            console.log('æ˜ å°„è¡¨å¤§å°:', Object.keys(this.itemToSupplierMap).length);

            // ç¬¬äºŒæ­¥ï¼šå¤„ç†æµæ°´è¡¨ï¼Œè¿›è¡Œå…³è”å’Œèšåˆ
            const supplierDateMap = {};
            this.unknownSupplierCount = 0;

            this.transactionLogData.forEach(row => {
              const item = String(row['Item'] || row['ç‰©æ–™å·'] || row['ç‰©æ–™ç¼–ç '] || '').trim();
              const dateRaw = row['Transaction Date'] || row['äº¤æ˜“æ—¥æœŸ'] || row['æ—¥æœŸ'] || row['Date'] || '';
              const date = this.normalizeExcelDate(dateRaw);

              if (!item || !date) return;

              // æŸ¥æ‰¾ä¾›åº”å•†
              const supplier = this.itemToSupplierMap[item];
              if (!supplier) {
                // æœªæ‰¾åˆ°ä¾›åº”å•†ï¼Œç»Ÿè®¡åˆ°æœªçŸ¥ä¾›åº”å•†
                this.unknownSupplierCount++;
                const unknownKey = `æœªçŸ¥/å…¶ä»–ä¾›åº”å•†|${date}`;
                if (!supplierDateMap[unknownKey]) {
                  supplierDateMap[unknownKey] = {
                    supplier: 'æœªçŸ¥/å…¶ä»–ä¾›åº”å•†',
                    supplier_en: 'UNKNOWN_SUPPLIER',
                    date: date,
                    count: 0
                  };
                }
                supplierDateMap[unknownKey].count++;
                return;
              }

              // æ‰¾åˆ°ä¾›åº”å•†ï¼ŒæŒ‰ Supplier + Date åˆ†ç»„è®¡æ•°
              const key = `${supplier}|${date}`;
              if (!supplierDateMap[key]) {
                supplierDateMap[key] = {
                  supplier: supplier,
                  supplier_en: supplier,
                  date: date,
                  count: 0
                };
              }
              supplierDateMap[key].count++;
            });

            console.log('èšåˆç»“æœ:', supplierDateMap);

            // ç¬¬ä¸‰æ­¥ï¼šå­—å…¸åŒ¹é…å’Œå›å¡«é€»è¾‘
            const matchedStats = [];
            const unmatchedSuppliers = new Set();

            Object.values(supplierDateMap).forEach(stat => {
              // æŸ¥æ‰¾ä¸­è‹±å­—å…¸
              const dictEntry = mockData.supplierDict.find(d => 
                String(d.en || '').trim().toUpperCase() === String(stat.supplier_en || '').trim().toUpperCase()
              );

              if (dictEntry) {
                // æ‰¾åˆ°å­—å…¸åŒ¹é…
                stat.supplier_cn = dictEntry.cn;
                matchedStats.push(stat);
              } else if (stat.supplier === 'æœªçŸ¥/å…¶ä»–ä¾›åº”å•†') {
                // æœªçŸ¥ä¾›åº”å•†ï¼Œä¹ŸåŠ å…¥åŒ¹é…åˆ—è¡¨
                stat.supplier_cn = 'æœªçŸ¥/å…¶ä»–ä¾›åº”å•†';
                matchedStats.push(stat);
              } else {
                // æœªæ‰¾åˆ°å­—å…¸åŒ¹é…ï¼Œè®°å½•å¾…å¤„ç†
                unmatchedSuppliers.add(stat.supplier_en);
                matchedStats.push(stat);
              }
            });

            // æ›´æ–°ä»»åŠ¡ï¼šæŸ¥æ‰¾å¯¹åº”çš„ receivingTasks å¹¶å›å¡«
            let matchedCount = 0;
            matchedStats.forEach(stat => {
              const matchedTasks = this.receivingTasks.filter(task => {
                const taskSupplierEn = String(task.supplier_en || '').trim().toUpperCase();
                const taskDate = String(task.åˆ°è´§æ—¥æœŸ || '').substring(0, 10);
                const statSupplierEn = String(stat.supplier_en || '').trim().toUpperCase();
                return taskSupplierEn === statSupplierEn && taskDate === stat.date;
              });

              matchedTasks.forEach(task => {
                task.æ€»è¡Œæ•° = stat.count;
                task.data_source = 'synced';
                matchedCount++;
              });
            });

            // å¤„ç†æœªçŸ¥ä¾›åº”å•†æç¤º
            let message = '';
            if (matchedCount > 0) {
              message = `æˆåŠŸåŒ¹é…å¹¶æ›´æ–° ${matchedCount} æ¡æ”¶è´§ä»»åŠ¡`;
            } else {
              message = 'æœªæ‰¾åˆ°åŒ¹é…çš„æ”¶è´§ä»»åŠ¡ï¼Œè¯·ç¡®è®¤ä¾›åº”å•†åç§°å’Œæ—¥æœŸæ˜¯å¦ä¸€è‡´';
            }

            if (this.unknownSupplierCount > 0) {
              message += `\n\nâš ï¸ æœ‰ ${this.unknownSupplierCount} æ¡æ•°æ®æ— æ³•åŒ¹é…åˆ°ä¾›åº”å•†ï¼Œå·²ç»Ÿè®¡åˆ°"æœªçŸ¥/å…¶ä»–ä¾›åº”å•†"åˆ†ç±»ï¼Œè¯·æ£€æŸ¥å…³ç³»è¡¨ã€‚`;
            }

            // å…ˆæ˜¾ç¤ºåŒ¹é…ç»“æœ
            if (unmatchedSuppliers.size === 0) {
              alert(message);
            } else {
              // å¦‚æœæœ‰æœªçŸ¥ä¾›åº”å•†ï¼Œå…ˆæ˜¾ç¤ºæç¤ºï¼Œç„¶åå¼¹å‡ºå…³è”å¼¹çª—
              const unmatchedList = Array.from(unmatchedSuppliers);
              this.unknownSuppliersQueue = unmatchedList;
              // è§¦å‘ç¬¬ä¸€ä¸ªæœªçŸ¥ä¾›åº”å•†çš„å¼¹çª—
              this.currentUnknownSupplier = unmatchedList[0];
              this.unknownSupplierCnInput = '';
              this.showUnknownSupplierModal = true;
              
              // å»¶è¿Ÿæ˜¾ç¤ºæç¤ºï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°å¼¹çª—
              setTimeout(() => {
                alert(message + `\n\nâš ï¸ å‘ç° ${unmatchedSuppliers.size} ä¸ªæœªåœ¨å­—å…¸ä¸­çš„ä¾›åº”å•†ï¼Œè¯·é€ä¸ªå…³è”ä¸­æ–‡åã€‚`);
              }, 100);
            }
          } catch (error) {
            console.error('åŒ¹é…è¿‡ç¨‹é”™è¯¯:', error);
            alert('åŒ¹é…å¤±è´¥ï¼š' + error.message);
          }
        },
        // ç¿»é¡µ
        goToReceivingPage(page) {
          const total = this.receivingTotalPages;
          if (page < 1 || page > total) return;
          this.receivingPage = page;
        },
        // æœªçŸ¥ä¾›åº”å•†å…³è”ï¼šä¿å­˜æ˜ å°„
        saveUnknownSupplierMapping() {
          if (!this.currentUnknownSupplier || !this.unknownSupplierCnInput.trim()) {
            alert('è¯·è¾“å…¥ä¸­æ–‡åç§°');
            return;
          }

          const cnName = this.unknownSupplierCnInput.trim();
          
          // æ·»åŠ åˆ°ä¾›åº”å•†å­—å…¸
          if (!mockData.supplierDict.find(d => d.en === this.currentUnknownSupplier)) {
            mockData.supplierDict.push({
              en: this.currentUnknownSupplier,
              cn: cnName
            });
          }

          // ä»é˜Ÿåˆ—ä¸­ç§»é™¤å½“å‰ä¾›åº”å•†
          this.unknownSuppliersQueue = this.unknownSuppliersQueue.filter(s => s !== this.currentUnknownSupplier);

          // å¦‚æœè¿˜æœ‰å¾…å¤„ç†çš„ä¾›åº”å•†ï¼Œç»§ç»­ä¸‹ä¸€ä¸ª
          if (this.unknownSuppliersQueue.length > 0) {
            this.currentUnknownSupplier = this.unknownSuppliersQueue[0];
            this.unknownSupplierCnInput = '';
          } else {
            // å…¨éƒ¨å¤„ç†å®Œæˆï¼Œå…³é—­å¼¹çª—
            this.closeUnknownSupplierModal();
            alert('æ‰€æœ‰ä¾›åº”å•†å·²å…³è”å®Œæˆï¼');
          }
        },
        // æœªçŸ¥ä¾›åº”å•†å…³è”ï¼šè·³è¿‡å½“å‰ä¾›åº”å•†
        skipUnknownSupplier() {
          // ä»é˜Ÿåˆ—ä¸­ç§»é™¤å½“å‰ä¾›åº”å•†
          this.unknownSuppliersQueue = this.unknownSuppliersQueue.filter(s => s !== this.currentUnknownSupplier);

          // å¦‚æœè¿˜æœ‰å¾…å¤„ç†çš„ä¾›åº”å•†ï¼Œç»§ç»­ä¸‹ä¸€ä¸ª
          if (this.unknownSuppliersQueue.length > 0) {
            this.currentUnknownSupplier = this.unknownSuppliersQueue[0];
            this.unknownSupplierCnInput = '';
          } else {
            // å…¨éƒ¨å¤„ç†å®Œæˆï¼Œå…³é—­å¼¹çª—
            this.closeUnknownSupplierModal();
          }
        },
        // å…³é—­æœªçŸ¥ä¾›åº”å•†å¼¹çª—
        closeUnknownSupplierModal() {
          this.showUnknownSupplierModal = false;
          this.currentUnknownSupplier = null;
          this.unknownSupplierCnInput = '';
          this.unknownSuppliersQueue = [];
        },
        // é€€å‡ºç™»å½•
        logout() {
          if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
            window.location.href = 'index.html';
          }
        },
        // é‡ç½®ç³»ç»Ÿæ•°æ®
        resetSystemData() {
          // ç¬¬ä¸€æ­¥ï¼šç¡®è®¤å¯¹è¯æ¡†
          if (!confirm('âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ä¸šåŠ¡æ•°æ®ï¼\n\nåŒ…æ‹¬ï¼š\n- ç”Ÿäº§è®¡åˆ’æ•°æ®\n- è½¦æ¬¡ç®¡ç†æ•°æ®\n- ECOå˜æ›´æ•°æ®\n- å®¢æˆ·è´¹ç”¨ç»“ç®—æ•°æ®\n- ä¾›åº”å•†æ”¶è´§æ•°æ®\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
            this.showResetConfirm = false;
            this.resetConfirmInput = '';
            return;
          }

          // ç¬¬äºŒæ­¥ï¼šè¦æ±‚è¾“å…¥ CONFIRM
          const userInput = prompt('âš ï¸ æœ€åç¡®è®¤ï¼šè¯·è¾“å…¥ "CONFIRM" ä»¥ç¡®è®¤é‡ç½®ç³»ç»Ÿæ•°æ®ï¼š');
          if (userInput !== 'CONFIRM') {
            alert('è¾“å…¥ä¸æ­£ç¡®ï¼Œæ“ä½œå·²å–æ¶ˆ');
            this.showResetConfirm = false;
            this.resetConfirmInput = '';
            return;
          }

          try {
            // æ¸…ç©ºæ‰€æœ‰ä¸šåŠ¡æ•°æ®çš„ localStorage
            const businessDataKeys = [
              'productionPlanData',
              'planUpdateTime',
              'vehicleLogData',
              'localEcoList',
              'ecoListData',
              'localEcoData', // å…¼å®¹æ—§key
              'billingRecordData',
              'receivingTasksData',
              'supplierMapData',
              'discrepancyListData',
              'defectListData',
              'workOrderListData'
            ];

            businessDataKeys.forEach(key => {
              localStorage.removeItem(key);
            });

            alert('âœ… ç³»ç»Ÿæ•°æ®å·²é‡ç½®ï¼é¡µé¢å³å°†åˆ·æ–°...');
            
            // åˆ·æ–°é¡µé¢
            setTimeout(() => {
              window.location.reload();
            }, 500);

          } catch (error) {
            console.error('é‡ç½®ç³»ç»Ÿæ•°æ®å¤±è´¥:', error);
            alert('é‡ç½®å¤±è´¥ï¼š' + error.message);
          }

          this.showResetConfirm = false;
          this.resetConfirmInput = '';
        },
        // æ‰“å¼€æ–°å¢ç¼ºé™·æ¨¡æ€æ¡†
        openDefectModal() {
          const today = new Date().toISOString().split('T')[0];
          this.newDefect = {
            å‘ç°æ—¥æœŸ: today,
            ç±»å‹: '',
            ç§ç±»: '',
            æ˜¯å¦æŒ‰ç¯: false,
            äº§å“: '',
            é—®é¢˜æè¿°: '',
            å‘ç°äºº: '',
            è´£ä»»äºº: '',
            åŸå› : '',
            è§£å†³æ–¹æ¡ˆ: '',
            '5WHYæ–‡ä»¶': '',
            å¤‡æ³¨: ''
          };
          this.defectFile = null;
          this.showDefectModal = true;
        },
        // å…³é—­æ–°å¢ç¼ºé™·æ¨¡æ€æ¡†
        closeDefectModal() {
          this.showDefectModal = false;
          this.newDefect = {
            å‘ç°æ—¥æœŸ: '',
            ç±»å‹: '',
            ç§ç±»: '',
            æ˜¯å¦æŒ‰ç¯: false,
            äº§å“: '',
            é—®é¢˜æè¿°: '',
            å‘ç°äºº: '',
            è´£ä»»äºº: '',
            åŸå› : '',
            è§£å†³æ–¹æ¡ˆ: '',
            '5WHYæ–‡ä»¶': '',
            å¤‡æ³¨: ''
          };
          this.defectFile = null;
        },
        // æŒ‰ç¯é€‰æ‹©å˜åŒ–æ—¶çš„å¤„ç†
        onAndonChange() {
          // å¦‚æœé€‰æ‹©"å¦"ï¼Œæ¸…ç©ºæ–‡ä»¶
          if (this.newDefect.æ˜¯å¦æŒ‰ç¯ === false) {
            this.defectFile = null;
            this.newDefect['5WHYæ–‡ä»¶'] = '';
            if (this.$refs.fileInput) {
              this.$refs.fileInput.value = '';
            }
          }
        },
        // æ–‡ä»¶é€‰æ‹©å˜åŒ–æ—¶çš„å¤„ç†
        onFileChange(event) {
          const file = event.target.files[0];
          if (file) {
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ10MBï¼‰
            if (file.size > 10 * 1024 * 1024) {
              alert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 10MB');
              event.target.value = '';
              this.defectFile = null;
              return;
            }
            this.defectFile = file;
            // æ¨¡æ‹Ÿç”Ÿæˆæ–‡ä»¶å
            const timestamp = new Date().getTime();
            const ext = file.name.split('.').pop();
            this.newDefect['5WHYæ–‡ä»¶'] = `5why-${this.newDefect.äº§å“}-${timestamp}.${ext}`;
          } else {
            this.defectFile = null;
            this.newDefect['5WHYæ–‡ä»¶'] = '';
          }
        },
        // ä¿å­˜ç¼ºé™·
        saveDefect() {
          // éªŒè¯å¿…å¡«é¡¹
          if (!this.newDefect.å‘ç°æ—¥æœŸ || !this.newDefect.ç±»å‹ || !this.newDefect.ç§ç±» || 
              !this.newDefect.äº§å“ || !this.newDefect.é—®é¢˜æè¿° || !this.newDefect.å‘ç°äºº || !this.newDefect.è´£ä»»äºº) {
            alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹');
            return;
          }
          
          // å¦‚æœé€‰æ‹©äº†"æŒ‰ç¯è§¦å‘"ï¼Œå¿…é¡»ä¸Šä¼ æ–‡ä»¶
          if (this.newDefect.æ˜¯å¦æŒ‰ç¯ === true) {
            if (!this.defectFile || !this.newDefect['5WHYæ–‡ä»¶']) {
              alert('æŒ‰ç¯è§¦å‘çš„ç¼ºé™·å¿…é¡»ä¸Šä¼  5WHY åˆ†ææŠ¥å‘Š');
              return;
            }
          }
          
          // åˆ›å»ºæ–°ç¼ºé™·è®°å½•
          const newItem = {
            å‘ç°æ—¥æœŸ: this.newDefect.å‘ç°æ—¥æœŸ,
            ç±»å‹: this.newDefect.ç±»å‹,
            ç§ç±»: this.newDefect.ç§ç±»,
            æ˜¯å¦æŒ‰ç¯: this.newDefect.æ˜¯å¦æŒ‰ç¯,
            äº§å“: this.newDefect.äº§å“,
            é—®é¢˜æè¿°: this.newDefect.é—®é¢˜æè¿°,
            å‘ç°äºº: this.newDefect.å‘ç°äºº,
            è´£ä»»äºº: this.newDefect.è´£ä»»äºº,
            åŸå› : this.newDefect.åŸå›  || '',
            è§£å†³æ–¹æ¡ˆ: this.newDefect.è§£å†³æ–¹æ¡ˆ || '',
            '5WHYæ–‡ä»¶': this.newDefect['5WHYæ–‡ä»¶'] || '',
            å¤‡æ³¨: this.newDefect.å¤‡æ³¨ || ''
          };
          
          // æ·»åŠ åˆ°åˆ—è¡¨é¡¶éƒ¨
          this.defectList.unshift(newItem);
          this.closeDefectModal();
          alert('ç¼ºé™·ç™»è®°æˆåŠŸï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼Œä»…å‰ç«¯ä¿å­˜äºå†…å­˜ï¼‰');
        },
        // è·å–5WHYæ–‡ä»¶ï¼ˆå®‰å…¨è®¿é—®å±æ€§ï¼‰
        get5WhyFile(item) {
          return item && item['5WHYæ–‡ä»¶'] ? item['5WHYæ–‡ä»¶'] : '';
        },
        // æŸ¥çœ‹5WHYæŠ¥å‘Š
        view5WhyReport(filename) {
          alert(`æŸ¥çœ‹ 5WHY åˆ†ææŠ¥å‘Šï¼š${filename}\n\nï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼šå®é™…ç¯å¢ƒä¸­è¿™é‡Œä¼šæ‰“å¼€æ–‡ä»¶é¢„è§ˆæˆ–ä¸‹è½½ï¼‰`);
        },
        // è§¦å‘Excelå¯¼å…¥
        triggerExcelImport() {
          if (this.$refs.excelFileInput) {
            this.$refs.excelFileInput.click();
          }
        },
        // å¤„ç†Excelå¯¼å…¥
        handleExcelImport(event) {
          const file = event.target.files[0];
          if (!file) return;

          // æ£€æŸ¥æ–‡ä»¶ç±»å‹
          const fileName = file.name.toLowerCase();
          if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
            alert('è¯·é€‰æ‹© Excel æ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsï¼‰');
            event.target.value = '';
            return;
          }

          // æ£€æŸ¥ XLSX åº“æ˜¯å¦åŠ è½½
          if (typeof XLSX === 'undefined') {
            alert('Excel è§£æåº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            event.target.value = '';
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              // è§£æExcelæ–‡ä»¶
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });

              // è·å–ç¬¬ä¸€ä¸ªSheet
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];

              // è½¬æ¢ä¸ºJSONï¼ˆä¿ç•™è¡¨å¤´ï¼‰
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                header: 1, // ä½¿ç”¨æ•°ç»„æ ¼å¼ï¼Œç¬¬ä¸€è¡Œæ˜¯è¡¨å¤´
                defval: '' // ç©ºå•å…ƒæ ¼é»˜è®¤å€¼
              });

              if (jsonData.length < 2) {
                alert('Excelæ–‡ä»¶è‡³å°‘éœ€è¦åŒ…å«è¡¨å¤´å’Œæ•°æ®è¡Œ');
                event.target.value = '';
                return;
              }

              // è·å–è¡¨å¤´ï¼ˆç¬¬ä¸€è¡Œï¼‰ï¼Œå»é™¤ç©ºæ ¼å’Œæ¢è¡Œ
              const headers = jsonData[0].map(h => h ? String(h).trim().replace(/\s+/g, '') : '');
              
              // è°ƒè¯•ï¼šæ˜¾ç¤ºè¯†åˆ«åˆ°çš„è¡¨å¤´
              console.log('è¯†åˆ«åˆ°çš„è¡¨å¤´:', headers);
              
              // å­—æ®µæ˜ å°„ï¼šä¸­æ–‡è¡¨å¤´ -> å†…éƒ¨å˜é‡åï¼ˆå»é™¤ç©ºæ ¼åçš„åŒ¹é…ï¼‰
              const headerMapping = {
                'å‘ç°æ—¥æœŸ': 'date',
                'ç±»å‹': 'type',
                'ç§ç±»': 'category',
                'æŒ‰ç¯': 'andon',
                'äº§å“': 'product',
                'é—®é¢˜æè¿°': 'description',
                'å‘ç°äºº': 'finder',
                'è´£ä»»äºº': 'owner',
                'åŸå› ': 'cause',
                'è§£å†³æ–¹æ¡ˆ': 'solution',
                '5WHYåˆ†æ': 'fiveWhyFile',
                '5whyåˆ†æ': 'fiveWhyFile', // å…¼å®¹å°å†™
                '5WHY': 'fiveWhyFile' // ç®€åŒ–ç‰ˆæœ¬
              };

              // æ‰¾åˆ°è¡¨å¤´å¯¹åº”çš„ç´¢å¼•ï¼ˆæ”¯æŒå»é™¤ç©ºæ ¼åçš„åŒ¹é…ï¼‰
              const columnIndexes = {};
              headers.forEach((header, index) => {
                if (header) {
                  // å…ˆå°è¯•ç²¾ç¡®åŒ¹é…
                  if (headerMapping[header]) {
                    columnIndexes[headerMapping[header]] = index;
                  } else {
                    // å°è¯•å»é™¤ç©ºæ ¼ååŒ¹é…
                    const cleanHeader = header.replace(/\s+/g, '');
                    if (headerMapping[cleanHeader]) {
                      columnIndexes[headerMapping[cleanHeader]] = index;
                    }
                  }
                }
              });

              // æ£€æŸ¥æ˜¯å¦è¯†åˆ«åˆ°å¿…è¦çš„å­—æ®µ
              const requiredFields = ['date', 'type', 'category', 'product', 'description', 'finder', 'owner'];
              const missingFields = requiredFields.filter(field => columnIndexes[field] === undefined);
              
              if (missingFields.length > 0) {
                const missingHeaders = missingFields.map(f => {
                  const map = {
                    'date': 'å‘ç°æ—¥æœŸ',
                    'type': 'ç±»å‹',
                    'category': 'ç§ç±»',
                    'product': 'äº§å“',
                    'description': 'é—®é¢˜æè¿°',
                    'finder': 'å‘ç°äºº',
                    'owner': 'è´£ä»»äºº'
                  };
                  return map[f] || f;
                }).join('ã€');
                
                alert(`è¡¨å¤´è¯†åˆ«å¤±è´¥ï¼\n\nç¼ºå°‘ä»¥ä¸‹å¿…éœ€å­—æ®µï¼š${missingHeaders}\n\nè¯†åˆ«åˆ°çš„è¡¨å¤´ï¼š${headers.filter(h => h).join('ã€')}\n\nè¯·ç¡®ä¿Excelç¬¬ä¸€è¡ŒåŒ…å«å®Œæ•´çš„ä¸­æ–‡è¡¨å¤´ã€‚`);
                console.error('ç¼ºå°‘çš„å­—æ®µ:', missingFields);
                console.error('è¯†åˆ«åˆ°çš„è¡¨å¤´:', headers);
                event.target.value = '';
                return;
              }

              // è½¬æ¢æ•°æ®è¡Œï¼ˆä»ç¬¬äºŒè¡Œå¼€å§‹ï¼‰
              const importedData = [];
              for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                
                // è·³è¿‡ç©ºè¡Œ
                if (!row || row.every(cell => !cell || cell.toString().trim() === '')) {
                  continue;
                }

                // æ„å»ºæ•°æ®å¯¹è±¡
                const item = {};

                // å¤„ç†å‘ç°æ—¥æœŸï¼ˆExcelæ—¥æœŸæ ¼å¼è½¬æ¢ï¼‰
                if (columnIndexes.date !== undefined) {
                  const dateValue = row[columnIndexes.date];
                  if (dateValue) {
                    if (typeof dateValue === 'number') {
                      // Excelæ—¥æœŸåºåˆ—å·ï¼Œéœ€è¦è½¬æ¢
                      const excelEpoch = new Date(1899, 11, 30);
                      const date = new Date(excelEpoch.getTime() + dateValue * 24 * 60 * 60 * 1000);
                      item.å‘ç°æ—¥æœŸ = date.toISOString().split('T')[0];
                    } else if (typeof dateValue === 'string') {
                      // å­—ç¬¦ä¸²æ ¼å¼çš„æ—¥æœŸ
                      let dateStr = dateValue.trim();
                      if (dateStr) {
                        // å¤„ç† "2025.11.7" è¿™ç§æ ¼å¼ï¼Œè½¬æ¢ä¸º "2025-11-07"
                        dateStr = dateStr.replace(/\./g, '-');
                        // å¤„ç†å•æ•°æ—¥æœŸï¼Œå¦‚ "2025-11-7" -> "2025-11-07"
                        const parts = dateStr.split('-');
                        if (parts.length === 3) {
                          const year = parts[0];
                          const month = parts[1].padStart(2, '0');
                          const day = parts[2].padStart(2, '0');
                          dateStr = `${year}-${month}-${day}`;
                        }
                        // å°è¯•è§£æå„ç§æ—¥æœŸæ ¼å¼
                        const parsedDate = new Date(dateStr);
                        if (!isNaN(parsedDate.getTime())) {
                          item.å‘ç°æ—¥æœŸ = parsedDate.toISOString().split('T')[0];
                        } else {
                          // å¦‚æœè¿˜æ˜¯æ— æ³•è§£æï¼Œå°è¯•å…¶ä»–æ ¼å¼
                          item.å‘ç°æ—¥æœŸ = dateStr; // ä¿æŒåŸæ ·
                        }
                      }
                    } else if (dateValue instanceof Date) {
                      item.å‘ç°æ—¥æœŸ = dateValue.toISOString().split('T')[0];
                    }
                  }
                }

                // å¤„ç†ç±»å‹
                if (columnIndexes.type !== undefined && row[columnIndexes.type]) {
                  item.ç±»å‹ = String(row[columnIndexes.type]).trim();
                }

                // å¤„ç†ç§ç±»
                if (columnIndexes.category !== undefined && row[columnIndexes.category]) {
                  item.ç§ç±» = String(row[columnIndexes.category]).trim();
                }

                // å¤„ç†æŒ‰ç¯ï¼ˆé€»è¾‘ï¼šåŒ…å«"æ˜¯"åˆ™ä¸ºtrueï¼‰
                if (columnIndexes.andon !== undefined) {
                  const andonValue = row[columnIndexes.andon];
                  if (andonValue !== undefined && andonValue !== null && andonValue !== '') {
                    const andonStr = String(andonValue).trim();
                    item.æ˜¯å¦æŒ‰ç¯ = andonStr.includes('æ˜¯') || andonStr.toLowerCase().includes('yes') || andonStr === '1';
                  } else {
                    item.æ˜¯å¦æŒ‰ç¯ = false;
                  }
                }

                // å¤„ç†äº§å“
                if (columnIndexes.product !== undefined && row[columnIndexes.product]) {
                  item.äº§å“ = String(row[columnIndexes.product]).trim();
                }

                // å¤„ç†é—®é¢˜æè¿°
                if (columnIndexes.description !== undefined && row[columnIndexes.description]) {
                  item.é—®é¢˜æè¿° = String(row[columnIndexes.description]).trim();
                }

                // å¤„ç†å‘ç°äºº
                if (columnIndexes.finder !== undefined && row[columnIndexes.finder]) {
                  item.å‘ç°äºº = String(row[columnIndexes.finder]).trim();
                }

                // å¤„ç†è´£ä»»äºº
                if (columnIndexes.owner !== undefined && row[columnIndexes.owner]) {
                  item.è´£ä»»äºº = String(row[columnIndexes.owner]).trim();
                }

                // å¤„ç†åŸå› 
                if (columnIndexes.cause !== undefined && row[columnIndexes.cause]) {
                  item.åŸå›  = String(row[columnIndexes.cause]).trim();
                }

                // å¤„ç†è§£å†³æ–¹æ¡ˆ
                if (columnIndexes.solution !== undefined && row[columnIndexes.solution]) {
                  item.è§£å†³æ–¹æ¡ˆ = String(row[columnIndexes.solution]).trim();
                }

                // å¤„ç†5WHYåˆ†æï¼ˆä½œä¸ºæ–‡ä»¶åå ä½ç¬¦ï¼‰
                if (columnIndexes.fiveWhyFile !== undefined && row[columnIndexes.fiveWhyFile]) {
                  item['5WHYæ–‡ä»¶'] = String(row[columnIndexes.fiveWhyFile]).trim();
                } else {
                  item['5WHYæ–‡ä»¶'] = '';
                }

                // é»˜è®¤å¤‡æ³¨ä¸ºç©º
                item.å¤‡æ³¨ = '';

                // éªŒè¯å¿…å¡«é¡¹ï¼ˆè´£ä»»äººæ”¹ä¸ºå¯é€‰ï¼‰
                const missingFields = [];
                if (!item.å‘ç°æ—¥æœŸ) missingFields.push('å‘ç°æ—¥æœŸ');
                if (!item.ç±»å‹) missingFields.push('ç±»å‹');
                if (!item.ç§ç±») missingFields.push('ç§ç±»');
                if (!item.äº§å“) missingFields.push('äº§å“');
                if (!item.é—®é¢˜æè¿°) missingFields.push('é—®é¢˜æè¿°');
                if (!item.å‘ç°äºº) missingFields.push('å‘ç°äºº');
                // è´£ä»»äººæ”¹ä¸ºå¯é€‰ï¼Œä¸å†éªŒè¯
                
                if (missingFields.length > 0) {
                  console.warn(`ç¬¬ ${i + 1} è¡Œæ•°æ®ç¼ºå°‘å¿…å¡«é¡¹ï¼š${missingFields.join('ã€')}ï¼Œå·²è·³è¿‡`);
                  console.warn('è¯¥è¡Œæ•°æ®:', row);
                  continue;
                }
                
                // å¦‚æœè´£ä»»äººä¸å­˜åœ¨ï¼Œè®¾ä¸ºç©ºå­—ç¬¦ä¸²
                if (!item.è´£ä»»äºº) {
                  item.è´£ä»»äºº = '';
                }

                importedData.push(item);
              }

              if (importedData.length === 0) {
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ–‡ä»¶æ ¼å¼\n\nå¯èƒ½åŸå› ï¼š\n1. æ•°æ®è¡Œç¼ºå°‘å¿…å¡«é¡¹\n2. æ•°æ®è¡Œä¸ºç©º\n3. è¡¨å¤´æ ¼å¼ä¸æ­£ç¡®');
                event.target.value = '';
                return;
              }

              // åˆå¹¶æ•°æ®åˆ°defectList
              this.defectList = [...importedData, ...this.defectList];
              
              // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
              event.target.value = '';
              
              // æ˜¾ç¤ºæˆåŠŸæç¤º
              alert(`æˆåŠŸå¯¼å…¥ ${importedData.length} æ¡æ•°æ®`);
              console.log('å¯¼å…¥çš„æ•°æ®:', importedData);

            } catch (error) {
              console.error('Excelå¯¼å…¥é”™è¯¯:', error);
              console.error('é”™è¯¯å †æ ˆ:', error.stack);
              alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message + '\n\nè¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯');
              event.target.value = '';
            }
          };

          reader.onerror = () => {
            alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
            event.target.value = '';
          };

          reader.readAsArrayBuffer(file);
        },
        // æ ¼å¼åŒ–æ•°å­—ï¼ˆæ·»åŠ åƒåˆ†ä½ï¼‰
        // å·¥å…·ï¼šæ ¼å¼åŒ–æ•°å­—
        formatNumber(num) {
          return Number(num).toLocaleString('zh-CN');
        },
        // å·¥å…·ï¼šå°† Excel æ—¥æœŸ/å­—ç¬¦ä¸²æ ‡å‡†åŒ–ä¸º YYYY-MM-DD
        // æ ¼å¼åŒ–Excelæ—¶é—´ï¼ˆæ”¯æŒå°æ•°æ ¼å¼å’Œå­—ç¬¦ä¸²æ ¼å¼ï¼‰
        normalizeExcelTime(raw) {
          if (raw === null || raw === undefined || raw === '') return '';

          // å¦‚æœæ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼ˆå¦‚ "10:30" æˆ– "10:30:00"ï¼‰ï¼Œç›´æ¥è¿”å›å‰5ä¸ªå­—ç¬¦
          if (typeof raw === 'string') {
            const timeStr = raw.trim();
            if (timeStr.includes(':')) {
              return timeStr.substring(0, 5);
            }
          }

          // å¦‚æœæ˜¯æ•°å­—ï¼ˆExcelæ—¶é—´æ ¼å¼ï¼š0-1ä¹‹é—´çš„å°æ•°ï¼Œ0=00:00, 1=24:00ï¼‰
          const num = Number(raw);
          if (!isNaN(num) && isFinite(num) && num >= 0 && num < 1) {
            // å°†å°æ•°è½¬æ¢ä¸ºå°æ—¶æ•°
            const totalHours = num * 24;
            const hours = Math.floor(totalHours);
            const minutes = Math.floor((totalHours - hours) * 60);
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
          }

          // å¦‚æœæ˜¯Dateå¯¹è±¡ï¼Œæå–æ—¶é—´éƒ¨åˆ†
          if (raw instanceof Date) {
            const hours = raw.getHours();
            const minutes = raw.getMinutes();
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
          }

          // å…¶ä»–æƒ…å†µï¼Œå°è¯•è½¬æ¢ä¸ºå­—ç¬¦ä¸²
          return String(raw).substring(0, 5);
        },
        normalizeExcelDate(raw) {
          if (raw === null || raw === undefined || raw === '') return '';

          // å¦‚æœæ˜¯ Date å¯¹è±¡ï¼Œç›´æ¥æ ¼å¼åŒ–
          if (raw instanceof Date) {
            const year = raw.getFullYear();
            const month = String(raw.getMonth() + 1).padStart(2, '0');
            const day = String(raw.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
          }

          // å¦‚æœæ˜¯æ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼ˆExcel åºåˆ—å·ï¼Œå¦‚ 45989ï¼‰
          const num = Number(raw);
          if (!isNaN(num) && isFinite(num) && String(raw).trim() !== '') {
            // Excel 1900 æ—¥æœŸç³»ç»Ÿï¼šä»¥ 1899-12-30 ä¸ºåŸºå‡†ï¼ˆè€ƒè™‘ Excel çš„é—°å¹´åå·®ï¼‰
            const excelEpoch = new Date(Date.UTC(1899, 11, 30)); // 1899-12-30
            const ms = num * 24 * 60 * 60 * 1000;
            const date = new Date(excelEpoch.getTime() + ms);
            const year = date.getUTCFullYear();
            const month = String(date.getUTCMonth() + 1).padStart(2, '0');
            const day = String(date.getUTCDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
          }

          // å¦åˆ™è®¤ä¸ºå·²ç»æ˜¯å­—ç¬¦ä¸²æ—¥æœŸï¼Œåšç®€å•è§„èŒƒåŒ–ï¼ˆæ”¯æŒ 2025/11/14 æˆ– 2025-11-14 ç­‰ï¼‰
          const str = String(raw).trim().replace(/\//g, '-');
          return str.substring(0, 10);
        },
        // å·¥å•é…æ–™ï¼šè§¦å‘ç”Ÿäº§è®¡åˆ’è¡¨ä¸Šä¼ 
        triggerPlanFileUpload() {
          if (this.$refs.planFileInput) {
            this.$refs.planFileInput.click();
          }
        },
        // å·¥å•é…æ–™ï¼šå¤„ç†ç”Ÿäº§è®¡åˆ’è¡¨ä¸Šä¼ 
        handlePlanFileUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              // å­—æ®µæ˜ å°„ - GE æ–°ç‰ˆç”Ÿäº§è®¡åˆ’è¡¨æ ¼å¼ï¼ˆä¸¥æ ¼æŒ‰ç…§ Excel åˆ—åæ˜ å°„ï¼‰
              const fullPlanData = jsonData.map(row => {
                // å…³é”®å­—æ®µæ˜ å°„ï¼ˆä¸¥æ ¼æŒ‰ç…§ Excel åˆ—åï¼Œç”¨äºåŒ¹é…ï¼‰
                // work_order å¿…é¡»å¯¹åº” Excel åˆ—å"å·¥å•å·"ï¼ˆç»å¯¹ä¸èƒ½æ˜ å°„åˆ°"åŠ å·¥åºåˆ—å·"ï¼‰
                const workOrder = String(row['å·¥å•å·'] || '').trim();
                // op å¯¹åº” Excel åˆ—å"å·¥åº"
                const op = String(row['å·¥åº'] || '').trim();
                // seq_no å¯¹åº” Excel åˆ—å"åŠ å·¥åºåˆ—å·"ï¼ˆå±•ç¤ºç”¨ï¼‰
                const seqNo = String(row['åŠ å·¥åºåˆ—å·'] || '').trim();
                // description å¯¹åº” Excel åˆ—å"äº§å“æè¿°"
                const description = String(row['äº§å“æè¿°'] || '').trim();
                
                // å…¶ä»–å­—æ®µæ˜ å°„ï¼ˆå…¼å®¹æ—§å­—æ®µåï¼‰
                const tripNo = String(row['è½¦æ¬¡'] || row['trip_no'] || '').trim();
                const containerNo = String(row['å®¹å™¨ç¼–å·'] || row['container_no'] || '').trim();
                const arrivalDate = this.normalizeExcelDate(row['åˆ°è¾¾æ—¥æœŸ'] || row['arrival_date'] || row['ä½¿ç”¨æ—¥æœŸ'] || row['æ—¥æœŸ'] || '');
                // å¼ºåˆ¶è¯»å–"åˆ°è¾¾æ—¶é—´"åˆ—ï¼Œæ”¯æŒå°æ•°æ ¼å¼ï¼ˆExcelæ—¶é—´æ ¼å¼ï¼‰
                const arrivalTimeRaw = row['åˆ°è¾¾æ—¶é—´'] || row['arrival_time'] || row['åˆ°åœºæ—¶é—´'] || '';
                const arrivalTime = this.normalizeExcelTime(arrivalTimeRaw);
                const line = String(row['äº§çº¿'] || row['line'] || row['äº§çº¿åç§°'] || '').trim();
                const agvTime = String(row['AGVå‘è½¦æ—¶é—´'] || row['agv_time'] || row['å‘è½¦æ—¶é—´'] || '').trim();
                const itemDesc = String(row['ItemDesc'] || row['item_desc'] || row['å·¥åºæè¿°'] || '').trim();
                
                // å…¶ä»–å­—æ®µï¼ˆå™¨å…·ç¼–å·ã€å è½¦æ¯”ç­‰ï¼‰
                const toolNo = String(row['å™¨å…·ç¼–å·'] || row['tool_no'] || '').trim();
                const carRatio = String(row['å è½¦æ¯”'] || row['car_ratio'] || '').trim();
                
                return {
                  // æ–°å­—æ®µåï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰
                  trip_no: tripNo,
                  container_no: containerNo,
                  arrival_date: arrivalDate,
                  arrival_time: arrivalTime,
                  line: line,
                  description: description,
                  op: op,
                  work_order: workOrder,
                  seq_no: seqNo,
                  agv_time: agvTime,
                  item_desc: itemDesc,
                  tool_no: toolNo,
                  car_ratio: carRatio,
                  // å…¼å®¹æ—§å­—æ®µåï¼ˆç”¨äºå‘åå…¼å®¹å’Œå·¥å•é…æ–™æ¨¡å—ï¼‰
                  'ä½¿ç”¨æ—¥æœŸ': arrivalDate,
                  'å‘è½¦æ—¶é—´': agvTime,
                  'è½¦æ¬¡': tripNo,
                  'å·¥åºå·': op,
                  'äº§çº¿åç§°': line,
                  'åˆ°åœºæ—¶é—´': arrivalTime,
                  'äº§å“æè¿°': description,
                  'å·¥å•å·': workOrder,
                  'åŠ å·¥åºåˆ—å·': seqNo,
                  'å·¥åºæè¿°': itemDesc,
                  'å°å¥—': String(row['å°å¥—'] || row['Station'] || '').trim()
                };
              });

              // å·¥å•é…æ–™æ¨¡å—ä½¿ç”¨çš„ç®€åŒ–æ•°æ®ï¼ˆä¸¥æ ¼æŒ‰ç…§æ˜ å°„ï¼šwork_order å¿…é¡»æ¥è‡ª"å·¥å•å·"åˆ—ï¼‰
              let debugCount = 0;
              this.planData = fullPlanData.map((row, index) => {
                // å…³é”®å­—æ®µæå–ï¼šç›´æ¥ä» fullPlanData ä¸­è·å–ï¼ˆå·²æ­£ç¡®æ˜ å°„ï¼‰
                // work_order å¿…é¡»æ¥è‡ª Excel åˆ—å"å·¥å•å·"ï¼ˆç»å¯¹ä¸èƒ½ä½¿ç”¨"åŠ å·¥åºåˆ—å·"ï¼‰
                const workOrder = String(row.work_order || '').trim();
                // op æ¥è‡ª Excel åˆ—å"å·¥åº"
                const op = String(row.op || '').trim();
                // seq_no æ¥è‡ª Excel åˆ—å"åŠ å·¥åºåˆ—å·"ï¼ˆå±•ç¤ºç”¨ï¼‰
                const seqNo = String(row.seq_no || '').trim();
                // å…¶ä»–å­—æ®µ
                const arrivalDate = String(row.arrival_date || row['ä½¿ç”¨æ—¥æœŸ'] || '').trim();
                const description = String(row.description || row['äº§å“æè¿°'] || '').trim();
                
                // è°ƒè¯•ï¼šæ£€æŸ¥å‰3æ¡æ•°æ®çš„å­—æ®µå€¼
                if (debugCount < 3) {
                  console.log(`Plan æ•°æ®æ„å»ºè°ƒè¯•ï¼ˆç¬¬${index + 1}æ¡ï¼‰ï¼š`, {
                    'ExcelåŸå§‹åˆ—åæ£€æŸ¥': {
                      'å·¥å•å·': row['å·¥å•å·'],
                      'å·¥åº': row['å·¥åº'],
                      'åŠ å·¥åºåˆ—å·': row['åŠ å·¥åºåˆ—å·']
                    },
                    'fullPlanDataæ˜ å°„å': {
                      work_order: row.work_order,
                      op: row.op,
                      seq_no: row.seq_no
                    },
                    'planDataæœ€ç»ˆå€¼': {
                      workOrder_final: workOrder,
                      op_final: op,
                      seqNo_final: seqNo
                    },
                    isEmpty: !workOrder || !op || workOrder === '' || op === '',
                    'workOrderç±»å‹': typeof workOrder,
                    'workOrderé•¿åº¦': workOrder.length,
                    'workOrderå€¼(JSON)': JSON.stringify(workOrder)
                  });
                  debugCount++;
                }
                
                return {
                  // ç»Ÿä¸€ä½¿ç”¨æ–°å­—æ®µåï¼ˆwork_order, op, seq_noï¼‰
                  work_order: workOrder,
                  op: op,
                  seq_no: seqNo,
                  arrival_time: String(row.arrival_time || '').trim(),
                  // å…¼å®¹å­—æ®µï¼ˆç”¨äºæ˜¾ç¤ºå’Œç­›é€‰ï¼‰
                  'ä½¿ç”¨æ—¥æœŸ': arrivalDate,
                  'å·¥å•å·': workOrder,
                  'OP': op,
                  'äº§å“æè¿°': description,
                  'åŠ å·¥åºåˆ—å·': seqNo,
                  'å°å¥—': seqNo, // ä¿ç•™å…¼å®¹å­—æ®µ
                  'åˆ°è¾¾æ—¶é—´': String(row.arrival_time || '').trim()
                };
              }).filter(item => {
                // æ•°æ®æ¸…æ´—ï¼šè¿‡æ»¤æ— æ•ˆè¡Œå’Œè¡¨å¤´è¡Œ
                const workOrder = String(item.work_order || '').trim();
                const op = String(item.op || '').trim();
                
                // 1. åŸºæœ¬éªŒè¯ï¼šç¡®ä¿å…³é”®å­—æ®µä¸ä¸ºç©º
                if (!workOrder || !op || workOrder === '' || op === '') {
                  if (debugCount < 5) {
                    console.warn('Plan æ•°æ®è¢«è¿‡æ»¤ï¼ˆç¼ºå°‘å…³é”®å­—æ®µï¼‰ï¼š', item);
                    debugCount++;
                  }
                  return false;
                }
                
                // 2. è¿‡æ»¤è¡¨å¤´è¡Œï¼šç§»é™¤åŒ…å«è¡¨å¤´å…³é”®è¯çš„è¡Œ
                const headerKeywords = ['å·¥å•å·', 'Order', 'order', 'ORDER', 'å·¥å•', 'è®¢å•å·', 'Job', 'JOB'];
                const isHeaderRow = headerKeywords.some(keyword => 
                  workOrder.includes(keyword) || op.includes(keyword)
                );
                
                if (isHeaderRow) {
                  if (debugCount < 5) {
                    console.warn('Plan æ•°æ®è¢«è¿‡æ»¤ï¼ˆè¡¨å¤´è¡Œï¼‰ï¼š', { workOrder, op });
                    debugCount++;
                  }
                  return false;
                }
                
                // 3. éªŒè¯å·¥å•å·æ ¼å¼ï¼šåº”è¯¥åŒ…å«å­—æ¯æˆ–æ•°å­—ï¼Œä¸åº”è¯¥æ˜¯çº¯è¡¨å¤´æ–‡æœ¬
                // å¦‚æœå·¥å•å·çœ‹èµ·æ¥åƒè¡¨å¤´ï¼ˆå…¨æ˜¯ä¸­æ–‡ä¸”å¾ˆçŸ­ï¼‰ï¼Œä¹Ÿè¿‡æ»¤æ‰
                if (workOrder.length < 3 && /^[\u4e00-\u9fa5]+$/.test(workOrder)) {
                  if (debugCount < 5) {
                    console.warn('Plan æ•°æ®è¢«è¿‡æ»¤ï¼ˆç–‘ä¼¼è¡¨å¤´æ–‡æœ¬ï¼‰ï¼š', { workOrder, op });
                    debugCount++;
                  }
                  return false;
                }
                
                return true;
              });
              
              console.log(`Plan æ•°æ®æ„å»ºå®Œæˆï¼šåŸå§‹ ${fullPlanData.length} æ¡ï¼Œè¿‡æ»¤å ${this.planData.length} æ¡`);
              
              // ä¸´æ—¶è°ƒè¯•ï¼šç›´æ¥è¾“å‡ºå‰3æ¡ Plan çš„å·¥å•å·å€¼
              if (this.planData.length > 0) {
                console.log('=== ä¸´æ—¶è°ƒè¯•ï¼šPlan å·¥å•å·å®é™…å€¼ ===');
                this.planData.slice(0, 3).forEach((p, i) => {
                  console.log(`Plan[${i}]:`, {
                    work_order: p.work_order,
                    'å·¥å•å·': p['å·¥å•å·'],
                    'work_orderç±»å‹': typeof p.work_order,
                    'work_orderé•¿åº¦': String(p.work_order || '').length,
                    'work_orderå€¼(JSON)': JSON.stringify(p.work_order)
                  });
                });
              }

              // ä¿å­˜å®Œæ•´æ•°æ®åˆ° localStorage
              const updateTime = new Date();
              const timeString = updateTime.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
              }).replace(/\//g, '-');

              localStorage.setItem('productionPlanData', JSON.stringify(fullPlanData));
              localStorage.setItem('planUpdateTime', timeString);

              this.performMatching();
              alert(`æˆåŠŸåŠ è½½ ${this.planData.length} æ¡ç”Ÿäº§è®¡åˆ’è®°å½•\nè®¡åˆ’å·²æ›´æ–°ï¼Œå¯å‰å¾€ç”Ÿäº§è®¡åˆ’æ¨¡å—æŸ¥çœ‹`);
            } catch (error) {
              console.error('è§£æç”Ÿäº§è®¡åˆ’è¡¨é”™è¯¯:', error);
              alert('è§£æå¤±è´¥ï¼š' + error.message);
            }
            event.target.value = '';
          };
          reader.readAsArrayBuffer(file);
        },
        // å·¥å•é…æ–™ï¼šè§¦å‘BOMè¡¨ä¸Šä¼ 
        triggerBomFileUpload() {
          if (this.$refs.bomFileInput) {
            this.$refs.bomFileInput.click();
          }
        },
        // å·¥å•é…æ–™ï¼šå¤„ç†BOMè¡¨ä¸Šä¼ 
        handleBomFileUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const firstSheetName = workbook.SheetNames[0];
              const worksheet = workbook.Sheets[firstSheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

              // å­—æ®µæ˜ å°„ï¼ˆå¼ºåˆ¶æ•°æ®ç±»å‹è½¬æ¢å’Œæ ‡å‡†åŒ–ï¼‰
              this.bomData = jsonData.map(row => {
                // æ ‡å‡†åŒ–å­—æ®µæå–ï¼šè½¬ä¸ºå­—ç¬¦ä¸²å¹¶å»é™¤ç©ºæ ¼
                const job = String(row['Job'] || row['å·¥å•å·'] || '').trim();
                const op = String(row['OP'] || row['å·¥åº'] || '').trim();
                
                return {
                  'Job': job,
                  'OP': op,
                  'Component': String(row['Component'] || row['ç‰©æ–™å·'] || '').trim(),
                  'PENDING_LOCATOR': String(row['PENDING_LOCATOR'] || row['åº“ä½'] || '').trim(),
                  'Required': String(row['Required'] || row['æ•°é‡'] || '').trim(),
                  'tool_type': String(row['å™¨å…·'] || row['ToolType'] || row['tool_type'] || row['å™¨å…·ç±»å‹'] || '').trim(),
                  'å¤‡æ³¨': String(row['å®é™…æ•°é‡'] || row['å¤‡æ³¨'] || '').trim()
                };
              }).filter(item => {
                // æ•°æ®æ¸…æ´—ï¼šè¿‡æ»¤æ— æ•ˆè¡Œå’Œè¡¨å¤´è¡Œ
                const job = String(item['Job'] || '').trim();
                const op = String(item['OP'] || '').trim();
                
                // 1. åŸºæœ¬éªŒè¯ï¼šç¡®ä¿å…³é”®å­—æ®µä¸ä¸ºç©º
                if (!job || !op || job === '' || op === '') {
                  return false;
                }
                
                // 2. è¿‡æ»¤è¡¨å¤´è¡Œï¼šç§»é™¤åŒ…å«è¡¨å¤´å…³é”®è¯çš„è¡Œ
                const headerKeywords = ['å·¥å•å·', 'Job', 'JOB', 'JOB', 'å·¥å•', 'è®¢å•å·', 'Order', 'ORDER'];
                const isHeaderRow = headerKeywords.some(keyword => 
                  job.includes(keyword) || op.includes(keyword)
                );
                
                if (isHeaderRow) {
                  return false;
                }
                
                // 3. éªŒè¯ Job æ ¼å¼ï¼šåº”è¯¥åŒ…å«å­—æ¯æˆ–æ•°å­—ï¼Œä¸åº”è¯¥æ˜¯çº¯è¡¨å¤´æ–‡æœ¬
                // å¦‚æœ Job çœ‹èµ·æ¥åƒè¡¨å¤´ï¼ˆå…¨æ˜¯ä¸­æ–‡ä¸”å¾ˆçŸ­ï¼‰ï¼Œä¹Ÿè¿‡æ»¤æ‰
                if (job.length < 3 && /^[\u4e00-\u9fa5]+$/.test(job)) {
                  return false;
                }
                
                return true;
              });
              
              // ä¸´æ—¶è°ƒè¯•ï¼šç›´æ¥è¾“å‡ºå‰3æ¡ BOM çš„ Job å€¼
              if (this.bomData.length > 0) {
                console.log('=== ä¸´æ—¶è°ƒè¯•ï¼šBOM Job å®é™…å€¼ ===');
                this.bomData.slice(0, 3).forEach((b, i) => {
                  console.log(`BOM[${i}]:`, {
                    Job: b['Job'],
                    'Jobç±»å‹': typeof b['Job'],
                    'Jobé•¿åº¦': String(b['Job'] || '').length,
                    'Jobå€¼(JSON)': JSON.stringify(b['Job'])
                  });
                });
              }

              this.performMatching();
              alert(`æˆåŠŸåŠ è½½ ${this.bomData.length} æ¡BOMè®°å½•`);
            } catch (error) {
              console.error('è§£æBOMè¡¨é”™è¯¯:', error);
              alert('è§£æå¤±è´¥ï¼š' + error.message);
            }
            event.target.value = '';
          };
          reader.readAsArrayBuffer(file);
        },
        // å·¥å•é…æ–™ï¼šæ‰§è¡ŒåŒ¹é…é€»è¾‘
        performMatching() {
          if (this.planData.length === 0 || this.bomData.length === 0) {
            this.matchedWorkOrders = [];
            console.warn('åŒ¹é…å¤±è´¥ï¼šæ•°æ®ä¸ºç©º', {
              planDataLength: this.planData.length,
              bomDataLength: this.bomData.length
            });
            return;
          }

          // è°ƒè¯•ï¼šè¾“å‡ºå‰3æ¡ Plan å’Œ BOM æ•°æ®æ ·æœ¬
          console.log('=== åŒ¹é…è°ƒè¯•ä¿¡æ¯ ===');
          console.log('Plan æ•°æ®æ ·æœ¬ï¼ˆå‰3æ¡ï¼‰ï¼š', this.planData.slice(0, 3).map(p => ({
            work_order: p.work_order,
            'å·¥å•å·': p['å·¥å•å·'],
            op: p.op,
            'OP': p['OP'],
            'å®Œæ•´å¯¹è±¡': p
          })));
          console.log('BOM æ•°æ®æ ·æœ¬ï¼ˆå‰3æ¡ï¼‰ï¼š', this.bomData.slice(0, 3).map(b => ({
            Job: b['Job'],
            OP: b['OP'],
            'å®Œæ•´å¯¹è±¡': b
          })));

          let matchStats = {
            totalPlans: this.planData.length,
            totalBoms: this.bomData.length,
            matchedPlans: 0,
            unmatchedPlans: [],
            sampleMatches: []
          };

          this.matchedWorkOrders = this.planData.map(plan => {
            // è·å–è®¡åˆ’ä¸­çš„åŠ å·¥åºåˆ—å·ï¼ˆè½¬ä¸ºæ•°å­—ï¼Œç”¨äº ECO åŒ¹é…ï¼‰
            const planSetNumber = Number(plan['åŠ å·¥åºåˆ—å·'] || plan.seq_no || plan.åŠ å·¥åºåˆ—å· || plan['å°å¥—'] || plan.å°å¥— || 0);
            
            // åŒ¹é…BOMæ•°æ®ï¼šå·¥å•å· + OP åŒ¹é…ï¼ˆå¼ºåˆ¶æ•°æ®ç±»å‹è½¬æ¢å’Œæ ‡å‡†åŒ–ï¼‰
            // ä» Plan ä¸­æå–å¹¶æ ‡å‡†åŒ–å­—æ®µï¼ˆplanData ä¸­å·²æ­£ç¡®æ˜ å°„ï¼Œç›´æ¥ä½¿ç”¨ï¼‰
            const planKey = String(plan.work_order || '').trim();
            const planOp = String(plan.op || '').trim();
            
            // å¦‚æœ Plan çš„å…³é”®å­—æ®µä¸ºç©ºï¼Œè¿”å› nullï¼ˆåç»­ä¼šè¢« filter æ‰ï¼‰
            if (!planKey || !planOp || planKey === '' || planOp === '') {
              matchStats.unmatchedPlans.push({
                reason: 'Plan å…³é”®å­—æ®µä¸ºç©º',
                plan: { work_order: plan.work_order, op: plan.op, 'å·¥å•å·': plan['å·¥å•å·'], 'OP': plan['OP'] }
              });
              return null;
            }
            
            const matchedMaterials = this.bomData.filter(bom => {
              // ä» BOM ä¸­æå–å¹¶æ ‡å‡†åŒ–å­—æ®µï¼ˆå¼ºåˆ¶ç±»å‹è½¬æ¢å’Œ trimï¼‰
              const bomKey = String(bom['Job'] || bom.Job || '').trim();
              const bomOp = String(bom['OP'] || bom.OP || '').trim();
              
              // å¦‚æœ BOM çš„å…³é”®å­—æ®µä¸ºç©ºï¼Œè·³è¿‡
              if (!bomKey || !bomOp || bomKey === '' || bomOp === '') {
                return false;
              }
              
              // ä¸¥æ ¼åŒ¹é…ï¼šå·¥å•å·å¿…é¡»å®Œå…¨ç›¸ç­‰ï¼ŒOP å¿…é¡»å®Œå…¨ç›¸ç­‰
              const isMatch = planKey === bomKey && planOp === bomOp;
              
              // è°ƒè¯•ï¼šè®°å½•å‰3ä¸ªåŒ¹é…æ ·æœ¬
              if (isMatch && matchStats.sampleMatches.length < 3) {
                matchStats.sampleMatches.push({
                  planKey,
                  planOp,
                  bomKey,
                  bomOp,
                  match: true
                });
              }
              
              return isMatch;
            }).map(bom => {
              // ä¸ºæ¯ä¸ªç‰©æ–™åŒ¹é… ECOï¼ˆä¸‰é‡åŒ¹é…ï¼šç‰©æ–™ã€å·¥åºã€å°å¥—ï¼‰
              const component = String(bom['Component'] || bom.Component || '').trim();
              const op = String(bom['OP'] || bom.OP || '').trim();
              
              // ä» localStorage è¯»å– ECO æ•°æ®ï¼ˆå®Œå…¨æœ¬åœ°åŒ–ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°æ•°æ®ï¼Œæ— äº‘ä¾èµ–ï¼‰
              let ecoListForMatching = [];
              try {
                const saved = localStorage.getItem('localEcoList');
                if (saved) {
                  const parsed = JSON.parse(saved);
                  if (Array.isArray(parsed)) {
                    ecoListForMatching = parsed;
                  } else {
                    ecoListForMatching = this.ecoList || [];
                  }
                } else {
                  // å¦‚æœ localStorage ä¸ºç©ºï¼Œä½¿ç”¨å½“å‰ ecoListï¼ˆå¯èƒ½æ¥è‡ª mockDataï¼‰
                  ecoListForMatching = this.ecoList || [];
                }
              } catch (e) {
                console.error('è¯»å– localStorage ECO æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨å†…å­˜æ•°æ®:', e);
                ecoListForMatching = this.ecoList || [];
              }
              
              // åŒ¹é… ECOï¼šç‰©æ–™å‘½ä¸­ + å·¥åºå‘½ä¸­ + å°å¥—å‘½ä¸­ï¼ˆæ”¯æŒå¤šæ¡ç›¸åŒ eco_no çš„è®°å½•ï¼‰
              const matchedEcos = ecoListForMatching.filter(eco => {
                // æ¡ä»¶1ï¼šç‰©æ–™å‘½ä¸­ - æ£€æŸ¥ç‰©æ–™å·æ˜¯å¦åœ¨ ECO çš„ materials æ•°ç»„ä¸­
                const ecoMaterials = eco.materials || [];
                const materialMatch = ecoMaterials.some(ecoMat => {
                  const ecoMatStr = String(ecoMat || '').trim();
                  return component && ecoMatStr && component === ecoMatStr;
                });
                
                // å…¼å®¹æ—§ç»“æ„ï¼šå•ç‰©æ–™å·
                const oldMaterialMatch = !materialMatch && ecoMaterials.length === 0 && 
                  component === String(eco['ç‰©æ–™å·'] || eco.ç‰©æ–™å· || '').trim();
                
                if (!materialMatch && !oldMaterialMatch) return false;
                
                // æ¡ä»¶2ï¼šå·¥åºå‘½ä¸­
                const ecoOp = String(eco.op || eco.é€‚ç”¨å·¥åº || '').trim();
                const normalizedOp = op.replace(/^OP/i, ''); // ç§»é™¤ OP å‰ç¼€
                const normalizedEcoOp = ecoOp.replace(/^OP/i, ''); // ç§»é™¤ OP å‰ç¼€
                const processMatch = normalizedOp && normalizedEcoOp && normalizedOp === normalizedEcoOp;
                
                if (!processMatch) return false;
                
                // æ¡ä»¶3ï¼šå°å¥—å‘½ä¸­ - è®¡åˆ’å°å¥— >= ECOèµ·å§‹å°å¥—
                const ecoStartSet = Number(eco.start_set || eco.å°å¥— || 0);
                const setMatch = planSetNumber >= ecoStartSet;
                
                if (!setMatch) return false;
                
                // ä»…åŒ¹é…æœªå®Œæˆæˆ–è¿›è¡Œä¸­çš„ ECOï¼ˆæ’é™¤"å·²å®Œæˆ"å’Œ"å·²è¿‡æœŸ"ï¼‰
                const status = String(eco.status || eco.å˜æ›´çŠ¶æ€ || '').trim();
                const isActive = status && (
                  status === 'æœªå®Œæˆ' || 
                  status === 'è¿›è¡Œä¸­' || 
                  status.includes('æœªå®Œæˆ') || 
                  status.includes('è¿›è¡Œä¸­')
                ) && !status.includes('å·²å®Œæˆ') && !status.includes('å·²è¿‡æœŸ');
                
                return isActive;
              });
              
              // åˆå¹¶å¤šæ¡ ECO è®°å½•çš„ä¿¡æ¯ï¼ˆå¦‚æœåŒä¸€ä¸ªç‰©æ–™å‘½ä¸­äº†å¤šæ¡ ECOï¼‰
              let ecoInfo = null;
              if (matchedEcos.length > 0) {
                // æ”¶é›†æ‰€æœ‰åŒ¹é…çš„ ECO å·ï¼ˆå»é‡ï¼‰
                const ecoNos = [...new Set(matchedEcos.map(eco => eco.eco_no || eco.ECOå· || '').filter(n => n))];
                // åˆå¹¶å˜æ›´è¯¦æƒ…ï¼ˆå»é‡ï¼‰
                const changeDetails = [...new Set(matchedEcos.map(eco => eco.change_details || '').filter(d => d))];
                // è·å–çŠ¶æ€ï¼ˆå–ç¬¬ä¸€ä¸ªï¼‰
                const status = matchedEcos[0].status || matchedEcos[0].å˜æ›´çŠ¶æ€ || '';
                
                ecoInfo = {
                  ecoNo: ecoNos.join(', '), // å¤šä¸ª ECO å·ç”¨é€—å·åˆ†éš”
                  ecoNos: ecoNos, // ä¿ç•™æ•°ç»„å½¢å¼ï¼Œä¾¿äºåç»­ä½¿ç”¨
                  status: status,
                  changeDetails: changeDetails.join(' | '), // å¤šä¸ªå˜æ›´è¯¦æƒ…ç”¨ | åˆ†éš”
                  matchedCount: matchedEcos.length // åŒ¹é…åˆ°çš„ ECO è®°å½•æ•°é‡
                };
              }
              
              // æ·»åŠ  ECO ä¿¡æ¯åˆ°ç‰©æ–™å¯¹è±¡
              return {
                ...bom,
                ecoInfo: ecoInfo
              };
            });

            // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç‰©æ–™åŒ…å« ECO
            const hasEco = matchedMaterials.some(m => m.ecoInfo !== null);

            const result = {
              ...plan,
              materials: matchedMaterials,
              hasEco: hasEco
            };
            
            // ç»Ÿè®¡åŒ¹é…ç»“æœ
            if (matchedMaterials.length > 0) {
              matchStats.matchedPlans++;
            } else {
              matchStats.unmatchedPlans.push({
                reason: 'æœªæ‰¾åˆ°åŒ¹é…çš„ BOM æ•°æ®',
                planKey: planKey,
                planOp: planOp,
                plan: { work_order: plan.work_order, op: plan.op, 'å·¥å•å·': plan['å·¥å•å·'], 'OP': plan['OP'] }
              });
            }
            
            return result;
          }).filter(wo => wo !== null && wo.materials && wo.materials.length > 0);
          
          // è¾“å‡ºåŒ¹é…ç»Ÿè®¡ä¿¡æ¯
          console.log('=== åŒ¹é…ç»Ÿè®¡ ===');
          console.log(`æ€» Plan æ•°ï¼š${matchStats.totalPlans}`);
          console.log(`æ€» BOM æ•°ï¼š${matchStats.totalBoms}`);
          console.log(`æˆåŠŸåŒ¹é…çš„ Plan æ•°ï¼š${matchStats.matchedPlans}`);
          console.log(`æœªåŒ¹é…çš„ Plan æ•°ï¼š${matchStats.unmatchedPlans.length}`);
          if (matchStats.sampleMatches.length > 0) {
            console.log('åŒ¹é…æ ·æœ¬ï¼š', matchStats.sampleMatches);
          }
          if (matchStats.unmatchedPlans.length > 0 && matchStats.unmatchedPlans.length <= 5) {
            console.log('æœªåŒ¹é…çš„ Plan æ ·æœ¬ï¼ˆå‰5ä¸ªï¼‰ï¼š', matchStats.unmatchedPlans.slice(0, 5));
          } else if (matchStats.unmatchedPlans.length > 5) {
            console.log('æœªåŒ¹é…çš„ Plan æ ·æœ¬ï¼ˆå‰5ä¸ªï¼‰ï¼š', matchStats.unmatchedPlans.slice(0, 5));
            console.log(`... è¿˜æœ‰ ${matchStats.unmatchedPlans.length - 5} ä¸ªæœªåŒ¹é…`);
          }
          
          // å¦‚æœåŒ¹é…ç»“æœä¸º0ï¼Œæ˜¾ç¤ºè¯¦ç»†è°ƒè¯•ä¿¡æ¯å’Œå‹å¥½çš„é”™è¯¯æç¤º
          if (this.matchedWorkOrders.length === 0) {
            console.error('âš ï¸ åŒ¹é…å¤±è´¥ï¼šæœªæ‰¾åˆ°ä»»ä½•åŒ¹é…çš„å·¥å•');
            console.log('è¯·æ£€æŸ¥ï¼š');
            console.log('1. Plan æ•°æ®ä¸­çš„å·¥å•å·å’Œ OP å­—æ®µå€¼');
            console.log('2. BOM æ•°æ®ä¸­çš„ Job å’Œ OP å­—æ®µå€¼');
            console.log('3. å­—æ®µå€¼æ˜¯å¦å®Œå…¨ä¸€è‡´ï¼ˆåŒ…æ‹¬å¤§å°å†™ã€ç©ºæ ¼ç­‰ï¼‰');
            
            // å°è¯•æ‰¾å‡ºå¯èƒ½çš„åŒ¹é…é—®é¢˜
            const planKeys = new Set(this.planData.map(p => {
              const key = String(p.work_order || p['å·¥å•å·'] || '').trim();
              return key;
            }).filter(k => k && k !== ''));
            const bomKeys = new Set(this.bomData.map(b => {
              const key = String(b['Job'] || b.Job || '').trim();
              return key;
            }).filter(k => k && k !== ''));
            const planOps = new Set(this.planData.map(p => {
              const op = String(p.op || p['OP'] || '').trim();
              return op;
            }).filter(o => o && o !== ''));
            const bomOps = new Set(this.bomData.map(b => {
              const op = String(b['OP'] || b.OP || '').trim();
              return op;
            }).filter(o => o && o !== ''));
            
            console.log('Plan ä¸­çš„å·¥å•å·æ ·æœ¬ï¼ˆå‰10ä¸ªï¼‰ï¼š', Array.from(planKeys).slice(0, 10));
            console.log('BOM ä¸­çš„ Job æ ·æœ¬ï¼ˆå‰10ä¸ªï¼‰ï¼š', Array.from(bomKeys).slice(0, 10));
            console.log('Plan ä¸­çš„ OP æ ·æœ¬ï¼ˆå‰10ä¸ªï¼‰ï¼š', Array.from(planOps).slice(0, 10));
            console.log('BOM ä¸­çš„ OP æ ·æœ¬ï¼ˆå‰10ä¸ªï¼‰ï¼š', Array.from(bomOps).slice(0, 10));
            
            // è¯¦ç»†å¯¹æ¯”ï¼šæ˜¾ç¤ºå‰3æ¡ Plan å’Œ BOM çš„å®é™…å€¼
            console.log('=== è¯¦ç»†å¯¹æ¯”ï¼ˆå‰3æ¡ï¼‰ ===');
            console.log('Plan å‰3æ¡å·¥å•å·ï¼š', this.planData.slice(0, 3).map(p => ({
              work_order: p.work_order,
              'å·¥å•å·': p['å·¥å•å·'],
              'ç±»å‹': typeof p.work_order,
              'é•¿åº¦': String(p.work_order || p['å·¥å•å·'] || '').length
            })));
            console.log('BOM å‰3æ¡ Jobï¼š', this.bomData.slice(0, 3).map(b => ({
              Job: b['Job'],
              'ç±»å‹': typeof b['Job'],
              'é•¿åº¦': String(b['Job'] || '').length
            })));
            
            // æ£€æŸ¥æ˜¯å¦æœ‰äº¤é›†
            const commonKeys = [...planKeys].filter(k => bomKeys.has(k));
            const commonOps = [...planOps].filter(o => bomOps.has(o));
            console.log(`å·¥å•å·äº¤é›†æ•°é‡ï¼š${commonKeys.length}ï¼ˆå¦‚æœä¸º0ï¼Œè¯´æ˜å·¥å•å·å®Œå…¨ä¸åŒ¹é…ï¼‰`);
            console.log(`OP äº¤é›†æ•°é‡ï¼š${commonOps.length}ï¼ˆå¦‚æœä¸º0ï¼Œè¯´æ˜ OP å®Œå…¨ä¸åŒ¹é…ï¼‰`);
            
            // è·å–æ ·æœ¬å·¥å•å·ç”¨äºæç¤º
            const planSample = Array.from(planKeys).slice(0, 3).join('ã€') || 'æ— ';
            const bomSample = Array.from(bomKeys).slice(0, 3).join('ã€') || 'æ— ';
            
            // å‹å¥½çš„é”™è¯¯æç¤º
            let errorMessage = 'åŒ¹é…å¤±è´¥ï¼šæœªæ‰¾åˆ°ä»»ä½•åŒ¹é…çš„å·¥å•ã€‚\n\n';
            if (commonKeys.length === 0) {
              errorMessage += `ç”Ÿäº§è®¡åˆ’ä¸­çš„å·¥å•å·ï¼ˆå¦‚ ${planSample}ï¼‰ä¸ BOM è¡¨ä¸­çš„å·¥å•å·ï¼ˆå¦‚ ${bomSample}ï¼‰å®Œå…¨ä¸ä¸€è‡´ã€‚\n\n`;
              errorMessage += 'è¯·æ£€æŸ¥æ˜¯å¦ä¸Šä¼ äº†æ—¥æœŸå¯¹åº”çš„æ–‡ä»¶ã€‚';
            } else if (commonOps.length === 0) {
              errorMessage += `å·¥å•å·æœ‰äº¤é›†ï¼Œä½† OP å­—æ®µå®Œå…¨ä¸åŒ¹é…ã€‚\n\n`;
              errorMessage += 'è¯·æ£€æŸ¥ç”Ÿäº§è®¡åˆ’å’Œ BOM è¡¨ä¸­çš„å·¥åºï¼ˆOPï¼‰å­—æ®µæ˜¯å¦ä¸€è‡´ã€‚';
            } else {
              errorMessage += `å·¥å•å·å’Œ OP éƒ½æœ‰äº¤é›†ï¼Œä½†ç»„åˆåŒ¹é…å¤±è´¥ã€‚\n\n`;
              errorMessage += 'è¯·æ£€æŸ¥ï¼šåŒä¸€å·¥å•å·åœ¨ä¸åŒè¡¨ä¸­çš„ OP æ˜¯å¦ä¸€è‡´ã€‚';
            }
            
            // å»¶è¿Ÿæ˜¾ç¤º alertï¼Œé¿å…é˜»å¡æ§åˆ¶å°è¾“å‡º
            setTimeout(() => {
              alert(errorMessage);
            }, 100);
          }

          // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå·¥å•
          if (this.matchedWorkOrders.length > 0) {
            // é‡ç½®é€‰ä¸­ç´¢å¼•ä¸ºç¬¬ä¸€ä¸ªï¼ˆåç»­ç”±è®¡ç®—å±æ€§ç»Ÿä¸€æ’åº/ç­›é€‰ï¼‰
            this.selectedWorkOrderIndex = 0;
          } else {
            this.selectedWorkOrderIndex = -1;
          }
        },
        // å·¥å•é…æ–™ï¼šé€‰æ‹©å·¥å•
        selectWorkOrder(index) {
          if (index >= 0 && index < this.matchedWorkOrders.length) {
            this.selectedWorkOrderIndex = index;
            // ç¡®ä¿ materials å±æ€§å­˜åœ¨
            const workOrder = this.matchedWorkOrders[index];
            if (workOrder && !workOrder.materials) {
              workOrder.materials = [];
            }
          }
        },
        // å·¥å•é…æ–™ï¼šæ‰“å°
        printWorkOrder() {
          const now = new Date();
          this.printTime = now
            .toLocaleString('zh-CN', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit',
              hour12: false
            })
            .replace(/\//g, '-');

          // ç¡®ä¿æ‰“å°æ—¶é—´å·²ç»æ¸²æŸ“åå†è§¦å‘æ‰“å°
          this.$nextTick(() => {
            window.print();
          });
        },
        // å·¥å•é…æ–™ï¼šåŠ è½½æ¨¡æ‹Ÿæ•°æ®
        loadMockData() {
          // æ¨¡æ‹Ÿç”Ÿäº§è®¡åˆ’æ•°æ®
          this.planData = [
            {
              'ä½¿ç”¨æ—¥æœŸ': '2024-01-15',
              'å·¥å•å·': 'G463922442',
              'OP': '220',
              'äº§å“æè¿°': 'HAL-X NC1',
              'å°å¥—': '1'
            }
          ];

          // æ¨¡æ‹ŸBOMæ•°æ®
          this.bomData = [
            { 'Job': 'G463922442', 'OP': '220', 'Component': '151X1249KA08NP17', 'PENDING_LOCATOR': 'W6.4.2', 'Required': '1', 'å¤‡æ³¨': '' },
            { 'Job': 'G463922442', 'OP': '220', 'Component': '151X1249KA08NP18', 'PENDING_LOCATOR': 'W6.4.3', 'Required': '2', 'å¤‡æ³¨': '' },
            { 'Job': 'G463922442', 'OP': '220', 'Component': '151X1249KA08NP19', 'PENDING_LOCATOR': 'W7.4.1', 'Required': '1', 'å¤‡æ³¨': '' }
          ];

          this.performMatching();
          if (this.matchedWorkOrders.length > 0) {
            this.selectedWorkOrderIndex = 0;
          }
        },
        // åˆå§‹åŒ–BIå›¾è¡¨
        initBICharts() {
          if (typeof echarts === 'undefined') {
            console.error('ECharts æœªåŠ è½½');
            return;
          }
          
          // å›¾è¡¨1ï¼šäº§é‡ä¸ç¼ºé™·ç‡è¶‹åŠ¿å›¾ï¼ˆåŒè½´å›¾ï¼‰
          const chart1El = this.$refs.chart1;
          if (chart1El && !this.chartInstances.chart1) {
            this.chartInstances.chart1 = echarts.init(chart1El);
            const option1 = {
              tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'cross' }
              },
              legend: {
                data: ['äº§é‡', 'DPMO'],
                top: 10
              },
              grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
              },
              xAxis: {
                type: 'category',
                data: this.biData.productionDefectTrend.months,
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              yAxis: [
                {
                  type: 'value',
                  name: 'äº§é‡',
                  position: 'left',
                  axisLine: { lineStyle: { color: '#2563eb' } },
                  axisLabel: { formatter: '{value}' }
                },
                {
                  type: 'value',
                  name: 'DPMO',
                  position: 'right',
                  axisLine: { lineStyle: { color: '#f97316' } },
                  axisLabel: { formatter: '{value}' }
                }
              ],
              series: [
                {
                  name: 'äº§é‡',
                  type: 'bar',
                  data: this.biData.productionDefectTrend.production,
                  itemStyle: { color: '#2563eb', borderRadius: [4, 4, 0, 0] },
                  barWidth: '50%'
                },
                {
                  name: 'DPMO',
                  type: 'line',
                  yAxisIndex: 1,
                  data: this.biData.productionDefectTrend.dmpo,
                  lineStyle: { color: '#f97316', width: 3 },
                  itemStyle: { color: '#f97316' },
                  smooth: true
                }
              ]
            };
            this.chartInstances.chart1.setOption(option1);
          }

          // å›¾è¡¨2ï¼šæ”¶å‘è´§ç¼ºé™·åˆ†å¸ƒï¼ˆå †å æŸ±çŠ¶å›¾ï¼‰
          const chart2El = this.$refs.chart2;
          if (chart2El && !this.chartInstances.chart2) {
            this.chartInstances.chart2 = echarts.init(chart2El);
            const option2 = {
              tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'shadow' }
              },
              legend: {
                data: this.biData.defectDistribution.series.map(s => s.name),
                top: 10
              },
              grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
              },
              xAxis: {
                type: 'category',
                data: this.biData.defectDistribution.categories,
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              yAxis: {
                type: 'value',
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              series: this.biData.defectDistribution.series.map((s, idx) => {
                const colors = ['#2563eb', '#f97316', '#06b6d4', '#10b981', '#8b5cf6'];
                return {
                  name: s.name,
                  type: 'bar',
                  stack: 'defect',
                  data: s.data,
                  itemStyle: { color: colors[idx % colors.length], borderRadius: [0, 0, 0, 0] }
                };
              })
            };
            this.chartInstances.chart2.setOption(option2);
          }

          // å›¾è¡¨3ï¼šæ”¶å‘è´§åŠæ—¶æ€§å¯¹æ¯”ï¼ˆæŠ˜çº¿å›¾ï¼‰
          const chart3El = this.$refs.chart3;
          if (chart3El && !this.chartInstances.chart3) {
            this.chartInstances.chart3 = echarts.init(chart3El);
            const option3 = {
              tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'cross' }
              },
              legend: {
                data: ['åˆ°è´§é‡', 'æ”¶è´§é‡'],
                top: 10
              },
              grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
              },
              xAxis: {
                type: 'category',
                data: this.biData.receivingShippingTimeliness.dates,
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              yAxis: {
                type: 'value',
                axisLine: { lineStyle: { color: '#e0e0e0' } }
              },
              series: [
                {
                  name: 'åˆ°è´§é‡',
                  type: 'line',
                  data: this.biData.receivingShippingTimeliness.receiving,
                  lineStyle: { color: '#2563eb', width: 3 },
                  itemStyle: { color: '#2563eb' },
                  smooth: true,
                  areaStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: 'rgba(37, 99, 235, 0.3)' }, { offset: 1, color: 'rgba(37, 99, 235, 0.05)' }] } }
                },
                {
                  name: 'æ”¶è´§é‡',
                  type: 'line',
                  data: this.biData.receivingShippingTimeliness.shipping,
                  lineStyle: { color: '#f97316', width: 3 },
                  itemStyle: { color: '#f97316' },
                  smooth: true,
                  areaStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: 'rgba(249, 115, 22, 0.3)' }, { offset: 1, color: 'rgba(249, 115, 22, 0.05)' }] } }
                }
              ]
            };
            this.chartInstances.chart3.setOption(option3);
          }

          // å›¾è¡¨4ï¼šä¾›åº”å•†é—®é¢˜åˆ†å¸ƒï¼ˆé¥¼å›¾ï¼‰
          const chart4El = this.$refs.chart4;
          if (chart4El && !this.chartInstances.chart4) {
            this.chartInstances.chart4 = echarts.init(chart4El);
            const option4 = {
              tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b}: {c}% ({d}%)'
              },
              legend: {
                orient: 'vertical',
                left: 'left',
                top: 'middle',
                data: this.biData.supplierIssueDistribution.map(item => item.name)
              },
              series: [
                {
                  name: 'ä¾›åº”å•†é—®é¢˜',
                  type: 'pie',
                  radius: ['40%', '70%'],
                  center: ['60%', '50%'],
                  avoidLabelOverlap: false,
                  itemStyle: {
                    borderRadius: 8,
                    borderColor: '#fff',
                    borderWidth: 2
                  },
                  label: {
                    show: true,
                    formatter: '{b}: {c}%'
                  },
                  emphasis: {
                    label: {
                      show: true,
                      fontSize: 16,
                      fontWeight: 'bold'
                    }
                  },
                  data: this.biData.supplierIssueDistribution.map(item => ({
                    value: item.value,
                    name: item.name,
                    itemStyle: {
                      color: item.name === 'ç³»ç»Ÿé—®é¢˜' ? '#2563eb' : item.name === 'å•æ®é—®é¢˜' ? '#f97316' : '#06b6d4'
                    }
                  }))
                }
              ]
            };
            this.chartInstances.chart4.setOption(option4);
          }

          // å“åº”å¼è°ƒæ•´
          window.addEventListener('resize', () => {
            Object.values(this.chartInstances).forEach(chart => {
              if (chart) {
                chart.resize();
              }
            });
          });
        }
      }
    });

    // æŒ‚è½½ Vue å®ä¾‹ï¼ˆæ·»åŠ é”™è¯¯æ•è·å’Œè°ƒè¯•ä¿¡æ¯ï¼‰
    console.log('=== å‡†å¤‡æŒ‚è½½ Vue å®ä¾‹ ===');
    console.log('app å¯¹è±¡:', app);
    console.log('#app å…ƒç´ æ˜¯å¦å­˜åœ¨:', document.getElementById('app') !== null);
    
    try {
      const mountResult = app.mount('#app');
      console.log('âœ… Vue å®ä¾‹æŒ‚è½½æˆåŠŸï¼', mountResult);
    } catch (error) {
      console.error('âŒ Vue æŒ‚è½½å¤±è´¥ï¼', error);
      console.error('é”™è¯¯è¯¦æƒ…:', error.message);
      console.error('é”™è¯¯å †æ ˆ:', error.stack);
      alert('Vue æŒ‚è½½å¤±è´¥ï¼š' + error.message + '\n\nè¯·æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯');
    }
  </script>
</body>
</html>
